"use strict";var Vd=Object.defineProperty;var il=n=>{throw TypeError(n)};var Qd=(n,e,t)=>e in n?Vd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>Qd(n,typeof e!="symbol"?e+"":e,t),_i=(n,e,t)=>e.has(n)||il("Cannot "+t);var w=(n,e,t)=>(_i(n,e,"read from private field"),t?t.call(n):e.get(n)),xe=(n,e,t)=>e.has(n)?il("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),fe=(n,e,t,s)=>(_i(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),it=(n,e,t)=>(_i(n,e,"access private method"),t);const wo=require("siyuan");function Xd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zd=zc;function zc(n,e,t){n instanceof RegExp&&(n=ol(n,t)),e instanceof RegExp&&(e=ol(e,t));var s=$c(n,e,t);return s&&{start:s[0],end:s[1],pre:t.slice(0,s[0]),body:t.slice(s[0]+n.length,s[1]),post:t.slice(s[1]+e.length)}}function ol(n,e){var t=e.match(n);return t?t[0]:null}zc.range=$c;function $c(n,e,t){var s,r,a,i,l,c=t.indexOf(n),u=t.indexOf(e,c+1),d=c;if(c>=0&&u>0){if(n===e)return[c,u];for(s=[],a=t.length;d>=0&&!l;)d==c?(s.push(d),c=t.indexOf(n,d+1)):s.length==1?l=[s.pop(),u]:(r=s.pop(),r<a&&(a=r,i=u),u=t.indexOf(e,d+1)),d=c<u&&c>=0?c:u;s.length&&(l=[a,i])}return l}var Yc=Zd,Jd=sh,Wc="\0SLASH"+Math.random()+"\0",jc="\0OPEN"+Math.random()+"\0",To="\0CLOSE"+Math.random()+"\0",Hc="\0COMMA"+Math.random()+"\0",Gc="\0PERIOD"+Math.random()+"\0";function wi(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function eh(n){return n.split("\\\\").join(Wc).split("\\{").join(jc).split("\\}").join(To).split("\\,").join(Hc).split("\\.").join(Gc)}function th(n){return n.split(Wc).join("\\").split(jc).join("{").split(To).join("}").split(Hc).join(",").split(Gc).join(".")}function Kc(n){if(!n)return[""];var e=[],t=Yc("{","}",n);if(!t)return n.split(",");var s=t.pre,r=t.body,a=t.post,i=s.split(",");i[i.length-1]+="{"+r+"}";var l=Kc(a);return a.length&&(i[i.length-1]+=l.shift(),i.push.apply(i,l)),e.push.apply(e,i),e}function sh(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),jr(eh(n),!0).map(th)):[]}function nh(n){return"{"+n+"}"}function rh(n){return/^-?0\d/.test(n)}function ah(n,e){return n<=e}function ih(n,e){return n>=e}function jr(n,e){var t=[],s=Yc("{","}",n);if(!s)return[n];var r=s.pre,a=s.post.length?jr(s.post,!1):[""];if(/\$$/.test(s.pre))for(var i=0;i<a.length;i++){var l=r+"{"+s.body+"}"+a[i];t.push(l)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=c||u,f=s.body.indexOf(",")>=0;if(!d&&!f)return s.post.match(/,(?!,).*\}/)?(n=s.pre+"{"+s.body+To+s.post,jr(n)):[n];var g;if(d)g=s.body.split(/\.\./);else if(g=Kc(s.body),g.length===1&&(g=jr(g[0],!1).map(nh),g.length===1))return a.map(function(X){return s.pre+g[0]+X});var y;if(d){var _=wi(g[0]),m=wi(g[1]),p=Math.max(g[0].length,g[1].length),k=g.length==3?Math.abs(wi(g[2])):1,S=ah,D=m<_;D&&(k*=-1,S=ih);var E=g.some(rh);y=[];for(var R=_;S(R,m);R+=k){var P;if(u)P=String.fromCharCode(R),P==="\\"&&(P="");else if(P=String(R),E){var L=p-P.length;if(L>0){var H=new Array(L+1).join("0");R<0?P="-"+H+P.slice(1):P=H+P}}y.push(P)}}else{y=[];for(var Y=0;Y<g.length;Y++)y.push.apply(y,jr(g[Y],!1))}for(var Y=0;Y<y.length;Y++)for(var i=0;i<a.length;i++){var l=r+y[Y]+a[i];(!e||d||l)&&t.push(l)}}return t}const oh=Xd(Jd),lh=1024*64,za=n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>lh)throw new TypeError("pattern is too long")},ch={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Wr=n=>n.replace(/[[\]\\-]/g,"\\$&"),uh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ll=n=>n.join(""),dh=(n,e)=>{const t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],r=[];let a=t+1,i=!1,l=!1,c=!1,u=!1,d=t,f="";e:for(;a<n.length;){const m=n.charAt(a);if((m==="!"||m==="^")&&a===t+1){u=!0,a++;continue}if(m==="]"&&i&&!c){d=a+1;break}if(i=!0,m==="\\"&&!c){c=!0,a++;continue}if(m==="["&&!c){for(const[p,[k,S,D]]of Object.entries(ch))if(n.startsWith(p,a)){if(f)return["$.",!1,n.length-t,!0];a+=p.length,D?r.push(k):s.push(k),l=l||S;continue e}}if(c=!1,f){m>f?s.push(Wr(f)+"-"+Wr(m)):m===f&&s.push(Wr(m)),f="",a++;continue}if(n.startsWith("-]",a+1)){s.push(Wr(m+"-")),a+=2;continue}if(n.startsWith("-",a+1)){f=m,a+=2;continue}s.push(Wr(m)),a++}if(d<a)return["",!1,0,!1];if(!s.length&&!r.length)return["$.",!1,n.length-t,!0];if(r.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u){const m=s[0].length===2?s[0].slice(-1):s[0];return[uh(m),!1,d-t,!1]}const g="["+(u?"^":"")+ll(s)+"]",y="["+(u?"":"^")+ll(r)+"]";return[s.length&&r.length?"("+g+"|"+y+")":s.length?g:y,l,d-t,!0]},Hr=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),hh=new Set(["!","?","+","*","@"]),cl=n=>hh.has(n),fh="(?!(?:^|/)\\.\\.?(?:$|/))",xa="(?!\\.)",vh=new Set(["[","."]),gh=new Set(["..","."]),ph=new Set("().*{}+?[]^$\\!"),mh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),xo="[^/]",ul=xo+"*?",dl=xo+"+?";var At,Mt,Zs,ot,kt,kn,jn,_n,Bs,Hn,ca,or,Vc,On,Na,zi,Qc;const Qt=class Qt{constructor(e,t,s={}){xe(this,or);b(this,"type");xe(this,At);xe(this,Mt);xe(this,Zs,!1);xe(this,ot,[]);xe(this,kt);xe(this,kn);xe(this,jn);xe(this,_n,!1);xe(this,Bs);xe(this,Hn);xe(this,ca,!1);this.type=e,e&&fe(this,Mt,!0),fe(this,kt,t),fe(this,At,w(this,kt)?w(w(this,kt),At):this),fe(this,Bs,w(this,At)===this?s:w(w(this,At),Bs)),fe(this,jn,w(this,At)===this?[]:w(w(this,At),jn)),e==="!"&&!w(w(this,At),_n)&&w(this,jn).push(this),fe(this,kn,w(this,kt)?w(w(this,kt),ot).length:0)}get hasMagic(){if(w(this,Mt)!==void 0)return w(this,Mt);for(const e of w(this,ot))if(typeof e!="string"&&(e.type||e.hasMagic))return fe(this,Mt,!0);return w(this,Mt)}toString(){return w(this,Hn)!==void 0?w(this,Hn):this.type?fe(this,Hn,this.type+"("+w(this,ot).map(e=>String(e)).join("|")+")"):fe(this,Hn,w(this,ot).map(e=>String(e)).join(""))}push(...e){for(const t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof Qt&&w(t,kt)===this))throw new Error("invalid part: "+t);w(this,ot).push(t)}}toJSON(){var t;const e=this.type===null?w(this,ot).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...w(this,ot).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===w(this,At)||w(w(this,At),_n)&&((t=w(this,kt))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(w(this,At)===this)return!0;if(!((t=w(this,kt))!=null&&t.isStart()))return!1;if(w(this,kn)===0)return!0;const e=w(this,kt);for(let s=0;s<w(this,kn);s++){const r=w(e,ot)[s];if(!(r instanceof Qt&&r.type==="!"))return!1}return!0}isEnd(){var t,s,r;if(w(this,At)===this||((t=w(this,kt))==null?void 0:t.type)==="!")return!0;if(!((s=w(this,kt))!=null&&s.isEnd()))return!1;if(!this.type)return(r=w(this,kt))==null?void 0:r.isEnd();const e=w(this,kt)?w(w(this,kt),ot).length:0;return w(this,kn)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Qt(this.type,e);for(const s of w(this,ot))t.copyIn(s);return t}static fromGlob(e,t={}){var r;const s=new Qt(null,void 0,t);return it(r=Qt,On,Na).call(r,e,s,0,t),s}toMMPattern(){if(this!==w(this,At))return w(this,At).toMMPattern();const e=this.toString(),[t,s,r,a]=this.toRegExpSource();if(!(r||w(this,Mt)||w(this,Bs).nocase&&!w(this,Bs).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const l=(w(this,Bs).nocase?"i":"")+(a?"u":"");return Object.assign(new RegExp(`^${t}$`,l),{_src:t,_glob:e})}get options(){return w(this,Bs)}toRegExpSource(e){var c;const t=e??!!w(this,Bs).dot;if(w(this,At)===this&&it(this,or,Vc).call(this),!this.type){const u=this.isStart()&&this.isEnd(),d=w(this,ot).map(_=>{var D;const[m,p,k,S]=typeof _=="string"?it(D=Qt,On,Qc).call(D,_,w(this,Mt),u):_.toRegExpSource(e);return fe(this,Mt,w(this,Mt)||k),fe(this,Zs,w(this,Zs)||S),m}).join("");let f="";if(this.isStart()&&typeof w(this,ot)[0]=="string"&&!(w(this,ot).length===1&&gh.has(w(this,ot)[0]))){const m=vh,p=t&&m.has(d.charAt(0))||d.startsWith("\\.")&&m.has(d.charAt(2))||d.startsWith("\\.\\.")&&m.has(d.charAt(4)),k=!t&&!e&&m.has(d.charAt(0));f=p?fh:k?xa:""}let g="";return this.isEnd()&&w(w(this,At),_n)&&((c=w(this,kt))==null?void 0:c.type)==="!"&&(g="(?:$|\\/)"),[f+d+g,Hr(d),fe(this,Mt,!!w(this,Mt)),w(this,Zs)]}const s=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:";let a=it(this,or,zi).call(this,t);if(this.isStart()&&this.isEnd()&&!a&&this.type!=="!"){const u=this.toString();return fe(this,ot,[u]),this.type=null,fe(this,Mt,void 0),[u,Hr(this.toString()),!1,!1]}let i=!s||e||t||!xa?"":it(this,or,zi).call(this,!0);i===a&&(i=""),i&&(a=`(?:${a})(?:${i})*?`);let l="";if(this.type==="!"&&w(this,ca))l=(this.isStart()&&!t?xa:"")+dl;else{const u=this.type==="!"?"))"+(this.isStart()&&!t&&!e?xa:"")+ul+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;l=r+a+u}return[l,Hr(a),fe(this,Mt,!!w(this,Mt)),w(this,Zs)]}};At=new WeakMap,Mt=new WeakMap,Zs=new WeakMap,ot=new WeakMap,kt=new WeakMap,kn=new WeakMap,jn=new WeakMap,_n=new WeakMap,Bs=new WeakMap,Hn=new WeakMap,ca=new WeakMap,or=new WeakSet,Vc=function(){if(this!==w(this,At))throw new Error("should only call on root");if(w(this,_n))return this;this.toString(),fe(this,_n,!0);let e;for(;e=w(this,jn).pop();){if(e.type!=="!")continue;let t=e,s=w(t,kt);for(;s;){for(let r=w(t,kn)+1;!s.type&&r<w(s,ot).length;r++)for(const a of w(e,ot)){if(typeof a=="string")throw new Error("string part in extglob AST??");a.copyIn(w(s,ot)[r])}t=s,s=w(t,kt)}}return this},On=new WeakSet,Na=function(e,t,s,r){var y,_;let a=!1,i=!1,l=-1,c=!1;if(t.type===null){let m=s,p="";for(;m<e.length;){const k=e.charAt(m++);if(a||k==="\\"){a=!a,p+=k;continue}if(i){m===l+1?(k==="^"||k==="!")&&(c=!0):k==="]"&&!(m===l+2&&c)&&(i=!1),p+=k;continue}else if(k==="["){i=!0,l=m,c=!1,p+=k;continue}if(!r.noext&&cl(k)&&e.charAt(m)==="("){t.push(p),p="";const S=new Qt(k,t);m=it(y=Qt,On,Na).call(y,e,S,m,r),t.push(S);continue}p+=k}return t.push(p),m}let u=s+1,d=new Qt(null,t);const f=[];let g="";for(;u<e.length;){const m=e.charAt(u++);if(a||m==="\\"){a=!a,g+=m;continue}if(i){u===l+1?(m==="^"||m==="!")&&(c=!0):m==="]"&&!(u===l+2&&c)&&(i=!1),g+=m;continue}else if(m==="["){i=!0,l=u,c=!1,g+=m;continue}if(cl(m)&&e.charAt(u)==="("){d.push(g),g="";const p=new Qt(m,d);d.push(p),u=it(_=Qt,On,Na).call(_,e,p,u,r);continue}if(m==="|"){d.push(g),g="",f.push(d),d=new Qt(null,t);continue}if(m===")")return g===""&&w(t,ot).length===0&&fe(t,ca,!0),d.push(g),g="",t.push(...f,d),u;g+=m}return t.type=null,fe(t,Mt,void 0),fe(t,ot,[e.substring(s-1)]),u},zi=function(e){return w(this,ot).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,r,a,i]=t.toRegExpSource(e);return fe(this,Zs,w(this,Zs)||i),s}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")},Qc=function(e,t,s=!1){let r=!1,a="",i=!1;for(let l=0;l<e.length;l++){const c=e.charAt(l);if(r){r=!1,a+=(ph.has(c)?"\\":"")+c;continue}if(c==="\\"){l===e.length-1?a+="\\\\":r=!0;continue}if(c==="["){const[u,d,f,g]=dh(e,l);if(f){a+=u,i=i||d,l+=f-1,t=t||g;continue}}if(c==="*"){s&&e==="*"?a+=dl:a+=ul,t=!0;continue}if(c==="?"){a+=xo,t=!0;continue}a+=mh(c)}return[a,Hr(e),!!t,i]},xe(Qt,On);let $a=Qt;const yh=(n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&"),es=(n,e,t={})=>(za(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Cr(e,t).match(n)),bh=/^\*+([^+@!?\*\[\(]*)$/,kh=n=>e=>!e.startsWith(".")&&e.endsWith(n),_h=n=>e=>e.endsWith(n),wh=n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),Th=n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),xh=/^\*+\.\*+$/,Sh=n=>!n.startsWith(".")&&n.includes("."),Dh=n=>n!=="."&&n!==".."&&n.includes("."),Eh=/^\.\*+$/,Ah=n=>n!=="."&&n!==".."&&n.startsWith("."),Ch=/^\*+$/,Ih=n=>n.length!==0&&!n.startsWith("."),Mh=n=>n.length!==0&&n!=="."&&n!=="..",Oh=/^\?+([^+@!?\*\[\(]*)?$/,Rh=([n,e=""])=>{const t=Xc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Nh=([n,e=""])=>{const t=Zc([n]);return e?(e=e.toLowerCase(),s=>t(s)&&s.toLowerCase().endsWith(e)):t},Ph=([n,e=""])=>{const t=Zc([n]);return e?s=>t(s)&&s.endsWith(e):t},Lh=([n,e=""])=>{const t=Xc([n]);return e?s=>t(s)&&s.endsWith(e):t},Xc=([n])=>{const e=n.length;return t=>t.length===e&&!t.startsWith(".")},Zc=([n])=>{const e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},Jc=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",hl={win32:{sep:"\\"},posix:{sep:"/"}},Fh=Jc==="win32"?hl.win32.sep:hl.posix.sep;es.sep=Fh;const bs=Symbol("globstar **");es.GLOBSTAR=bs;const qh="[^/]",Bh=qh+"*?",Uh="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",zh="(?:(?!(?:\\/|^)\\.).)*?",$h=(n,e={})=>t=>es(t,n,e);es.filter=$h;const ys=(n,e={})=>Object.assign({},n,e),Yh=n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return es;const e=es;return Object.assign((s,r,a={})=>e(s,r,ys(n,a)),{Minimatch:class extends e.Minimatch{constructor(r,a={}){super(r,ys(n,a))}static defaults(r){return e.defaults(ys(n,r)).Minimatch}},AST:class extends e.AST{constructor(r,a,i={}){super(r,a,ys(n,i))}static fromGlob(r,a={}){return e.AST.fromGlob(r,ys(n,a))}},unescape:(s,r={})=>e.unescape(s,ys(n,r)),escape:(s,r={})=>e.escape(s,ys(n,r)),filter:(s,r={})=>e.filter(s,ys(n,r)),defaults:s=>e.defaults(ys(n,s)),makeRe:(s,r={})=>e.makeRe(s,ys(n,r)),braceExpand:(s,r={})=>e.braceExpand(s,ys(n,r)),match:(s,r,a={})=>e.match(s,r,ys(n,a)),sep:e.sep,GLOBSTAR:bs})};es.defaults=Yh;const eu=(n,e={})=>(za(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:oh(n));es.braceExpand=eu;const Wh=(n,e={})=>new Cr(n,e).makeRe();es.makeRe=Wh;const jh=(n,e,t={})=>{const s=new Cr(e,t);return n=n.filter(r=>s.match(r)),s.options.nonull&&!n.length&&n.push(e),n};es.match=jh;const fl=/[?*]|[+@!]\(.*?\)|\[|\]/,Hh=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Cr{constructor(e,t={}){b(this,"options");b(this,"set");b(this,"pattern");b(this,"windowsPathsNoEscape");b(this,"nonegate");b(this,"negate");b(this,"comment");b(this,"empty");b(this,"preserveMultipleSlashes");b(this,"partial");b(this,"globSet");b(this,"globParts");b(this,"nocase");b(this,"isWindows");b(this,"platform");b(this,"windowsNoMagicRoot");b(this,"regexp");za(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Jc,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...a)=>console.error(...a)),this.debug(this.pattern,this.globSet);const s=this.globSet.map(a=>this.slashSplit(a));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((a,i,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=a[0]===""&&a[1]===""&&(a[2]==="?"||!fl.test(a[2]))&&!fl.test(a[3]),u=/^[a-z]:/i.test(a[0]);if(c)return[...a.slice(0,4),...a.slice(4).map(d=>this.parse(d))];if(u)return[a[0],...a.slice(1).map(d=>this.parse(d))]}return a.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(a=>a.indexOf(!1)===-1),this.isWindows)for(let a=0;a<this.set.length;a++){const i=this.set[a];i[0]===""&&i[1]===""&&this.globParts[a][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)e[s][r]==="**"&&(e[s][r]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let r=s;for(;t[r+1]==="**";)r++;r!==s&&t.splice(s,r-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,r)=>{const a=s[s.length-1];return r==="**"&&a==="**"?s:r===".."&&a&&a!==".."&&a!=="."&&a!=="**"?(s.pop(),s):(s.push(r),s)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let r=1;r<e.length-1;r++){const a=e[r];r===1&&a===""&&e[0]===""||(a==="."||a==="")&&(t=!0,e.splice(r,1),r--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const r=e[s-1];r&&r!=="."&&r!==".."&&r!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let r=-1;for(;(r=s.indexOf("**",r+1))!==-1;){let i=r;for(;s[i+1]==="**";)i++;i>r&&s.splice(r+1,i-r);let l=s[r+1];const c=s[r+2],u=s[r+3];if(l!==".."||!c||c==="."||c===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(r,1);const d=s.slice(0);d[r]="**",e.push(d),r--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const l=s[i];i===1&&l===""&&s[0]===""||(l==="."||l==="")&&(t=!0,s.splice(i,1),i--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(t=!0,s.pop())}let a=0;for(;(a=s.indexOf("..",a+1))!==-1;){const i=s[a-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const c=a===1&&s[a+1]==="**"?["."]:[];s.splice(a-1,2,...c),s.length===0&&s.push(""),a-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const r=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(r){e[t]=[],e[s]=r;break}}return e.filter(t=>t.length)}partsMatch(e,t,s=!1){let r=0,a=0,i=[],l="";for(;r<e.length&&a<t.length;)if(e[r]===t[a])i.push(l==="b"?t[a]:e[r]),r++,a++;else if(s&&e[r]==="**"&&t[a]===e[r+1])i.push(e[r]),r++;else if(s&&t[a]==="**"&&e[r]===t[a+1])i.push(t[a]),a++;else if(e[r]==="*"&&t[a]&&(this.options.dot||!t[a].startsWith("."))&&t[a]!=="**"){if(l==="b")return!1;l="a",i.push(e[r]),r++,a++}else if(t[a]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(l==="a")return!1;l="b",i.push(t[a]),r++,a++}else return!1;return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t,s=!1){const r=this.options;if(this.isWindows){const m=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),p=!m&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),k=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),S=!k&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),D=p?3:m?0:void 0,E=S?3:k?0:void 0;if(typeof D=="number"&&typeof E=="number"){const[R,P]=[e[D],t[E]];R.toLowerCase()===P.toLowerCase()&&(t[E]=R,E>D?t=t.slice(E):D>E&&(e=e.slice(D)))}}const{optimizationLevel:a=1}=this.options;a>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,l=0,c=e.length,u=t.length;i<c&&l<u;i++,l++){this.debug("matchOne loop");var d=t[l],f=e[i];if(this.debug(t,d,f),d===!1)return!1;if(d===bs){this.debug("GLOBSTAR",[t,d,f]);var g=i,y=l+1;if(y===u){for(this.debug("** at the end");i<c;i++)if(e[i]==="."||e[i]===".."||!r.dot&&e[i].charAt(0)===".")return!1;return!0}for(;g<c;){var _=e[g];if(this.debug(`
globstar while`,e,g,t,y,_),this.matchOne(e.slice(g),t.slice(y),s))return this.debug("globstar found match!",g,c,_),!0;if(_==="."||_===".."||!r.dot&&_.charAt(0)==="."){this.debug("dot detected!",e,g,t,y);break}this.debug("globstar swallow a segment, and continue"),g++}return!!(s&&(this.debug(`
>>> no match, partial?`,e,g,t,y),g===c))}let m;if(typeof d=="string"?(m=f===d,this.debug("string match",d,f,m)):(m=d.test(f),this.debug("pattern match",d,f,m)),!m)return!1}if(i===c&&l===u)return!0;if(i===c)return s;if(l===u)return i===c-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return eu(this.pattern,this.options)}parse(e){za(e);const t=this.options;if(e==="**")return bs;if(e==="")return"";let s,r=null;(s=e.match(Ch))?r=t.dot?Mh:Ih:(s=e.match(bh))?r=(t.nocase?t.dot?Th:wh:t.dot?_h:kh)(s[1]):(s=e.match(Oh))?r=(t.nocase?t.dot?Nh:Rh:t.dot?Ph:Lh)(s):(s=e.match(xh))?r=t.dot?Dh:Sh:(s=e.match(Eh))&&(r=Ah);const a=$a.fromGlob(e,this.options).toMMPattern();return r&&typeof a=="object"&&Reflect.defineProperty(a,"test",{value:r}),a}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?Bh:t.dot?Uh:zh,r=new Set(t.nocase?["i"]:[]);let a=e.map(c=>{const u=c.map(d=>{if(d instanceof RegExp)for(const f of d.flags.split(""))r.add(f);return typeof d=="string"?Hh(d):d===bs?bs:d._src});return u.forEach((d,f)=>{const g=u[f+1],y=u[f-1];d!==bs||y===bs||(y===void 0?g!==void 0&&g!==bs?u[f+1]="(?:\\/|"+s+"\\/)?"+g:u[f]=s:g===void 0?u[f-1]=y+"(?:\\/|"+s+")?":g!==bs&&(u[f-1]=y+"(?:\\/|\\/"+s+"\\/)"+g,u[f+1]=bs))}),u.filter(d=>d!==bs).join("/")}).join("|");const[i,l]=e.length>1?["(?:",")"]:["",""];a="^"+i+a+l+"$",this.negate&&(a="^(?!"+a+").+$");try{this.regexp=new RegExp(a,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const a=this.set;this.debug(this.pattern,"set",a);let i=r[r.length-1];if(!i)for(let l=r.length-2;!i&&l>=0;l--)i=r[l];for(let l=0;l<a.length;l++){const c=a[l];let u=r;if(s.matchBase&&c.length===1&&(u=[i]),this.matchOne(u,c,t))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(e){return es.defaults(e).Minimatch}}es.AST=$a;es.Minimatch=Cr;es.escape=yh;es.unescape=Hr;function Gh(n){const e=[];if((!n.name||n.name.trim().length===0)&&e.push("name: Profile name cannot be empty"),(!n.regexTargets||n.regexTargets.length===0)&&e.push("regexTargets: Must include at least one target"),n.includeRegex)try{new RegExp(n.includeRegex)}catch(t){e.push(`includeRegex: ${t instanceof Error?t.message:String(t)}`)}if(n.excludeRegex)try{new RegExp(n.excludeRegex)}catch(t){e.push(`excludeRegex: ${t instanceof Error?t.message:String(t)}`)}return[...n.includeTags,...n.excludeTags].forEach(t=>{t.startsWith("#")||e.push(`Invalid tag "${t}" - must start with #`)}),{valid:e.length===0,errors:e}}const Kh={id:"default",name:"Default",description:"Include all tasks",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},na={enabled:!1,mode:"all",activeProfileId:"default",profiles:[Kh]};class Vh{constructor(e){b(this,"includePathMatchers",[]);b(this,"excludePathMatchers",[]);b(this,"includeTagsSet",new Set);b(this,"excludeTagsSet",new Set);b(this,"includeRegex");b(this,"excludeRegex");b(this,"regexTargets");if(this.includePathMatchers=e.includePaths.map(t=>new Cr(this.normalizePath(t),{dot:!0,matchBase:!0})),this.excludePathMatchers=e.excludePaths.map(t=>new Cr(this.normalizePath(t),{dot:!0,matchBase:!0})),this.includeTagsSet=new Set(e.includeTags.map(t=>this.normalizeTag(t))),this.excludeTagsSet=new Set(e.excludeTags.map(t=>this.normalizeTag(t))),e.includeRegex)try{this.includeRegex=new RegExp(e.includeRegex)}catch{}if(e.excludeRegex)try{this.excludeRegex=new RegExp(e.excludeRegex)}catch{}this.regexTargets=new Set(e.regexTargets)}matches(e){return this.explain(e).included}explain(e){const t=this.buildContext(e);if(this.excludePathMatchers.length>0&&t.path){for(const s of this.excludePathMatchers)if(s.match(t.path))return{included:!1,reason:"Excluded by path pattern",matchedRule:{type:"excludePath",pattern:s.pattern}}}if(this.includePathMatchers.length>0){if(!t.path)return{included:!1,reason:"includePaths set but task has no path metadata"};let s=!1;for(const r of this.includePathMatchers)if(r.match(t.path)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includePath pattern"}}if(this.excludeTagsSet.size>0&&t.tags.length>0){for(const s of t.tags)if(this.excludeTagsSet.has(s))return{included:!1,reason:"Excluded by tag",matchedRule:{type:"excludeTag",pattern:s}}}if(this.includeTagsSet.size>0){if(t.tags.length===0)return{included:!1,reason:"includeTags set but task has no tags"};let s=!1;for(const r of t.tags)if(this.includeTagsSet.has(r)){s=!0;break}if(!s)return{included:!1,reason:"Did not match any includeTag"}}if(this.excludeRegex){const s=this.extractRegexTargets(e,t);for(const[r,a]of s)if(this.excludeRegex.test(a))return{included:!1,reason:"Excluded by regex",matchedRule:{type:"excludeRegex",pattern:this.excludeRegex.source,target:r}}}if(this.includeRegex){const s=this.extractRegexTargets(e,t);let r=!1;for(const[,a]of s)if(this.includeRegex.test(a)){r=!0;break}if(!r)return{included:!1,reason:"Did not match includeRegex",matchedRule:{type:"includeRegex",pattern:this.includeRegex.source}}}return{included:!0,reason:"Passed all filters"}}buildContext(e){return{path:e.path?this.normalizePath(e.path):void 0,fileName:e.path?this.extractFileName(e.path):void 0,tags:(e.tags||[]).map(t=>this.normalizeTag(t)),taskText:e.name||""}}extractRegexTargets(e,t){const s=[];return this.regexTargets.has("taskText")&&s.push(["taskText",t.taskText]),this.regexTargets.has("path")&&t.path&&s.push(["path",t.path]),this.regexTargets.has("fileName")&&t.fileName&&s.push(["fileName",t.fileName]),s}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\/+/,"")}normalizeTag(e){return e.startsWith("#")?e.toLowerCase():`#${e}`.toLowerCase()}extractFileName(e){return e.split("/").pop()||""}}const Bn=class Bn{constructor(){b(this,"config");b(this,"compiled",null);this.config=na}static getInstance(){return Bn.instance||(Bn.instance=new Bn),Bn.instance}initialize(e){this.updateConfig(e)}updateConfig(e){this.config=e,this.compile()}compile(){if(!this.config.enabled){this.compiled=null;return}const e=this.config.profiles.find(t=>t.id===this.config.activeProfileId)||this.config.profiles[0];if(!e){this.compiled=null;return}this.compiled=new Vh(e)}shouldTreatAsTask(e,t){if(!this.compiled)return!0;const s=this.extractTagsFromContent(e),r={name:e,path:t,tags:s};return this.compiled.matches(r)}shouldIncludeTask(e){return this.compiled?this.compiled.matches(e):!0}explainTask(e){return this.compiled?this.compiled.explain(e):{included:!0,reason:"Global filter disabled"}}extractTagsFromContent(e){return e.match(/#[\w\/-]+/g)||[]}getConfig(){return this.config}getActiveProfile(){return this.config.profiles.find(e=>e.id===this.config.activeProfileId)}setActiveProfile(e){this.config.profiles.some(t=>t.id===e)&&(this.config.activeProfileId=e,this.compile())}reset(){this.updateConfig(na)}};b(Bn,"instance");let vs=Bn;const $i=!1;var So=Array.isArray,Qh=Array.prototype.indexOf,ri=Array.from,Xh=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,tu=Object.getOwnPropertyDescriptors,Zh=Object.prototype,Jh=Array.prototype,Do=Object.getPrototypeOf,vl=Object.isExtensible;function ef(n){for(var e=0;e<n.length;e++)n[e]()}function su(){var n,e,t=new Promise((s,r)=>{n=s,e=r});return{promise:t,resolve:n,reject:e}}function nu(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const s of n)if(t.push(s),t.length===e)break;return t}const zt=2,Ya=4,ai=8,ru=1<<24,ln=16,cn=32,lr=64,Eo=128,Es=512,Ht=1024,ts=2048,un=4096,ps=8192,sn=16384,Ao=32768,Ir=65536,gl=1<<17,au=1<<18,Fr=1<<19,tf=1<<20,en=1<<25,rr=32768,Yi=1<<21,Co=1<<22,An=1<<23,nn=Symbol("$state"),sf=Symbol("legacy props"),nf=Symbol(""),kr=new class extends Error{constructor(){super(...arguments);b(this,"name","StaleReactionError");b(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Io(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function rf(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function af(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function of(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function lf(n){throw new Error("https://svelte.dev/e/effect_orphan")}function cf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function uf(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function df(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function hf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ff(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function vf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const gf=1,pf=2,iu=4,mf=8,yf=16,bf=1,kf=4,_f=8,wf=16,Tf=1,xf=2,qt=Symbol(),Sf="http://www.w3.org/1999/xhtml";function Df(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ef(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ou(n){return n===this.v}function lu(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function cu(n){return!lu(n,this.v)}let Af=!1,Ct=null;function Mr(n){Ct=n}function uu(n){return hu().get(n)}function Cf(n,e){return hu().set(n,e),e}function ht(n,e=!1,t){Ct={p:Ct,i:!1,c:null,e:null,s:n,x:null,l:null}}function ft(n){var e=Ct,t=e.e;if(t!==null){e.e=null;for(var s of t)Mu(s)}return e.i=!0,Ct=e.p,{}}function du(){return!0}function hu(n){return Ct===null&&Io(),Ct.c??(Ct.c=new Map(If(Ct)||void 0))}function If(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let $n=[];function fu(){var n=$n;$n=[],ef(n)}function qr(n){if($n.length===0&&!Xr){var e=$n;queueMicrotask(()=>{e===$n&&fu()})}$n.push(n)}function Mf(){for(;$n.length>0;)fu()}function vu(n){var e=Xe;if(e===null)return qe.f|=An,n;if(e.f&Ao)Or(n,e);else{if(!(e.f&Eo))throw n;e.b.error(n)}}function Or(n,e){for(;e!==null;){if(e.f&Eo)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const Of=-7169;function Nt(n,e){n.f=n.f&Of|e}function Mo(n){n.f&Es||n.deps===null?Nt(n,Ht):Nt(n,un)}function gu(n){if(n!==null)for(const e of n)!(e.f&zt)||!(e.f&rr)||(e.f^=rr,gu(e.deps))}function pu(n,e,t){n.f&ts?e.add(n):n.f&un&&t.add(n),gu(n.deps),Nt(n,Ht)}const Sa=new Set;let Fe=null,Qr=null,Bt=null,xs=[],ii=null,Wi=!1,Xr=!1;var Tr,xr,Gn,Kn,ua,Sr,Dr,As,ji,Hi,mu,yu;const ti=class ti{constructor(){xe(this,As);b(this,"committed",!1);b(this,"current",new Map);b(this,"previous",new Map);xe(this,Tr,new Set);xe(this,xr,new Set);xe(this,Gn,0);xe(this,Kn,0);xe(this,ua,null);xe(this,Sr,new Set);xe(this,Dr,new Set);b(this,"skipped_effects",new Set);b(this,"is_fork",!1)}is_deferred(){return this.is_fork||w(this,Kn)>0}process(e){var r;xs=[],Qr=null,this.apply();var t=[],s=[];for(const a of e)it(this,As,ji).call(this,a,t,s);this.is_fork||it(this,As,mu).call(this),this.is_deferred()?(it(this,As,Hi).call(this,s),it(this,As,Hi).call(this,t)):(Qr=this,Fe=null,pl(s),pl(t),Qr=null,(r=w(this,ua))==null||r.resolve()),Bt=null}capture(e,t){t!==qt&&!this.previous.has(e)&&this.previous.set(e,t),e.f&An||(this.current.set(e,e.v),Bt==null||Bt.set(e,e.v))}activate(){Fe=this,this.apply()}deactivate(){Fe===this&&(Fe=null,Bt=null)}flush(){if(this.activate(),xs.length>0){if(bu(),Fe!==null&&Fe!==this)return}else w(this,Gn)===0&&this.process([]);this.deactivate()}discard(){for(const e of w(this,xr))e(this);w(this,xr).clear()}increment(e){fe(this,Gn,w(this,Gn)+1),e&&fe(this,Kn,w(this,Kn)+1)}decrement(e){fe(this,Gn,w(this,Gn)-1),e&&fe(this,Kn,w(this,Kn)-1),this.revive()}revive(){for(const e of w(this,Sr))w(this,Dr).delete(e),Nt(e,ts),an(e);for(const e of w(this,Dr))Nt(e,un),an(e);this.flush()}oncommit(e){w(this,Tr).add(e)}ondiscard(e){w(this,xr).add(e)}settled(){return(w(this,ua)??fe(this,ua,su())).promise}static ensure(){if(Fe===null){const e=Fe=new ti;Sa.add(Fe),Xr||ti.enqueue(()=>{Fe===e&&e.flush()})}return Fe}static enqueue(e){qr(e)}apply(){}};Tr=new WeakMap,xr=new WeakMap,Gn=new WeakMap,Kn=new WeakMap,ua=new WeakMap,Sr=new WeakMap,Dr=new WeakMap,As=new WeakSet,ji=function(e,t,s){e.f^=Ht;for(var r=e.first,a=null;r!==null;){var i=r.f,l=(i&(cn|lr))!==0,c=l&&(i&Ht)!==0,u=c||(i&ps)!==0||this.skipped_effects.has(r);if(!u&&r.fn!==null){l?r.f^=Ht:a!==null&&i&(Ya|ai|ru)?a.b.defer_effect(r):i&Ya?t.push(r):ga(r)&&(i&ln&&w(this,Sr).add(r),aa(r));var d=r.first;if(d!==null){r=d;continue}}var f=r.parent;for(r=r.next;r===null&&f!==null;)f===a&&(a=null),r=f.next,f=f.parent}},Hi=function(e){for(var t=0;t<e.length;t+=1)pu(e[t],w(this,Sr),w(this,Dr))},mu=function(){if(w(this,Kn)===0){for(const e of w(this,Tr))e();w(this,Tr).clear()}w(this,Gn)===0&&it(this,As,yu).call(this)},yu=function(){var r;if(Sa.size>1){this.previous.clear();var e=Bt,t=!0;for(const a of Sa){if(a===this){t=!1;continue}const i=[];for(const[c,u]of this.current){if(a.current.has(c))if(t&&u!==a.current.get(c))a.current.set(c,u);else continue;i.push(c)}if(i.length===0)continue;const l=[...a.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var s=xs;xs=[];const c=new Set,u=new Map;for(const d of i)ku(d,l,c,u);if(xs.length>0){Fe=a,a.apply();for(const d of xs)it(r=a,As,ji).call(r,d,[],[]);a.deactivate()}xs=s}}Fe=null,Bt=e}this.committed=!0,Sa.delete(this)};let tn=ti;function Rf(n){var e=Xr;Xr=!0;try{for(var t;;){if(Mf(),xs.length===0&&(Fe==null||Fe.flush(),xs.length===0))return ii=null,t;bu()}}finally{Xr=e}}function bu(){var n=er;Wi=!0;var e=null;try{var t=0;for(ja(!0);xs.length>0;){var s=tn.ensure();if(t++>1e3){var r,a;Nf()}s.process(xs),Cn.clear()}}finally{Wi=!1,ja(n),ii=null}}function Nf(){try{cf()}catch(n){Or(n,ii)}}let Is=null;function pl(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if(!(s.f&(sn|ps))&&ga(s)&&(Is=new Set,aa(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?Pu(s):s.fn=null),(Is==null?void 0:Is.size)>0)){Cn.clear();for(const r of Is){if(r.f&(sn|ps))continue;const a=[r];let i=r.parent;for(;i!==null;)Is.has(i)&&(Is.delete(i),a.push(i)),i=i.parent;for(let l=a.length-1;l>=0;l--){const c=a[l];c.f&(sn|ps)||aa(c)}}Is.clear()}}Is=null}}function ku(n,e,t,s){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const r of n.reactions){const a=r.f;a&zt?ku(r,e,t,s):a&(Co|ln)&&!(a&ts)&&_u(r,e,s)&&(Nt(r,ts),an(r))}}function _u(n,e,t){const s=t.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const r of n.deps){if(e.includes(r))return!0;if(r.f&zt&&_u(r,e,t))return t.set(r,!0),!0}return t.set(n,!1),!1}function an(n){for(var e=ii=n;e.parent!==null;){e=e.parent;var t=e.f;if(Wi&&e===Xe&&t&ln&&!(t&au))return;if(t&(lr|cn)){if(!(t&Ht))return;e.f^=Ht}}xs.push(e)}function Pf(n){let e=0,t=ar(0),s;return()=>{No()&&(o(t),va(()=>(e===0&&(s=Nn(()=>n(()=>Zr(t)))),e+=1,()=>{qr(()=>{e-=1,e===0&&(s==null||s(),s=void 0,Zr(t))})})))}}var Lf=Ir|Fr|Eo;function Ff(n,e,t){new qf(n,e,t)}var ws,_o,Us,Vn,zs,Ts,is,$s,Js,wn,Qn,Tn,Xn,Er,Ar,xn,si,Rt,Bf,Uf,Gi,Pa,La,Ki;class qf{constructor(e,t,s){xe(this,Rt);b(this,"parent");b(this,"is_pending",!1);xe(this,ws);xe(this,_o,null);xe(this,Us);xe(this,Vn);xe(this,zs);xe(this,Ts,null);xe(this,is,null);xe(this,$s,null);xe(this,Js,null);xe(this,wn,null);xe(this,Qn,0);xe(this,Tn,0);xe(this,Xn,!1);xe(this,Er,new Set);xe(this,Ar,new Set);xe(this,xn,null);xe(this,si,Pf(()=>(fe(this,xn,ar(w(this,Qn))),()=>{fe(this,xn,null)})));fe(this,ws,e),fe(this,Us,t),fe(this,Vn,s),this.parent=Xe.b,this.is_pending=!!w(this,Us).pending,fe(this,zs,Fo(()=>{Xe.b=this;{var r=it(this,Rt,Gi).call(this);try{fe(this,Ts,Ss(()=>s(r)))}catch(a){this.error(a)}w(this,Tn)>0?it(this,Rt,La).call(this):this.is_pending=!1}return()=>{var a;(a=w(this,wn))==null||a.remove()}},Lf))}defer_effect(e){pu(e,w(this,Er),w(this,Ar))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!w(this,Us).pending}update_pending_count(e){it(this,Rt,Ki).call(this,e),fe(this,Qn,w(this,Qn)+e),w(this,xn)&&Rr(w(this,xn),w(this,Qn))}get_effect_pending(){return w(this,si).call(this),o(w(this,xn))}error(e){var t=w(this,Us).onerror;let s=w(this,Us).failed;if(w(this,Xn)||!t&&!s)throw e;w(this,Ts)&&(us(w(this,Ts)),fe(this,Ts,null)),w(this,is)&&(us(w(this,is)),fe(this,is,null)),w(this,$s)&&(us(w(this,$s)),fe(this,$s,null));var r=!1,a=!1;const i=()=>{if(r){Ef();return}r=!0,a&&vf(),tn.ensure(),fe(this,Qn,0),w(this,$s)!==null&&Jn(w(this,$s),()=>{fe(this,$s,null)}),this.is_pending=this.has_pending_snippet(),fe(this,Ts,it(this,Rt,Pa).call(this,()=>(fe(this,Xn,!1),Ss(()=>w(this,Vn).call(this,w(this,ws)))))),w(this,Tn)>0?it(this,Rt,La).call(this):this.is_pending=!1};var l=qe;try{cs(null),a=!0,t==null||t(e,i),a=!1}catch(c){Or(c,w(this,zs)&&w(this,zs).parent)}finally{cs(l)}s&&qr(()=>{fe(this,$s,it(this,Rt,Pa).call(this,()=>{tn.ensure(),fe(this,Xn,!0);try{return Ss(()=>{s(w(this,ws),()=>e,()=>i)})}catch(c){return Or(c,w(this,zs).parent),null}finally{fe(this,Xn,!1)}}))})}}ws=new WeakMap,_o=new WeakMap,Us=new WeakMap,Vn=new WeakMap,zs=new WeakMap,Ts=new WeakMap,is=new WeakMap,$s=new WeakMap,Js=new WeakMap,wn=new WeakMap,Qn=new WeakMap,Tn=new WeakMap,Xn=new WeakMap,Er=new WeakMap,Ar=new WeakMap,xn=new WeakMap,si=new WeakMap,Rt=new WeakSet,Bf=function(){try{fe(this,Ts,Ss(()=>w(this,Vn).call(this,w(this,ws))))}catch(e){this.error(e)}},Uf=function(){const e=w(this,Us).pending;e&&(fe(this,is,Ss(()=>e(w(this,ws)))),tn.enqueue(()=>{var t=it(this,Rt,Gi).call(this);fe(this,Ts,it(this,Rt,Pa).call(this,()=>(tn.ensure(),Ss(()=>w(this,Vn).call(this,t))))),w(this,Tn)>0?it(this,Rt,La).call(this):(Jn(w(this,is),()=>{fe(this,is,null)}),this.is_pending=!1)}))},Gi=function(){var e=w(this,ws);return this.is_pending&&(fe(this,wn,rn()),w(this,ws).before(w(this,wn)),e=w(this,wn)),e},Pa=function(e){var t=Xe,s=qe,r=Ct;Hs(w(this,zs)),cs(w(this,zs)),Mr(w(this,zs).ctx);try{return e()}catch(a){return vu(a),null}finally{Hs(t),cs(s),Mr(r)}},La=function(){const e=w(this,Us).pending;w(this,Ts)!==null&&(fe(this,Js,document.createDocumentFragment()),w(this,Js).append(w(this,wn)),qu(w(this,Ts),w(this,Js))),w(this,is)===null&&fe(this,is,Ss(()=>e(w(this,ws))))},Ki=function(e){var t;if(!this.has_pending_snippet()){this.parent&&it(t=this.parent,Rt,Ki).call(t,e);return}if(fe(this,Tn,w(this,Tn)+e),w(this,Tn)===0){this.is_pending=!1;for(const s of w(this,Er))Nt(s,ts),an(s);for(const s of w(this,Ar))Nt(s,un),an(s);w(this,Er).clear(),w(this,Ar).clear(),w(this,is)&&Jn(w(this,is),()=>{fe(this,is,null)}),w(this,Js)&&(w(this,ws).before(w(this,Js)),fe(this,Js,null))}};function zf(n,e,t,s){const r=oi;if(t.length===0&&n.length===0){s(e.map(r));return}var a=Fe,i=Xe,l=$f();function c(){Promise.all(t.map(u=>Yf(u))).then(u=>{l();try{s([...e.map(r),...u])}catch(d){i.f&sn||Or(d,i)}a==null||a.deactivate(),Wa()}).catch(u=>{Or(u,i)})}n.length>0?Promise.all(n).then(()=>{l();try{return c()}finally{a==null||a.deactivate(),Wa()}}):c()}function $f(){var n=Xe,e=qe,t=Ct,s=Fe;return function(a=!0){Hs(n),cs(e),Mr(t),a&&(s==null||s.activate())}}function Wa(){Hs(null),cs(null),Mr(null)}function oi(n){var e=zt|ts,t=qe!==null&&qe.f&zt?qe:null;return Xe!==null&&(Xe.f|=Fr),{ctx:Ct,deps:null,effects:null,equals:ou,f:e,fn:n,reactions:null,rv:0,v:qt,wv:0,parent:t??Xe,ac:null}}function Yf(n,e,t){let s=Xe;s===null&&rf();var r=s.b,a=void 0,i=ar(qt),l=!qe,c=new Map;return ev(()=>{var y;var u=su();a=u.promise;try{Promise.resolve(n()).then(u.resolve,u.reject).then(()=>{d===Fe&&d.committed&&d.deactivate(),Wa()})}catch(_){u.reject(_),Wa()}var d=Fe;if(l){var f=r.is_rendered();r.update_pending_count(1),d.increment(f),(y=c.get(d))==null||y.reject(kr),c.delete(d),c.set(d,u)}const g=(_,m=void 0)=>{if(d.activate(),m)m!==kr&&(i.f|=An,Rr(i,m));else{i.f&An&&(i.f^=An),Rr(i,_);for(const[p,k]of c){if(c.delete(p),p===d)break;k.reject(kr)}}l&&(r.update_pending_count(-1),d.decrement(f))};u.promise.then(g,_=>g(null,_||"unknown"))}),Po(()=>{for(const u of c.values())u.reject(kr)}),new Promise(u=>{function d(f){function g(){f===a?u(i):d(a)}f.then(g,g)}d(a)})}function J(n){const e=oi(n);return Bu(e),e}function wu(n){const e=oi(n);return e.equals=cu,e}function Tu(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)us(e[t])}}function Wf(n){for(var e=n.parent;e!==null;){if(!(e.f&zt))return e.f&sn?null:e;e=e.parent}return null}function Oo(n){var e,t=Xe;Hs(Wf(n));try{n.f&=~rr,Tu(n),e=Yu(n)}finally{Hs(t)}return e}function xu(n){var e=Oo(n);if(!n.equals(e)&&(n.wv=zu(),(!(Fe!=null&&Fe.is_fork)||n.deps===null)&&(n.v=e,n.deps===null))){Nt(n,Ht);return}Rn||(Bt!==null?(No()||Fe!=null&&Fe.is_fork)&&Bt.set(n,e):Mo(n))}let Vi=new Set;const Cn=new Map;let Su=!1;function ar(n,e){var t={f:0,v:n,reactions:null,equals:ou,rv:0,wv:0};return t}function V(n,e){const t=ar(n);return Bu(t),t}function jf(n,e=!1,t=!0){const s=ar(n);return e||(s.equals=cu),s}function T(n,e,t=!1){qe!==null&&(!Rs||qe.f&gl)&&du()&&qe.f&(zt|ln|Co|gl)&&!(Jt!=null&&Jt.includes(n))&&ff();let s=t?De(e):e;return Rr(n,s)}function Rr(n,e){if(!n.equals(e)){var t=n.v;Rn?Cn.set(n,e):Cn.set(n,t),n.v=e;var s=tn.ensure();if(s.capture(n,t),n.f&zt){const r=n;n.f&ts&&Oo(r),Mo(r)}n.wv=zu(),Du(n,ts),Xe!==null&&Xe.f&Ht&&!(Xe.f&(cn|lr))&&(_s===null?sv([n]):_s.push(n)),!s.is_fork&&Vi.size>0&&!Su&&Hf()}return e}function Hf(){Su=!1;var n=er;ja(!0);const e=Array.from(Vi);try{for(const t of e)t.f&Ht&&Nt(t,un),ga(t)&&aa(t)}finally{ja(n)}Vi.clear()}function ml(n,e=1){var t=o(n),s=e===1?t++:t--;return T(n,t),s}function Zr(n){T(n,n.v+1)}function Du(n,e){var t=n.reactions;if(t!==null)for(var s=t.length,r=0;r<s;r++){var a=t[r],i=a.f,l=(i&ts)===0;if(l&&Nt(a,e),i&zt){var c=a;Bt==null||Bt.delete(c),i&rr||(i&Es&&(a.f|=rr),Du(c,un))}else l&&(i&ln&&Is!==null&&Is.add(a),an(a))}}function De(n){if(typeof n!="object"||n===null||nn in n)return n;const e=Do(n);if(e!==Zh&&e!==Jh)return n;var t=new Map,s=So(n),r=V(0),a=tr,i=l=>{if(tr===a)return l();var c=qe,u=tr;cs(null),wl(a);var d=l();return cs(c),wl(u),d};return s&&t.set("length",V(n.length)),new Proxy(n,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&df();var d=t.get(c);return d===void 0?d=i(()=>{var f=V(u.value);return t.set(c,f),f}):T(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=i(()=>V(qt));t.set(c,d),Zr(r)}}else T(u,qt),Zr(r);return!0},get(l,c,u){var y;if(c===nn)return n;var d=t.get(c),f=c in l;if(d===void 0&&(!f||(y=wr(l,c))!=null&&y.writable)&&(d=i(()=>{var _=De(f?l[c]:qt),m=V(_);return m}),t.set(c,d)),d!==void 0){var g=o(d);return g===qt?void 0:g}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=o(d))}else if(u===void 0){var f=t.get(c),g=f==null?void 0:f.v;if(f!==void 0&&g!==qt)return{enumerable:!0,configurable:!0,value:g,writable:!0}}return u},has(l,c){var g;if(c===nn)return!0;var u=t.get(c),d=u!==void 0&&u.v!==qt||Reflect.has(l,c);if(u!==void 0||Xe!==null&&(!d||(g=wr(l,c))!=null&&g.writable)){u===void 0&&(u=i(()=>{var y=d?De(l[c]):qt,_=V(y);return _}),t.set(c,u));var f=o(u);if(f===qt)return!1}return d},set(l,c,u,d){var D;var f=t.get(c),g=c in l;if(s&&c==="length")for(var y=u;y<f.v;y+=1){var _=t.get(y+"");_!==void 0?T(_,qt):y in l&&(_=i(()=>V(qt)),t.set(y+"",_))}if(f===void 0)(!g||(D=wr(l,c))!=null&&D.writable)&&(f=i(()=>V(void 0)),T(f,De(u)),t.set(c,f));else{g=f.v!==qt;var m=i(()=>De(u));T(f,m)}var p=Reflect.getOwnPropertyDescriptor(l,c);if(p!=null&&p.set&&p.set.call(d,u),!g){if(s&&typeof c=="string"){var k=t.get("length"),S=Number(c);Number.isInteger(S)&&S>=k.v&&T(k,S+1)}Zr(r)}return!0},ownKeys(l){o(r);var c=Reflect.ownKeys(l).filter(f=>{var g=t.get(f);return g===void 0||g.v!==qt});for(var[u,d]of t)d.v!==qt&&!(u in l)&&c.push(u);return c},setPrototypeOf(){hf()}})}function yl(n){try{if(n!==null&&typeof n=="object"&&nn in n)return n[nn]}catch{}return n}function Gf(n,e){return Object.is(yl(n),yl(e))}var bl,Eu,Au,Cu;function Kf(){if(bl===void 0){bl=window,Eu=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Au=wr(e,"firstChild").get,Cu=wr(e,"nextSibling").get,vl(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),vl(t)&&(t.__t=void 0)}}function rn(n=""){return document.createTextNode(n)}function Sn(n){return Au.call(n)}function fa(n){return Cu.call(n)}function h(n,e){return Sn(n)}function Qe(n,e=!1){{var t=Sn(n);return t instanceof Comment&&t.data===""?fa(t):t}}function v(n,e=1,t=!1){let s=n;for(;e--;)s=fa(s);return s}function Vf(n){n.textContent=""}function Iu(){return!1}let kl=!1;function Qf(){kl||(kl=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var e;if(!n.defaultPrevented)for(const t of n.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function li(n){var e=qe,t=Xe;cs(null),Hs(null);try{return n()}finally{cs(e),Hs(t)}}function Ro(n,e,t,s=t){n.addEventListener(e,()=>li(t));const r=n.__on_r;r?n.__on_r=()=>{r(),s(!0)}:n.__on_r=()=>s(!0),Qf()}function Xf(n){Xe===null&&(qe===null&&lf(),of()),Rn&&af()}function Zf(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function dn(n,e,t){var s=Xe;s!==null&&s.f&ps&&(n|=ps);var r={ctx:Ct,deps:null,nodes:null,f:n|ts|Es,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{aa(r),r.f|=Ao}catch(l){throw us(r),l}else e!==null&&an(r);var a=r;if(t&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&!(a.f&Fr)&&(a=a.first,n&ln&&n&Ir&&a!==null&&(a.f|=Ir)),a!==null&&(a.parent=s,s!==null&&Zf(a,s),qe!==null&&qe.f&zt&&!(n&lr))){var i=qe;(i.effects??(i.effects=[])).push(a)}return r}function No(){return qe!==null&&!Rs}function Po(n){const e=dn(ai,null,!1);return Nt(e,Ht),e.teardown=n,e}function Tt(n){Xf();var e=Xe.f,t=!qe&&(e&cn)!==0&&(e&Ao)===0;if(t){var s=Ct;(s.e??(s.e=[])).push(n)}else return Mu(n)}function Mu(n){return dn(Ya|tf,n,!1)}function Jf(n){tn.ensure();const e=dn(lr|Fr,n,!0);return(t={})=>new Promise(s=>{t.outro?Jn(e,()=>{us(e),s(void 0)}):(us(e),s(void 0))})}function Lo(n){return dn(Ya,n,!1)}function ev(n){return dn(Co|Fr,n,!0)}function va(n,e=0){return dn(ai|e,n,!0)}function $(n,e=[],t=[],s=[]){zf(s,e,t,r=>{dn(ai,()=>n(...r.map(o)),!0)})}function Fo(n,e=0){var t=dn(ln|e,n,!0);return t}function Ss(n){return dn(cn|Fr,n,!0)}function Ou(n){var e=n.teardown;if(e!==null){const t=Rn,s=qe;_l(!0),cs(null);try{e.call(null)}finally{_l(t),cs(s)}}}function Ru(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&li(()=>{r.abort(kr)});var s=t.next;t.f&lr?t.parent=null:us(t,e),t=s}}function tv(n){for(var e=n.first;e!==null;){var t=e.next;e.f&cn||us(e),e=t}}function us(n,e=!0){var t=!1;(e||n.f&au)&&n.nodes!==null&&n.nodes.end!==null&&(Nu(n.nodes.start,n.nodes.end),t=!0),Ru(n,e&&!t),Ha(n,0),Nt(n,sn);var s=n.nodes&&n.nodes.t;if(s!==null)for(const a of s)a.stop();Ou(n);var r=n.parent;r!==null&&r.first!==null&&Pu(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function Nu(n,e){for(;n!==null;){var t=n===e?null:fa(n);n.remove(),n=t}}function Pu(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function Jn(n,e,t=!0){var s=[];Lu(n,s,!0);var r=()=>{t&&us(n),e&&e()},a=s.length;if(a>0){var i=()=>--a||r();for(var l of s)l.out(i)}else r()}function Lu(n,e,t){if(!(n.f&ps)){n.f^=ps;var s=n.nodes&&n.nodes.t;if(s!==null)for(const l of s)(l.is_global||t)&&e.push(l);for(var r=n.first;r!==null;){var a=r.next,i=(r.f&Ir)!==0||(r.f&cn)!==0&&(n.f&ln)!==0;Lu(r,e,i?t:!1),r=a}}}function qo(n){Fu(n,!0)}function Fu(n,e){if(n.f&ps){n.f^=ps,n.f&Ht||(Nt(n,ts),an(n));for(var t=n.first;t!==null;){var s=t.next,r=(t.f&Ir)!==0||(t.f&cn)!==0;Fu(t,r?e:!1),t=s}var a=n.nodes&&n.nodes.t;if(a!==null)for(const i of a)(i.is_global||e)&&i.in()}}function qu(n,e){if(n.nodes)for(var t=n.nodes.start,s=n.nodes.end;t!==null;){var r=t===s?null:fa(t);e.append(t),t=r}}let er=!1;function ja(n){er=n}let Rn=!1;function _l(n){Rn=n}let qe=null,Rs=!1;function cs(n){qe=n}let Xe=null;function Hs(n){Xe=n}let Jt=null;function Bu(n){qe!==null&&(Jt===null?Jt=[n]:Jt.push(n))}let Xt=null,hs=0,_s=null;function sv(n){_s=n}let Uu=1,ra=0,tr=ra;function wl(n){tr=n}function zu(){return++Uu}function ga(n){var e=n.f;if(e&ts)return!0;if(e&zt&&(n.f&=~rr),e&un){for(var t=n.deps,s=t.length,r=0;r<s;r++){var a=t[r];if(ga(a)&&xu(a),a.wv>n.wv)return!0}e&Es&&Bt===null&&Nt(n,Ht)}return!1}function $u(n,e,t=!0){var s=n.reactions;if(s!==null&&!(Jt!=null&&Jt.includes(n)))for(var r=0;r<s.length;r++){var a=s[r];a.f&zt?$u(a,e,!1):e===a&&(t?Nt(a,ts):a.f&Ht&&Nt(a,un),an(a))}}function Yu(n){var _;var e=Xt,t=hs,s=_s,r=qe,a=Jt,i=Ct,l=Rs,c=tr,u=n.f;Xt=null,hs=0,_s=null,qe=u&(cn|lr)?null:n,Jt=null,Mr(n.ctx),Rs=!1,tr=++ra,n.ac!==null&&(li(()=>{n.ac.abort(kr)}),n.ac=null);try{n.f|=Yi;var d=n.fn,f=d(),g=n.deps;if(Xt!==null){var y;if(Ha(n,hs),g!==null&&hs>0)for(g.length=hs+Xt.length,y=0;y<Xt.length;y++)g[hs+y]=Xt[y];else n.deps=g=Xt;if(No()&&n.f&Es)for(y=hs;y<g.length;y++)((_=g[y]).reactions??(_.reactions=[])).push(n)}else g!==null&&hs<g.length&&(Ha(n,hs),g.length=hs);if(du()&&_s!==null&&!Rs&&g!==null&&!(n.f&(zt|un|ts)))for(y=0;y<_s.length;y++)$u(_s[y],n);return r!==null&&r!==n&&(ra++,_s!==null&&(s===null?s=_s:s.push(..._s))),n.f&An&&(n.f^=An),f}catch(m){return vu(m)}finally{n.f^=Yi,Xt=e,hs=t,_s=s,qe=r,Jt=a,Mr(i),Rs=l,tr=c}}function nv(n,e){let t=e.reactions;if(t!==null){var s=Qh.call(t,n);if(s!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[s]=t[r],t.pop())}}if(t===null&&e.f&zt&&(Xt===null||!Xt.includes(e))){var a=e;a.f&Es&&(a.f^=Es,a.f&=~rr),Mo(a),Tu(a),Ha(a,0)}}function Ha(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)nv(n,t[s])}function aa(n){var e=n.f;if(!(e&sn)){Nt(n,Ht);var t=Xe,s=er;Xe=n,er=!0;try{e&(ln|ru)?tv(n):Ru(n),Ou(n);var r=Yu(n);n.teardown=typeof r=="function"?r:null,n.wv=Uu;var a;$i&&Af&&n.f&ts&&n.deps}finally{er=s,Xe=t}}}async function Wu(){await Promise.resolve(),Rf()}function o(n){var e=n.f,t=(e&zt)!==0;if(qe!==null&&!Rs){var s=Xe!==null&&(Xe.f&sn)!==0;if(!s&&!(Jt!=null&&Jt.includes(n))){var r=qe.deps;if(qe.f&Yi)n.rv<ra&&(n.rv=ra,Xt===null&&r!==null&&r[hs]===n?hs++:Xt===null?Xt=[n]:Xt.includes(n)||Xt.push(n));else{(qe.deps??(qe.deps=[])).push(n);var a=n.reactions;a===null?n.reactions=[qe]:a.includes(qe)||a.push(qe)}}}if(Rn&&Cn.has(n))return Cn.get(n);if(t){var i=n;if(Rn){var l=i.v;return(!(i.f&Ht)&&i.reactions!==null||Hu(i))&&(l=Oo(i)),Cn.set(i,l),l}var c=(i.f&Es)===0&&!Rs&&qe!==null&&(er||(qe.f&Es)!==0),u=i.deps===null;ga(i)&&(c&&(i.f|=Es),xu(i)),c&&!u&&ju(i)}if(Bt!=null&&Bt.has(n))return Bt.get(n);if(n.f&An)throw n.v;return n.v}function ju(n){if(n.deps!==null){n.f|=Es;for(const e of n.deps)(e.reactions??(e.reactions=[])).push(n),e.f&zt&&!(e.f&Es)&&ju(e)}}function Hu(n){if(n.v===qt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Cn.has(e)||e.f&zt&&Hu(e))return!0;return!1}function Nn(n){var e=Rs;try{return Rs=!0,n()}finally{Rs=e}}function rv(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(nn in n)Qi(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&nn in t&&Qi(t)}}}function Qi(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{Qi(n[s],e)}catch{}const t=Do(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=tu(t);for(let r in s){const a=s[r].get;if(a)try{a.call(n)}catch{}}}}}const av=["touchstart","touchmove"];function iv(n){return av.includes(n)}const Gu=new Set,Xi=new Set;function ov(n,e,t,s={}){function r(a){if(s.capture||Gr.call(e,a),!a.cancelBubble)return li(()=>t==null?void 0:t.call(this,a))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?qr(()=>{e.addEventListener(n,r,s)}):e.addEventListener(n,r,s),r}function Ut(n,e,t,s,r){var a={capture:s,passive:r},i=ov(n,e,t,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Po(()=>{e.removeEventListener(n,i,a)})}function xt(n){for(var e=0;e<n.length;e++)Gu.add(n[e]);for(var t of Xi)t(n)}let Tl=null;function Gr(n){var p;var e=this,t=e.ownerDocument,s=n.type,r=((p=n.composedPath)==null?void 0:p.call(n))||[],a=r[0]||n.target;Tl=n;var i=0,l=Tl===n&&n.__root;if(l){var c=r.indexOf(l);if(c!==-1&&(e===document||e===window)){n.__root=e;return}var u=r.indexOf(e);if(u===-1)return;c<=u&&(i=c)}if(a=r[i]||n.target,a!==e){Xh(n,"currentTarget",{configurable:!0,get(){return a||t}});var d=qe,f=Xe;cs(null),Hs(null);try{for(var g,y=[];a!==null;){var _=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+s];m!=null&&(!a.disabled||n.target===a)&&m.call(a,n)}catch(k){g?y.push(k):g=k}if(n.cancelBubble||_===e||_===null)break;a=_}if(g){for(let k of y)queueMicrotask(()=>{throw k});throw g}}finally{n.__root=e,delete n.currentTarget,cs(d),Hs(f)}}}function Ku(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function ia(n,e){var t=Xe;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function C(n,e){var t=(e&Tf)!==0,s=(e&xf)!==0,r,a=!n.startsWith("<!>");return()=>{r===void 0&&(r=Ku(a?n:"<!>"+n),t||(r=Sn(r)));var i=s||Eu?document.importNode(r,!0):r.cloneNode(!0);if(t){var l=Sn(i),c=i.lastChild;ia(l,c)}else ia(i,i);return i}}function Ti(n=""){{var e=rn(n+"");return ia(e,e),e}}function lt(){var n=document.createDocumentFragment(),e=document.createComment(""),t=rn();return n.append(e,t),ia(e,t),n}function x(n,e){n!==null&&n.before(e)}function N(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function Da(n,e){return lv(n,e)}const fr=new Map;function lv(n,{target:e,anchor:t,props:s={},events:r,context:a,intro:i=!0}){Kf();var l=new Set,c=f=>{for(var g=0;g<f.length;g++){var y=f[g];if(!l.has(y)){l.add(y);var _=iv(y);e.addEventListener(y,Gr,{passive:_});var m=fr.get(y);m===void 0?(document.addEventListener(y,Gr,{passive:_}),fr.set(y,1)):fr.set(y,m+1)}}};c(ri(Gu)),Xi.add(c);var u=void 0,d=Jf(()=>{var f=t??e.appendChild(rn());return Ff(f,{pending:()=>{}},g=>{if(a){ht({});var y=Ct;y.c=a}r&&(s.$$events=r),u=n(g,s)||{},a&&ft()}),()=>{var _;for(var g of l){e.removeEventListener(g,Gr);var y=fr.get(g);--y===0?(document.removeEventListener(g,Gr),fr.delete(g)):fr.set(g,y)}Xi.delete(c),f!==t&&((_=f.parentNode)==null||_.removeChild(f))}});return Zi.set(u,d),u}let Zi=new WeakMap;function Ea(n,e){const t=Zi.get(n);return t?(Zi.delete(n),t(e)):Promise.resolve()}var Ms,Ys,fs,Zn,da,ha,ni;class cv{constructor(e,t=!0){b(this,"anchor");xe(this,Ms,new Map);xe(this,Ys,new Map);xe(this,fs,new Map);xe(this,Zn,new Set);xe(this,da,!0);xe(this,ha,()=>{var e=Fe;if(w(this,Ms).has(e)){var t=w(this,Ms).get(e),s=w(this,Ys).get(t);if(s)qo(s),w(this,Zn).delete(t);else{var r=w(this,fs).get(t);r&&(w(this,Ys).set(t,r.effect),w(this,fs).delete(t),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[a,i]of w(this,Ms)){if(w(this,Ms).delete(a),a===e)break;const l=w(this,fs).get(i);l&&(us(l.effect),w(this,fs).delete(i))}for(const[a,i]of w(this,Ys)){if(a===t||w(this,Zn).has(a))continue;const l=()=>{if(Array.from(w(this,Ms).values()).includes(a)){var u=document.createDocumentFragment();qu(i,u),u.append(rn()),w(this,fs).set(a,{effect:i,fragment:u})}else us(i);w(this,Zn).delete(a),w(this,Ys).delete(a)};w(this,da)||!s?(w(this,Zn).add(a),Jn(i,l,!1)):l()}}});xe(this,ni,e=>{w(this,Ms).delete(e);const t=Array.from(w(this,Ms).values());for(const[s,r]of w(this,fs))t.includes(s)||(us(r.effect),w(this,fs).delete(s))});this.anchor=e,fe(this,da,t)}ensure(e,t){var s=Fe,r=Iu();if(t&&!w(this,Ys).has(e)&&!w(this,fs).has(e))if(r){var a=document.createDocumentFragment(),i=rn();a.append(i),w(this,fs).set(e,{effect:Ss(()=>t(i)),fragment:a})}else w(this,Ys).set(e,Ss(()=>t(this.anchor)));if(w(this,Ms).set(s,e),r){for(const[l,c]of w(this,Ys))l===e?s.skipped_effects.delete(c):s.skipped_effects.add(c);for(const[l,c]of w(this,fs))l===e?s.skipped_effects.delete(c.effect):s.skipped_effects.add(c.effect);s.oncommit(w(this,ha)),s.ondiscard(w(this,ni))}else w(this,ha).call(this)}}Ms=new WeakMap,Ys=new WeakMap,fs=new WeakMap,Zn=new WeakMap,da=new WeakMap,ha=new WeakMap,ni=new WeakMap;function W(n,e,t=!1){var s=new cv(n),r=t?Ir:0;function a(i,l){s.ensure(i,l)}Fo(()=>{var i=!1;e((l,c=!0)=>{i=!0,a(c,l)}),i||a(!1,null)},r)}function bt(n,e){return e}function uv(n,e,t){for(var s=[],r=e.length,a,i=e.length,l=0;l<r;l++){let f=e[l];Jn(f,()=>{if(a){if(a.pending.delete(f),a.done.add(f),a.pending.size===0){var g=n.outrogroups;Ji(ri(a.done)),g.delete(a),g.size===0&&(n.outrogroups=null)}}else i-=1},!1)}if(i===0){var c=s.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Vf(d),d.append(u),n.items.clear()}Ji(e,!c)}else a={pending:new Set(e),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(a)}function Ji(n,e=!0){for(var t=0;t<n.length;t++)us(n[t],e)}var xl;function He(n,e,t,s,r,a=null){var i=n,l=new Map,c=(e&iu)!==0;if(c){var u=n;i=u.appendChild(rn())}var d=null,f=wu(()=>{var k=t();return So(k)?k:k==null?[]:ri(k)}),g,y=!0;function _(){p.fallback=d,dv(p,g,i,e,s),d!==null&&(g.length===0?d.f&en?(d.f^=en,Kr(d,null,i)):qo(d):Jn(d,()=>{d=null}))}var m=Fo(()=>{g=o(f);for(var k=g.length,S=new Set,D=Fe,E=Iu(),R=0;R<k;R+=1){var P=g[R],L=s(P,R),H=y?null:l.get(L);H?(H.v&&Rr(H.v,P),H.i&&Rr(H.i,R),E&&D.skipped_effects.delete(H.e)):(H=hv(l,y?i:xl??(xl=rn()),P,L,R,r,e,t),y||(H.e.f|=en),l.set(L,H)),S.add(L)}if(k===0&&a&&!d&&(y?d=Ss(()=>a(i)):(d=Ss(()=>a(xl??(xl=rn()))),d.f|=en)),!y)if(E){for(const[Y,X]of l)S.has(Y)||D.skipped_effects.add(X.e);D.oncommit(_),D.ondiscard(()=>{})}else _();o(f)}),p={effect:m,items:l,outrogroups:null,fallback:d};y=!1}function dv(n,e,t,s,r){var X,oe,ae,ve,Q,Z,B,M,I;var a=(s&mf)!==0,i=e.length,l=n.items,c=n.effect.first,u,d=null,f,g=[],y=[],_,m,p,k;if(a)for(k=0;k<i;k+=1)_=e[k],m=r(_,k),p=l.get(m).e,p.f&en||((oe=(X=p.nodes)==null?void 0:X.a)==null||oe.measure(),(f??(f=new Set)).add(p));for(k=0;k<i;k+=1){if(_=e[k],m=r(_,k),p=l.get(m).e,n.outrogroups!==null)for(const G of n.outrogroups)G.pending.delete(p),G.done.delete(p);if(p.f&en)if(p.f^=en,p===c)Kr(p,null,t);else{var S=d?d.next:c;p===n.effect.last&&(n.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),pn(n,d,p),pn(n,p,S),Kr(p,S,t),d=p,g=[],y=[],c=d.next;continue}if(p.f&ps&&(qo(p),a&&((ve=(ae=p.nodes)==null?void 0:ae.a)==null||ve.unfix(),(f??(f=new Set)).delete(p))),p!==c){if(u!==void 0&&u.has(p)){if(g.length<y.length){var D=y[0],E;d=D.prev;var R=g[0],P=g[g.length-1];for(E=0;E<g.length;E+=1)Kr(g[E],D,t);for(E=0;E<y.length;E+=1)u.delete(y[E]);pn(n,R.prev,P.next),pn(n,d,R),pn(n,P,D),c=D,d=P,k-=1,g=[],y=[]}else u.delete(p),Kr(p,c,t),pn(n,p.prev,p.next),pn(n,p,d===null?n.effect.first:d.next),pn(n,d,p),d=p;continue}for(g=[],y=[];c!==null&&c!==p;)(u??(u=new Set)).add(c),y.push(c),c=c.next;if(c===null)continue}p.f&en||g.push(p),d=p,c=p.next}if(n.outrogroups!==null){for(const G of n.outrogroups)G.pending.size===0&&(Ji(ri(G.done)),(Q=n.outrogroups)==null||Q.delete(G));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||u!==void 0){var L=[];if(u!==void 0)for(p of u)p.f&ps||L.push(p);for(;c!==null;)!(c.f&ps)&&c!==n.fallback&&L.push(c),c=c.next;var H=L.length;if(H>0){var Y=s&iu&&i===0?t:null;if(a){for(k=0;k<H;k+=1)(B=(Z=L[k].nodes)==null?void 0:Z.a)==null||B.measure();for(k=0;k<H;k+=1)(I=(M=L[k].nodes)==null?void 0:M.a)==null||I.fix()}uv(n,L,Y)}}a&&qr(()=>{var G,se;if(f!==void 0)for(p of f)(se=(G=p.nodes)==null?void 0:G.a)==null||se.apply()})}function hv(n,e,t,s,r,a,i,l){var c=i&gf?i&yf?ar(t):jf(t,!1,!1):null,u=i&pf?ar(r):null;return{v:c,i:u,e:Ss(()=>(a(e,c??t,u??r,l),()=>{n.delete(s)}))}}function Kr(n,e,t){if(n.nodes)for(var s=n.nodes.start,r=n.nodes.end,a=e&&!(e.f&en)?e.nodes.start:t;s!==null;){var i=fa(s);if(a.before(s),s===r)return;s=i}}function pn(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function fv(n,e,t=!1,s=!1,r=!1){var a=n,i="";$(()=>{var l=Xe;if(i!==(i=e()??"")&&(l.nodes!==null&&(Nu(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var c=i+"";t?c=`<svg>${c}</svg>`:s&&(c=`<math>${c}</math>`);var u=Ku(c);if((t||s)&&(u=Sn(u)),ia(Sn(u),u.lastChild),t||s)for(;Sn(u);)a.before(Sn(u));else a.before(u)}})}function vv(n,e,t){Lo(()=>{var s=Nn(()=>e(n,t==null?void 0:t())||{});if(t&&(s!=null&&s.update)){var r=!1,a={};va(()=>{var i=t();rv(i),r&&lu(a,i)&&(a=i,s.update(i))}),r=!0}if(s!=null&&s.destroy)return()=>s.destroy()})}function Vu(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=Vu(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function gv(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=Vu(n))&&(s&&(s+=" "),s+=e);return s}function pv(n){return typeof n=="object"?gv(n):n??""}const Sl=[...` 	
\r\f\v\uFEFF`];function mv(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var a=r.length,i=0;(i=s.indexOf(r,i))>=0;){var l=i+a;(i===0||Sl.includes(s[i-1]))&&(l===s.length||Sl.includes(s[l]))?s=(i===0?"":s.substring(0,i))+s.substring(l+1):i=l}}return s===""?null:s}function yv(n,e){return n==null?null:String(n)}function et(n,e,t,s,r,a){var i=n.__className;if(i!==t||i===void 0){var l=mv(t,s,a);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(a&&r!==a)for(var c in a){var u=!!a[c];(r==null||u!==!!r[c])&&n.classList.toggle(c,u)}return a}function Ns(n,e,t,s){var r=n.__style;if(r!==e){var a=yv(e);a==null?n.removeAttribute("style"):n.style.cssText=a,n.__style=e}return s}function Qu(n,e,t=!1){if(n.multiple){if(e==null)return;if(!So(e))return Df();for(var s of n.options)s.selected=e.includes(Jr(s));return}for(s of n.options){var r=Jr(s);if(Gf(r,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function bv(n){var e=new MutationObserver(()=>{Qu(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Po(()=>{e.disconnect()})}function Xu(n,e,t=e){var s=new WeakSet,r=!0;Ro(n,"change",a=>{var i=a?"[selected]":":checked",l;if(n.multiple)l=[].map.call(n.querySelectorAll(i),Jr);else{var c=n.querySelector(i)??n.querySelector("option:not([disabled])");l=c&&Jr(c)}t(l),Fe!==null&&s.add(Fe)}),Lo(()=>{var a=e();if(n===document.activeElement){var i=Qr??Fe;if(s.has(i))return}if(Qu(n,a,r),r&&a===void 0){var l=n.querySelector(":checked");l!==null&&(a=Jr(l),t(a))}n.__value=a,r=!1}),bv(n)}function Jr(n){return"__value"in n?n.__value:n.value}const kv=Symbol("is custom element"),_v=Symbol("is html");function Bo(n,e){var t=Uo(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function In(n,e){var t=Uo(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Le(n,e,t,s){var r=Uo(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[nf]=t),t==null?n.removeAttribute(e):typeof t!="string"&&wv(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Uo(n){return n.__attributes??(n.__attributes={[kv]:n.nodeName.includes("-"),[_v]:n.namespaceURI===Sf})}var Dl=new Map;function wv(n){var e=n.getAttribute("is")||n.nodeName,t=Dl.get(e);if(t)return t;Dl.set(e,t=[]);for(var s,r=n,a=Element.prototype;a!==r;){s=tu(r);for(var i in s)s[i].set&&t.push(i);r=Do(r)}return t}function ut(n,e,t=e){var s=new WeakSet;Ro(n,"input",async r=>{var a=r?n.defaultValue:n.value;if(a=xi(n)?Si(a):a,t(a),Fe!==null&&s.add(Fe),await Wu(),a!==(a=e())){var i=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=a??"",l!==null){var u=n.value.length;i===l&&l===c&&u>c?(n.selectionStart=u,n.selectionEnd=u):(n.selectionStart=i,n.selectionEnd=Math.min(l,u))}}}),Nn(e)==null&&n.value&&(t(xi(n)?Si(n.value):n.value),Fe!==null&&s.add(Fe)),va(()=>{var r=e();if(n===document.activeElement){var a=Qr??Fe;if(s.has(a))return}xi(n)&&r===Si(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}function Ls(n,e,t=e){Ro(n,"change",s=>{var r=s?n.defaultChecked:n.checked;t(r)}),Nn(e)==null&&t(n.checked),va(()=>{var s=e();n.checked=!!s})}function xi(n){var e=n.type;return e==="number"||e==="range"}function Si(n){return n===""?null:+n}function El(n,e){return n===e||(n==null?void 0:n[nn])===e}function Ps(n={},e,t,s){return Lo(()=>{var r,a;return va(()=>{r=a,a=(s==null?void 0:s())||[],Nn(()=>{n!==t(...a)&&(e(n,...a),r&&El(t(...r),n)&&e(null,...r))})}),()=>{qr(()=>{a&&El(t(...a),n)&&e(null,...a)})}}),n}let Aa=!1;function Tv(n){var e=Aa;try{return Aa=!1,[n(),Aa]}finally{Aa=e}}function on(n,e,t,s){var S;var r=(t&_f)!==0,a=(t&wf)!==0,i=s,l=!0,c=()=>(l&&(l=!1,i=a?Nn(s):s),i),u;if(r){var d=nn in n||sf in n;u=((S=wr(n,e))==null?void 0:S.set)??(d&&e in n?D=>n[e]=D:void 0)}var f,g=!1;r?[f,g]=Tv(()=>n[e]):f=n[e],f===void 0&&s!==void 0&&(f=c(),u&&(uf(),u(f)));var y;if(y=()=>{var D=n[e];return D===void 0?c():(l=!0,D)},!(t&kf))return y;if(u){var _=n.$$legacy;return function(D,E){return arguments.length>0?((!E||_||g)&&u(E?y():D),D):y()}}var m=!1,p=(t&bf?oi:wu)(()=>(m=!1,y()));r&&o(p);var k=Xe;return function(D,E){if(arguments.length>0){const R=E?o(p):r?De(D):D;return T(p,R),m=!0,i!==void 0&&(i=R),D}return Rn&&m||k.f&sn?p.v:o(p)}}function pa(n){Ct===null&&Io(),Tt(()=>{const e=Nn(n);if(typeof e=="function")return e})}function xv(n){Ct===null&&Io(),pa(()=>()=>Nn(n))}const Sv="5";var Uc;typeof window<"u"&&((Uc=window.__svelte??(window.__svelte={})).v??(Uc.v=new Set)).add(Sv);function ci(){return{type:"daily",interval:1,time:"09:00"}}function Zu(n){return!n||!n.type||!n.interval||n.interval<1?!1:n.type==="weekly"?Array.isArray(n.weekdays)&&n.weekdays.length>0&&n.weekdays.every(e=>e>=0&&e<=6):n.type==="monthly"?n.dayOfMonth>=1&&n.dayOfMonth<=31:n.type==="yearly"?n.month>=0&&n.month<=11&&n.dayOfMonth>=1&&n.dayOfMonth<=31:!0}const Yn="recurring-tasks-active",Fa="recurring-tasks-archive",Al="recurring-tasks",Cl="recurring-tasks.json.bak",Il="n8n-event-settings",Ml="n8n-event-queue",Dv="notification-state",Ev="recurring-tasks-dock",Ol="scheduler-emitted-occurrences",yn=5,eo={n8n:{webhookUrl:"",sharedSecret:"",enabled:!1}},zo=60*1e3,Av=30*1e3,Di=2e3,Rl="shehab-note-recurring-plugin",Nl="1.0.0",Cv=60*60*1e3,Iv=3,Pl=10,Ei=1e3,qa=100,Ll=[{label:"15 minutes",minutes:15},{label:"30 minutes",minutes:30},{label:"1 hour",minutes:60},{label:"2 hours",minutes:120},{label:"4 hours",minutes:240}],Mv=[{label:"+1 day",minutes:60*24},{label:"+3 days",minutes:60*24*3},{label:"+1 week",minutes:60*24*7}],Ov={lowest:"#94a3b8",low:"#64748b",normal:"#3b82f6",medium:"#f59e0b",high:"#f97316",highest:"#ef4444"},Rv=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Fl="last-run-timestamp",ql="custom-recurring-task-id",Bl="custom-recurring-task-due",Ul="custom-recurring-task-enabled",Ca=3,zl=[1e3,5e3,3e4],Nv=1e4,$o={dueSoonScoreMax:100,dueSoonScoreMin:0,dueDateWeight:10,overdueBaseScore:110,overduePenaltyWeight:15,noDueDateScore:0,priorityMultipliers:{lowest:.8,low:1,normal:1.1,medium:1.2,high:1.5,highest:2},maxUrgency:200,minUrgency:0},Ju=24*60*60*1e3,Pv=(n,e,t)=>Math.min(t,Math.max(e,n)),$l=n=>new Date(n.getFullYear(),n.getMonth(),n.getDate()),Lv=(n,e)=>{const t=$l(n),s=$l(e);return Math.round((s.getTime()-t.getTime())/Ju)},Fv=(n,e)=>e.priorityMultipliers[n]??1;function Yo(n,e={}){return qv(n,e).score}function qv(n,e={}){const t=e.now??new Date,s=e.settings??$o;if(!Wo(n))return{score:0,breakdown:{priorityContribution:0,dueDateContribution:0,overdueContribution:0}};const r=Nr(n.priority)??"normal",a=Fv(r,s);if(!n.dueAt){const _=s.noDueDateScore,m=_*a;return{score:Ai(m,s),breakdown:{priorityContribution:m-_,dueDateContribution:_,overdueContribution:0}}}const i=new Date(n.dueAt);if(Number.isNaN(i.getTime())){const _=s.noDueDateScore,m=_*a;return{score:Ai(m,s),breakdown:{priorityContribution:m-_,dueDateContribution:_,overdueContribution:0}}}const l=i.getTime()<t.getTime(),c=Lv(t,i),u=l?Math.max(1,Math.ceil((t.getTime()-i.getTime())/Ju)):0,d=l?0:Pv(s.dueSoonScoreMax-c*s.dueDateWeight,s.dueSoonScoreMin,s.dueSoonScoreMax),f=l?s.overdueBaseScore+u*s.overduePenaltyWeight:0,g=d+f,y=g*a;return{score:Ai(y,s),breakdown:{priorityContribution:y-g,dueDateContribution:d,overdueContribution:f}}}function Ai(n,e){const t=e.maxUrgency!==void 0?Math.min(e.maxUrgency,n):n;return Math.round(Math.max(e.minUrgency,t))}function ma(n,e,t){const s=new Date().toISOString(),r=t||new Date;return{id:ed(),name:n,lastCompletedAt:void 0,dueAt:r.toISOString(),frequency:e,enabled:!0,priority:"normal",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0,maxSnoozes:3,version:yn,createdAt:s,updatedAt:s}}const Bv=["lowest","low","normal","medium","high","highest"];function Nr(n){if(!n)return;const e=n.toLowerCase();if(e==="urgent")return"highest";if(e==="none")return"normal";if(Bv.includes(e))return e}function ed(){return`task_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}function td(n,e={}){const t=new Date().toISOString();return{...{...n,id:ed(),createdAt:t,updatedAt:t,lastCompletedAt:void 0,completionCount:0,missCount:0,currentStreak:0,bestStreak:0,recentCompletions:[],snoozeCount:0},...e}}function Uv(n){var s;const e=new Date,t=e.toISOString();if(n.completionCount=(n.completionCount||0)+1,n.currentStreak=(n.currentStreak||0)+1,n.bestStreak=Math.max(n.bestStreak||0,n.currentStreak),n.recentCompletions||(n.recentCompletions=[]),n.recentCompletions.push(t),n.recentCompletions.length>Pl&&(n.recentCompletions=n.recentCompletions.slice(-Pl)),(s=n.smartRecurrence)!=null&&s.enabled){n.completionHistory||(n.completionHistory=[]);const r=new Date(n.dueAt),a=Math.round((e.getTime()-r.getTime())/(1e3*60)),i={scheduledFor:n.dueAt,completedAt:t,delayMinutes:a,dayOfWeek:e.getDay(),context:{tags:n.tags||[],relatedBlocks:n.linkedBlockId?[n.linkedBlockId]:[]}};n.completionHistory.push(i),n.completionHistory.length>100&&(n.completionHistory=n.completionHistory.slice(-100))}n.snoozeCount=0,n.lastCompletedAt=t,n.updatedAt=t}function sd(n){n.missCount=(n.missCount||0)+1,n.currentStreak=0,n.updatedAt=new Date().toISOString()}function nd(n){const e=n.completionCount||0,t=n.missCount||0,s=e+t;if(s===0)return 100;let a=e/s*70;const i=n.currentStreak||0,l=Math.min(30,i*3);return a+=l,Math.round(Math.min(100,a))}function zv(n,e){const t=new Set([...n.blockedBy??[],...n.dependsOn??[]]);return t.size===0?!1:e.filter(r=>t.has(r.id)).some(r=>Wo(r))}function $v(n,e){return e.some(t=>t.id===n.id||!new Set([...t.blockedBy??[],...t.dependsOn??[]]).has(n.id)?!1:Wo(t))}function Wo(n){return n.status?n.status==="todo":n.enabled}function Wn(n){const{message:e,type:t="info",duration:s=3e3,actionLabel:r,onAction:a,showCountdown:i=!1}=n,l=document.createElement("div");l.className=`recurring-tasks-toast recurring-tasks-toast--${t}`;const c=document.createElement("span");c.textContent=e,l.appendChild(c);let u=null;if(r&&a){const f=document.createElement("button");f.type="button";let g=Math.max(1,Math.ceil(s/1e3));f.textContent=i?`${r} (${g}s)`:r,f.className="recurring-tasks-toast__action",f.addEventListener("click",()=>{a(),u!==null&&window.clearInterval(u),l.parentElement&&l.parentElement.removeChild(l)}),l.appendChild(f),i&&s>0&&(u=window.setInterval(()=>{g=Math.max(0,g-1),f.textContent=`${r} (${g}s)`,g<=0&&u!==null&&(window.clearInterval(u),u=null)},1e3))}Object.assign(l.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 20px",borderRadius:"6px",backgroundColor:Yv(t),color:"white",fontSize:"14px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"10000",maxWidth:"420px",display:"flex",alignItems:"center",gap:"12px",animation:"slideInRight 0.3s ease-out"}),document.body.appendChild(l);const d=()=>{u!==null&&window.clearInterval(u),l.style.animation="slideOutRight 0.3s ease-out",setTimeout(()=>{l.parentElement&&l.parentElement.removeChild(l)},300)};s>0&&setTimeout(()=>{d()},s)}function Yv(n){switch(n){case"success":return"#4caf50";case"error":return"#f44336";case"warning":return"#ff9800";case"info":default:return"#2196f3"}}const j={success:(n,e)=>Wn({message:n,type:"success",duration:e}),error:(n,e)=>Wn({message:n,type:"error",duration:e}),warning:(n,e)=>Wn({message:n,type:"warning",duration:e}),info:(n,e)=>Wn({message:n,type:"info",duration:e})};if(typeof document<"u"){const n=document.createElement("style");n.textContent=`
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .recurring-tasks-toast__action {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
      white-space: nowrap;
    }

    .recurring-tasks-toast__action:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  `,document.head.appendChild(n)}class Wv{constructor(){b(this,"handlers",new Map)}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{var s;return(s=this.handlers.get(e))==null?void 0:s.delete(t)}}emit(e,t){var s;(s=this.handlers.get(e))==null||s.forEach(r=>r(t))}clear(){this.handlers.clear()}}const We=new Wv;function Ia(n,e){const t=n.findIndex(r=>r.id===e.id);if(t===-1)return[...n,e];const s=[...n];return s[t]=e,s}function Yl(n,e){const t=n.filter(s=>s.id!==e);return t.length===n.length?n:t}function Ci(n,e,t){let s=!1;const r=n.map(a=>a.id!==e?a:(s=!0,t(a)));return s?r:n}function jv(n,e=new Date){const t=new Date(e);return t.setHours(23,59,59,999),n.filter(s=>s.enabled?new Date(s.dueAt)<=t:!1)}const jo=Symbol("urgency-settings"),Hv=(()=>{try{if(typeof process<"u"&&process.env)return process.env.DEBUG==="true"}catch{}return!1})();function ui(n,e,t){const s={timestamp:new Date().toISOString()},r=`[${n.toUpperCase()}] [${s.timestamp}]`;n==="error"?console.error(r,e,t||""):n==="warn"?console.warn(r,e,t||""):n==="debug"&&Hv?console.debug(r,e,t||""):n==="info"&&console.log(r,e,t||"")}function ea(n,e){ui("debug",n,e)}function ne(n,e){ui("info",n,e)}function ze(n,e){ui("warn",n,e)}function ye(n,e){ui("error",n,e)}async function Gv(n){return new Promise(e=>{try{wo.fetchPost("/api/block/getBlockInfo",{id:n},t=>{var r,a,i;const s=((r=t==null?void 0:t.data)==null?void 0:r.content)??((a=t==null?void 0:t.data)==null?void 0:a.markdown)??((i=t==null?void 0:t.data)==null?void 0:i.name)??null;e(s?s.trim():null)})}catch(t){ze("Failed to fetch block preview",t),e(null)}})}async function Kv(n){return new Promise(e=>{try{wo.fetchPost("/api/block/getBlockHTML",{id:n},t=>{var r;const s=((r=t==null?void 0:t.data)==null?void 0:r.html)??null;e(s?s.trim():null)})}catch(t){ze("Failed to fetch block embed",t),e(null)}})}function to(n){const[e,t]=n.split(":").map(Number);return{hours:e,minutes:t}}function Vv(n){const e=n.getHours().toString().padStart(2,"0"),t=n.getMinutes().toString().padStart(2,"0");return`${e}:${t}`}function Qv(n){return n.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function so(n){return n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Ho(n){const e=new Date;return n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()}function Xv(n){return n<new Date}function Zv(n){return Xv(n)&&!Ho(n)}function Mn(n,e){const t=new Date(n);return t.setDate(t.getDate()+e),t}function Wl(n,e){return Mn(n,e*7)}function Ii(n,e,t){const s=new Date(n);return s.setHours(e,t,0,0),s}function jl(n,e,t){const s=new Date(n);s.setHours(e,t,0,0);const r=s.getHours()!==e||s.getMinutes()!==t;return{date:s,shifted:r}}function no(n){const e=new Date(n);return e.setHours(0,0,0,0),e}function Jv(n){const e=new Date(n);return e.setHours(23,59,59,999),e}function eg(n,e){const s=Math.abs(e.getTime()-n.getTime());return Math.floor(s/864e5)}function tg(n,e){const t=[];for(let s=0;s<e;s++)t.push(Mn(n,s));return t}var sg=C('<span class="task-card__streak svelte-yjw1ud"> </span>'),ng=C('<button class="task-card__edit-btn svelte-yjw1ud" title="Edit"></button>'),rg=C('<span class="task-card__relative svelte-yjw1ud"> </span>'),ag=C('<div class="task-card__last-completed svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Last completed:</span> <span class="task-card__value svelte-yjw1ud"> </span></div>'),ig=C('<div class="task-card__block-preview-html svelte-yjw1ud"><!></div>'),og=C('<div class="task-card__block-preview svelte-yjw1ud" role="tooltip"><!></div>'),lg=C('<div class="task-card__linked-block svelte-yjw1ud"><button class="task-card__block-link svelte-yjw1ud"> </button> <!></div>'),cg=C('<button class="task-card__snooze-chip"> </button>'),ug=C('<button class="task-card__snooze-option" role="menuitem"> </button>'),dg=C('<div class="task-card__snooze-menu" role="menu" tabindex="0" aria-label="Snooze options"></div>'),hg=C('<div role="article" tabindex="0"><div class="task-card__header svelte-yjw1ud"><div class="task-card__title-row svelte-yjw1ud"><div class="task-card__priority-indicator svelte-yjw1ud"></div> <h3 class="task-card__name svelte-yjw1ud"> </h3> <!></div> <!></div> <div class="task-card__details svelte-yjw1ud"><div class="task-card__due svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Due:</span> <span class="task-card__value svelte-yjw1ud"> </span> <!></div> <div class="task-card__urgency svelte-yjw1ud"><span class="task-card__label svelte-yjw1ud">Urgency:</span> <span class="task-card__value svelte-yjw1ud"> </span></div> <!> <!></div> <div><div class="task-card__health-bar"></div></div> <div class="task-card__actions svelte-yjw1ud"><div class="task-card__snooze-container svelte-yjw1ud"><button class="task-card__action task-card__action--snooze" aria-label="Snooze task" aria-haspopup="menu"> Snooze</button> <div class="task-card__snooze-quick"><!> <button class="task-card__snooze-chip task-card__snooze-chip--tomorrow" aria-label="Snooze until tomorrow">Tomorrow</button></div> <!></div> <button class="task-card__action task-card__action--delay" aria-label="Delay task to tomorrow"> Tomorrow</button> <button class="task-card__action task-card__action--skip" aria-label="Skip this occurrence"> Skip</button> <button class="task-card__action task-card__action--done" aria-label="Mark task as done"> Done</button></div></div>');function Br(n,e){ht(e,!0);const t=J(()=>new Date(e.task.dueAt)),s=J(()=>Zv(o(t))),r=J(()=>Ho(o(t))),a=J(()=>o(s)?eg(new Date(e.task.dueAt),new Date):0),i=J(()=>o(s)?"task-card--overdue":o(r)?"task-card--today":""),l=J(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.45,.12+o(a)*.05)})`:""),c=J(()=>()=>o(s)?`rgba(244, 67, 54, ${Math.min(.8,.3+o(a)*.08)})`:""),u=J(()=>()=>{const re=Nr(e.task.priority)||"normal";return Ov[re]}),d=J(()=>()=>e.timezoneHandler?e.timezoneHandler.getRelativeTime(o(t)):""),f=J(()=>(e.task.currentStreak||0)>0),g=J(()=>()=>""),y=J(()=>nd(e.task)),_=J(()=>o(y)>=80?"health--good":o(y)>=50?"health--fair":"health--poor"),m=uu(jo),p=J(()=>Yo(e.task,{settings:m}));let k=V(!1),S=V(-1),D=[],E=V(!1),R=V(null),P=V(null),L=V(!1);const H=J(()=>()=>e.task.linkedBlockId?e.task.linkedBlockId.length>10?`${e.task.linkedBlockId.slice(0,10)}`:e.task.linkedBlockId:""),Y=J(()=>()=>{if(!o(R))return"";const re=o(R).replace(/\s+/g," ").trim();return re.length>220?`${re.slice(0,220)}`:re}),X=J(()=>()=>Ll.filter(re=>[15,60,120].includes(re.minutes))),oe=J(()=>()=>`snooze-menu-${e.task.id}`);Tt(()=>{T(R,e.task.linkedBlockContent??null,!0),T(P,null),T(L,!1)});function ae(){e.onDone(e.task)}function ve(){e.onDelay(e.task)}function Q(){e.onEdit&&e.onEdit(e.task)}function Z(){e.onSkip(e.task)}async function B(){T(k,!o(k)),o(k)&&(await Wu(),T(S,-1),D=[])}function M(re){const we=new CustomEvent("task-snooze",{detail:{taskId:e.task.id,minutes:re}});window.dispatchEvent(we),T(k,!1),T(S,-1)}function I(re){var pe,Oe,he,Te;const we=o(X);re.key==="ArrowDown"?(re.preventDefault(),T(S,Math.min(o(S)+1,we.length-1),!0),(pe=D[o(S)])==null||pe.focus()):re.key==="ArrowUp"?(re.preventDefault(),T(S,Math.max(o(S)-1,0),!0),(Oe=D[o(S)])==null||Oe.focus()):re.key==="Escape"?(T(k,!1),T(S,-1)):re.key==="Home"?(re.preventDefault(),T(S,0),(he=D[0])==null||he.focus()):re.key==="End"&&(re.preventDefault(),T(S,we.length-1),(Te=D[o(S)])==null||Te.focus())}function G(re){if(re.key==="Escape"&&o(k)){T(k,!1);return}(re.key==="Enter"||re.key===" ")&&(re.preventDefault(),B())}async function se(){if(T(E,!0),!e.task.linkedBlockId||o(L)||o(P))return;T(L,!0);const[re,we]=await Promise.all([Kv(e.task.linkedBlockId),Gv(e.task.linkedBlockId)]);T(P,re,!0),T(R,we,!0),T(L,!1)}function ke(){T(E,!1)}const ge=J(()=>()=>`Task:  ${e.task.name.replace(/[<>"&]/g,we=>({"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;"})[we]||we)}`);var ce=hg();ce.__keydown=re=>{re.key==="Escape"&&o(k)&&T(k,!1)};var Ie=h(ce),Me=h(Ie),Ue=h(Me),de=v(Ue,2),U=h(de),A=v(de,2);{var F=re=>{var we=sg(),pe=h(we);$(Oe=>{Le(we,"title",`${e.task.currentStreak??""} day streak`),N(pe,`${Oe??""} ${e.task.currentStreak??""}`)},[()=>o(g)()]),x(re,we)};W(A,re=>{o(f)&&re(F)})}var K=v(Me,2);{var ie=re=>{var we=ng();we.__click=Q,x(re,we)};W(K,re=>{e.onEdit&&re(ie)})}var O=v(Ie,2),q=h(O),ee=v(h(q),2),me=h(ee),_e=v(ee,2);{var ue=re=>{var we=rg(),pe=h(we);$(Oe=>N(pe,Oe),[()=>o(d)()]),x(re,we)};W(_e,re=>{e.timezoneHandler&&re(ue)})}var Ee=v(q,2),Ae=v(h(Ee),2),$e=h(Ae),Je=v(Ee,2);{var Ge=re=>{var we=ag(),pe=v(h(we),2),Oe=h(pe);$(he=>N(Oe,he),[()=>so(new Date(e.task.lastCompletedAt))]),x(re,we)};W(Je,re=>{e.task.lastCompletedAt&&re(Ge)})}var at=v(Je,2);{var dt=re=>{var we=lg(),pe=h(we),Oe=h(pe),he=v(pe,2);{var Te=Re=>{var pt=og(),$t=h(pt);{var St=Dt=>{var Lt=Ti("Loading preview");x(Dt,Lt)},Gt=Dt=>{var Lt=lt(),Cs=Qe(Lt);{var Yt=Kt=>{var z=ig(),be=h(z);fv(be,()=>o(P)),x(Kt,z)},ns=Kt=>{var z=lt(),be=Qe(z);{var nt=Vt=>{var fn=Ti();$(()=>N(fn,o(Y))),x(Vt,fn)},rs=Vt=>{var fn=Ti("No preview available.");x(Vt,fn)};W(be,Vt=>{o(R)?Vt(nt):Vt(rs,!1)},!0)}x(Kt,z)};W(Cs,Kt=>{o(P)?Kt(Yt):Kt(ns,!1)},!0)}x(Dt,Lt)};W($t,Dt=>{o(L)?Dt(St):Dt(Gt,!1)})}x(Re,pt)};W(he,Re=>{o(E)&&Re(Te)})}$(()=>{Le(pe,"title",`Linked block: ${e.task.linkedBlockId}`),N(Oe,` Block ${o(H)??""}`)}),Ut("mouseenter",pe,se),Ut("mouseleave",pe,ke),Ut("focus",pe,se),Ut("blur",pe,ke),x(re,we)};W(at,re=>{e.task.linkedBlockId&&re(dt)})}var Ce=v(O,2),Ne=h(Ce),Se=v(Ce,2),Pe=h(Se),Ke=h(Pe);Ke.__click=B,Ke.__keydown=G;var Be=v(Ke,2),st=h(Be);He(st,17,()=>o(X),bt,(re,we)=>{var pe=cg();pe.__click=()=>M(o(we).minutes);var Oe=h(pe);$(()=>{Le(pe,"aria-label",`Snooze for ${o(we).label}`),N(Oe,o(we).label)}),x(re,pe)});var mt=v(st,2);mt.__click=ve;var gt=v(Be,2);{var It=re=>{var we=dg();we.__keydown=I,He(we,21,()=>Ll,bt,(pe,Oe,he)=>{var Te=ug();Te.__click=()=>M(o(Oe).minutes),Le(Te,"tabindex",he===0?0:-1);var Re=h(Te);Ps(Te,(pt,$t)=>D[$t]=pt,pt=>D==null?void 0:D[pt],()=>[he]),$(()=>N(Re,o(Oe).label)),x(pe,Te)}),$(()=>Le(we,"id",o(oe))),x(re,we)};W(gt,re=>{o(k)&&re(It)})}var yt=v(Pe,2);yt.__click=ve;var Pt=v(yt,2);Pt.__click=Z;var ss=v(Pt,2);ss.__click=ae,$((re,we)=>{et(ce,1,`task-card ${o(i)??""}`,"svelte-yjw1ud"),Ns(ce,`--overdue-tint: ${o(l)??""}; --overdue-border: ${o(c)??""};`),Le(ce,"aria-label",re),Le(ce,"data-task-id",e.task.id),Ns(Ue,`background-color: ${o(u)??""}`),Le(Ue,"title",`Priority:  ${(e.task.priority||"normal")??""}`),N(U,e.task.name),N(me,we),Le(Ee,"title",`Urgency score: ${o(p)??""}`),N($e,o(p)),et(Ce,1,`task-card__health ${o(_)??""}`,"svelte-yjw1ud"),Le(Ce,"title",`Task health:  ${o(y)??""}%`),Ns(Ne,`width: ${o(y)??""}%`),Le(Ke,"aria-expanded",o(k)),Le(Ke,"aria-controls",o(oe))},[()=>o(ge)(),()=>so(o(t))]),x(n,ce),ft()}xt(["keydown","click"]);var fg=C(`<div class="today-tab__empty svelte-u7986x"><p class="svelte-u7986x"> No tasks due today or overdue!</p> <p class="today-tab__empty-subtitle svelte-u7986x">You're all caught up.</p></div>`),vg=C('<div class="today-tab__card-wrapper svelte-u7986x" role="listitem"><!></div>'),gg=C('<div class="today-tab svelte-u7986x"><div class="today-tab__header svelte-u7986x"><h2 class="today-tab__title svelte-u7986x">Today & Overdue Tasks</h2> <p class="today-tab__subtitle svelte-u7986x"> </p></div> <div class="today-tab__content svelte-u7986x" role="list" aria-label="Today and overdue tasks"><!></div></div>');function pg(n,e){ht(e,!0);const t=J(()=>[...e.tasks].sort((m,p)=>new Date(m.dueAt).getTime()-new Date(p.dueAt).getTime()));let s=V(0),r=De([]);Tt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var k;if(o(t).length===0)return;const p=Math.max(0,Math.min(m,o(t).length-1));T(s,p,!0),(k=r[p])==null||k.focus()}function i(m,p){m.key==="ArrowDown"?(m.preventDefault(),a(p+1)):m.key==="ArrowUp"?(m.preventDefault(),a(p-1)):m.key==="Home"?(m.preventDefault(),a(0)):m.key==="End"&&(m.preventDefault(),a(o(t).length-1))}var l=gg(),c=h(l),u=v(h(c),2),d=h(u),f=v(c,2),g=h(f);{var y=m=>{var p=fg();x(m,p)},_=m=>{var p=lt(),k=Qe(p);He(k,19,()=>o(t),S=>S.id,(S,D,E)=>{var R=vg();R.__keydown=L=>i(L,o(E));var P=h(R);Br(P,{get task(){return o(D)},get onDone(){return e.onDone},get onDelay(){return e.onDelay},get onSkip(){return e.onSkip},get onEdit(){return e.onEdit},get timezoneHandler(){return e.timezoneHandler}}),Ps(R,(L,H)=>r[H]=L,L=>r==null?void 0:r[L],()=>[o(E)]),$(()=>Le(R,"tabindex",o(E)===o(s)?0:-1)),Ut("focus",R,()=>T(s,o(E),!0)),x(S,R)}),x(m,p)};W(g,m=>{o(t).length===0?m(y):m(_,!1)})}$(()=>N(d,`${e.tasks.length??""} task${e.tasks.length!==1?"s":""} requiring attention`)),x(n,l),ft()}xt(["keydown"]);var mg=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn">No recurring tasks yet.</p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Create your first task to get started!</p></div>'),yg=C('<div class="all-tasks-tab__empty svelte-i091qn"><p class="svelte-i091qn"> </p> <p class="all-tasks-tab__empty-subtitle svelte-i091qn">Try a different search term.</p></div>'),bg=C('<tr><td class="all-tasks-tab__select-col svelte-i091qn"><input type="checkbox"/></td><td class="task-name svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"> </td><td class="svelte-i091qn"><label class="toggle-switch svelte-i091qn"><input type="checkbox" class="svelte-i091qn"/> <span class="toggle-slider svelte-i091qn"></span></label></td><td class="svelte-i091qn"><div class="task-actions svelte-i091qn"><button class="task-action-btn task-action-btn--edit svelte-i091qn" title="Edit"></button> <button class="task-action-btn task-action-btn--duplicate svelte-i091qn" title="Duplicate"></button> <button class="task-action-btn task-action-btn--delete svelte-i091qn" title="Delete"></button></div></td></tr>'),kg=C('<table class="all-tasks-tab__table svelte-i091qn"><thead class="svelte-i091qn"><tr class="svelte-i091qn"><th class="all-tasks-tab__select-col svelte-i091qn"><input class="all-tasks-tab__select-all svelte-i091qn" type="checkbox" aria-label="Select all visible tasks"/></th><th class="svelte-i091qn">Task Name</th><th class="svelte-i091qn">Next Due</th><th class="svelte-i091qn">Frequency</th><th class="svelte-i091qn">Status</th><th class="svelte-i091qn">Actions</th></tr></thead><tbody></tbody></table>'),_g=C('<div class="all-tasks-tab__table-wrapper svelte-i091qn"><!></div>'),wg=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Task?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),Tg=C('<div class="delete-confirm-overlay svelte-i091qn"><div class="delete-confirm-dialog svelte-i091qn"><h3 class="svelte-i091qn">Delete Selected Tasks?</h3> <p class="svelte-i091qn"> </p> <div class="delete-confirm-actions svelte-i091qn"><button class="btn-cancel svelte-i091qn">Cancel</button> <button class="btn-delete svelte-i091qn">Delete</button></div></div></div>'),xg=C('<div class="all-tasks-tab svelte-i091qn"><div class="all-tasks-tab__header svelte-i091qn"><h2 class="all-tasks-tab__title svelte-i091qn">All Recurring Tasks</h2> <div class="all-tasks-tab__actions svelte-i091qn"><div class="all-tasks-tab__search svelte-i091qn"><span class="all-tasks-tab__search-icon svelte-i091qn"></span> <input class="all-tasks-tab__search-input svelte-i091qn" type="search" placeholder="Search tasks (name, tags, block content)" aria-label="Search tasks" title="Searches task names, descriptions, tags, and linked block content."/></div> <button class="all-tasks-tab__create-btn svelte-i091qn">+ Create New Task</button></div></div> <div class="all-tasks-tab__content svelte-i091qn"><div class="all-tasks-tab__bulk svelte-i091qn"><div class="all-tasks-tab__bulk-info"> </div> <div class="all-tasks-tab__bulk-actions svelte-i091qn"><button class="all-tasks-tab__bulk-btn svelte-i091qn">Enable</button> <button class="all-tasks-tab__bulk-btn svelte-i091qn">Disable</button> <button class="all-tasks-tab__bulk-btn all-tasks-tab__bulk-btn--danger svelte-i091qn">Delete</button></div></div> <!></div></div> <!> <!>',1);function Sg(n,e){ht(e,!0);let t=V(null),s=V(!1),r=V(""),a=V(""),i=V(De(new Set)),l=V(0),c=De([]),u=V(null);const d=J(()=>[...e.tasks].sort((O,q)=>new Date(O.dueAt).getTime()-new Date(q.dueAt).getTime())),f=J(()=>()=>{const O=o(a).trim().toLowerCase();return O?o(d).filter(q=>{var me;return[q.name,q.description,q.category,q.linkedBlockContent,(me=q.tags)==null?void 0:me.join(" ")].filter(Boolean).join(" ").toLowerCase().includes(O)}):o(d)}),g=J(()=>o(f).map(O=>O.id)),y=J(()=>o(i).size>0),_=J(()=>o(f).length>0&&o(f).every(O=>o(i).has(O.id))),m=J(()=>o(f).some(O=>o(i).has(O.id))&&!o(_));Tt(()=>{const O=new Set([...o(i)].filter(q=>e.tasks.some(ee=>ee.id===q)));O.size!==o(i).size&&T(i,O,!0)}),Tt(()=>{o(u)&&(o(u).indeterminate=o(m))}),Tt(()=>{o(l)>=o(f).length&&T(l,Math.max(0,o(f).length-1),!0)}),Tt(()=>{const O=window.setTimeout(()=>{T(a,o(r),!0)},300);return()=>{window.clearTimeout(O)}});function p(O){T(t,O,!0)}function k(){o(t)&&(e.onDelete(o(t)),T(t,null))}function S(){T(t,null)}function D(O){const q=new Set(o(i));q.has(O)?q.delete(O):q.add(O),T(i,q,!0)}function E(){const O=new Set(o(i));o(_)?o(g).forEach(q=>O.delete(q)):o(g).forEach(q=>O.add(q)),T(i,O,!0)}function R(O){var ee;if(o(f).length===0)return;const q=Math.max(0,Math.min(O,o(f).length-1));T(l,q,!0),(ee=c[q])==null||ee.focus()}function P(O,q){O.key==="ArrowDown"?(O.preventDefault(),R(q+1)):O.key==="ArrowUp"?(O.preventDefault(),R(q-1)):O.key==="Home"?(O.preventDefault(),R(0)):O.key==="End"&&(O.preventDefault(),R(o(f).length-1))}function L(){if(o(i).size===0){T(s,!1);return}e.onBulkDelete([...o(i)]),T(i,new Set,!0),T(s,!1)}function H(){T(s,!1)}function Y(O){const{type:q,interval:ee}=O.frequency,me=q==="daily"?"day":q==="weekly"?"week":q==="monthly"?"month":"year",_e=ee===1?`Every ${me}`:`Every ${ee} ${me}s`;if(q==="weekly")return`${_e} on ${O.frequency.weekdays.map(ue=>Rv[ue]??ue).join(", ")}`;if(q==="monthly")return`${_e} on day ${O.frequency.dayOfMonth}`;if(q==="yearly"){const ue=X[O.frequency.month]??`Month ${O.frequency.month+1}`;return`${_e} on ${ue} ${O.frequency.dayOfMonth}`}return _e}const X=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var oe=xg(),ae=Qe(oe),ve=h(ae),Q=v(h(ve),2),Z=h(Q),B=v(h(Z),2),M=v(Z,2);M.__click=function(...O){var q;(q=e.onCreate)==null||q.apply(this,O)};var I=v(ve,2),G=h(I),se=h(G),ke=h(se),ge=v(se,2),ce=h(ge);ce.__click=()=>e.onBulkEnable([...o(i)]);var Ie=v(ce,2);Ie.__click=()=>e.onBulkDisable([...o(i)]);var Me=v(Ie,2);Me.__click=()=>T(s,!0);var Ue=v(G,2);{var de=O=>{var q=mg();x(O,q)},U=O=>{var q=_g(),ee=h(q);{var me=ue=>{var Ee=yg(),Ae=h(Ee),$e=h(Ae);$(Je=>N($e,`No tasks match "${Je??""}".`),[()=>o(a).trim()]),x(ue,Ee)},_e=ue=>{var Ee=kg(),Ae=h(Ee),$e=h(Ae),Je=h($e),Ge=h(Je);Ge.__click=E,Ps(Ge,dt=>T(u,dt),()=>o(u));var at=v(Ae);He(at,23,()=>o(f),dt=>dt.id,(dt,Ce,Ne)=>{var Se=bg();Se.__keydown=Re=>P(Re,o(Ne));var Pe=h(Se),Ke=h(Pe);Ke.__click=()=>D(o(Ce).id);var Be=v(Pe),st=h(Be),mt=v(Be),gt=h(mt),It=v(mt),yt=h(It),Pt=v(It),ss=h(Pt),re=h(ss);re.__change=()=>e.onToggleEnabled(o(Ce));var we=v(Pt),pe=h(we),Oe=h(pe);Oe.__click=()=>e.onEdit(o(Ce));var he=v(Oe,2);he.__click=()=>e.onDuplicate(o(Ce));var Te=v(he,2);Te.__click=()=>p(o(Ce)),Ps(Se,(Re,pt)=>c[pt]=Re,Re=>c==null?void 0:c[Re],()=>[o(Ne)]),$((Re,pt,$t,St)=>{et(Se,1,pv(o(Ce).enabled?"":"disabled"),"svelte-i091qn"),Le(Se,"tabindex",o(Ne)===o(l)?0:-1),Le(Se,"aria-selected",Re),Le(Ke,"aria-label",`Select ${o(Ce).name}`),In(Ke,pt),N(st,o(Ce).name),N(gt,$t),N(yt,St),In(re,o(Ce).enabled)},[()=>o(i).has(o(Ce).id),()=>o(i).has(o(Ce).id),()=>so(new Date(o(Ce).dueAt)),()=>Y(o(Ce))]),Ut("focus",Se,()=>T(l,o(Ne),!0)),x(dt,Se)}),$(()=>{In(Ge,o(_)),Ge.disabled=o(f).length===0}),x(ue,Ee)};W(ee,ue=>{o(f).length===0?ue(me):ue(_e,!1)})}x(O,q)};W(Ue,O=>{o(d).length===0?O(de):O(U,!1)})}var A=v(ae,2);{var F=O=>{var q=wg(),ee=h(q),me=v(h(ee),2),_e=h(me),ue=v(me,2),Ee=h(ue);Ee.__click=S;var Ae=v(Ee,2);Ae.__click=k,$(()=>N(_e,`Are you sure you want to delete "${o(t).name??""}"? This action cannot be undone.`)),x(O,q)};W(A,O=>{o(t)&&O(F)})}var K=v(A,2);{var ie=O=>{var q=Tg(),ee=h(q),me=v(h(ee),2),_e=h(me),ue=v(me,2),Ee=h(ue);Ee.__click=H;var Ae=v(Ee,2);Ae.__click=L,$(()=>N(_e,`Are you sure you want to delete ${o(i).size??""} task${o(i).size===1?"":"s"}? This action cannot be undone.`)),x(O,q)};W(K,O=>{o(s)&&O(ie)})}$(()=>{B.disabled=o(d).length===0,N(ke,`${o(i).size??""} selected`),ce.disabled=!o(y),Ie.disabled=!o(y),Me.disabled=!o(y)}),ut(B,()=>o(r),O=>T(r,O)),x(n,oe),ft()}xt(["click","keydown","change"]);var Dg=C('<div class="timeline-tab__empty svelte-11jqy0n"><p> </p></div>'),Eg=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),Ag=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),Cg=C('<span class="timeline-task__meta-item svelte-11jqy0n"> </span>'),Ig=C('<div class="timeline-task svelte-11jqy0n"><div class="timeline-task__time svelte-11jqy0n"> </div> <div class="timeline-task__content svelte-11jqy0n"><div class="timeline-task__name svelte-11jqy0n"> </div> <div class="timeline-task__meta svelte-11jqy0n"><!> <!> <!></div></div></div>'),Mg=C('<div class="timeline-day svelte-11jqy0n"><div class="timeline-day__date svelte-11jqy0n"><div class="timeline-day__date-label svelte-11jqy0n"> </div> <div class="timeline-day__weekday svelte-11jqy0n"> </div></div> <div class="timeline-day__tasks svelte-11jqy0n"></div></div>'),Og=C('<div class="timeline-tab__timeline svelte-11jqy0n"></div>'),Rg=C('<div class="timeline-tab svelte-11jqy0n"><div class="timeline-tab__header svelte-11jqy0n"><h2 class="timeline-tab__title svelte-11jqy0n">Scheduled Timeline</h2> <p class="timeline-tab__subtitle svelte-11jqy0n"> </p></div> <div class="timeline-tab__content svelte-11jqy0n"><!></div></div>');function Ng(n,e){ht(e,!0);let t=on(e,"days",3,30);function s(k){const{frequency:S}=k;if(S.type==="weekly"){const D=[...S.weekdays].sort((E,R)=>E-R).join(",");return`weekly:${S.interval}:${S.time??""}:${D}`}return S.type==="monthly"?`monthly:${S.interval}:${S.time??""}:${S.dayOfMonth}`:S.type==="yearly"?`yearly:${S.interval}:${S.time??""}:${S.month}:${S.dayOfMonth}`:`daily:${S.interval}:${S.time??""}`}function r(k,S){const D=k.map(E=>`${E.id}:${E.enabled}:${E.dueAt}:${s(E)}`).join("|");return`${S}:${D}`}function a(k,S){const D=no(new Date),E=Jv(Mn(D,S-1)),R=24*60*60*1e3,L=tg(D,S).map(H=>({date:H,tasks:[]}));for(const H of k.filter(Y=>Y.enabled)){const Y=new Date(H.dueAt),X=e.recurrenceEngine.getOccurrencesInRange(D,E,H.frequency,Y);for(const oe of X){const ae=no(oe),ve=Math.floor((ae.getTime()-D.getTime())/R);ve>=0&&ve<S&&L[ve].tasks.push({task:H,occurrence:oe})}}for(const H of L)H.tasks.sort((Y,X)=>Y.occurrence.getTime()-X.occurrence.getTime());return L}const i=(()=>{let k="",S=[];return{get(D,E){const R=r(D,E);return R===k||(k=R,S=a(D,E)),S}}})(),l=J(()=>i.get(e.tasks,t())),c=J(()=>o(l).some(k=>k.tasks.length>0));var u=Rg(),d=h(u),f=v(h(d),2),g=h(f),y=v(d,2),_=h(y);{var m=k=>{var S=Dg(),D=h(S),E=h(D);$(()=>N(E,`No tasks scheduled in the next ${t()??""} days.`)),x(k,S)},p=k=>{var S=Og();He(S,21,()=>o(l),D=>D.date.toISOString(),(D,E)=>{var R=lt(),P=Qe(R);{var L=H=>{var Y=Mg(),X=h(Y),oe=h(X),ae=h(oe),ve=v(oe,2),Q=h(ve),Z=v(X,2);He(Z,21,()=>o(E).tasks,({task:B,occurrence:M})=>B.id+M.toISOString(),(B,M)=>{let I=()=>o(M).task,G=()=>o(M).occurrence;var se=Ig(),ke=h(se),ge=h(ke),ce=v(ke,2),Ie=h(ce),Me=h(Ie),Ue=v(Ie,2),de=h(Ue);{var U=O=>{var q=Eg(),ee=h(q);$(()=>N(ee,` ${I().linkedBlockId??""}`)),x(O,q)};W(de,O=>{I().linkedBlockId&&O(U)})}var A=v(de,2);{var F=O=>{var q=Ag(),ee=h(q);$(()=>N(ee,` ${I().priority??""}`)),x(O,q)};W(A,O=>{I().priority&&O(F)})}var K=v(A,2);{var ie=O=>{var q=Cg(),ee=h(q);$(me=>N(ee,` ${me??""}`),[()=>I().tags.join(", ")]),x(O,q)};W(K,O=>{var q;(q=I().tags)!=null&&q.length&&O(ie)})}$(O=>{N(ge,O),N(Me,I().name)},[()=>Vv(G())]),x(B,se)}),$((B,M)=>{N(ae,B),N(Q,M)},[()=>Qv(o(E).date),()=>o(E).date.toLocaleDateString(void 0,{weekday:"short"})]),x(H,Y)};W(P,H=>{o(E).tasks.length>0&&H(L)})}x(D,R)}),x(k,S)};W(_,k=>{o(c)?k(p,!1):k(m)})}$(()=>N(g,`Next ${t()??""} days`)),x(n,u),ft()}var Pg=C('<span class="leaderboard-item__badge svelte-1ptoc1q"> Best</span>'),Lg=C('<div class="leaderboard-item svelte-1ptoc1q"><div class="leaderboard-item__rank svelte-1ptoc1q"></div> <div class="leaderboard-item__name svelte-1ptoc1q"> </div> <div class="leaderboard-item__value svelte-1ptoc1q"> <!></div></div>'),Fg=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q"> Current Streaks</h3> <div class="leaderboard svelte-1ptoc1q"></div></div>'),qg=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),Bg=C('<h4 class="subsection-title svelte-1ptoc1q"> Best Performing</h4> <div class="health-list svelte-1ptoc1q"></div>',1),Ug=C('<div class="health-item svelte-1ptoc1q"><div class="health-item__name svelte-1ptoc1q"> </div> <div class="health-item__bar-container svelte-1ptoc1q"><div class="health-item__bar svelte-1ptoc1q"></div> <div class="health-item__score svelte-1ptoc1q"> </div></div></div>'),zg=C('<h4 class="subsection-title svelte-1ptoc1q"> Needs Attention</h4> <div class="health-list svelte-1ptoc1q"></div>',1),$g=C('<div class="activity-item svelte-1ptoc1q"><div class="activity-item__icon svelte-1ptoc1q"></div> <div class="activity-item__details svelte-1ptoc1q"><div class="activity-item__name svelte-1ptoc1q"> </div> <div class="activity-item__time svelte-1ptoc1q"> </div></div></div>'),Yg=C('<div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Recent Activity</h3> <div class="activity-list svelte-1ptoc1q"></div></div>'),Wg=C('<div class="analytics-tab svelte-1ptoc1q"><div class="analytics-tab__header svelte-1ptoc1q"><h2 class="analytics-tab__title svelte-1ptoc1q">Task Analytics</h2> <p class="analytics-tab__subtitle svelte-1ptoc1q">Performance insights and statistics</p></div> <div class="analytics-tab__content svelte-1ptoc1q"><div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Overall Performance</h3> <div class="stats-grid svelte-1ptoc1q"><div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Completions</div></div> <div class="stat-card svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Total Misses</div></div> <div class="stat-card stat-card--highlight svelte-1ptoc1q"><div class="stat-card__value svelte-1ptoc1q"> </div> <div class="stat-card__label svelte-1ptoc1q">Completion Rate</div></div></div></div> <!> <div class="analytics-section svelte-1ptoc1q"><h3 class="analytics-section__title svelte-1ptoc1q">Task Health Scores</h3> <!> <!></div> <!></div></div>');function jg(n,e){ht(e,!0);const t=J(()=>()=>{let B=0,M=0;for(const se of e.tasks)B+=se.completionCount||0,M+=se.missCount||0;const I=B+M,G=I>0?B/I*100:100;return{totalCompletions:B,totalMisses:M,completionRate:Math.round(G)}}),s=J(()=>()=>[...e.tasks].filter(B=>(B.currentStreak||0)>0).sort((B,M)=>(M.currentStreak||0)-(B.currentStreak||0)).slice(0,10)),r=J(()=>()=>[...e.tasks].map(B=>({task:B,health:nd(B)})).sort((B,M)=>B.health-M.health)),a=J(()=>()=>o(r)().slice(-5).reverse()),i=J(()=>()=>o(r)().slice(0,5)),l=J(()=>()=>{const B=[];for(const M of e.tasks)if(M.recentCompletions&&M.recentCompletions.length>0)for(const I of M.recentCompletions)B.push({task:M,completedAt:I});return B.sort((M,I)=>new Date(I.completedAt).getTime()-new Date(M.completedAt).getTime()).slice(0,10)});function c(B){return new Date(B).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function u(B){return B>=80?"#10b981":B>=60?"#3b82f6":B>=40?"#f59e0b":"#ef4444"}var d=Wg(),f=v(h(d),2),g=h(f),y=v(h(g),2),_=h(y),m=h(_),p=h(m),k=v(_,2),S=h(k),D=h(S),E=v(k,2),R=h(E),P=h(R),L=v(g,2);{var H=B=>{var M=Fg(),I=v(h(M),2);He(I,21,()=>o(s)(),bt,(G,se,ke)=>{var ge=Lg(),ce=h(ge);ce.textContent=`#${ke+1}`;var Ie=v(ce,2),Me=h(Ie),Ue=v(Ie,2),de=h(Ue),U=v(de);{var A=F=>{var K=Pg();x(F,K)};W(U,F=>{o(se).bestStreak&&o(se).currentStreak===o(se).bestStreak&&F(A)})}$(()=>{N(Me,o(se).name),N(de,`${o(se).currentStreak??""} day${o(se).currentStreak!==1?"s":""} `)}),x(G,ge)}),x(B,M)};W(L,B=>{o(s)().length>0&&B(H)})}var Y=v(L,2),X=v(h(Y),2);{var oe=B=>{var M=Bg(),I=v(Qe(M),2);He(I,21,()=>o(a)(),bt,(G,se)=>{let ke=()=>o(se).task,ge=()=>o(se).health;var ce=qg(),Ie=h(ce),Me=h(Ie),Ue=v(Ie,2),de=h(Ue),U=v(de,2),A=h(U);$(F=>{N(Me,ke().name),Ns(de,`width: ${ge()??""}%; background-color: ${F??""}`),N(A,`${ge()??""}/100`)},[()=>u(ge())]),x(G,ce)}),x(B,M)};W(X,B=>{o(a)().length>0&&B(oe)})}var ae=v(X,2);{var ve=B=>{var M=zg(),I=v(Qe(M),2);He(I,21,()=>o(i)(),bt,(G,se)=>{let ke=()=>o(se).task,ge=()=>o(se).health;var ce=Ug(),Ie=h(ce),Me=h(Ie),Ue=v(Ie,2),de=h(Ue),U=v(de,2),A=h(U);$(F=>{N(Me,ke().name),Ns(de,`width: ${ge()??""}%; background-color: ${F??""}`),N(A,`${ge()??""}/100`)},[()=>u(ge())]),x(G,ce)}),x(B,M)};W(ae,B=>{o(i)().length>0&&o(i)()[0].health<80&&B(ve)})}var Q=v(Y,2);{var Z=B=>{var M=Yg(),I=v(h(M),2);He(I,21,()=>o(l)(),bt,(G,se)=>{let ke=()=>o(se).task,ge=()=>o(se).completedAt;var ce=$g(),Ie=v(h(ce),2),Me=h(Ie),Ue=h(Me),de=v(Me,2),U=h(de);$(A=>{N(Ue,ke().name),N(U,A)},[()=>c(ge())]),x(G,ce)}),x(B,M)};W(Q,B=>{o(l)().length>0&&B(Z)})}$((B,M,I)=>{N(p,B),N(D,M),N(P,`${I??""}%`)},[()=>o(t)().totalCompletions,()=>o(t)().totalMisses,()=>o(t)().completionRate]),x(n,d),ft()}var Hg=C('<div class="inbox-tab__empty svelte-1jnb97y"><p class="svelte-1jnb97y"> No tasks in inbox</p> <p class="inbox-tab__empty-subtitle svelte-1jnb97y">Create your first task or schedule your existing tasks!</p></div>'),Gg=C('<div class="inbox-tab__card-wrapper svelte-1jnb97y" role="listitem"><!></div>'),Kg=C('<div class="inbox-tab svelte-1jnb97y"><div class="inbox-tab__header svelte-1jnb97y"><h2 class="inbox-tab__title svelte-1jnb97y">Inbox</h2> <p class="inbox-tab__subtitle svelte-1jnb97y"> </p></div> <div class="inbox-tab__content svelte-1jnb97y" role="list" aria-label="Inbox tasks"><!></div></div>');function Vg(n,e){ht(e,!0);const t=J(()=>e.tasks.filter(m=>m.status!=="done"&&m.status!=="cancelled"&&!m.dueAt&&!m.scheduledAt&&!m.startAt).sort((m,p)=>new Date(p.createdAt).getTime()-new Date(m.createdAt).getTime()));let s=V(0),r=De([]);Tt(()=>{o(s)>=o(t).length&&T(s,Math.max(0,o(t).length-1),!0)});function a(m){var k;if(o(t).length===0)return;const p=Math.max(0,Math.min(m,o(t).length-1));T(s,p,!0),(k=r[p])==null||k.focus()}function i(m,p){m.key==="ArrowDown"?(m.preventDefault(),a(p+1)):m.key==="ArrowUp"?(m.preventDefault(),a(p-1)):m.key==="Enter"&&e.onEdit?(m.preventDefault(),e.onEdit(o(t)[p])):m.key===" "&&e.onDone&&(m.preventDefault(),e.onDone(o(t)[p]))}var l=Kg(),c=h(l),u=v(h(c),2),d=h(u),f=v(c,2),g=h(f);{var y=m=>{var p=Hg();x(m,p)},_=m=>{var p=lt(),k=Qe(p);He(k,19,()=>o(t),S=>S.id,(S,D,E)=>{var R=Gg();R.__keydown=L=>i(L,o(E));var P=h(R);Br(P,{get task(){return o(D)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(R,(L,H)=>r[H]=L,L=>r==null?void 0:r[L],()=>[o(E)]),$(()=>Le(R,"tabindex",o(E)===o(s)?0:-1)),Ut("focus",R,()=>T(s,o(E),!0)),x(S,R)}),x(m,p)};W(g,m=>{o(t).length===0?m(y):m(_,!1)})}$(()=>N(d,`${o(t).length??""} task${o(t).length!==1?"s":""} without dates`)),x(n,l),ft()}xt(["keydown"]);var Qg=C('<div class="upcoming-tab__empty svelte-102jr7u"><p class="svelte-102jr7u"> </p> <p class="upcoming-tab__empty-subtitle svelte-102jr7u">You have a clear schedule ahead!</p></div>'),Xg=C('<div class="upcoming-tab__card-wrapper svelte-102jr7u" role="listitem"><!></div>'),Zg=C('<div class="upcoming-tab__date-group svelte-102jr7u"><h3 class="upcoming-tab__date-header svelte-102jr7u"> </h3> <!></div>'),Jg=C('<div class="upcoming-tab svelte-102jr7u"><div class="upcoming-tab__header svelte-102jr7u"><h2 class="upcoming-tab__title svelte-102jr7u">Upcoming</h2> <p class="upcoming-tab__subtitle svelte-102jr7u"> </p></div> <div class="upcoming-tab__content svelte-102jr7u" role="list" aria-label="Upcoming tasks"><!></div></div>');function ep(n,e){ht(e,!0);let t=on(e,"daysAhead",3,7);const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()+t());const a=J(()=>e.tasks.filter(D=>{if(D.status==="done"||D.status==="cancelled"||!D.dueAt)return!1;const E=new Date(D.dueAt);return E.setHours(0,0,0,0),E>s&&E<=r}).sort((D,E)=>new Date(D.dueAt).getTime()-new Date(E.dueAt).getTime())),i=J(()=>()=>{const D=new Map;return o(a).forEach(E=>{const R=new Date(E.dueAt);R.setHours(0,0,0,0);const P=R.toISOString().split("T")[0];D.has(P)||D.set(P,[]),D.get(P).push(E)}),D});function l(D){const E=new Date(D),R=Math.floor((E.getTime()-s.getTime())/(1e3*60*60*24)),P=E.toLocaleDateString("en-US",{weekday:"long"}),L=E.toLocaleDateString("en-US",{month:"short",day:"numeric"});return R===1?`Tomorrow - ${P}, ${L}`:`${P}, ${L} (in ${R} days)`}let c=V(0),u=De([]);Tt(()=>{o(c)>=o(a).length&&T(c,Math.max(0,o(a).length-1),!0)});function d(D,E){D.key==="ArrowDown"?(D.preventDefault(),T(c,Math.min(o(c)+1,o(a).length-1),!0)):D.key==="ArrowUp"?(D.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):D.key==="Enter"&&e.onEdit?(D.preventDefault(),e.onEdit(o(a)[E])):D.key===" "&&e.onDone&&(D.preventDefault(),e.onDone(o(a)[E]))}var f=Jg(),g=h(f),y=v(h(g),2),_=h(y),m=v(g,2),p=h(m);{var k=D=>{var E=Qg(),R=h(E),P=h(R);$(()=>N(P,` No tasks scheduled for the next ${t()??""} days`)),x(D,E)},S=D=>{var E=lt(),R=Qe(E);He(R,17,()=>[...o(i).entries()],bt,(P,L)=>{var H=J(()=>nu(o(L),2));let Y=()=>o(H)[0],X=()=>o(H)[1];var oe=Zg(),ae=h(oe),ve=h(ae),Q=v(ae,2);He(Q,19,X,Z=>Z.id,(Z,B)=>{const M=J(()=>o(a).indexOf(o(B)));var I=Xg();I.__keydown=se=>d(se,o(M));var G=h(I);Br(G,{get task(){return o(B)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(I,(se,ke)=>u[ke]=se,se=>u==null?void 0:u[se],()=>[o(M)]),$(()=>Le(I,"tabindex",o(M)===o(c)?0:-1)),Ut("focus",I,()=>T(c,o(M),!0)),x(Z,I)}),$(Z=>N(ve,Z),[()=>l(Y())]),x(P,oe)}),x(D,E)};W(p,D=>{o(a).length===0?D(k):D(S,!1)})}$(()=>N(_,`${o(a).length??""} task${o(a).length!==1?"s":""} in the next ${t()??""} days`)),x(n,f),ft()}xt(["keydown"]);var tp=C('<div class="done-tab__empty svelte-z9ywjc"><p class="svelte-z9ywjc"> No completed tasks yet</p> <p class="done-tab__empty-subtitle svelte-z9ywjc">Complete some tasks to see them here!</p></div>'),sp=C('<button class="done-tab__uncomplete-btn svelte-z9ywjc" title="Mark as not done">Undo</button>'),np=C('<div class="done-tab__card-wrapper svelte-z9ywjc" role="listitem"><div class="done-tab__task-header svelte-z9ywjc"><span class="done-tab__done-date svelte-z9ywjc"> </span> <!></div> <!></div>'),rp=C('<div class="done-tab__pagination svelte-z9ywjc"><button class="done-tab__page-btn svelte-z9ywjc"> Previous</button> <span class="done-tab__page-info svelte-z9ywjc"> </span> <button class="done-tab__page-btn svelte-z9ywjc">Next </button></div>'),ap=C("<!> <!>",1),ip=C('<div class="done-tab svelte-z9ywjc"><div class="done-tab__header svelte-z9ywjc"><h2 class="done-tab__title svelte-z9ywjc">Done</h2> <p class="done-tab__subtitle svelte-z9ywjc"> </p></div> <div class="done-tab__content svelte-z9ywjc" role="list" aria-label="Completed tasks"><!></div></div>');function op(n,e){ht(e,!0);let t=on(e,"daysBack",3,30),s=V(0);const r=50,a=new Date;a.setDate(a.getDate()-t()),a.setHours(0,0,0,0);const i=J(()=>e.tasks.filter(L=>L.status!=="done"||!L.doneAt?!1:new Date(L.doneAt)>=a).sort((L,H)=>new Date(H.doneAt).getTime()-new Date(L.doneAt).getTime())),l=J(()=>Math.ceil(o(i).length/r)),c=J(()=>o(i).slice(o(s)*r,(o(s)+1)*r));Tt(()=>{o(s)>=o(l)&&o(l)>0&&T(s,o(l)-1)});function u(){o(s)<o(l)-1&&ml(s)}function d(){o(s)>0&&ml(s,-1)}function f(L){const H=new Date(L),Y=new Date,X=Y.getTime()-H.getTime(),oe=Math.floor(X/(1e3*60*60*24));return oe===0?"Today":oe===1?"Yesterday":oe<7?`${oe} days ago`:H.toLocaleDateString("en-US",{month:"short",day:"numeric",year:H.getFullYear()!==Y.getFullYear()?"numeric":void 0})}let g=V(0),y=De([]);Tt(()=>{o(g)>=o(c).length&&T(g,Math.max(0,o(c).length-1),!0)});function _(L,H){L.key==="ArrowDown"?(L.preventDefault(),T(g,Math.min(o(g)+1,o(c).length-1),!0)):L.key==="ArrowUp"?(L.preventDefault(),T(g,Math.max(o(g)-1,0),!0)):L.key==="Enter"&&e.onEdit&&(L.preventDefault(),e.onEdit(o(c)[H]))}var m=ip(),p=h(m),k=v(h(p),2),S=h(k),D=v(p,2),E=h(D);{var R=L=>{var H=tp();x(L,H)},P=L=>{var H=ap(),Y=Qe(H);He(Y,19,()=>o(c),ae=>ae.id,(ae,ve,Q)=>{var Z=np();Z.__keydown=ge=>_(ge,o(Q));var B=h(Z),M=h(B),I=h(M),G=v(M,2);{var se=ge=>{var ce=sp();ce.__click=()=>e.onUncomplete(o(ve)),x(ge,ce)};W(G,ge=>{e.onUncomplete&&ge(se)})}var ke=v(B,2);Br(ke,{get task(){return o(ve)},get onEdit(){return e.onEdit},get onDelete(){return e.onDelete}}),Ps(Z,(ge,ce)=>y[ce]=ge,ge=>y==null?void 0:y[ge],()=>[o(Q)]),$(ge=>{Le(Z,"tabindex",o(Q)===o(g)?0:-1),N(I,`Completed ${ge??""}`)},[()=>f(o(ve).doneAt)]),Ut("focus",Z,()=>T(g,o(Q),!0)),x(ae,Z)});var X=v(Y,2);{var oe=ae=>{var ve=rp(),Q=h(ve);Q.__click=d;var Z=v(Q,2),B=h(Z),M=v(Z,2);M.__click=u,$(()=>{Q.disabled=o(s)===0,N(B,`Page ${o(s)+1} of ${o(l)??""}`),M.disabled=o(s)>=o(l)-1}),x(ae,ve)};W(X,ae=>{o(l)>1&&ae(oe)})}x(L,H)};W(E,L=>{o(i).length===0?L(R):L(P,!1)})}$(()=>N(S,`${o(i).length??""} completed task${o(i).length!==1?"s":""} in the last ${t()??""} days`)),x(n,m),ft()}xt(["keydown","click"]);var lp=C('<div class="projects-tab__empty svelte-8ybpha"><p class="svelte-8ybpha"> No active projects</p> <p class="projects-tab__empty-subtitle svelte-8ybpha">Create tasks to see them organized by project!</p></div>'),cp=C('<div class="projects-tab__card-wrapper svelte-8ybpha" role="listitem"><!></div>'),up=C('<div class="projects-tab__project-tasks svelte-8ybpha" role="list"></div>'),dp=C('<div class="projects-tab__project svelte-8ybpha"><button class="projects-tab__project-header svelte-8ybpha"><span class="projects-tab__expand-icon svelte-8ybpha"> </span> <span class="projects-tab__project-name svelte-8ybpha"> </span> <span class="projects-tab__project-count svelte-8ybpha"> </span></button> <!></div>'),hp=C('<div class="projects-tab svelte-8ybpha"><div class="projects-tab__header svelte-8ybpha"><div class="projects-tab__header-main svelte-8ybpha"><h2 class="projects-tab__title svelte-8ybpha">Projects</h2> <p class="projects-tab__subtitle svelte-8ybpha"> </p></div> <div class="projects-tab__actions svelte-8ybpha"><button class="projects-tab__action-btn svelte-8ybpha">Expand All</button> <button class="projects-tab__action-btn svelte-8ybpha">Collapse All</button></div></div> <div class="projects-tab__content svelte-8ybpha" role="region" aria-label="Project task lists"><!></div></div>');function fp(n,e){ht(e,!0);const t=J(()=>()=>{const Y=new Map;return e.tasks.filter(oe=>oe.status!=="done"&&oe.status!=="cancelled").forEach(oe=>{const ae=oe.linkedBlockPath||"Uncategorized";Y.has(ae)||Y.set(ae,[]),Y.get(ae).push(oe)}),Y.forEach(oe=>{oe.sort((ae,ve)=>!ae.dueAt&&!ve.dueAt?0:ae.dueAt?ve.dueAt?new Date(ae.dueAt).getTime()-new Date(ve.dueAt).getTime():-1:1)}),new Map([...Y.entries()].sort(([oe],[ae])=>oe.localeCompare(ae)))}),s=J(()=>[...o(t).values()].reduce((Y,X)=>Y+X.length,0));let r=V(De(new Set([...o(t).keys()])));function a(Y){const X=new Set(o(r));X.has(Y)?X.delete(Y):X.add(Y),T(r,X,!0)}function i(){T(r,new Set([...o(t).keys()]),!0)}function l(){T(r,new Set,!0)}let c=V(0),u=De([]);const d=J(()=>()=>{const Y=[];return o(t).forEach((X,oe)=>{o(r).has(oe)&&Y.push(...X)}),Y});Tt(()=>{o(c)>=o(d).length&&T(c,Math.max(0,o(d).length-1),!0)});function f(Y,X){Y.key==="ArrowDown"?(Y.preventDefault(),T(c,Math.min(o(c)+1,o(d).length-1),!0)):Y.key==="ArrowUp"?(Y.preventDefault(),T(c,Math.max(o(c)-1,0),!0)):Y.key==="Enter"&&e.onEdit?(Y.preventDefault(),e.onEdit(o(d)[X])):Y.key===" "&&e.onDone&&(Y.preventDefault(),e.onDone(o(d)[X]))}function g(Y){const X=Y.split("/");return X[X.length-1]||Y}var y=hp(),_=h(y),m=h(_),p=v(h(m),2),k=h(p),S=v(m,2),D=h(S);D.__click=i;var E=v(D,2);E.__click=l;var R=v(_,2),P=h(R);{var L=Y=>{var X=lp();x(Y,X)},H=Y=>{var X=lt(),oe=Qe(X);He(oe,17,()=>[...o(t).entries()],bt,(ae,ve)=>{var Q=J(()=>nu(o(ve),2));let Z=()=>o(Q)[0],B=()=>o(Q)[1];var M=dp(),I=h(M);I.__click=()=>a(Z());var G=h(I),se=h(G),ke=v(G,2),ge=h(ke),ce=v(ke,2),Ie=h(ce),Me=v(I,2);{var Ue=de=>{var U=up();He(U,23,B,A=>A.id,(A,F)=>{const K=J(()=>o(d).indexOf(o(F)));var ie=cp();ie.__keydown=q=>f(q,o(K));var O=h(ie);Br(O,{get task(){return o(F)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ie,(q,ee)=>u[ee]=q,q=>u==null?void 0:u[q],()=>[o(K)]),$(()=>Le(ie,"tabindex",o(K)===o(c)?0:-1)),Ut("focus",ie,()=>T(c,o(K),!0)),x(A,ie)}),$(A=>Le(U,"aria-label",A),[()=>`Tasks for ${g(Z())}`]),x(de,U)};W(Me,de=>{o(r).has(Z())&&de(Ue)})}$((de,U)=>{N(se,de),Le(ke,"title",Z()),N(ge,U),N(Ie,B().length)},[()=>o(r).has(Z())?"":"",()=>g(Z())]),x(ae,M)}),x(Y,X)};W(P,Y=>{o(t).size===0?Y(L):Y(H,!1)})}$(()=>N(k,`${o(s)??""} task${o(s)!==1?"s":""} in ${o(t).size??""} project${o(t).size!==1?"s":""}`)),x(n,y),ft()}xt(["click","keydown"]);class as extends Error{constructor(e,t,s,r){super(e),this.line=t,this.column=s,this.suggestion=r,this.name="QuerySyntaxError"}}class vr extends Error{constructor(e,t){super(e),this.cause=t,this.name="QueryExecutionError"}}var wt=(n=>(n.TODO="TODO",n.IN_PROGRESS="IN_PROGRESS",n.DONE="DONE",n.CANCELLED="CANCELLED",n.NON_TASK="NON_TASK",n.EMPTY="EMPTY",n))(wt||{});const qs=class qs{constructor(e){b(this,"symbol");b(this,"name");b(this,"nextStatusSymbol");b(this,"type");this.symbol=e.symbol,this.name=e.name,this.nextStatusSymbol=e.nextStatusSymbol,this.type=e.type}static getTypeForUnknownSymbol(e){switch(e){case"x":case"X":return"DONE";case"/":return"IN_PROGRESS";case"-":return"CANCELLED";case" ":default:return"TODO"}}isCompleted(){return this.type==="DONE"||this.type==="CANCELLED"}};b(qs,"TODO",new qs({symbol:" ",name:"Todo",nextStatusSymbol:"x",type:"TODO"})),b(qs,"DONE",new qs({symbol:"x",name:"Done",nextStatusSymbol:" ",type:"DONE"})),b(qs,"IN_PROGRESS",new qs({symbol:"/",name:"In Progress",nextStatusSymbol:"x",type:"IN_PROGRESS"})),b(qs,"CANCELLED",new qs({symbol:"-",name:"Cancelled",nextStatusSymbol:" ",type:"CANCELLED"}));let Xs=qs;var Ve;(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(Ve||(Ve={}));var ct;(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(ct||(ct={}));var ks;(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(ks||(ks={}));function cr(n,e){n.assign("day",e.getDate()),n.assign("month",e.getMonth()+1),n.assign("year",e.getFullYear())}function rd(n,e){n.assign("hour",e.getHours()),n.assign("minute",e.getMinutes()),n.assign("second",e.getSeconds()),n.assign("millisecond",e.getMilliseconds()),n.assign("meridiem",e.getHours()<12?Ve.AM:Ve.PM)}function mr(n,e){n.imply("day",e.getDate()),n.imply("month",e.getMonth()+1),n.imply("year",e.getFullYear())}function Go(n,e){n.imply("hour",e.getHours()),n.imply("minute",e.getMinutes()),n.imply("second",e.getSeconds()),n.imply("millisecond",e.getMilliseconds()),n.imply("meridiem",e.getHours()<12?Ve.AM:Ve.PM)}const vp={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:2*60,timezoneOffsetNonDst:60,dstStart:n=>Hl(n,ks.MARCH,ct.SUNDAY,2),dstEnd:n=>Hl(n,ks.OCTOBER,ct.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-5*60,timezoneOffsetNonDst:-6*60,dstStart:n=>mn(n,ks.MARCH,ct.SUNDAY,2,2),dstEnd:n=>mn(n,ks.NOVEMBER,ct.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-4*60,timezoneOffsetNonDst:-5*60,dstStart:n=>mn(n,ks.MARCH,ct.SUNDAY,2,2),dstEnd:n=>mn(n,ks.NOVEMBER,ct.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-6*60,timezoneOffsetNonDst:-7*60,dstStart:n=>mn(n,ks.MARCH,ct.SUNDAY,2,2),dstEnd:n=>mn(n,ks.NOVEMBER,ct.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-7*60,timezoneOffsetNonDst:-8*60,dstStart:n=>mn(n,ks.MARCH,ct.SUNDAY,2,2),dstEnd:n=>mn(n,ks.NOVEMBER,ct.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360};function mn(n,e,t,s,r=0){let a=0,i=0;for(;i<s;)a++,new Date(n,e-1,a).getDay()===t&&i++;return new Date(n,e-1,a,r)}function Hl(n,e,t,s=0){const r=t===0?7:t,a=new Date(n,e-1+1,1,12),i=a.getDay()===0?7:a.getDay();let l;return i===r?l=7:i<r?l=7+i-r:l=i-r,a.setDate(a.getDate()-l),new Date(n,e-1,a.getDate(),s)}function ad(n,e,t={}){if(n==null)return null;if(typeof n=="number")return n;const s=t[n]??vp[n];return s==null?null:typeof s=="number"?s:e==null?null:e>s.dstStart(e.getFullYear())&&!(e>s.dstEnd(e.getFullYear()))?s.timezoneOffsetDuringDst:s.timezoneOffsetNonDst}const gp={day:0,second:0,millisecond:0};function os(n,e){let t=new Date(n);if(e.y&&(e.year=e.y,delete e.y),e.mo&&(e.month=e.mo,delete e.mo),e.M&&(e.month=e.M,delete e.M),e.w&&(e.week=e.w,delete e.w),e.d&&(e.day=e.d,delete e.d),e.h&&(e.hour=e.h,delete e.h),e.m&&(e.minute=e.m,delete e.m),e.s&&(e.second=e.s,delete e.s),e.ms&&(e.millisecond=e.ms,delete e.ms),"year"in e){const s=Math.floor(e.year);t.setFullYear(t.getFullYear()+s);const r=e.year-s;r>0&&(e.month=(e==null?void 0:e.month)??0,e.month+=r*12)}if("quarter"in e){const s=Math.floor(e.quarter);t.setMonth(t.getMonth()+s*3)}if("month"in e){const s=Math.floor(e.month);t.setMonth(t.getMonth()+s);const r=e.month-s;r>0&&(e.week=(e==null?void 0:e.week)??0,e.week+=r*4)}if("week"in e){const s=Math.floor(e.week);t.setDate(t.getDate()+s*7);const r=e.week-s;r>0&&(e.day=(e==null?void 0:e.day)??0,e.day+=Math.round(r*7))}if("day"in e){const s=Math.floor(e.day);t.setDate(t.getDate()+s);const r=e.day-s;r>0&&(e.hour=(e==null?void 0:e.hour)??0,e.hour+=Math.round(r*24))}if("hour"in e){const s=Math.floor(e.hour);t.setHours(t.getHours()+s);const r=e.hour-s;r>0&&(e.minute=(e==null?void 0:e.minute)??0,e.minute+=Math.round(r*60))}if("minute"in e){const s=Math.floor(e.minute);t.setMinutes(t.getMinutes()+s);const r=e.minute-s;r>0&&(e.second=(e==null?void 0:e.second)??0,e.second+=Math.round(r*60))}if("second"in e){const s=Math.floor(e.second);t.setSeconds(t.getSeconds()+s);const r=e.second-s;r>0&&(e.millisecond=(e==null?void 0:e.millisecond)??0,e.millisecond+=Math.round(r*1e3))}if("millisecond"in e){const s=Math.floor(e.millisecond);t.setMilliseconds(t.getMilliseconds()+s)}return t}function di(n){const e={};for(const t in n)e[t]=-n[t];return e}class sr{constructor(e,t){b(this,"instant");b(this,"timezoneOffset");this.instant=e??new Date,this.timezoneOffset=t??null}static fromDate(e){return new sr(e)}static fromInput(e,t){if(e instanceof Date)return sr.fromDate(e);const s=(e==null?void 0:e.instant)??new Date,r=ad(e==null?void 0:e.timezone,s,t);return new sr(s,r)}getDateWithAdjustedTimezone(){const e=new Date(this.instant);return this.timezoneOffset!==null&&e.setMinutes(e.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),e}getSystemTimezoneAdjustmentMinute(e,t){(!e||e.getTime()<0)&&(e=new Date);const s=-e.getTimezoneOffset(),r=t??this.timezoneOffset??s;return s-r}getTimezoneOffset(){return this.timezoneOffset??-this.instant.getTimezoneOffset()}}class rt{constructor(e,t){b(this,"knownValues");b(this,"impliedValues");b(this,"reference");b(this,"_tags",new Set);if(this.reference=e,this.knownValues={},this.impliedValues={},t)for(const r in t)this.knownValues[r]=t[r];const s=e.getDateWithAdjustedTimezone();this.imply("day",s.getDate()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}static createRelativeFromReference(e,t=gp){let s=os(e.getDateWithAdjustedTimezone(),t);const r=new rt(e);return r.addTag("result/relativeDate"),"hour"in t||"minute"in t||"second"in t||"millisecond"in t?(r.addTag("result/relativeDateAndTime"),rd(r,s),cr(r,s),r.assign("timezoneOffset",e.getTimezoneOffset())):(Go(r,s),r.imply("timezoneOffset",e.getTimezoneOffset()),"day"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.assign("weekday",s.getDay())):"week"in t?(r.assign("day",s.getDate()),r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear()),r.imply("weekday",s.getDay())):(r.imply("day",s.getDate()),"month"in t?(r.assign("month",s.getMonth()+1),r.assign("year",s.getFullYear())):(r.imply("month",s.getMonth()+1),"year"in t?r.assign("year",s.getFullYear()):r.imply("year",s.getFullYear())))),r}get(e){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:null}isCertain(e){return e in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(e,t){return e in this.knownValues?this:(this.impliedValues[e]=t,this)}assign(e,t){return this.knownValues[e]=t,delete this.impliedValues[e],this}addDurationAsImplied(e){const t=this.dateWithoutTimezoneAdjustment(),s=os(t,e);return("day"in e||"week"in e||"month"in e||"year"in e)&&(this.delete(["day","weekday","month","year"]),this.imply("day",s.getDate()),this.imply("weekday",s.getDay()),this.imply("month",s.getMonth()+1),this.imply("year",s.getFullYear())),("second"in e||"minute"in e||"hour"in e)&&(this.delete(["second","minute","hour"]),this.imply("second",s.getSeconds()),this.imply("minute",s.getMinutes()),this.imply("hour",s.getHours())),this}delete(e){typeof e=="string"&&(e=[e]);for(const t of e)delete this.knownValues[t],delete this.impliedValues[t]}clone(){const e=new rt(this.reference);e.knownValues={},e.impliedValues={};for(const t in this.knownValues)e.knownValues[t]=this.knownValues[t];for(const t in this.impliedValues)e.impliedValues[t]=this.impliedValues[t];return e}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){const e=this.dateWithoutTimezoneAdjustment();return!(e.getFullYear()!==this.get("year")||e.getMonth()!==this.get("month")-1||e.getDate()!==this.get("day")||this.get("hour")!=null&&e.getHours()!=this.get("hour")||this.get("minute")!=null&&e.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}date(){const e=this.dateWithoutTimezoneAdjustment(),t=this.reference.getSystemTimezoneAdjustmentMinute(e,this.get("timezoneOffset"));return new Date(e.getTime()+t*6e4)}addTag(e){return this._tags.add(e),this}addTags(e){for(const t of e)this._tags.add(t);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){const e=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return e.setFullYear(this.get("year")),e}}class Ur{constructor(e,t,s,r,a){b(this,"refDate");b(this,"index");b(this,"text");b(this,"reference");b(this,"start");b(this,"end");this.reference=e,this.refDate=e.instant,this.index=t,this.text=s,this.start=r||new rt(e),this.end=a}clone(){const e=new Ur(this.reference,this.index,this.text);return e.start=this.start?this.start.clone():null,e.end=this.end?this.end.clone():null,e}date(){return this.start.date()}addTag(e){return this.start.addTag(e),this.end&&this.end.addTag(e),this}addTags(e){return this.start.addTags(e),this.end&&this.end.addTags(e),this}tags(){const e=new Set(this.start.tags());if(this.end)for(const t of this.end.tags())e.add(t);return e}toString(){const e=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(e)} ...}]`}}function id(n,e,t="\\s{0,5},?\\s{0,5}"){const s=e.replace(/\((?!\?)/g,"(?:");return`${n}${s}(?:${t}${s}){0,10}`}function pp(n){let e;return n instanceof Array?e=[...n]:n instanceof Map?e=Array.from(n.keys()):e=Object.keys(n),e}function Ks(n){return`(?:${pp(n).sort((t,s)=>s.length-t.length).join("|").replace(/\./g,"\\.")})`}function od(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function hi(n,e,t){let s=new Date(n);s.setMonth(t-1),s.setDate(e);const r=os(s,{year:1}),a=os(s,{year:-1});return Math.abs(r.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())?s=r:Math.abs(a.getTime()-n.getTime())<Math.abs(s.getTime()-n.getTime())&&(s=a),s.getFullYear()}const ro={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},ld={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},Pn={...ld,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},ao={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},io={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},cd={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"day",days:"day",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},fi={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"day",day:"day",days:"day",w:"week",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...cd},ud=`(?:${Ks(ao)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;function mp(n){const e=n.toLowerCase();return ao[e]!==void 0?ao[e]:e==="a"||e==="an"||e=="the"?1:e.match(/few/)?3:e.match(/half/)?.5:e.match(/couple/)?2:e.match(/several/)?7:parseFloat(e)}const Ga=`(?:${Ks(io)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;function Ka(n){let e=n.toLowerCase();return io[e]!==void 0?io[e]:(e=e.replace(/(?:st|nd|rd|th)$/i,""),parseInt(e))}const vi="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";function gi(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);const e=parseInt(n);return od(e)}const dd=`(${ud})\\s{0,3}(${Ks(fi)})`,Gl=new RegExp(dd,"i"),yp=`(${ud})\\s{0,3}(${Ks(cd)})`,hd="\\s{0,5},?(?:\\s*and)?\\s{0,5}",ya=id("(?:(?:about|around)\\s{0,3})?",dd,hd),pi=id("(?:(?:about|around)\\s{0,3})?",yp,hd);function zr(n){const e={};let t=n,s=Gl.exec(t);for(;s;)bp(e,s),t=t.substring(s[0].length).trim(),s=Gl.exec(t);return Object.keys(e).length==0?null:e}function bp(n,e){if(e[0].match(/^[a-zA-Z]+$/))return;const t=mp(e[1]),s=fi[e[2].toLowerCase()];n[s]=t}class ds{constructor(){b(this,"cachedInnerPattern",null);b(this,"cachedPattern",null)}innerPatternHasChange(e,t){return this.innerPattern(e)!==t}patternLeftBoundary(){return"(\\W|^)"}pattern(e){return this.cachedInnerPattern&&!this.innerPatternHasChange(e,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(e),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(e,t){const s=t[1]??"";t.index=t.index+s.length,t[0]=t[0].substring(s.length);for(let r=2;r<t.length;r++)t[r-1]=t[r];return this.innerExtract(e,t)}}const kp=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${ya})(?=\\W|$)`,"i"),_p=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${ya})(?=\\W|$)`,"i"),wp=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${pi})(?=\\W|$)`,"i");class Tp extends ds{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(t){return this.strictMode?wp:t.option.forwardDate?kp:_p}innerExtract(t,s){if(s[0].match(/^for\s*the\s*\w+/))return null;const r=zr(s[1]);return r?rt.createRelativeFromReference(t.reference,r):null}}const xp=new RegExp(`(?:on\\s{0,3})?(${Ga})(?:\\s{0,3}(?:to|\\-|\\|until|through|till)?\\s{0,3}(${Ga}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${Ks(Pn)})(?:(?:-|/|,?\\s{0,3})(${vi}(?!\\w)))?(?=\\W|$)`,"i"),Kl=1,Vl=2,Sp=3,Ql=4;class Dp extends ds{innerPattern(){return xp}innerExtract(e,t){const s=e.createParsingResult(t.index,t[0]),r=Pn[t[Sp].toLowerCase()],a=Ka(t[Kl]);if(a>31)return t.index=t.index+t[Kl].length,null;if(s.start.assign("month",r),s.start.assign("day",a),t[Ql]){const i=gi(t[Ql]);s.start.assign("year",i)}else{const i=hi(e.refDate,a,r);s.start.imply("year",i)}if(t[Vl]){const i=Ka(t[Vl]);s.end=s.start.clone(),s.end.assign("day",i)}return s}}const Ep=new RegExp(`(${Ks(Pn)})(?:-|/|\\s*,?\\s*)(${Ga})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${Ga})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${vi}))?(?=\\W|$)(?!\\:\\d)`,"i"),Ap=1,Xl=2,Mi=3,Oi=4;class Cp extends ds{constructor(t){super();b(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=t}innerPattern(){return Ep}innerExtract(t,s){const r=Pn[s[Ap].toLowerCase()],a=Ka(s[Xl]);if(a>31||this.shouldSkipYearLikeDate&&!s[Mi]&&!s[Oi]&&s[Xl].match(/^2[0-5]$/))return null;const i=t.createParsingComponents({day:a,month:r}).addTag("parser/ENMonthNameMiddleEndianParser");if(s[Oi]){const u=gi(s[Oi]);i.assign("year",u)}else{const u=hi(t.refDate,a,r);i.imply("year",u)}if(!s[Mi])return i;const l=Ka(s[Mi]),c=t.createParsingResult(s.index,s[0]);return c.start=i,c.end=i.clone(),c.end.assign("day",l),c}}const Ip=new RegExp(`((?:in)\\s*)?(${Ks(Pn)})\\s*(?:(?:,|-|of)?\\s*(${vi})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),Mp=1,Op=2,Zl=3;class Rp extends ds{innerPattern(){return Ip}innerExtract(e,t){const s=t[Op].toLowerCase();if(t[0].length<=3&&!ld[s])return null;const r=e.createParsingResult(t.index+(t[Mp]||"").length,t.index+t[0].length);r.start.imply("day",1),r.start.addTag("parser/ENMonthNameParser");const a=Pn[s];if(r.start.assign("month",a),t[Zl]){const i=gi(t[Zl]);r.start.assign("year",i)}else{const i=hi(e.refDate,1,a);r.start.imply("year",i)}return r}}const Np=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${Ks(Pn)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),Pp=1,Lp=2,Jl=3,Fp=4;class qp extends ds{constructor(t){super();b(this,"strictMonthDateOrder");this.strictMonthDateOrder=t}innerPattern(){return Np}innerExtract(t,s){const r=parseInt(s[Pp]);let a=parseInt(s[Fp]),i=s[Jl]?parseInt(s[Jl]):Pn[s[Lp].toLowerCase()];if(i<1||i>12){if(this.strictMonthDateOrder)return null;a>=1&&a<=12&&([i,a]=[a,i])}return a<1||a>31?null:{day:a,month:i,year:r}}}const Bp=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),Up=1,zp=2;class $p extends ds{innerPattern(){return Bp}innerExtract(e,t){const s=parseInt(t[zp]),r=parseInt(t[Up]);return e.createParsingComponents().imply("day",1).assign("month",r).assign("year",s)}}function Yp(n,e,t,s){return new RegExp(`${n}${e}(\\d{1,4})(?:(?:\\.|:|)(\\d{1,2})(?:(?::|)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,s)}function Wp(n,e){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:(?:\\.|\\:|\\)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,"i")}const Ri=2,Fn=3,Ma=4,Oa=5,gr=6;class jp{constructor(e=!1){b(this,"strictMode");b(this,"cachedPrimaryPrefix",null);b(this,"cachedPrimarySuffix",null);b(this,"cachedPrimaryTimePattern",null);b(this,"cachedFollowingPhase",null);b(this,"cachedFollowingSuffix",null);b(this,"cachedFollowingTimePatten",null);this.strictMode=e}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(e){return this.getPrimaryTimePatternThroughCache()}extract(e,t){const s=this.extractPrimaryTimeComponents(e,t);if(!s)return t[0].match(/^\d{4}/)?(t.index+=4,null):(t.index+=t[0].length,null);const r=t.index+t[1].length,a=t[0].substring(t[1].length),i=e.createParsingResult(r,a,s);t.index+=t[0].length;const l=e.text.substring(t.index),u=this.getFollowingTimePatternThroughCache().exec(l);return a.match(/^\d{3,4}/)&&u&&(u[0].match(/^\s*([+-])\s*\d{2,4}$/)||u[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!u||u[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(i):(i.end=this.extractFollowingTimeComponents(e,u,i),i.end&&(i.text+=u[0]),this.checkAndReturnWithFollowingPattern(i))}extractPrimaryTimeComponents(e,t,s=!1){const r=e.createParsingComponents();let a=0,i=null,l=parseInt(t[Ri]);if(l>100){if(t[Ri].length==4&&t[Fn]==null&&!t[gr]||this.strictMode||t[Fn]!=null)return null;a=l%100,l=Math.floor(l/100)}if(l>24)return null;if(t[Fn]!=null){if(t[Fn].length==1&&!t[gr])return null;a=parseInt(t[Fn])}if(a>=60)return null;if(l>12&&(i=Ve.PM),t[gr]!=null){if(l>12)return null;const c=t[gr][0].toLowerCase();c=="a"&&(i=Ve.AM,l==12&&(l=0)),c=="p"&&(i=Ve.PM,l!=12&&(l+=12))}if(r.assign("hour",l),r.assign("minute",a),i!==null?r.assign("meridiem",i):l<12?r.imply("meridiem",Ve.AM):r.imply("meridiem",Ve.PM),t[Oa]!=null){const c=parseInt(t[Oa].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Ma]!=null){const c=parseInt(t[Ma]);if(c>=60)return null;r.assign("second",c)}return r}extractFollowingTimeComponents(e,t,s){const r=e.createParsingComponents();if(t[Oa]!=null){const c=parseInt(t[Oa].substring(0,3));if(c>=1e3)return null;r.assign("millisecond",c)}if(t[Ma]!=null){const c=parseInt(t[Ma]);if(c>=60)return null;r.assign("second",c)}let a=parseInt(t[Ri]),i=0,l=-1;if(t[Fn]!=null?i=parseInt(t[Fn]):a>100&&(i=a%100,a=Math.floor(a/100)),i>=60||a>24)return null;if(a>=12&&(l=Ve.PM),t[gr]!=null){if(a>12)return null;const c=t[gr][0].toLowerCase();c=="a"&&(l=Ve.AM,a==12&&(a=0,r.isCertain("day")||r.imply("day",r.get("day")+1))),c=="p"&&(l=Ve.PM,a!=12&&(a+=12)),s.start.isCertain("meridiem")||(l==Ve.AM?(s.start.imply("meridiem",Ve.AM),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",Ve.PM),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}return r.assign("hour",a),r.assign("minute",i),l>=0?r.assign("meridiem",l):s.start.isCertain("meridiem")&&s.start.get("hour")>12?s.start.get("hour")-12>a?r.imply("meridiem",Ve.AM):a<=12&&(r.assign("hour",a+12),r.assign("meridiem",Ve.PM)):a>12?r.imply("meridiem",Ve.PM):a<=12&&r.imply("meridiem",Ve.AM),r.date().getTime()<s.start.date().getTime()&&r.imply("day",r.get("day")+1),r}checkAndReturnWithoutFollowingPattern(e){if(e.text.match(/^\d$/)||e.text.match(/^\d\d\d+$/)||e.text.match(/\d[apAP]$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)$/);if(t){const s=t[1];if(this.strictMode||s.includes(".")&&!s.match(/\d(\.\d{2})+$/)||parseInt(s)>24)return null}return e}checkAndReturnWithFollowingPattern(e){if(e.text.match(/^\d+-\d+$/))return null;const t=e.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(t){if(this.strictMode)return null;const s=t[1],r=t[2];if(r.includes(".")&&!r.match(/\d(\.\d{2})+$/))return null;const a=parseInt(r),i=parseInt(s);if(a>24||i>24)return null}return e}getPrimaryTimePatternThroughCache(){const e=this.primaryPrefix(),t=this.primarySuffix();return this.cachedPrimaryPrefix===e&&this.cachedPrimarySuffix===t?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=Yp(this.primaryPatternLeftBoundary(),e,t,this.patternFlags()),this.cachedPrimaryPrefix=e,this.cachedPrimarySuffix=t,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){const e=this.followingPhase(),t=this.followingSuffix();return this.cachedFollowingPhase===e&&this.cachedFollowingSuffix===t?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=Wp(e,t),this.cachedFollowingPhase=e,this.cachedFollowingSuffix=t,this.cachedFollowingTimePatten)}}class Hp extends jp{constructor(e){super(e)}followingPhase(){return"\\s*(?:\\-|\\|\\~|\\|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){const s=super.extractPrimaryTimeComponents(e,t);if(!s)return s;if(t[0].endsWith("night")){const r=s.get("hour");r>=6&&r<12?(s.assign("hour",s.get("hour")+12),s.assign("meridiem",Ve.PM)):r<6&&s.assign("meridiem",Ve.AM)}if(t[0].endsWith("afternoon")){s.assign("meridiem",Ve.PM);const r=s.get("hour");r>=0&&r<=6&&s.assign("hour",s.get("hour")+12)}return t[0].endsWith("morning")&&(s.assign("meridiem",Ve.AM),s.get("hour")<12&&s.assign("hour",s.get("hour"))),s.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(e,t,s){const r=super.extractFollowingTimeComponents(e,t,s);return r&&r.addTag("parser/ENTimeExpressionParser"),r}}const Gp=new RegExp(`(${ya})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Kp=new RegExp(`(${pi})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i");class Vp extends ds{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Kp:Gp}innerExtract(t,s){const r=zr(s[1]);return r?rt.createRelativeFromReference(t.reference,di(r)):null}}const Qp=new RegExp(`(${ya})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),Xp=new RegExp(`(${pi})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),Zp=1;class Jp extends ds{constructor(t){super();b(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Xp:Qp}innerExtract(t,s){const r=zr(s[Zp]);return r?rt.createRelativeFromReference(t.reference,r):null}}let fd=class{refine(e,t){return t.filter(s=>this.isValid(e,s))}};class ba{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0],a=null;for(let i=1;i<t.length;i++){a=t[i];const l=e.text.substring(r.index+r.text.length,a.index);if(!this.shouldMergeResults(l,r,a,e))s.push(r),r=a;else{const c=r,u=a,d=this.mergeResults(l,c,u,e);e.debug(()=>{console.log(`${this.constructor.name} merged ${c} and ${u} into ${d}`)}),r=d}}return r!=null&&s.push(r),s}}class em extends ba{shouldMergeResults(e,t,s){return!t.end&&!s.end&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){if(!t.start.isOnlyWeekdayComponent()&&!s.start.isOnlyWeekdayComponent()&&(s.start.getCertainComponents().forEach(a=>{t.start.isCertain(a)||t.start.imply(a,s.start.get(a))}),t.start.getCertainComponents().forEach(a=>{s.start.isCertain(a)||s.start.imply(a,t.start.get(a))})),t.start.date()>s.start.date()){let a=t.start.date(),i=s.start.date();s.start.isOnlyWeekdayComponent()&&os(i,{day:7})>a?(i=os(i,{day:7}),s.start.imply("day",i.getDate()),s.start.imply("month",i.getMonth()+1),s.start.imply("year",i.getFullYear())):t.start.isOnlyWeekdayComponent()&&os(a,{day:-7})<i?(a=os(a,{day:-7}),t.start.imply("day",a.getDate()),t.start.imply("month",a.getMonth()+1),t.start.imply("year",a.getFullYear())):s.start.isDateWithUnknownYear()&&os(i,{year:1})>a?(i=os(i,{year:1}),s.start.imply("year",i.getFullYear())):t.start.isDateWithUnknownYear()&&os(a,{year:-1})<i?(a=os(a,{year:-1}),t.start.imply("year",a.getFullYear())):[s,t]=[t,s]}const r=t.clone();return r.start=t.start,r.end=s.start,r.index=Math.min(t.index,s.index),t.index<s.index?r.text=t.text+e+s.text:r.text=s.text+e+t.text,r}}class tm extends em{patternBetween(){return/^\s*(to|-||until|through|till)\s*$/i}}function ec(n,e){const t=n.clone(),s=n.start,r=e.start;if(t.start=tc(s,r),n.end!=null||e.end!=null){const a=n.end==null?n.start:n.end,i=e.end==null?e.start:e.end,l=tc(a,i);if(n.end==null&&l.date().getTime()<t.start.date().getTime()){const c=new Date(l.date().getTime());c.setDate(c.getDate()+1),l.isCertain("day")?cr(l,c):mr(l,c)}t.end=l}return t}function tc(n,e){const t=n.clone();return e.isCertain("hour")?(t.assign("hour",e.get("hour")),t.assign("minute",e.get("minute")),e.isCertain("second")?(t.assign("second",e.get("second")),e.isCertain("millisecond")?t.assign("millisecond",e.get("millisecond")):t.imply("millisecond",e.get("millisecond"))):(t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond")))):(t.imply("hour",e.get("hour")),t.imply("minute",e.get("minute")),t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond"))),e.isCertain("timezoneOffset")&&t.assign("timezoneOffset",e.get("timezoneOffset")),e.isCertain("meridiem")?t.assign("meridiem",e.get("meridiem")):e.get("meridiem")!=null&&t.get("meridiem")==null&&t.imply("meridiem",e.get("meridiem")),t.get("meridiem")==Ve.PM&&t.get("hour")<12&&(e.isCertain("hour")?t.assign("hour",t.get("hour")+12):t.imply("hour",t.get("hour")+12)),t.addTags(n.tags()),t.addTags(e.tags()),t}class sm extends ba{shouldMergeResults(e,t,s){return(t.start.isOnlyDate()&&s.start.isOnlyTime()||s.start.isOnlyDate()&&t.start.isOnlyTime())&&e.match(this.patternBetween())!=null}mergeResults(e,t,s){const r=t.start.isOnlyDate()?ec(t,s):ec(s,t);return r.index=t.index,r.text=t.text+e+s.text,r}}class sc extends sm{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.||:)?\\s*$")}}const nm=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i");class rm{constructor(e){b(this,"timezoneOverrides");this.timezoneOverrides=e}refine(e,t){const s=e.option.timezones??{};return t.forEach(r=>{const a=e.text.substring(r.index+r.text.length),i=nm.exec(a);if(!i)return;const l=i[1].toUpperCase(),c=r.start.date()??r.refDate??new Date,u={...this.timezoneOverrides,...s},d=ad(l,c,u);if(d==null)return;e.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${d} for: ${r.start}`)});const f=r.start.get("timezoneOffset");f!==null&&d!=f&&(r.start.isCertain("timezoneOffset")||l!=i[1])||r.start.isOnlyDate()&&l!=i[1]||(r.text+=i[0],r.start.isCertain("timezoneOffset")||r.start.assign("timezoneOffset",d),r.end!=null&&!r.end.isCertain("timezoneOffset")&&r.end.assign("timezoneOffset",d))}),t}}const am=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),im=1,om=2,lm=3;class cm{refine(e,t){return t.forEach(function(s){if(s.start.isCertain("timezoneOffset"))return;const r=e.text.substring(s.index+s.text.length),a=am.exec(r);if(!a)return;e.debug(()=>{console.log(`Extracting timezone: '${a[0]}' into : ${s}`)});const i=parseInt(a[om]),l=parseInt(a[lm]||"0");let c=i*60+l;c>14*60||(a[im]==="-"&&(c=-c),s.end!=null&&s.end.assign("timezoneOffset",c),s.start.assign("timezoneOffset",c),s.text+=a[0])}),t}}class oo{refine(e,t){if(t.length<2)return t;const s=[];let r=t[0];for(let a=1;a<t.length;a++){const i=t[a];if(i.index>=r.index+r.text.length){s.push(r),r=i;continue}let l=null,c=null;i.text.length>r.text.length?(l=i,c=r):(l=r,c=i),e.debug(()=>{console.log(`${this.constructor.name} remove ${c} by ${l}`)}),r=l}return r!=null&&s.push(r),s}}class um{refine(e,t){return e.option.forwardDate&&t.forEach(s=>{let r=e.reference.getDateWithAdjustedTimezone();if(s.start.isOnlyTime()&&e.reference.instant>s.start.date()){const a=e.reference.getDateWithAdjustedTimezone(),i=new Date(a);i.setDate(i.getDate()+1),mr(s.start,i),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} time from the ref date (${a}) to the following day (${i})`)}),s.end&&s.end.isOnlyTime()&&(mr(s.end,i),s.start.date()>s.end.date()&&(i.setDate(i.getDate()+1),mr(s.end,i)))}if(s.start.isOnlyWeekdayComponent()&&r>s.start.date()){let a=s.start.get("weekday")-r.getDay();if(a<=0&&(a+=7),r=os(r,{day:a}),mr(s.start,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.start})`)}),s.end&&s.end.isOnlyWeekdayComponent()){let i=s.end.get("weekday")-r.getDay();i<=0&&(i+=7),r=os(r,{day:i}),mr(s.end,r),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} weekday (${s.end})`)})}}if(s.start.isDateWithUnknownYear()&&r>s.start.date())for(let a=0;a<3&&r>s.start.date();a++)s.start.imply("year",s.start.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} year (${s.start})`)}),s.end&&!s.end.isCertain("year")&&(s.end.imply("year",s.end.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${s} month (${s.start})`)}))}),t}}class dm extends fd{constructor(t){super();b(this,"strictMode");this.strictMode=t}isValid(t,s){return s.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(t.debug(()=>{console.log(`Removing unlikely result '${s.text}'`)}),!1):s.start.isValidDate()?s.end&&!s.end.isValidDate()?(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.end})`)}),!1):this.strictMode?this.isStrictModeValid(t,s):!0:(t.debug(()=>{console.log(`Removing invalid result: ${s} (${s.start})`)}),!1)}isStrictModeValid(t,s){return s.start.isOnlyWeekdayComponent()?(t.debug(()=>{console.log(`(Strict) Removing weekday only component: ${s} (${s.end})`)}),!1):!0}}const hm=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),fm=1,vm=2,gm=3,nc=4,pm=5,rc=6,ac=7,mm=8,ic=9,oc=10;class ym extends ds{innerPattern(){return hm}innerExtract(e,t){const s=e.createParsingComponents({year:parseInt(t[fm]),month:parseInt(t[vm]),day:parseInt(t[gm])});if(t[nc]!=null&&(s.assign("hour",parseInt(t[nc])),s.assign("minute",parseInt(t[pm])),t[rc]!=null&&s.assign("second",parseInt(t[rc])),t[ac]!=null&&s.assign("millisecond",parseInt(t[ac])),t[mm]!=null)){let r=0;if(t[ic]){const a=parseInt(t[ic]);let i=0;t[oc]!=null&&(i=parseInt(t[oc])),r=a*60,r<0?r-=i:r+=i}s.assign("timezoneOffset",r)}return s.addTag("parser/ISOFormatParser")}}class bm extends ba{mergeResults(e,t,s){const r=s.clone();return r.index=t.index,r.text=t.text+e+r.text,r.start.assign("weekday",t.start.get("weekday")),r.end&&r.end.assign("weekday",t.start.get("weekday")),r}shouldMergeResults(e,t,s){return t.start.isOnlyWeekdayComponent()&&!t.start.isCertain("hour")&&s.start.isCertain("day")&&e.match(/^,?\s*$/)!=null}}function km(n,e=!1){return n.parsers.unshift(new ym),n.refiners.unshift(new bm),n.refiners.unshift(new cm),n.refiners.unshift(new oo),n.refiners.push(new rm),n.refiners.push(new oo),n.refiners.push(new um),n.refiners.push(new dm(e)),n}function _m(n){const e=n.getDateWithAdjustedTimezone(),t=new rt(n,{});return cr(t,e),rd(t,e),t.assign("timezoneOffset",n.getTimezoneOffset()),t.addTag("casualReference/now"),t}function wm(n){const e=n.getDateWithAdjustedTimezone(),t=new rt(n,{});return cr(t,e),Go(t,e),t.delete("meridiem"),t.addTag("casualReference/today"),t}function Tm(n){return Sm(n).addTag("casualReference/yesterday")}function xm(n){return Ko(n,1).addTag("casualReference/tomorrow")}function Sm(n,e){return Ko(n,-1)}function Ko(n,e){const t=n.getDateWithAdjustedTimezone(),s=new rt(n,{}),r=new Date(t.getTime());return r.setDate(r.getDate()+e),cr(s,r),Go(s,r),s.delete("meridiem"),s}function Dm(n,e=22){const t=n.getDateWithAdjustedTimezone(),s=new rt(n,{});return cr(s,t),s.imply("hour",e),s.imply("meridiem",Ve.PM),s.addTag("casualReference/tonight"),s}function Em(n,e=20){const t=new rt(n,{});return t.imply("meridiem",Ve.PM),t.imply("hour",e),t.addTag("casualReference/evening"),t}function Am(n){const e=new rt(n,{});return n.getDateWithAdjustedTimezone().getHours()>2&&e.addDurationAsImplied({day:1}),e.assign("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/midnight"),e}function Cm(n,e=6){const t=new rt(n,{});return t.imply("meridiem",Ve.AM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/morning"),t}function Im(n,e=15){const t=new rt(n,{});return t.imply("meridiem",Ve.PM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/afternoon"),t}function Mm(n){const e=new rt(n,{});return e.imply("meridiem",Ve.AM),e.assign("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/noon"),e}const Om=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i;class Rm extends ds{innerPattern(e){return Om}innerExtract(e,t){let s=e.refDate;const r=t[0].toLowerCase();let a=e.createParsingComponents();switch(r){case"now":a=_m(e.reference);break;case"today":a=wm(e.reference);break;case"yesterday":a=Tm(e.reference);break;case"tomorrow":case"tmr":case"tmrw":a=xm(e.reference);break;case"tonight":a=Dm(e.reference);break;case"overmorrow":a=Ko(e.reference,2);break;default:if(r.match(/last\s*night/)){if(s.getHours()>6){const i=new Date(s.getTime());i.setDate(i.getDate()-1),s=i}cr(a,s),a.imply("hour",0)}break}return a.addTag("parser/ENCasualDateParser"),a}}const Nm=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i;class Pm extends ds{innerPattern(){return Nm}innerExtract(e,t){let s=null;switch(t[1].toLowerCase()){case"afternoon":s=Im(e.reference);break;case"evening":case"night":s=Em(e.reference);break;case"midnight":s=Am(e.reference);break;case"morning":s=Cm(e.reference);break;case"noon":case"midday":s=Mm(e.reference);break}return s&&s.addTag("parser/ENCasualTimeParser"),s}}function Lm(n,e,t){const s=n.getDateWithAdjustedTimezone(),r=Fm(s,e,t);let a=new rt(n);return a=a.addDurationAsImplied({day:r}),a.assign("weekday",e),a}function Fm(n,e,t){const s=n.getDay();switch(t){case"this":return Ba(n,e);case"last":return vd(n,e);case"next":return s==ct.SUNDAY?e==ct.SUNDAY?7:e:s==ct.SATURDAY?e==ct.SATURDAY?7:e==ct.SUNDAY?8:1+e:e<s&&e!=ct.SUNDAY?Ba(n,e):Ba(n,e)+7}return qm(n,e)}function qm(n,e){const t=vd(n,e),s=Ba(n,e);return s<-t?s:t}function Ba(n,e){const t=n.getDay();let s=e-t;return s<0&&(s+=7),s}function vd(n,e){const t=n.getDay();let s=e-t;return s>=0&&(s-=7),s}const Bm=new RegExp(`(?:(?:\\,|\\(|\\)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${Ks(ro)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),Um=1,zm=2,$m=3;class Ym extends ds{innerPattern(){return Bm}innerExtract(e,t){const s=t[Um],r=t[$m];let a=s||r;a=a||"",a=a.toLowerCase();let i=null;a=="last"||a=="past"?i="last":a=="next"?i="next":a=="this"&&(i="this");const l=t[zm].toLowerCase();let c;if(ro[l]!==void 0)c=ro[l];else if(l=="weekend")c=i=="last"?ct.SUNDAY:ct.SATURDAY;else if(l=="weekday"){const u=e.reference.getDateWithAdjustedTimezone().getDay();u==ct.SUNDAY||u==ct.SATURDAY?c=i=="last"?ct.FRIDAY:ct.MONDAY:(c=u-1,c=i=="last"?c-1:c+1,c=c%5+1)}else return null;return Lm(e.reference,c,i)}}const Wm=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${Ks(fi)})(?=\\s*)(?=\\W|$)`,"i"),jm=1,Hm=2;class Gm extends ds{innerPattern(){return Wm}innerExtract(e,t){const s=t[jm].toLowerCase(),r=t[Hm].toLowerCase(),a=fi[r];if(s=="next"||s.startsWith("after")){const c={};return c[a]=1,rt.createRelativeFromReference(e.reference,c)}if(s=="last"||s=="past"){const c={};return c[a]=-1,rt.createRelativeFromReference(e.reference,c)}const i=e.createParsingComponents();let l=new Date(e.reference.instant.getTime());return r.match(/week/i)?(l.setDate(l.getDate()-l.getDay()),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.imply("year",l.getFullYear())):r.match(/month/i)?(l.setDate(1),i.imply("day",l.getDate()),i.assign("year",l.getFullYear()),i.assign("month",l.getMonth()+1)):r.match(/year/i)&&(l.setDate(1),l.setMonth(0),i.imply("day",l.getDate()),i.imply("month",l.getMonth()+1),i.assign("year",l.getFullYear())),i}}const Km=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),Vm=1,Qm=5,lc=2,cc=3,Ni=4;class Xm{constructor(e){b(this,"groupNumberMonth");b(this,"groupNumberDay");this.groupNumberMonth=e?cc:lc,this.groupNumberDay=e?lc:cc}pattern(){return Km}extract(e,t){const s=t.index+t[Vm].length,r=t.index+t[0].length-t[Qm].length;if(s>0&&e.text.substring(0,s).match("\\d/?$")||r<e.text.length&&e.text.substring(r).match("^/?\\d"))return;const a=e.text.substring(s,r);if(a.match(/^\d\.\d$/)||a.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!t[Ni]&&a.indexOf("/")<0)return;const i=e.createParsingResult(s,a);let l=parseInt(t[this.groupNumberMonth]),c=parseInt(t[this.groupNumberDay]);if((l<1||l>12)&&l>12)if(c>=1&&c<=12&&l<=31)[c,l]=[l,c];else return null;if(c<1||c>31)return null;if(i.start.assign("day",c),i.start.assign("month",l),t[Ni]){const u=parseInt(t[Ni]),d=od(u);i.start.assign("year",d)}else{const u=hi(e.refDate,c,l);i.start.imply("year",u)}return i.addTag("parser/SlashDateFormatParser")}}const Zm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${ya})(?=\\W|$)`,"i"),Jm=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${pi})(?=\\W|$)`,"i");class ey extends ds{constructor(t=!0){super();b(this,"allowAbbreviations");this.allowAbbreviations=t}innerPattern(){return this.allowAbbreviations?Zm:Jm}innerExtract(t,s){const r=s[1].toLowerCase();let a=zr(s[2]);if(!a)return null;switch(r){case"last":case"past":case"-":a=di(a);break}return rt.createRelativeFromReference(t.reference,a)}}function ty(n){return n.text.match(/^[+-]/i)!=null}function uc(n){return n.text.match(/^-/i)!=null}class sy extends ba{shouldMergeResults(e,t,s){return e.match(/^\s*$/i)?ty(s)||uc(s):!1}mergeResults(e,t,s,r){let a=zr(s.text);uc(s)&&(a=di(a));const i=rt.createRelativeFromReference(sr.fromDate(t.start.date()),a);return new Ur(t.reference,t.index,`${t.text}${e}${s.text}`,i)}}function dc(n){return n.text.match(/\s+(before|from)$/i)!=null}function ny(n){return n.text.match(/\s+(after|since)$/i)!=null}class ry extends ba{patternBetween(){return/^\s*$/i}shouldMergeResults(e,t,s){return!e.match(this.patternBetween())||!dc(t)&&!ny(t)?!1:!!s.start.get("day")&&!!s.start.get("month")&&!!s.start.get("year")}mergeResults(e,t,s){let r=zr(t.text);dc(t)&&(r=di(r));const a=rt.createRelativeFromReference(sr.fromDate(s.start.date()),r);return new Ur(s.reference,t.index,`${t.text}${e}${s.text}`,a)}}const ay=new RegExp(`^\\s*(${vi})`,"i"),iy=1;class oy{refine(e,t){return t.forEach(function(s){if(!s.start.isDateWithUnknownYear())return;const r=e.text.substring(s.index+s.text.length),a=ay.exec(r);if(!a||a[0].trim().length<=3)return;e.debug(()=>{console.log(`Extracting year: '${a[0]}' into : ${s}`)});const i=gi(a[iy]);s.end!=null&&s.end.assign("year",i),s.start.assign("year",i),s.text+=a[0]}),t}}class ly extends fd{constructor(){super()}isValid(e,t){const s=t.text.trim();return s===e.text.trim()?!0:s.toLowerCase()==="may"&&!e.text.substring(0,t.index).trim().match(/\b(in)$/i)?(e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):s.toLowerCase().endsWith("the second")?(e.text.substring(t.index+t.text.length).trim().length>0&&e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):!0}}class gd{createCasualConfiguration(e=!1){const t=this.createConfiguration(!1,e);return t.parsers.push(new Rm),t.parsers.push(new Pm),t.parsers.push(new Rp),t.parsers.push(new Gm),t.parsers.push(new ey),t.refiners.push(new ly),t}createConfiguration(e=!0,t=!1){const s=km({parsers:[new Xm(t),new Tp(e),new Dp,new Cp(t),new Ym,new $p,new Hp(e),new Vp(e),new Jp(e)],refiners:[new sc]},e);return s.parsers.unshift(new qp(e)),s.refiners.unshift(new ry),s.refiners.unshift(new sy),s.refiners.unshift(new oo),s.refiners.push(new sc),s.refiners.push(new oy),s.refiners.push(new tm),s}}class Pr{constructor(e){b(this,"parsers");b(this,"refiners");b(this,"defaultConfig",new gd);e=e||this.defaultConfig.createCasualConfiguration(),this.parsers=[...e.parsers],this.refiners=[...e.refiners]}clone(){return new Pr({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(e,t,s){const r=this.parse(e,t,s);return r.length>0?r[0].start.date():null}parse(e,t,s){const r=new cy(e,t,s);let a=[];return this.parsers.forEach(i=>{const l=Pr.executeParser(r,i);a=a.concat(l)}),a.sort((i,l)=>i.index-l.index),this.refiners.forEach(function(i){a=i.refine(r,a)}),a}static executeParser(e,t){const s=[],r=t.pattern(e),a=e.text;let i=e.text,l=r.exec(i);for(;l;){const c=l.index+a.length-i.length;l.index=c;const u=t.extract(e,l);if(!u){i=a.substring(l.index+1),l=r.exec(i);continue}let d=null;u instanceof Ur?d=u:u instanceof rt?(d=e.createParsingResult(l.index,l[0]),d.start=u):d=e.createParsingResult(l.index,l[0],u);const f=d.index,g=d.text;e.debug(()=>console.log(`${t.constructor.name} extracted (at index=${f}) '${g}'`)),s.push(d),i=a.substring(f+g.length),l=r.exec(i)}return s}}class cy{constructor(e,t,s){b(this,"text");b(this,"option");b(this,"reference");b(this,"refDate");this.text=e,this.option=s??{},this.reference=sr.fromInput(t,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(e){return e instanceof rt?e:new rt(this.reference,e)}createParsingResult(e,t,s,r){const a=typeof t=="string"?t:this.text.substring(e,t),i=s?this.createParsingComponents(s):null,l=r?this.createParsingComponents(r):null;return new Ur(this.reference,e,a,i,l)}debug(e){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(e):this.option.debug.debug(e))}}const Vo=new gd,uy=new Pr(Vo.createCasualConfiguration(!1));new Pr(Vo.createConfiguration(!0,!1));new Pr(Vo.createCasualConfiguration(!0));const dy=uy;function Ra(n,e,t){return dy.parseDate(n,e,t)}class ls{static parse(e,t=new Date){const s=e.trim(),r=e;if(!s)return{date:null,isValid:!1,error:"Empty date string",original:r};if(s.match(/^(\d{4})-(\d{2})-(\d{2})$/)){const _=new Date(s);if(!isNaN(_.getTime()))return{date:_,isValid:!0,original:r}}try{const _=Ra(s,t);if(_){const m=new Date(_);return m.setHours(0,0,0,0),{date:m,isValid:!0,original:r}}}catch{}const i=new Date(t);i.setHours(0,0,0,0);const l=s.toLowerCase();if(l==="today")return{date:i,isValid:!0,original:r};if(l==="tomorrow"){const _=new Date(i);return _.setDate(_.getDate()+1),{date:_,isValid:!0,original:r}}if(l==="yesterday"){const _=new Date(i);return _.setDate(_.getDate()-1),{date:_,isValid:!0,original:r}}const c=l.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months)$/);if(c){const _=parseInt(c[1]),m=c[2],p=new Date(i);return m.startsWith("day")?p.setDate(p.getDate()+_):m.startsWith("week")?p.setDate(p.getDate()+_*7):m.startsWith("month")&&p.setMonth(p.getMonth()+_),{date:p,isValid:!0,original:r}}const u=l.match(/^(\d+)\s+(day|days|week|weeks|month|months)\s+ago$/);if(u){const _=parseInt(u[1]),m=u[2],p=new Date(i);return m.startsWith("day")?p.setDate(p.getDate()-_):m.startsWith("week")?p.setDate(p.getDate()-_*7):m.startsWith("month")&&p.setMonth(p.getMonth()-_),{date:p,isValid:!0,original:r}}const d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],f=l.match(/^(next|last)\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(f){const _=f[1],m=d.indexOf(f[2]),p=i.getDay();let k=m-p;_==="next"?k<=0&&(k+=7):k>=0&&(k-=7);const S=new Date(i);return S.setDate(S.getDate()+k),{date:S,isValid:!0,original:r}}const g=l.match(/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$/);if(g){const _=d.indexOf(g[1]),m=i.getDay();let p=_-m;p<0&&(p+=7);const k=new Date(i);return k.setDate(k.getDate()+p),{date:k,isValid:!0,original:r}}const y=l.match(/^(this|next|last)\s+(week|month)$/);if(y){const _=y[1],m=y[2],p=new Date(i);if(m==="week"){const k=p.getDay(),S=k===0?-6:1-k;p.setDate(p.getDate()+S),_==="next"?p.setDate(p.getDate()+7):_==="last"&&p.setDate(p.getDate()-7)}else m==="month"&&(p.setDate(1),_==="next"?p.setMonth(p.getMonth()+1):_==="last"&&p.setMonth(p.getMonth()-1));return{date:p,isValid:!0,original:r}}return{date:null,isValid:!1,error:`Could not parse date: ${e}`,original:r}}static toISODateString(e){return e.toISOString().split("T")[0]}static parseNaturalLanguageDate(e,t=new Date){const s=e.trim();if(!s)return null;const r=ls.handleShortcuts(s,t);if(r)return r;try{const i=Ra(s,t,{forwardDate:!0});if(i)return i}catch{}return ls.parse(s,t).date}static parseToISO(e,t=new Date){const s=ls.parseNaturalLanguageDate(e,t);return s?s.toISOString():null}static isDateExpression(e){const t=e.trim().toLowerCase();if(!t)return!1;if(["today","tomorrow","yesterday","monday","tuesday","wednesday","thursday","friday","saturday","sunday","next","last","this","week","month","year","day","days","ago","eod","eow","eom","in ","at "].some(r=>t.includes(r)))return!0;try{return Ra(t,new Date)!==null}catch{return!1}}static getDateSuggestions(e,t=new Date){const s=[],r=e.trim().toLowerCase(),a=new Date(t);a.setHours(0,0,0,0);const i=[{text:"Today",offset:0,icon:""},{text:"Tomorrow",offset:1,icon:""},{text:"In 2 days",offset:2,icon:""},{text:"In 3 days",offset:3,icon:""},{text:"In 1 week",offset:7,icon:""},{text:"In 2 weeks",offset:14,icon:""}];for(const u of i)if(!r||u.text.toLowerCase().includes(r)){const d=Mn(a,u.offset);s.push({text:u.text,value:d.toISOString(),description:ls.formatDateForDisplay(d,!1),category:"relative",icon:u.icon})}const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let u=0;u<l.length;u++){const d=l[u];if(!r||d.toLowerCase().includes(r)||`next ${d}`.toLowerCase().includes(r)){const f=a.getDay();let y=(u===6?0:u+1)-f;y<=0&&(y+=7);const _=Mn(a,y);s.push({text:d,value:_.toISOString(),description:ls.formatDateForDisplay(_,!1),category:"named",icon:""})}}const c=[{text:"EOD (end of day)",keyword:"eod",icon:""},{text:"EOW (end of week)",keyword:"eow",icon:""},{text:"EOM (end of month)",keyword:"eom",icon:""}];for(const u of c)if(!r||u.text.toLowerCase().includes(r)||u.keyword.includes(r)){const d=ls.handleShortcuts(u.keyword,t);d&&s.push({text:u.text,value:d.toISOString(),description:ls.formatDateForDisplay(d,!0),category:"shortcut",icon:u.icon})}if(!r||"next month".includes(r)){const u=new Date(a);u.setMonth(u.getMonth()+1),s.push({text:"Next month",value:u.toISOString(),description:ls.formatDateForDisplay(u,!1),category:"relative",icon:""})}return s.slice(0,8)}static formatDateForDisplay(e,t=!1){const s={weekday:"short",year:"numeric",month:"short",day:"numeric"};return t&&(s.hour="2-digit",s.minute="2-digit"),e.toLocaleString(void 0,s)}static parseTime(e){const t=e.trim().toLowerCase(),s=t.match(/^(\d{1,2}):(\d{2})$/);if(s){const a=parseInt(s[1]),i=parseInt(s[2]);if(a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}const r=t.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/);if(r){let a=parseInt(r[1]);const i=r[2]?parseInt(r[2]):0,l=r[3];if(l==="pm"&&a!==12?a+=12:l==="am"&&a===12&&(a=0),a>=0&&a<24&&i>=0&&i<60)return{hours:a,minutes:i}}try{const a=Ra(t,new Date);if(a)return{hours:a.getHours(),minutes:a.getMinutes()}}catch{}return null}static handleShortcuts(e,t){const s=e.trim().toLowerCase(),r=new Date(t);switch(r.setHours(0,0,0,0),s){case"eod":return Ii(r,17,0);case"eow":{const a=r.getDay();let i;a===0?i=5:a<=5?i=5-a:i=6;const l=Mn(r,i);return Ii(l,17,0)}case"eom":{const a=new Date(r.getFullYear(),r.getMonth()+1,0);return Ii(a,17,0)}default:return null}}}class js{static compile(e){const{pattern:t,flags:s=""}=e,r=this.validatePattern(t);if(!r.valid)throw new Error(r.error||"Invalid regex pattern");const a=this.validateFlags(s);if(!a.valid)throw new Error(a.error||"Invalid regex flags");try{return new RegExp(t,s)}catch(i){throw new Error(`Failed to compile regex: ${i instanceof Error?i.message:String(i)}`)}}static test(e,t){try{return e.test(t)}catch{return!1}}static validatePattern(e){if(e.length===0)return{valid:!1,error:"Regex pattern cannot be empty"};if(e.length>500)return{valid:!1,error:"Regex pattern is too long (max 500 characters)"};try{return new RegExp(e),{valid:!0}}catch(t){return{valid:!1,error:`Invalid regex syntax: ${t instanceof Error?t.message:String(t)}`}}}static validateFlags(e){if(!e)return{valid:!0};const t=["i","m","s","u"],s=["g","y","d"];for(const a of e)if(s.includes(a))return{valid:!1,error:`Unsupported flag: "${a}" (use i, m, s, u only)`};for(const a of e)if(!t.includes(a))return{valid:!1,error:`Unknown flag: "${a}" (use i, m, s, u only)`};return new Set(e.split("")).size!==e.length?{valid:!1,error:"Duplicate flags found"}:{valid:!0}}static parseRegexLiteral(e){if(!e.startsWith("/")||e.length<2)return null;let t=-1;for(let i=e.length-1;i>0;i--)if(e[i]==="/"){let l=0;for(let c=i-1;c>=0&&e[c]==="\\";c--)l++;if(l%2===0){t=i;break}}if(t<=0)return null;const r=e.substring(1,t).replace(/\\\//g,"/"),a=e.substring(t+1);return{pattern:r,flags:a}}}class nr{constructor(){b(this,"input","");b(this,"position",0);b(this,"line",1);b(this,"column",1);b(this,"referenceDate",new Date)}parse(e,t=new Date){let s=e.trim();const r={},a=s.split(`
`),i=[];for(const u of a){const d=u.trim();if(d==="@ignoreGlobalFilter"){r.overrideGlobalFilter=!0;continue}const f=d.match(/^@profile\s+(.+)$/);if(f){r.useProfile=f[1].trim();continue}i.push(u)}this.input=i.join(`
`).trim(),this.position=0,this.line=1,this.column=1,this.referenceDate=t;const l={filters:[]},c=this.input.split(`
`).map(u=>u.trim()).filter(u=>u.length>0);for(let u=0;u<c.length;u++){this.line=u+1,this.column=1;const d=c[u];if(d.startsWith("sort by "))l.sort=this.parseSortInstruction(d);else if(d.startsWith("group by "))l.group=this.parseGroupInstruction(d);else if(d.startsWith("limit ")||d.startsWith("limit to "))l.limit=this.parseLimitInstruction(d);else if(/^explain$/i.test(d))l.explain=!0;else{const f=this.parseFilterInstruction(d);f&&l.filters.push(f)}}return{...l,...r}}validate(e){try{return this.parse(e),{valid:!0}}catch(t){return t instanceof as?{valid:!1,error:t.message}:{valid:!1,error:String(t)}}}normalizeOperatorAliases(e){return e=e.replace(/^-(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+-(\w+)/gi,"$1 not $2"),e=e.replace(/^!(\w+)/,"not $1"),e=e.replace(/(\s+(?:and|AND|or|OR))\s+!(\w+)/gi,"$1 not $2"),e=e.replace(/\s+except\s+/gi," AND NOT "),e=e.replace(/\s*&&\s*/g," AND "),e=e.replace(/\s*\|\|\s*/g," OR "),e}parseFilterInstruction(e){if(e=this.normalizeOperatorAliases(e),e==="done")return{type:"done",operator:"is",value:!0};if(e==="not done")return{type:"done",operator:"is",value:!1};if(this.hasBooleanOperators(e)||e.includes("("))return this.parseBooleanExpression(e);if(e.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const r=this.parseDateFilter(e);if(r)return r}if(e.startsWith("status.type is ")){const r=e.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(r)}}if(e.startsWith("status.name includes ")){const r=e.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(r)}}if(e.startsWith("status.symbol is ")){const r=e.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(r)}}const s=this.parseDateFilter(e);if(s)return s;if(e.startsWith("priority is "))return{type:"priority",operator:"is",value:e.substring(12).trim()};if(e.startsWith("priority above "))return{type:"priority",operator:"above",value:e.substring(15).trim()};if(e.startsWith("priority below "))return{type:"priority",operator:"below",value:e.substring(15).trim()};if(e.startsWith("urgency is ")){const r=e.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency above ")){const r=e.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("urgency below ")){const r=e.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(r,"urgency")}}if(e.startsWith("tag includes ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e.startsWith("tag does not include ")){const r=e.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(r),negate:!0}}if(e.startsWith("tags include ")){const r=e.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(r)}}if(e==="has tags")return{type:"tag",operator:"has",value:!0};if(e==="no tags")return{type:"tag",operator:"has",value:!1};if(e.startsWith("tag regex ")||e.startsWith("tags regex ")){const r=e.startsWith("tag regex ")?e.substring(10).trim():e.substring(11).trim();return{type:"tag-regex",operator:"regex",value:this.parseRegexPattern(r)}}if(e.startsWith("not tag regex ")||e.startsWith("not tags regex ")){const r=e.startsWith("not tag regex ")?e.substring(14).trim():e.substring(15).trim();return{type:"tag-regex",operator:"regex",value:this.parseRegexPattern(r),negate:!0}}if(e.startsWith("path includes ")){const r=e.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(r)}}if(e.startsWith("path does not include ")){const r=e.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(r),negate:!0}}if(e.startsWith("path regex ")){const r=e.substring(11).trim();return{type:"path-regex",operator:"regex",value:this.parseRegexPattern(r)}}if(e.startsWith("not path regex ")){const r=e.substring(15).trim();return{type:"path-regex",operator:"regex",value:this.parseRegexPattern(r),negate:!0}}if(e==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(e==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(e==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(e==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(e==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(e.startsWith("description includes ")){const r=e.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(r)}}if(e.startsWith("description does not include ")){const r=e.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(r)}}if(e.startsWith("description regex ")){const r=e.substring(18).trim();return{type:"description-regex",operator:"regex",value:this.parseRegexPattern(r)}}if(e.startsWith("not description regex ")){const r=e.substring(22).trim();return{type:"description-regex",operator:"regex",value:this.parseRegexPattern(r),negate:!0}}if(e.startsWith("heading includes ")){const r=e.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(r)}}if(e.startsWith("heading does not include ")){const r=e.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(r)}}throw new as(`Unknown filter instruction: "${e}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}parseDateFilter(e){const t=["due","scheduled","start","created","done","cancelled"];for(const s of t){if(e===`has ${s} date`)return{type:"date",operator:"has",value:{field:s}};if(e===`no ${s} date`)return{type:"date",operator:"has",value:{field:s},negate:!0};const r=e.match(new RegExp(`^${s}\\s+between\\s+(.+?)\\s+and\\s+(.+)$`,"i"));if(r){const i=r[1].trim(),l=r[2].trim(),c=ls.parse(i,this.referenceDate),u=ls.parse(l,this.referenceDate);if(!c.isValid||!c.date)throw new as(`Invalid start date: "${i}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');if(!u.isValid||!u.date)throw new as(`Invalid end date: "${l}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:"between",value:{field:s,date:c.date,endDate:u.date}}}const a=["before","after","on","on or before","on or after"];for(const i of a){const l=`${s} ${i} `;if(e.startsWith(l)){const c=e.substring(l.length).trim(),u=ls.parse(c,this.referenceDate);if(!u.isValid||!u.date)throw new as(`Invalid date value: "${c}"`,this.line,this.column,'Use formats like: today, tomorrow, YYYY-MM-DD, "in 3 days", "next Monday"');return{type:"date",operator:i,value:{field:s,date:u.date}}}}}return null}parseSortInstruction(e){const t=e.match(/^sort by ([a-z.]+)(\s+reverse)?$/i);if(!t)throw new as(`Invalid sort instruction: "${e}"`,this.line,this.column,'Use format: "sort by FIELD" or "sort by FIELD reverse"');return{field:t[1],reverse:!!t[2]}}parseGroupInstruction(e){const t=e.match(/^group by ([a-z.]+)$/i);if(!t)throw new as(`Invalid group instruction: "${e}"`,this.line,this.column,'Use format: "group by FIELD"');return{field:t[1]}}parseLimitInstruction(e){let t=e.match(/^limit (\d+)$/);if(t||(t=e.match(/^limit to (\d+) tasks?$/),t))return parseInt(t[1],10);throw new as(`Invalid limit instruction: "${e}"`,this.line,this.column,'Use format: "limit 10" or "limit to 10 tasks"')}parseStatusType(e){switch(e.toUpperCase().replace(/\s+/g,"_")){case"TODO":return wt.TODO;case"IN_PROGRESS":return wt.IN_PROGRESS;case"DONE":return wt.DONE;case"CANCELLED":return wt.CANCELLED;case"NON_TASK":return wt.NON_TASK;default:throw new as(`Invalid status type: "${e}"`,this.line,this.column,"Valid types: TODO, IN_PROGRESS, DONE, CANCELLED, NON_TASK")}}parseNumericValue(e,t){const s=Number(e);if(Number.isNaN(s))throw new as(`Invalid ${t} value: "${e}"`,this.line,this.column,`Use a numeric ${t} value (e.g., "${t} above 75")`);return s}unquote(e){return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}hasBooleanOperators(e){if(/^(not|NOT)\s+/i.test(e))return!0;const t=/\s+between\s+.+?\s+and\s+/i;if(t.test(e)){const s=e.replace(t," ");return/\s+(and|AND|or|OR)\s+/i.test(s)}return/\s+(and|AND|or|OR)\s+/i.test(e)}parseBooleanExpression(e){return this.parseOrExpression(e)}parseOrExpression(e){const t=this.splitByOperator(e,/\s+(or|OR)\s+/i);if(t.length===1)return this.parseAndExpression(t[0]);let s=this.parseAndExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"OR",value:null,left:s,right:this.parseAndExpression(t[r])};return s}parseAndExpression(e){const t=this.splitByOperator(e,/\s+(and|AND)\s+/i,!0);if(t.length===1)return this.parseNotExpression(t[0]);let s=this.parseNotExpression(t[0]);for(let r=1;r<t.length;r++)s={type:"boolean",operator:"AND",value:null,left:s,right:this.parseNotExpression(t[r])};return s}parseNotExpression(e){const t=e.trim();if(t.toLowerCase()==="not done")return{type:"done",operator:"is",value:!1};if(/^(not|NOT)\s+/i.test(t)){const s=t.replace(/^(not|NOT)\s+/i,"").trim();return{type:"boolean",operator:"NOT",value:null,inner:this.parsePrimaryExpression(s)}}return this.parsePrimaryExpression(t)}parsePrimaryExpression(e){const t=e.trim();if(t.startsWith("(")&&t.endsWith(")")){let s=0;for(let r=0;r<t.length&&(t[r]==="("&&s++,t[r]===")"&&s--,!(s===0&&r<t.length-1));r++);if(s===0){const r=t.slice(1,-1).trim();return this.parseBooleanExpression(r)}}return this.parseAtomicFilter(t)}splitByOperator(e,t,s=!1){const r=[];let a="",i=0,l=0;for(;l<e.length;){const c=e[l];if(c==="(")i++,a+=c,l++;else if(c===")")i--,a+=c,l++;else if(i===0){const d=e.slice(l).match(t);if(d&&d.index===0){if(s&&/\s+(and|AND)\s+/i.test(d[0])&&a.toLowerCase().match(/\s+between\s+[^)]*$/)){a+=d[0],l+=d[0].length;continue}a.trim()&&r.push(a.trim()),a="",l+=d[0].length}else a+=c,l++}else a+=c,l++}return a.trim()&&r.push(a.trim()),r.length>0?r:[e]}parseAtomicFilter(e){const t=this.normalizeOperatorAliases(e.trim());if(t==="done")return{type:"done",operator:"is",value:!0};if(t==="not done")return{type:"done",operator:"is",value:!1};if(t.match(/^(due|scheduled|start|created|done|cancelled)\s+between\s+/i)){const a=this.parseDateFilter(t);if(a)return a}if(t.startsWith("status.type is ")){const a=t.substring(15).trim();return{type:"status",operator:"type-is",value:this.parseStatusType(a)}}if(t.startsWith("status.name includes ")){const a=t.substring(21).trim();return{type:"status",operator:"name-includes",value:this.unquote(a)}}if(t.startsWith("status.symbol is ")){const a=t.substring(17).trim();return{type:"status",operator:"symbol-is",value:this.unquote(a)}}const r=this.parseDateFilter(t);if(r)return r;if(t.startsWith("priority is "))return{type:"priority",operator:"is",value:t.substring(12).trim()};if(t.startsWith("priority above "))return{type:"priority",operator:"above",value:t.substring(15).trim()};if(t.startsWith("priority below "))return{type:"priority",operator:"below",value:t.substring(15).trim()};if(t.startsWith("urgency is ")){const a=t.substring(11).trim();return{type:"urgency",operator:"is",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency above ")){const a=t.substring(14).trim();return{type:"urgency",operator:"above",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("urgency below ")){const a=t.substring(14).trim();return{type:"urgency",operator:"below",value:this.parseNumericValue(a,"urgency")}}if(t.startsWith("tag includes ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t.startsWith("tag does not include ")){const a=t.substring(21).trim();return{type:"tag",operator:"includes",value:this.unquote(a),negate:!0}}if(t.startsWith("tags include ")){const a=t.substring(13).trim();return{type:"tag",operator:"includes",value:this.unquote(a)}}if(t==="has tags")return{type:"tag",operator:"has",value:!0};if(t==="no tags")return{type:"tag",operator:"has",value:!1};if(t.startsWith("tag regex ")||t.startsWith("tags regex ")){const a=t.startsWith("tag regex ")?t.substring(10).trim():t.substring(11).trim();return{type:"tag-regex",operator:"regex",value:this.parseRegexPattern(a)}}if(t.startsWith("not tag regex ")||t.startsWith("not tags regex ")){const a=t.startsWith("not tag regex ")?t.substring(14).trim():t.substring(15).trim();return{type:"tag-regex",operator:"regex",value:this.parseRegexPattern(a),negate:!0}}if(t.startsWith("path includes ")){const a=t.substring(14).trim();return{type:"path",operator:"includes",value:this.unquote(a)}}if(t.startsWith("path does not include ")){const a=t.substring(22).trim();return{type:"path",operator:"includes",value:this.unquote(a),negate:!0}}if(t.startsWith("path regex ")){const a=t.substring(11).trim();return{type:"path-regex",operator:"regex",value:this.parseRegexPattern(a)}}if(t.startsWith("not path regex ")){const a=t.substring(15).trim();return{type:"path-regex",operator:"regex",value:this.parseRegexPattern(a),negate:!0}}if(t==="is blocked")return{type:"dependency",operator:"is-blocked",value:!0};if(t==="is not blocked")return{type:"dependency",operator:"is-blocked",value:!1};if(t==="is blocking")return{type:"dependency",operator:"is-blocking",value:!0};if(t==="is recurring")return{type:"recurrence",operator:"is",value:!0};if(t==="is not recurring")return{type:"recurrence",operator:"is",value:!1};if(t.startsWith("description includes ")){const a=t.substring(21).trim();return{type:"description",operator:"includes",value:this.unquote(a)}}if(t.startsWith("description does not include ")){const a=t.substring(29).trim();return{type:"description",operator:"does not include",value:this.unquote(a)}}if(t.startsWith("description regex ")){const a=t.substring(18).trim();return{type:"description-regex",operator:"regex",value:this.parseRegexPattern(a)}}if(t.startsWith("not description regex ")){const a=t.substring(22).trim();return{type:"description-regex",operator:"regex",value:this.parseRegexPattern(a),negate:!0}}if(t.startsWith("heading includes ")){const a=t.substring(17).trim();return{type:"heading",operator:"includes",value:this.unquote(a)}}if(t.startsWith("heading does not include ")){const a=t.substring(25).trim();return{type:"heading",operator:"does not include",value:this.unquote(a)}}throw new as(`Unknown filter instruction: "${t}"`,this.line,this.column,"Check the query syntax documentation for valid filter instructions")}parseRegexPattern(e){const t=js.parseRegexLiteral(e);if(t){const a=js.validatePattern(t.pattern);if(!a.valid)throw new as(`Invalid regex pattern: ${a.error}`,this.line,this.column,"Check your regex syntax");const i=js.validateFlags(t.flags||"");if(!i.valid)throw new as(`Invalid regex flags: ${i.error}`,this.line,this.column,"Only i, m, s, u flags are supported");return t}const s=this.unquote(e),r=js.validatePattern(s);if(!r.valid)throw new as(`Invalid regex pattern: ${r.error}`,this.line,this.column,"Check your regex syntax");return{pattern:s,flags:""}}}class vt{}const Un=class Un{constructor(){b(this,"statuses",new Map);this.addDefaultStatuses()}static getInstance(){return Un.instance||(Un.instance=new Un),Un.instance}addDefaultStatuses(){this.add(Xs.TODO),this.add(Xs.IN_PROGRESS),this.add(Xs.DONE),this.add(Xs.CANCELLED)}add(e){this.statuses.set(e.symbol,e)}register(e){this.add(e)}unregister(e){this.statuses.delete(e)}get(e){const t=this.statuses.get(e);return t||new Xs({symbol:e,name:"Unknown",nextStatusSymbol:"x",type:Xs.getTypeForUnknownSymbol(e)})}getNextStatus(e){return this.get(e.nextStatusSymbol)}getAllStatuses(){return Array.from(this.statuses.values())}getAll(){return this.getAllStatuses()}reset(){this.statuses.clear(),this.addDefaultStatuses()}};b(Un,"instance",null);let Gs=Un;class hy extends vt{constructor(e,t=!1){super(),this.statusType=e,this.negate=t}matches(e){const t=Gs.getInstance(),s=e.statusSymbol||" ",a=t.get(s).type===this.statusType;return this.negate?!a:a}}class fy extends vt{constructor(e,t=!1){super(),this.name=e,this.negate=t}matches(e){const t=Gs.getInstance(),s=e.statusSymbol||" ",a=t.get(s).name.toLowerCase().includes(this.name.toLowerCase());return this.negate?!a:a}}class vy extends vt{constructor(e,t=!1){super(),this.symbol=e,this.negate=t}matches(e){const s=(e.statusSymbol||" ")===this.symbol;return this.negate?!s:s}}class gy extends vt{matches(e){const t=Gs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type===wt.DONE}}class py extends vt{matches(e){const t=Gs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type!==wt.DONE}}class hc extends vt{constructor(e,t,s,r){super(),this.field=e,this.comparator=t,this.targetDate=s,this.endDate=r}matches(e){const t=this.getTaskDate(e);if(!t)return!1;const s=new Date(this.targetDate);s.setHours(0,0,0,0);const r=new Date(t);switch(r.setHours(0,0,0,0),this.comparator){case"before":return r<s;case"after":return r>s;case"on":return r.getTime()===s.getTime();case"on or before":return r<=s;case"on or after":return r>=s;case"between":if(!this.endDate)return!1;const a=new Date(this.endDate);return a.setHours(0,0,0,0),r>=s&&r<=a;default:return!1}}getTaskDate(e){let t;switch(this.field){case"due":t=e.dueAt;break;case"scheduled":t=e.scheduledAt;break;case"start":t=e.startAt;break;case"created":t=e.createdAt;break;case"done":t=e.doneAt;break;case"cancelled":t=e.cancelledAt;break}return t?new Date(t):null}}class my extends vt{constructor(e,t=!1){super(),this.field=e,this.negate=t}matches(e){let t=!1;switch(this.field){case"due":t=!!e.dueAt;break;case"scheduled":t=!!e.scheduledAt;break;case"start":t=!!e.startAt;break;case"created":t=!!e.createdAt;break;case"done":t=!!e.doneAt;break;case"cancelled":t=!!e.cancelledAt;break}return this.negate?!t:t}}const fc={lowest:0,low:1,normal:2,medium:3,high:4,highest:5};function yy(n){return Nr(n)??"normal"}function by(n){return n==="urgent"?"highest":n==="none"?"normal":n}class ky extends vt{constructor(e,t){super(),this.operator=e,this.level=t}matches(e){const t=yy(e.priority),s=fc[t],r=fc[by(this.level)];switch(this.operator){case"is":return s===r;case"above":return s>r;case"below":return s<r;default:return!1}}}class _y extends vt{constructor(e,t=!1){super(),this.tag=e,this.negate=t}matches(e){const t=e.tags||[],s=this.tag.toLowerCase(),r=t.some(a=>a.toLowerCase().includes(s));return this.negate?!r:r}}class wy extends vt{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.tags&&e.tags.length>0;return this.negate?!t:!!t}}class Ty extends vt{constructor(e,t=!1){super(),this.pattern=e,this.negate=t}matches(e){const s=(e.path||"").toLowerCase().includes(this.pattern.toLowerCase());return this.negate?!s:s}}class xy extends vt{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph){const s=e.blockedBy&&e.blockedBy.length>0;return this.negate?!s:!!s}const t=this.dependencyGraph.isBlocked(e.id);return this.negate?!t:t}}class Sy extends vt{constructor(e,t=!1){super(),this.dependencyGraph=e,this.negate=t}matches(e){if(!this.dependencyGraph)return!!this.negate;const t=this.dependencyGraph.isBlocking(e.id);return this.negate?!t:t}}class Dy extends vt{constructor(e=!1){super(),this.negate=e}matches(e){const t=e.frequency&&e.frequency.type!=="once";return this.negate?!t:!!t}}class Ey extends vt{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)&&this.right.matches(e)}}class Ay extends vt{constructor(e,t){super(),this.left=e,this.right=t}matches(e){return this.left.matches(e)||this.right.matches(e)}}class Cy extends vt{constructor(e){super(),this.inner=e}matches(e){return!this.inner.matches(e)}}class Iy extends vt{constructor(e,t,s=!1){super(),this.operator=e,this.pattern=t,this.caseSensitive=s}matches(e){const t=e.name||"",s=e.description||"",r=`${t} ${s}`.trim();switch(this.operator){case"includes":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"does not include":{const a=this.caseSensitive?this.pattern:this.pattern.toLowerCase();return!(this.caseSensitive?r:r.toLowerCase()).includes(a)}case"regex":try{const a=this.caseSensitive?"":"i";return new RegExp(this.pattern,a).test(r)}catch{return!1}}}}class My extends vt{constructor(e,t){super(),this.operator=e,this.pattern=t}matches(e){const s=(e.heading||"").toLowerCase().includes(this.pattern.toLowerCase());return this.operator==="includes"?s:!s}}class Oy extends vt{constructor(e,t,s,r){super(),this.comparator=e,this.threshold=t,this.referenceDate=s,this.settings=r}matches(e){const t=Yo(e,{now:this.referenceDate,settings:this.settings});switch(this.comparator){case"above":return t>this.threshold;case"below":return t<this.threshold;case"is":return t===this.threshold;default:return!1}}}class Ry extends vt{constructor(t,s=!1){super();b(this,"re");this.negate=s,this.re=js.compile(t)}matches(t){const s=`${t.name||""} ${t.description||""}`.trim(),r=js.test(this.re,s);return this.negate?!r:r}}class Ny extends vt{constructor(t,s=!1){super();b(this,"re");this.negate=s,this.re=js.compile(t)}matches(t){const s=t.path||"",r=js.test(this.re,s);return this.negate?!r:r}}class Py extends vt{constructor(t,s=!1){super();b(this,"re");this.negate=s,this.re=js.compile(t)}matches(t){if(!t.tags||t.tags.length===0)return this.negate;const s=t.tags.some(r=>js.test(this.re,r));return this.negate?!s:s}}class Ln{group(e){const t=new Map;for(const s of e){const r=this.getGroupKey(s);this.addToGroup(t,r,s)}return t}addToGroup(e,t,s){e.has(t)||e.set(t,[]),e.get(t).push(s)}}class Ly extends Ln{getGroupKey(e){if(!e.dueAt)return"No due date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.dueAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Overdue":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class Fy extends Ln{getGroupKey(e){if(!e.scheduledAt)return"No scheduled date";const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.scheduledAt);s.setHours(0,0,0,0);const r=s.getTime()-t.getTime(),a=Math.ceil(r/(1e3*60*60*24));return a<0?"Past":a===0?"Today":a===1?"Tomorrow":a<=7?"This Week":"Later"}}class qy extends Ln{getGroupKey(e){const t=Gs.getInstance(),s=e.statusSymbol||" ";return t.get(s).type}}class By extends Ln{getGroupKey(e){const t=Gs.getInstance(),s=e.statusSymbol||" ";return t.get(s).name}}class Uy extends Ln{getGroupKey(e){const t=e.priority||"normal";return t.charAt(0).toUpperCase()+t.slice(1)}}class zy extends Ln{getGroupKey(e){return e.path||""||"No path"}}class $y extends Ln{getGroupKey(e){const t=e.path||"";if(!t)return"No folder";const s=t.lastIndexOf("/");return s===-1?"Root":t.substring(0,s)||"Root"}}class Yy extends Ln{group(e){const t=new Map;for(const s of e){const r=s.tags||[];if(r.length===0)this.addToGroup(t,"No tags",s);else for(const a of r)this.addToGroup(t,a,s)}return t}getGroupKey(e){const t=e.tags||[];return t.length>0?t[0]:"No tags"}}function Wy(n){const e=[];if(n.filters.length>0){e.push("**Filters:**");for(const t of n.filters)e.push(`- ${yr(t)}`)}else e.push("**Filters:** None (showing all tasks)");if(n.sort){const t=n.sort.reverse?"descending":"ascending";e.push(`
**Sort:** By ${n.sort.field} (${t})`)}return n.group&&e.push(`
**Group:** By ${n.group.field}`),n.limit!==void 0&&n.limit>0&&e.push(`
**Limit:** First ${n.limit} tasks`),e.join(`
`)}function yr(n){const e=n.negate?"NOT ":"";switch(n.type){case"status":return`${e}Status ${n.operator} "${n.value}"`;case"date":return`${e}${n.value.field} ${n.value.comparator} ${n.value.date}`;case"priority":return`${e}Priority ${n.operator} ${n.value}`;case"urgency":return`${e}Urgency ${n.operator} ${n.value}`;case"tag":return n.operator==="includes"?`${e}Tag includes "${n.value}"`:n.operator==="has"?`${e}Has tags`:`${e}Tag ${n.operator} "${n.value}"`;case"path":return`${e}Path ${n.operator} "${n.value}"`;case"dependency":return n.value==="blocked"?`${e}Is blocked by another task`:n.value==="blocking"?`${e}Is blocking another task`:`${e}Dependency ${n.operator} ${n.value}`;case"recurrence":return`${e}Recurrence ${n.operator} ${n.value}`;case"boolean":return n.operator==="AND"||n.operator==="and"?`(${yr(n.left)} AND ${yr(n.right)})`:n.operator==="OR"||n.operator==="or"?`(${yr(n.left)} OR ${yr(n.right)})`:n.operator==="NOT"||n.operator==="not"?`(NOT ${yr(n.inner)})`:"Unknown boolean filter";case"done":return n.value?`${e}done`:`${e}not done`;case"description":return`${e}Description ${n.operator} "${n.value}"`;default:return`${e}Unknown filter`}}class pd{constructor(e,t={}){b(this,"dependencyGraph",null);b(this,"globalFilterAST",null);b(this,"urgencySettings");this.taskIndex=e,this.urgencySettings=t.urgencySettings??$o}setDependencyGraph(e){this.dependencyGraph=e}setGlobalFilter(e){if(!e){this.globalFilterAST=null;return}try{const t=new nr;this.globalFilterAST=t.parse(e)}catch(t){console.error("Failed to parse global filter:",t),this.globalFilterAST=null}}execute(e){const t=performance.now(),s=new Date;try{const r=e.explain?this.generateExplanation(e):void 0;let a=this.taskIndex.getAllTasks();const i=a.length;this.globalFilterAST&&this.globalFilterAST.filters.length>0&&(a=this.applyFilters(a,this.globalFilterAST.filters,s)),e.filters.length>0&&(a=this.applyFilters(a,e.filters,s)),e.sort&&(a=this.applySort(a,e.sort,s)),e.limit!==void 0&&e.limit>0&&(a=a.slice(0,e.limit));let l;e.group&&(l=this.applyGrouping(a,e.group));const u=performance.now()-t;return{tasks:a,groups:l,totalCount:i,executionTimeMs:u,explanation:r}}catch(r){throw new vr(`Failed to execute query: ${r instanceof Error?r.message:String(r)}`,r instanceof Error?r:void 0)}}executeString(e){const s=new nr().parse(e);return this.execute(s)}validateQuery(e){try{return{valid:!0,parsedFilters:new nr().parse(e).filters.map(r=>`${r.type}:${r.operator}`)}}catch(t){return{valid:!1,error:t instanceof Error?t.message:String(t)}}}applyFilters(e,t,s){let r=e;for(const a of t){const i=this.createFilter(a,s);r=r.filter(l=>i.matches(l))}return r}createFilter(e,t){switch(e.type){case"done":return e.value?new gy:new py;case"status":if(e.operator==="type-is")return new hy(e.value,e.negate);if(e.operator==="name-includes")return new fy(e.value,e.negate);if(e.operator==="symbol-is")return new vy(e.value,e.negate);throw new vr(`Unknown status operator: ${e.operator}`);case"date":return e.operator==="has"?new my(e.value.field,e.negate):e.operator==="between"?new hc(e.value.field,e.operator,e.value.date,e.value.endDate):new hc(e.value.field,e.operator,e.value.date);case"priority":return new ky(e.operator,e.value);case"urgency":return new Oy(e.operator,e.value,t,this.urgencySettings);case"tag":return e.operator==="has"?new wy(!e.value):new _y(e.value,e.negate);case"path":return new Ty(e.value,e.negate);case"dependency":if(e.operator==="is-blocked")return new xy(this.dependencyGraph,!e.value);if(e.operator==="is-blocking")return new Sy(this.dependencyGraph,!e.value);throw new vr(`Unknown dependency operator: ${e.operator}`);case"recurrence":return new Dy(!e.value);case"description":return new Iy(e.operator,e.value,e.negate);case"description-regex":return new Ry(e.value,e.negate);case"path-regex":return new Ny(e.value,e.negate);case"tag-regex":return new Py(e.value,e.negate);case"heading":return new My(e.operator,e.value);case"boolean":if(e.operator==="AND"&&e.left&&e.right)return new Ey(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="OR"&&e.left&&e.right)return new Ay(this.createFilter(e.left,t),this.createFilter(e.right,t));if(e.operator==="NOT"&&e.inner)return new Cy(this.createFilter(e.inner,t));throw new vr(`Invalid boolean operator: ${e.operator}`);default:throw new vr(`Unknown filter type: ${e.type}`)}}applySort(e,t,s){const r=[...e];return r.sort((a,i)=>{let l=0;switch(t.field){case"due":l=this.compareDates(a.dueAt,i.dueAt);break;case"scheduled":l=this.compareDates(a.scheduledAt,i.scheduledAt);break;case"start":l=this.compareDates(a.startAt,i.startAt);break;case"created":l=this.compareDates(a.createdAt,i.createdAt);break;case"done":l=this.compareDates(a.doneAt,i.doneAt);break;case"priority":l=this.comparePriorities(a.priority,i.priority);break;case"urgency":l=this.getUrgencyScore(i,s)-this.getUrgencyScore(a,s);break;case"status.type":l=this.compareStatusTypes(a,i);break;case"description":l=(a.description||"").localeCompare(i.description||"");break;case"heading":l=(a.heading||"").localeCompare(i.heading||"");break;case"path":l=(a.path||"").localeCompare(i.path||"");break;default:l=a.name.localeCompare(i.name)}return t.reverse?-l:l}),r}compareDates(e,t){return!e&&!t?0:e?t?new Date(e).getTime()-new Date(t).getTime():-1:1}comparePriorities(e,t){const s={lowest:0,low:1,normal:2,medium:3,high:4,highest:5},r=s[Nr(e)||"normal"]||2,a=s[Nr(t)||"normal"]||2;return r-a}compareStatusTypes(e,t){const s=r=>{const a=r.statusSymbol||" ";return a===" "?0:a==="/"?1:a==="x"?2:a==="-"?3:0};return s(e)-s(t)}getUrgencyScore(e,t){return Yo(e,{now:t,settings:this.urgencySettings})}applyGrouping(e,t){return this.createGrouper(t.field).group(e)}createGrouper(e){switch(e){case"due":return new Ly;case"scheduled":return new Fy;case"status.type":return new qy;case"status.name":return new By;case"priority":return new Uy;case"path":return new zy;case"folder":return new $y;case"tags":return new Yy;default:throw new vr(`Unknown grouping field: ${e}`)}}generateExplanation(e){return Wy(e)}}class md{constructor(e){b(this,"parser");this.parser=e??new nr}compose(e,t){const{query:s,ignoreGlobal:r}=this.stripIgnoreDirective(e),a=this.parser.parse(s);return!r&&t&&t.filters.length>0?{ast:{...a,filters:[...t.filters,...a.filters]},ignoredGlobal:!1}:{ast:a,ignoredGlobal:r}}stripIgnoreDirective(e){const t=e.split(`
`),s=[];let r=!1;for(const a of t){if(/^ignore global query$/i.test(a.trim())){r=!0;continue}s.push(a)}return{query:s.join(`
`),ignoreGlobal:r}}}const yd={enabled:!1,query:""},zn=class zn{constructor(e=yd){b(this,"config");b(this,"ast",null);b(this,"error",null);this.config=e,this.parse()}static getInstance(){return zn.instance||(zn.instance=new zn),zn.instance}initialize(e){this.config=e,this.parse()}updateConfig(e){this.config=e,this.parse()}getConfig(){return this.config}isEnabled(){return this.config.enabled&&this.config.query.trim().length>0}getAST(){return this.ast}getError(){return this.error}parse(){if(!this.isEnabled()){this.ast=null,this.error=null;return}try{const e=new nr;this.ast=e.parse(this.config.query),this.error=null}catch(e){this.ast=null,this.error=e instanceof Error?e.message:String(e)}}};b(zn,"instance",null);let oa=zn;var jy=C('<button class="search-tab__btn svelte-1yjlv38"> </button>'),Hy=C('<div class="search-tab__error svelte-1yjlv38"> </div>'),Gy=C('<div class="search-tab__stats svelte-1yjlv38"> </div>'),Ky=C('<li><button class="search-tab__history-item svelte-1yjlv38"> </button></li>'),Vy=C('<div class="search-tab__history svelte-1yjlv38"><div class="search-tab__history-header svelte-1yjlv38"><h3 class="svelte-1yjlv38">Recent Queries</h3> <button class="search-tab__btn--small svelte-1yjlv38">Clear</button></div> <ul class="search-tab__history-list svelte-1yjlv38"></ul></div>'),Qy=C('<button class="search-tab__example-btn svelte-1yjlv38"><code class="svelte-1yjlv38"> </code></button>'),Xy=C('<div class="search-tab__empty svelte-1yjlv38"><p class="svelte-1yjlv38"> No tasks match your query</p> <p class="search-tab__empty-subtitle svelte-1yjlv38">Try adjusting your search criteria</p></div>'),Zy=C('<div class="search-tab__card-wrapper svelte-1yjlv38" role="listitem"><!></div>'),Jy=C(`<div class="search-tab svelte-1yjlv38"><div class="search-tab__header svelte-1yjlv38"><h2 class="search-tab__title svelte-1yjlv38">Search</h2> <p class="search-tab__subtitle svelte-1yjlv38">Use query language to filter and search tasks</p></div> <div class="search-tab__query-section svelte-1yjlv38"><div class="search-tab__input-wrapper svelte-1yjlv38"><textarea class="search-tab__input svelte-1yjlv38" placeholder="Enter query (e.g., 'not done AND priority high')..." rows="2"></textarea> <div class="search-tab__input-actions svelte-1yjlv38"><button class="search-tab__btn search-tab__btn--primary svelte-1yjlv38"> </button> <!></div></div> <!> <!></div> <!> <div class="search-tab__examples svelte-1yjlv38"><h3 class="search-tab__examples-title svelte-1yjlv38">Example Queries</h3> <div class="search-tab__examples-grid svelte-1yjlv38"></div></div> <div class="search-tab__results svelte-1yjlv38" role="list" aria-label="Search results"><!></div></div>`);function eb(n,e){ht(e,!0);let t=V(""),s=V(De([])),r=V(""),a=V(0),i=V(De([])),l=V(!1),c=V(!1);const u=["not done","priority is high","due before tomorrow","not done AND priority above medium","is blocked","description includes meeting","tag includes #work","is recurring","priority is high OR priority is medium","NOT is blocked","not done AND priority is high AND description includes priority","sort by priority","sort by urgency","urgency above 80","group by priority"],d={getAllTasks:()=>e.tasks},f=uu(jo),g=new pd(d,{urgencySettings:f}),y=new md(new nr);function _(){if(!o(t).trim()){T(s,[],!0),T(r,"");return}T(c,!0),T(r,"");try{const U=oa.getInstance();if(U.isEnabled()&&U.getError())throw new Error(`Global query error: ${U.getError()}`);const A=y.compose(o(t),U.getAST()).ast,F=g.execute(A);if(T(s,F.tasks,!0),T(a,F.executionTimeMs,!0),!o(i).includes(o(t))){T(i,[o(t),...o(i)].slice(0,10),!0);try{localStorage.setItem("query-history",JSON.stringify(o(i)))}catch{}}}catch(U){T(r,U instanceof Error?U.message:String(U),!0),T(s,[],!0),j.error(`Query error: ${o(r)}`)}finally{T(c,!1)}}function m(){try{const U=localStorage.getItem("query-history");U&&T(i,JSON.parse(U),!0)}catch{}}function p(U){T(t,U,!0),_()}function k(U){T(t,U,!0),T(l,!1),_()}function S(){T(i,[],!0);try{localStorage.removeItem("query-history")}catch{}T(l,!1)}function D(U){U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),_())}Tt(()=>{m()});let E=V(0),R=De([]);Tt(()=>{o(E)>=o(s).length&&T(E,Math.max(0,o(s).length-1),!0)});function P(U,A){U.key==="ArrowDown"?(U.preventDefault(),T(E,Math.min(o(E)+1,o(s).length-1),!0)):U.key==="ArrowUp"?(U.preventDefault(),T(E,Math.max(o(E)-1,0),!0)):U.key==="Enter"&&e.onEdit?(U.preventDefault(),e.onEdit(o(s)[A])):U.key===" "&&e.onDone&&(U.preventDefault(),e.onDone(o(s)[A]))}var L=Jy(),H=v(h(L),2),Y=h(H),X=h(Y);X.__keydown=D;var oe=v(X,2),ae=h(oe);ae.__click=_;var ve=h(ae),Q=v(ae,2);{var Z=U=>{var A=jy();A.__click=()=>T(l,!o(l));var F=h(A);$(()=>N(F,`History (${o(i).length??""})`)),x(U,A)};W(Q,U=>{o(i).length>0&&U(Z)})}var B=v(Y,2);{var M=U=>{var A=Hy(),F=h(A);$(()=>N(F,` ${o(r)??""}`)),x(U,A)};W(B,U=>{o(r)&&U(M)})}var I=v(B,2);{var G=U=>{var A=Gy(),F=h(A);$(K=>N(F,`Found ${o(s).length??""} task${o(s).length!==1?"s":""} in ${K??""}ms`),[()=>o(a).toFixed(2)]),x(U,A)};W(I,U=>{o(a)>0&&!o(r)&&U(G)})}var se=v(H,2);{var ke=U=>{var A=Vy(),F=h(A),K=v(h(F),2);K.__click=S;var ie=v(F,2);He(ie,21,()=>o(i),bt,(O,q)=>{var ee=Ky(),me=h(ee);me.__click=()=>k(o(q));var _e=h(me);$(()=>N(_e,o(q))),x(O,ee)}),x(U,A)};W(se,U=>{o(l)&&o(i).length>0&&U(ke)})}var ge=v(se,2),ce=v(h(ge),2);He(ce,21,()=>u,bt,(U,A)=>{var F=Qy();F.__click=()=>p(o(A));var K=h(F),ie=h(K);$(()=>N(ie,o(A))),x(U,F)});var Ie=v(ge,2),Me=h(Ie);{var Ue=U=>{var A=Xy();x(U,A)},de=U=>{var A=lt(),F=Qe(A);{var K=ie=>{var O=lt(),q=Qe(O);He(q,19,()=>o(s),ee=>ee.id,(ee,me,_e)=>{var ue=Zy();ue.__keydown=Ae=>P(Ae,o(_e));var Ee=h(ue);Br(Ee,{get task(){return o(me)},get onEdit(){return e.onEdit},get onDone(){return e.onDone},get onDelete(){return e.onDelete}}),Ps(ue,(Ae,$e)=>R[$e]=Ae,Ae=>R==null?void 0:R[Ae],()=>[o(_e)]),$(()=>Le(ue,"tabindex",o(_e)===o(E)?0:-1)),Ut("focus",ue,()=>T(E,o(_e),!0)),x(ee,ue)}),x(ie,O)};W(F,ie=>{o(s).length>0&&ie(K)},!0)}x(U,A)};W(Me,U=>{o(s).length===0&&o(t).trim()&&!o(r)?U(Ue):U(de,!1)})}$(()=>{ae.disabled=o(c),N(ve,o(c)?"Searching...":"Search")}),ut(X,()=>o(t),U=>T(t,U)),x(n,L),ft()}xt(["keydown","click"]);class tb{analyzeCompletionPatterns(e){if(!e.completionHistory||e.completionHistory.length===0)return this.getDefaultInsight();const t=e.completionHistory,s=new vc,r=this.calculateAverageDelay(t),a=s.calculateOptimalTime(t),i=s.findWeekdayPatterns(t),l=Array.from(i.keys()).filter(y=>{const _=i.get(y);return _&&_.confidence>.5}),c=this.calculateConsistencyScore(t),u=(e.completionCount||0)+(e.missCount||0),d=u>0?(e.missCount||0)/u*100:0,f=this.generateSuggestion(r,a,l,c),g=this.calculateConfidence(t.length,c,a.confidence);return{averageCompletionDelay:r,preferredTimeOfDay:a.hour,preferredDayOfWeek:l,completionConsistency:c,missedTaskFrequency:d,suggestedAdjustment:f,confidence:g}}suggestScheduleOptimization(e){const t=this.analyzeCompletionPatterns(e);if(t.confidence<.5||!e.completionHistory||e.completionHistory.length<10)return null;const s=e.frequency,r={...s};let a="",i="";if(Math.abs(t.averageCompletionDelay)>60&&(a=`You typically complete this task around ${t.preferredTimeOfDay}:00, `,a+=t.averageCompletionDelay>0?`${Math.round(t.averageCompletionDelay/60)} hours later than scheduled.`:`${Math.round(Math.abs(t.averageCompletionDelay)/60)} hours earlier than scheduled.`,i="Better alignment with your natural completion patterns"),s.type==="weekly"&&t.preferredDayOfWeek.length>0){const l=s.weekdays||[],c=t.preferredDayOfWeek;JSON.stringify(l.sort())!==JSON.stringify(c.sort())&&(r.weekdays=c,a+=` Consider scheduling for ${this.formatWeekdays(c)} based on completion patterns.`,i="Higher completion rate on preferred days")}return a?{currentSchedule:{frequency:s,time:this.extractTimeFromDueAt(e.dueAt)},suggestedSchedule:{frequency:r,time:t.preferredTimeOfDay!==void 0?`${t.preferredTimeOfDay.toString().padStart(2,"0")}:00`:void 0},reason:a,confidence:t.confidence,expectedImprovement:i}:null}autoAdjustSchedule(e,t=.7){var a;if(!((a=e.smartRecurrence)!=null&&a.autoAdjust))return!1;const s=this.suggestScheduleOptimization(e);if(!s||s.confidence<t)return!1;if(e.frequency=s.suggestedSchedule.frequency,s.suggestedSchedule.time){const i=new Date(e.dueAt),[l,c]=s.suggestedSchedule.time.split(":").map(Number);i.setHours(l,c||0,0,0),e.dueAt=i.toISOString()}e.learningMetrics||(e.learningMetrics={averageDelayMinutes:0,optimalHour:0,consistencyScore:0,lastLearningUpdate:new Date().toISOString()});const r=this.analyzeCompletionPatterns(e);return e.learningMetrics.averageDelayMinutes=r.averageCompletionDelay,e.learningMetrics.optimalHour=r.preferredTimeOfDay,e.learningMetrics.consistencyScore=r.completionConsistency,e.learningMetrics.lastLearningUpdate=new Date().toISOString(),!0}detectAnomalies(e){const t=[];if(!e.completionHistory||e.completionHistory.length<5)return t;const r=new vc().detectSkipPatterns(e);r.isAnomalous&&t.push({type:"consistently_skipped",severity:"high",description:r.reason,affectedPeriod:{start:e.createdAt,end:new Date().toISOString()},suggestion:"Consider adjusting the recurrence frequency or disabling this task"});const a=this.detectCompletionDrift(e.completionHistory);return a.isDrifting&&t.push({type:"completion_drift",severity:a.severity,description:`Completion times are drifting ${a.direction} by an average of ${a.averageDriftMinutes} minutes`,affectedPeriod:{start:e.completionHistory[0].completedAt,end:e.completionHistory[e.completionHistory.length-1].completedAt},suggestion:"Consider adjusting the scheduled time to match your natural completion pattern"}),t}getDefaultInsight(){return{averageCompletionDelay:0,preferredTimeOfDay:9,preferredDayOfWeek:[],completionConsistency:0,missedTaskFrequency:0,suggestedAdjustment:"Not enough data to generate insights (need at least 10 completions)",confidence:0}}calculateAverageDelay(e){if(e.length===0)return 0;const t=e.reduce((s,r)=>s+r.delayMinutes,0);return Math.round(t/e.length)}calculateConsistencyScore(e){if(e.length<2)return 0;const t=this.calculateAverageDelay(e),s=e.reduce((i,l)=>{const c=l.delayMinutes-t;return i+c*c},0)/e.length,r=Math.sqrt(s),a=Math.max(0,1-r/240);return Math.round(a*100)/100}generateSuggestion(e,t,s,r){if(r<.3)return"Completion patterns are inconsistent. Try to complete tasks at similar times.";const a=[];if(Math.abs(e)>60){const i=Math.round(Math.abs(e)/60);e>0?a.push(`Consider scheduling ${i} hour(s) later (around ${t.hour}:00)`):a.push(`Consider scheduling ${i} hour(s) earlier (around ${t.hour}:00)`)}return s.length>0&&t.confidence>.6&&a.push(`Best completion rate on ${this.formatWeekdays(s)}`),a.length>0?a.join(". "):"Maintaining good completion consistency!"}calculateConfidence(e,t,s){const a=Math.min(1,e/30)*.4+t*.3+s*.3;return Math.round(a*100)/100}extractTimeFromDueAt(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}formatWeekdays(e){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return e.map(s=>t[s]).join(", ")}detectCompletionDrift(e){if(e.length<10)return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"};const s=e.slice(-10).map(f=>f.delayMinutes);let r=0,a=0,i=0,l=0;const c=s.length;for(let f=0;f<c;f++)r+=f,a+=s[f],i+=f*s[f],l+=f*f;const u=(c*i-r*a)/(c*l-r*r),d=Math.abs(u);if(d>5){const f=d>30?"high":d>15?"medium":"low";return{isDrifting:!0,direction:u>0?"later":"earlier",averageDriftMinutes:Math.round(d),severity:f}}return{isDrifting:!1,direction:"later",averageDriftMinutes:0,severity:"low"}}}class vc{calculateOptimalTime(e){if(e.length===0)return{hour:9,confidence:0,sampleSize:0};const t=new Map;for(const i of e){const l=new Date(i.completedAt).getHours();t.set(l,(t.get(l)||0)+1)}let s=9,r=0;for(const[i,l]of t.entries())l>r&&(r=l,s=i);const a=r/e.length;return{hour:s,confidence:Math.round(a*100)/100,sampleSize:e.length}}findWeekdayPatterns(e){const t=new Map,s=new Map;for(const r of e){const a=r.dayOfWeek;s.has(a)||s.set(a,[]),s.get(a).push(r)}for(const[r,a]of s.entries()){const i=this.calculateOptimalTime(a);a.length>=2&&t.set(r,i)}return t}detectSkipPatterns(e){const t=(e.completionCount||0)+(e.missCount||0),s=t>0?(e.missCount||0)/t:0;return s>.5&&t>=10?{isAnomalous:!0,reason:`Task is skipped ${Math.round(s*100)}% of the time (${e.missCount} out of ${t})`}:(e.missCount||0)>=5&&e.currentStreak===0?{isAnomalous:!0,reason:"Task has been skipped multiple times recently"}:{isAnomalous:!1,reason:""}}}var sb=C('<div class="empty-state svelte-14xzl1l"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-14xzl1l"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <h3 class="svelte-14xzl1l">No Smart Tasks Yet</h3> <p>Enable smart recurrence on your tasks and complete them at least 5 times to see insights.</p></div>'),nb=C('<div class="suggestion-box svelte-14xzl1l"><div class="suggestion-icon svelte-14xzl1l"></div> <p class="svelte-14xzl1l"> </p></div>'),rb=C('<div class="schedule-suggestion svelte-14xzl1l"><h4 class="svelte-14xzl1l">Suggested Schedule Adjustment</h4> <div class="schedule-comparison svelte-14xzl1l"><div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Current</span> <span class="schedule-value svelte-14xzl1l"> </span></div> <div class="schedule-arrow svelte-14xzl1l"></div> <div class="schedule-column svelte-14xzl1l"><span class="schedule-label svelte-14xzl1l">Suggested</span> <span class="schedule-value svelte-14xzl1l"> </span></div></div> <p class="suggestion-reason svelte-14xzl1l"> </p> <p class="suggestion-improvement svelte-14xzl1l"> </p> <button class="apply-btn svelte-14xzl1l">Apply Suggestion</button></div>'),ab=C('<div class="anomaly-card svelte-14xzl1l"><div class="anomaly-header svelte-14xzl1l"><span class="anomaly-type svelte-14xzl1l"> </span> <span class="anomaly-severity svelte-14xzl1l"> </span></div> <p class="anomaly-description svelte-14xzl1l"> </p> <p class="anomaly-suggestion svelte-14xzl1l"> </p></div>'),ib=C('<div class="anomalies-section svelte-14xzl1l"><h4 class="svelte-14xzl1l"> Detected Issues</h4> <!></div>'),ob=C('<span class="history-label svelte-14xzl1l"> </span>'),lb=C('<div class="history-summary svelte-14xzl1l"><span class="history-label svelte-14xzl1l"> </span> <!></div>'),cb=C('<div class="insight-card svelte-14xzl1l"><div class="insight-header svelte-14xzl1l"><h3 class="svelte-14xzl1l"> </h3> <div class="confidence-badge svelte-14xzl1l"> </div></div> <div class="insight-stats svelte-14xzl1l"><div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Consistency</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Avg Delay</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Preferred Time</span> <span class="stat-value svelte-14xzl1l"> </span></div> <div class="stat-item svelte-14xzl1l"><span class="stat-label svelte-14xzl1l">Completion Rate</span> <span class="stat-value svelte-14xzl1l"> </span></div></div> <!> <!> <!> <!></div>'),ub=C('<div class="insights-list svelte-14xzl1l"></div>'),db=C('<div class="insights-tab svelte-14xzl1l"><div class="insights-header svelte-14xzl1l"><h2 class="svelte-14xzl1l">Smart Insights</h2> <p class="svelte-14xzl1l">Learn from your task completion patterns to optimize your schedule</p></div> <!></div>');function hb(n,e){ht(e,!0);const t=new tb,s=J(()=>e.tasks.filter(p=>{var k;return((k=p.smartRecurrence)==null?void 0:k.enabled)&&p.completionHistory&&p.completionHistory.length>=5})),r=J(()=>o(s).map(p=>({task:p,insight:t.analyzeCompletionPatterns(p),suggestion:t.suggestScheduleOptimization(p),anomalies:t.detectAnomalies(p)}))),a=J(()=>o(r).sort((p,k)=>k.insight.confidence-p.insight.confidence));function i(p,k){var S;(S=e.onApplySuggestion)==null||S.call(e,p,k)}function l(p){if(Math.abs(p)<60)return`${Math.abs(p)} minutes`;const k=Math.abs(Math.round(p/60));return`${k} hour${k!==1?"s":""}`}function c(p){const k=p>=12?"PM":"AM";return`${p>12?p-12:p===0?12:p}:00 ${k}`}function u(p){return p>=.8?"Excellent":p>=.6?"Good":p>=.4?"Fair":"Inconsistent"}function d(p){return p>=.8?"#4caf50":p>=.6?"#2196f3":p>=.4?"#ff9800":"#f44336"}function f(p){switch(p){case"low":return"#ff9800";case"medium":return"#ff5722";case"high":return"#f44336"}}var g=db(),y=v(h(g),2);{var _=p=>{var k=sb();x(p,k)},m=p=>{var k=ub();He(k,21,()=>o(a),bt,(S,D)=>{let E=()=>o(D).task,R=()=>o(D).insight,P=()=>o(D).suggestion,L=()=>o(D).anomalies;var H=cb(),Y=h(H),X=h(Y),oe=h(X),ae=v(X,2),ve=h(ae),Q=v(Y,2),Z=h(Q),B=v(h(Z),2),M=h(B),I=v(Z,2),G=v(h(I),2),se=h(G),ke=v(I,2),ge=v(h(ke),2),ce=h(ge),Ie=v(ke,2),Me=v(h(Ie),2),Ue=h(Me),de=v(Q,2);{var U=ee=>{var me=nb(),_e=v(h(me),2),ue=h(_e);$(()=>N(ue,R().suggestedAdjustment)),x(ee,me)};W(de,ee=>{R().suggestedAdjustment&&ee(U)})}var A=v(de,2);{var F=ee=>{var me=rb(),_e=v(h(me),2),ue=h(_e),Ee=v(h(ue),2),Ae=h(Ee),$e=v(ue,4),Je=v(h($e),2),Ge=h(Je),at=v(_e,2),dt=h(at),Ce=v(at,2),Ne=h(Ce),Se=v(Ce,2);Se.__click=()=>i(E(),P()),$(()=>{N(Ae,P().currentSchedule.time||"Not set"),N(Ge,P().suggestedSchedule.time||"Not set"),N(dt,P().reason),N(Ne,`Expected: ${P().expectedImprovement??""}`)}),x(ee,me)};W(A,ee=>{P()&&ee(F)})}var K=v(A,2);{var ie=ee=>{var me=ib(),_e=v(h(me),2);He(_e,17,L,bt,(ue,Ee)=>{var Ae=ab(),$e=h(Ae),Je=h($e),Ge=h(Je),at=v(Je,2),dt=h(at),Ce=v($e,2),Ne=h(Ce),Se=v(Ce,2),Pe=h(Se);$((Ke,Be,st)=>{Ns(Ae,`border-left-color: ${Ke??""}`),N(Ge,Be),Ns(at,`background-color: ${st??""}`),N(dt,o(Ee).severity),N(Ne,o(Ee).description),N(Pe,` ${o(Ee).suggestion??""}`)},[()=>f(o(Ee).severity),()=>o(Ee).type.replace(/_/g," "),()=>f(o(Ee).severity)]),x(ue,Ae)}),x(ee,me)};W(K,ee=>{L().length>0&&ee(ie)})}var O=v(K,2);{var q=ee=>{var me=lb(),_e=h(me),ue=h(_e),Ee=v(_e,2);{var Ae=$e=>{var Je=ob(),Ge=h(Je);$(at=>N(Ge,`Last updated: ${at??""}`),[()=>new Date(E().learningMetrics.lastLearningUpdate).toLocaleDateString()]),x($e,Je)};W(Ee,$e=>{E().learningMetrics&&$e(Ae)})}$(()=>N(ue,` ${E().completionHistory.length??""} completions tracked`)),x(ee,me)};W(O,ee=>{E().completionHistory&&E().completionHistory.length>0&&ee(q)})}$((ee,me,_e,ue,Ee,Ae,$e)=>{N(oe,E().name),Ns(ae,`background-color: ${ee??""}`),N(ve,`${me??""}% confidence`),Ns(B,`color: ${_e??""}`),N(M,ue),N(se,`${R().averageCompletionDelay>0?"+":""}${Ee??""}`),N(ce,Ae),N(Ue,`${$e??""}%`)},[()=>d(R().confidence),()=>Math.round(R().confidence*100),()=>d(R().completionConsistency),()=>u(R().completionConsistency),()=>l(R().averageCompletionDelay),()=>c(R().preferredTimeOfDay),()=>Math.round(100-R().missedTaskFrequency)]),x(S,H)}),x(p,k)};W(y,p=>{o(s).length===0?p(_):p(m,!1)})}x(n,g),ft()}xt(["click"]);var lo=["MO","TU","WE","TH","FR","SA","SU"],Zt=function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(lo.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=lo[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n}(),_t=function(n){return n!=null},Fs=function(n){return typeof n=="number"},gc=function(n){return typeof n=="string"&&lo.includes(n)},gs=Array.isArray,Vs=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],s=n;s<e;s++)t.push(s);return t},Ye=function(n,e){var t=0,s=[];if(gs(n))for(;t<e;t++)s[t]=[].concat(n);else for(;t<e;t++)s[t]=n;return s},fb=function(n){return gs(n)?n:[n]};function pr(n,e,t){t===void 0&&(t=" ");var s=String(n);return e=e>>0,s.length>e?String(s):(e=e-s.length,e>t.length&&(t+=Ye(t,e/t.length)),t.slice(0,e)+String(s))}var vb=function(n,e,t){var s=n.split(e);return t?s.slice(0,t).concat([s.slice(t).join(e)]):s},Ds=function(n,e){var t=n%e;return t*e<0?t+e:t},Pi=function(n,e){return{div:Math.floor(n/e),mod:Ds(n,e)}},Ws=function(n){return!_t(n)||n.length===0},Ot=function(n){return!Ws(n)},tt=function(n,e){return Ot(n)&&n.indexOf(e)!==-1},ir=function(n,e,t,s,r,a){return s===void 0&&(s=0),r===void 0&&(r=0),a===void 0&&(a=0),new Date(Date.UTC(n,e-1,t,s,r,a))},gb=[31,28,31,30,31,30,31,31,30,31,30,31],bd=1e3*60*60*24,kd=9999,_d=ir(1970,1,1),pb=[6,0,1,2,3,4,5],ta=function(n){return n%4===0&&n%100!==0||n%400===0},wd=function(n){return n instanceof Date},Vr=function(n){return wd(n)&&!isNaN(n.getTime())},mb=function(n,e){var t=n.getTime(),s=e.getTime(),r=t-s;return Math.round(r/bd)},co=function(n){return mb(n,_d)},Td=function(n){return new Date(_d.getTime()+n*bd)},yb=function(n){var e=n.getUTCMonth();return e===1&&ta(n.getUTCFullYear())?29:gb[e]},Lr=function(n){return pb[n.getUTCDay()]},pc=function(n,e){var t=ir(n,e+1,1);return[Lr(t),yb(t)]},xd=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},uo=function(n){var e=new Date(n.getTime());return e},mc=function(n){for(var e=[],t=0;t<n.length;t++)e.push(uo(n[t]));return e},la=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},Qo=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[pr(t.getUTCFullYear().toString(),4,"0"),pr(t.getUTCMonth()+1,2,"0"),pr(t.getUTCDate(),2,"0"),"T",pr(t.getUTCHours(),2,"0"),pr(t.getUTCMinutes(),2,"0"),pr(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},Xo=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},yc=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},bb=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,s=new Date(yc(n,t)),r=new Date(yc(n,e??"UTC")),a=r.getTime()-s.getTime();return new Date(n.getTime()-a)},_r=function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,s=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(s)return!1}else if(this.method==="before"){if(s)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n}(),ho=function(n,e){return ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])},ho(n,e)};function Zo(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ho(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ms=function(){return ms=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},ms.apply(this,arguments)};function te(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,a;s<r;s++)(a||!(s in e))&&(a||(a=Array.prototype.slice.call(e,0,s)),a[s]=e[s]);return n.concat(a||Array.prototype.slice.call(e))}var bc=function(n){Zo(e,n);function e(t,s,r){var a=n.call(this,t,s)||this;return a.iterator=r,a}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e}(_r),Va={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},kc=function(n,e){return n.indexOf(e)!==-1},kb=function(n){return n.toString()},_b=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},hn=function(){function n(e,t,s,r){if(t===void 0&&(t=kb),s===void 0&&(s=Va),r===void 0&&(r=_b),this.text=[],this.language=s||Va,this.gettext=t,this.dateFormatter=r,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var a=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);a.sort(function(d,f){return d-f}),i.sort(function(d,f){return f-d}),this.bymonthday=a.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(_t(this.origOptions.byweekday)){var l=gs(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(l);this.byweekday={allWeeks:l.filter(function(d){return!d.n}),someWeeks:l.filter(function(d){return!!d.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var u=function(d,f){return d.weekday-f.weekday};this.byweekday.allWeeks.sort(u),this.byweekday.someWeeks.sort(u),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var s in e.origOptions){if(kc(["dtstart","tzid","wkst","freq"],s))return!0;if(!kc(n.IMPLEMENTED[e.options.freq],s))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[le.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,s=this.gettext;if(e===-1)return s("last");var r=Math.abs(e);switch(r){case 1:case 21:case 31:t=r+s("st");break;case 2:case 22:t=r+s("nd");break;case 3:case 23:t=r+s("rd");break;default:t=r+s("th")}return e<0?t+" "+s("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=Fs(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,s,r){var a=this;r===void 0&&(r=","),gs(e)||(e=[e]);var i=function(c,u,d){for(var f="",g=0;g<c.length;g++)g!==0&&(g===c.length-1?f+=" "+d+" ":f+=u+" "),f+=c[g];return f};t=t||function(c){return c.toString()};var l=function(c){return t&&t.call(a,c)};return s?i(e.map(l),r,s):e.map(l).join(r+" ")},n}(),wb=function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var s=void 0;e=null;for(var r in this.rules){s=this.rules[r];var a=s.exec(this.text);a&&(e===null||a[0].length>e[0].length)&&(e=a,t=r)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n}();function Sd(n,e){e===void 0&&(e=Va);var t={},s=new wb(e.tokens);if(!s.start(n))return null;return r(),t;function r(){s.expect("every");var g=s.acceptNumber();if(g&&(t.interval=parseInt(g[0],10)),s.isDone())throw new Error("Unexpected end");switch(s.symbol){case"day(s)":t.freq=le.DAILY,s.nextSymbol()&&(i(),f());break;case"weekday(s)":t.freq=le.WEEKLY,t.byweekday=[le.MO,le.TU,le.WE,le.TH,le.FR],s.nextSymbol(),i(),f();break;case"week(s)":t.freq=le.WEEKLY,s.nextSymbol()&&(a(),i(),f());break;case"hour(s)":t.freq=le.HOURLY,s.nextSymbol()&&(a(),f());break;case"minute(s)":t.freq=le.MINUTELY,s.nextSymbol()&&(a(),f());break;case"month(s)":t.freq=le.MONTHLY,s.nextSymbol()&&(a(),f());break;case"year(s)":t.freq=le.YEARLY,s.nextSymbol()&&(a(),f());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=le.WEEKLY;var y=s.symbol.substr(0,2).toUpperCase();if(t.byweekday=[le[y]],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var _=c();if(!_)throw new Error("Unexpected symbol "+s.symbol+", expected weekday");t.byweekday.push(le[_]),s.nextSymbol()}i(),d(),f();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=le.YEARLY,t.bymonth=[l()],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var m=l();if(!m)throw new Error("Unexpected symbol "+s.symbol+", expected month");t.bymonth.push(m),s.nextSymbol()}a(),f();break;default:throw new Error("Unknown symbol")}}function a(){var g=s.accept("on"),y=s.accept("the");if(g||y)do{var _=u(),m=c(),p=l();if(_)m?(s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(le[m].nth(_))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(_),s.accept("day(s)"));else if(m)s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(le[m]);else if(s.symbol==="weekday(s)")s.nextSymbol(),t.byweekday||(t.byweekday=[le.MO,le.TU,le.WE,le.TH,le.FR]);else if(s.symbol==="week(s)"){s.nextSymbol();var k=s.acceptNumber();if(!k)throw new Error("Unexpected symbol "+s.symbol+", expected week number");for(t.byweekno=[parseInt(k[0],10)];s.accept("comma");){if(k=s.acceptNumber(),!k)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.byweekno.push(parseInt(k[0],10))}}else if(p)s.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(p);else return}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function i(){var g=s.accept("at");if(g)do{var y=s.acceptNumber();if(!y)throw new Error("Unexpected symbol "+s.symbol+", expected hour");for(t.byhour=[parseInt(y[0],10)];s.accept("comma");){if(y=s.acceptNumber(),!y)throw new Error("Unexpected symbol "+s.symbol+"; expected hour");t.byhour.push(parseInt(y[0],10))}}while(s.accept("comma")||s.accept("at"))}function l(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function u(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":var g=parseInt(s.value[1],10);if(g<-366||g>366)throw new Error("Nth out of range: "+g);return s.nextSymbol(),s.accept("last")?-g:g;default:return!1}}function d(){s.accept("on"),s.accept("the");var g=u();if(g)for(t.bymonthday=[g],s.nextSymbol();s.accept("comma");){if(g=u(),!g)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.bymonthday.push(g),s.nextSymbol()}}function f(){if(s.symbol==="until"){var g=Date.parse(s.text);if(!g)throw new Error("Cannot parse until date:"+s.text);t.until=new Date(g)}else s.accept("for")&&(t.count=parseInt(s.value[0],10),s.expect("number"))}}var je;(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(je||(je={}));function Jo(n){return n<je.HOURLY}var Tb=function(n,e){return e===void 0&&(e=Va),new le(Sd(n,e)||void 0)},$r=["count","until","interval","byweekday","bymonthday","bymonth"];hn.IMPLEMENTED=[];hn.IMPLEMENTED[je.HOURLY]=$r;hn.IMPLEMENTED[je.MINUTELY]=$r;hn.IMPLEMENTED[je.DAILY]=["byhour"].concat($r);hn.IMPLEMENTED[je.WEEKLY]=$r;hn.IMPLEMENTED[je.MONTHLY]=$r;hn.IMPLEMENTED[je.YEARLY]=["byweekno","byyearday"].concat($r);var xb=function(n,e,t,s){return new hn(n,e,t,s).toString()},Sb=hn.isFullyConvertible,Qa=function(){function n(e,t,s,r){this.hour=e,this.minute=t,this.second=s,this.millisecond=r||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n}(),Db=function(n){Zo(e,n);function e(t,s,r,a,i,l,c){var u=n.call(this,a,i,l,c)||this;return u.year=t,u.month=s,u.day=r,u}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return Lr(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var s=Math.floor(this.month/12),r=Ds(this.month,12);this.month=r,this.year+=s,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,s){s>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-s))+t*7:this.day+=-(this.getWeekday()-s)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,s,r){for(s&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var a=Pi(this.hour,24),i=a.div,l=a.mod;if(i&&(this.hour=l,this.addDaily(i)),Ws(r)||tt(r,this.hour))break}},e.prototype.addMinutes=function(t,s,r,a){for(s&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var i=Pi(this.minute,60),l=i.div,c=i.mod;if(l&&(this.minute=c,this.addHours(l,!1,r)),(Ws(r)||tt(r,this.hour))&&(Ws(a)||tt(a,this.minute)))break}},e.prototype.addSeconds=function(t,s,r,a,i){for(s&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var l=Pi(this.second,60),c=l.div,u=l.mod;if(c&&(this.second=u,this.addMinutes(c,!1,r,a)),(Ws(r)||tt(r,this.hour))&&(Ws(a)||tt(a,this.minute))&&(Ws(i)||tt(i,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=pc(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>kd))return;t=pc(this.year,this.month-1)[1]}}},e.prototype.add=function(t,s){var r=t.freq,a=t.interval,i=t.wkst,l=t.byhour,c=t.byminute,u=t.bysecond;switch(r){case je.YEARLY:return this.addYears(a);case je.MONTHLY:return this.addMonths(a);case je.WEEKLY:return this.addWeekly(a,i);case je.DAILY:return this.addDaily(a);case je.HOURLY:return this.addHours(a,s,l);case je.MINUTELY:return this.addMinutes(a,s,l,c);case je.SECONDLY:return this.addSeconds(a,s,l,c,u)}},e}(Qa);function Dd(n){for(var e=[],t=Object.keys(n),s=0,r=t;s<r.length;s++){var a=r[s];tt(sk,a)||e.push(a),wd(n[a])&&!Vr(n[a])&&e.push(a)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return ms({},n)}function Eb(n){var e=ms(ms({},el),Dd(n));if(_t(e.byeaster)&&(e.freq=le.YEARLY),!(_t(e.freq)&&le.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),_t(e.wkst)?Fs(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=le.MO.weekday,_t(e.bysetpos)){Fs(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var s=e.bysetpos[t];if(s===0||!(s>=-366&&s<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||Ot(e.byweekno)||Ot(e.byyearday)||e.bymonthday||Ot(e.bymonthday)||_t(e.byweekday)||_t(e.byeaster)))switch(e.freq){case le.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case le.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case le.WEEKLY:e.byweekday=[Lr(e.dtstart)];break}if(_t(e.bymonth)&&!gs(e.bymonth)&&(e.bymonth=[e.bymonth]),_t(e.byyearday)&&!gs(e.byyearday)&&Fs(e.byyearday)&&(e.byyearday=[e.byyearday]),!_t(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(gs(e.bymonthday)){for(var r=[],a=[],t=0;t<e.bymonthday.length;t++){var s=e.bymonthday[t];s>0?r.push(s):s<0&&a.push(s)}e.bymonthday=r,e.bynmonthday=a}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(_t(e.byweekno)&&!gs(e.byweekno)&&(e.byweekno=[e.byweekno]),!_t(e.byweekday))e.bynweekday=null;else if(Fs(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(gc(e.byweekday))e.byweekday=[Zt.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof Zt)!e.byweekday.n||e.freq>le.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var i=[],l=[],t=0;t<e.byweekday.length;t++){var c=e.byweekday[t];if(Fs(c)){i.push(c);continue}else if(gc(c)){i.push(Zt.fromStr(c).weekday);continue}!c.n||e.freq>le.MONTHLY?i.push(c.weekday):l.push([c.weekday,c.n])}e.byweekday=Ot(i)?i:null,e.bynweekday=Ot(l)?l:null}return _t(e.byhour)?Fs(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<le.HOURLY?[e.dtstart.getUTCHours()]:null,_t(e.byminute)?Fs(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<le.MINUTELY?[e.dtstart.getUTCMinutes()]:null,_t(e.bysecond)?Fs(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<le.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function Ab(n){var e=n.dtstart.getTime()%1e3;if(!Jo(n.freq))return[];var t=[];return n.byhour.forEach(function(s){n.byminute.forEach(function(r){n.bysecond.forEach(function(a){t.push(new Qa(s,r,a,e))})})}),t}function fo(n){var e=n.split(`
`).map(Cb).filter(function(t){return t!==null});return ms(ms({},e[0]),e[1])}function Xa(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var s=t[1],r=t[2];return s&&(e.tzid=s),e.dtstart=Xo(r),e}function Cb(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return _c(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return _c(n);case"DTSTART":return Xa(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function _c(n){var e=n.replace(/^RRULE:/i,""),t=Xa(e),s=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return s.forEach(function(r){var a=r.split("="),i=a[0],l=a[1];switch(i.toUpperCase()){case"FREQ":t.freq=je[l.toUpperCase()];break;case"WKST":t.wkst=Os[l.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=Ib(l),u=i.toLowerCase();t[u]=c;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=Mb(l);break;case"DTSTART":case"TZID":var d=Xa(n);t.tzid=d.tzid,t.dtstart=d.dtstart;break;case"UNTIL":t.until=Xo(l);break;case"BYEASTER":t.byeaster=Number(l);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),t}function Ib(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(wc)}return wc(n)}function wc(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function Mb(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Os[t];var s=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!s||s.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var r=Number(s[1]),a=s[2],i=Os[a].weekday;return new Zt(i,r)})}var Za=function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=Qo(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:bb(this.date,this.tzid)},n}();function vo(n){for(var e=[],t="",s=Object.keys(n),r=Object.keys(el),a=0;a<s.length;a++)if(s[a]!=="tzid"&&tt(r,s[a])){var i=s[a].toUpperCase(),l=n[s[a]],c="";if(!(!_t(l)||gs(l)&&!l.length)){switch(i){case"FREQ":c=le.FREQUENCIES[n.freq];break;case"WKST":Fs(l)?c=new Zt(l).toString():c=l.toString();break;case"BYWEEKDAY":i="BYDAY",c=fb(l).map(function(y){return y instanceof Zt?y:gs(y)?new Zt(y[0],y[1]):new Zt(y)}).toString();break;case"DTSTART":t=Ob(l,n.tzid);break;case"UNTIL":c=Qo(l,!n.tzid);break;default:if(gs(l)){for(var u=[],d=0;d<l.length;d++)u[d]=String(l[d]);c=u.toString()}else c=String(l)}c&&e.push([i,c])}}var f=e.map(function(y){var _=y[0],m=y[1];return"".concat(_,"=").concat(m.toString())}).join(";"),g="";return f!==""&&(g="RRULE:".concat(f)),[t,g].filter(function(y){return!!y}).join(`
`)}function Ob(n,e){return n?"DTSTART"+new Za(new Date(n),e).toString():""}function Rb(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,s){return t.getTime()===e[s].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var Nb=function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,s){t&&(t=t instanceof Date?uo(t):mc(t)),e==="all"?this.all=t:(s._value=t,this[e].push(s))},n.prototype._cacheGet=function(e,t){var s=!1,r=t?Object.keys(t):[],a=function(d){for(var f=0;f<r.length;f++){var g=r[f];if(!Rb(t[g],d[g]))return!0}return!1},i=this[e];if(e==="all")s=this.all;else if(gs(i))for(var l=0;l<i.length;l++){var c=i[l];if(!(r.length&&a(c))){s=c._value;break}}if(!s&&this.all){for(var u=new _r(e,t),l=0;l<this.all.length&&u.accept(this.all[l]);l++);s=u.getValue(),this._cacheAdd(e,s,t)}return gs(s)?mc(s):s instanceof Date?uo(s):s},n}(),Pb=te(te(te(te(te(te(te(te(te(te(te(te(te([],Ye(1,31),!0),Ye(2,28),!0),Ye(3,31),!0),Ye(4,30),!0),Ye(5,31),!0),Ye(6,30),!0),Ye(7,31),!0),Ye(8,31),!0),Ye(9,30),!0),Ye(10,31),!0),Ye(11,30),!0),Ye(12,31),!0),Ye(1,7),!0),Lb=te(te(te(te(te(te(te(te(te(te(te(te(te([],Ye(1,31),!0),Ye(2,29),!0),Ye(3,31),!0),Ye(4,30),!0),Ye(5,31),!0),Ye(6,30),!0),Ye(7,31),!0),Ye(8,31),!0),Ye(9,30),!0),Ye(10,31),!0),Ye(11,30),!0),Ye(12,31),!0),Ye(1,7),!0),Fb=Vs(1,29),qb=Vs(1,30),Dn=Vs(1,31),Wt=Vs(1,32),Bb=te(te(te(te(te(te(te(te(te(te(te(te(te([],Wt,!0),qb,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt.slice(0,7),!0),Ub=te(te(te(te(te(te(te(te(te(te(te(te(te([],Wt,!0),Fb,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt,!0),Dn,!0),Wt,!0),Dn,!0),Wt,!0),Wt.slice(0,7),!0),zb=Vs(-28,0),$b=Vs(-29,0),En=Vs(-30,0),jt=Vs(-31,0),Yb=te(te(te(te(te(te(te(te(te(te(te(te(te([],jt,!0),$b,!0),jt,!0),En,!0),jt,!0),En,!0),jt,!0),jt,!0),En,!0),jt,!0),En,!0),jt,!0),jt.slice(0,7),!0),Wb=te(te(te(te(te(te(te(te(te(te(te(te(te([],jt,!0),zb,!0),jt,!0),En,!0),jt,!0),En,!0),jt,!0),jt,!0),En,!0),jt,!0),En,!0),jt,!0),jt.slice(0,7),!0),jb=[0,31,60,91,121,152,182,213,244,274,305,335,366],Hb=[0,31,59,90,120,151,181,212,243,273,304,334,365],Tc=function(){for(var n=[],e=0;e<55;e++)n=n.concat(Vs(7));return n}();function Gb(n,e){var t=ir(n,1,1),s=ta(n)?366:365,r=ta(n+1)?366:365,a=co(t),i=Lr(t),l=ms(ms({yearlen:s,nextyearlen:r,yearordinal:a,yearweekday:i},Kb(n)),{wnomask:null});if(Ws(e.byweekno))return l;l.wnomask=Ye(0,s+7);var c,u,d=c=Ds(7-i+e.wkst,7);d>=4?(d=0,u=l.yearlen+Ds(i-e.wkst,7)):u=s-d;for(var f=Math.floor(u/7),g=Ds(u,7),y=Math.floor(f+g/4),_=0;_<e.byweekno.length;_++){var m=e.byweekno[_];if(m<0&&(m+=y+1),m>0&&m<=y){var p=void 0;m>1?(p=d+(m-1)*7,d!==c&&(p-=7-c)):p=d;for(var k=0;k<7&&(l.wnomask[p]=1,p++,l.wdaymask[p]!==e.wkst);k++);}}if(tt(e.byweekno,1)){var p=d+y*7;if(d!==c&&(p-=7-c),p<s)for(var _=0;_<7&&(l.wnomask[p]=1,p+=1,l.wdaymask[p]!==e.wkst);_++);}if(d){var S=void 0;if(tt(e.byweekno,-1))S=-1;else{var D=Lr(ir(n-1,1,1)),E=Ds(7-D.valueOf()+e.wkst,7),R=ta(n-1)?366:365,P=void 0;E>=4?(E=0,P=R+Ds(D-e.wkst,7)):P=s-d,S=Math.floor(52+Ds(P,7)/4)}if(tt(e.byweekno,S))for(var p=0;p<d;p++)l.wnomask[p]=1}return l}function Kb(n){var e=ta(n)?366:365,t=ir(n,1,1),s=Lr(t);return e===365?{mmask:Pb,mdaymask:Ub,nmdaymask:Wb,wdaymask:Tc.slice(s),mrange:Hb}:{mmask:Lb,mdaymask:Bb,nmdaymask:Yb,wdaymask:Tc.slice(s),mrange:jb}}function Vb(n,e,t,s,r,a){var i={lastyear:n,lastmonth:e,nwdaymask:[]},l=[];if(a.freq===le.YEARLY)if(Ws(a.bymonth))l=[[0,t]];else for(var c=0;c<a.bymonth.length;c++)e=a.bymonth[c],l.push(s.slice(e-1,e+1));else a.freq===le.MONTHLY&&(l=[s.slice(e-1,e+1)]);if(Ws(l))return i;i.nwdaymask=Ye(0,t);for(var c=0;c<l.length;c++)for(var u=l[c],d=u[0],f=u[1]-1,g=0;g<a.bynweekday.length;g++){var y=void 0,_=a.bynweekday[g],m=_[0],p=_[1];p<0?(y=f+(p+1)*7,y-=Ds(r[y]-m,7)):(y=d+(p-1)*7,y+=Ds(7-r[y]+m,7)),d<=y&&y<=f&&(i.nwdaymask[y]=1)}return i}function Qb(n,e){e===void 0&&(e=0);var t=n%19,s=Math.floor(n/100),r=n%100,a=Math.floor(s/4),i=s%4,l=Math.floor((s+8)/25),c=Math.floor((s-l+1)/3),u=Math.floor(19*t+s-a-c+15)%30,d=Math.floor(r/4),f=r%4,g=Math.floor(32+2*i+2*d-u-f)%7,y=Math.floor((t+11*u+22*g)/451),_=Math.floor((u+g-7*y+114)/31),m=(u+g-7*y+114)%31+1,p=Date.UTC(n,_-1,m+e),k=Date.UTC(n,0,1);return[Math.ceil((p-k)/(1e3*60*60*24))]}var Xb=function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var s=this.options;if(e!==this.lastyear&&(this.yearinfo=Gb(e,s)),Ot(s.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var r=this.yearinfo,a=r.yearlen,i=r.mrange,l=r.wdaymask;this.monthinfo=Vb(e,t,a,i,l,s)}_t(s.byeaster)&&(this.eastermask=Qb(e,s.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[Vs(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var s=this.mrange[t-1],r=this.mrange[t],a=Ye(null,this.yearlen),i=s;i<r;i++)a[i]=i;return[a,s,r]},n.prototype.wdayset=function(e,t,s){for(var r=Ye(null,this.yearlen+7),a=co(ir(e,t,s))-this.yearordinal,i=a,l=0;l<7&&(r[a]=a,++a,this.wdaymask[a]!==this.options.wkst);l++);return[r,i,a]},n.prototype.ddayset=function(e,t,s){var r=Ye(null,this.yearlen),a=co(ir(e,t,s))-this.yearordinal;return r[a]=a,[r,a,a+1]},n.prototype.htimeset=function(e,t,s,r){var a=this,i=[];return this.options.byminute.forEach(function(l){i=i.concat(a.mtimeset(e,l,s,r))}),la(i),i},n.prototype.mtimeset=function(e,t,s,r){var a=this.options.bysecond.map(function(i){return new Qa(e,t,i,r)});return la(a),a},n.prototype.stimeset=function(e,t,s,r){return[new Qa(e,t,s,r)]},n.prototype.getdayset=function(e){switch(e){case je.YEARLY:return this.ydayset.bind(this);case je.MONTHLY:return this.mdayset.bind(this);case je.WEEKLY:return this.wdayset.bind(this);case je.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case je.HOURLY:return this.htimeset.bind(this);case je.MINUTELY:return this.mtimeset.bind(this);case je.SECONDLY:return this.stimeset.bind(this)}},n}();function Zb(n,e,t,s,r,a){for(var i=[],l=0;l<n.length;l++){var c=void 0,u=void 0,d=n[l];d<0?(c=Math.floor(d/e.length),u=Ds(d,e.length)):(c=Math.floor((d-1)/e.length),u=Ds(d-1,e.length));for(var f=[],g=t;g<s;g++){var y=a[g];_t(y)&&f.push(y)}var _=void 0;c<0?_=f.slice(c)[0]:_=f[c];var m=e[u],p=Td(r.yearordinal+_),k=xd(p,m);tt(i,k)||i.push(k)}return la(i),i}function Ed(n,e){var t=e.dtstart,s=e.freq,r=e.interval,a=e.until,i=e.bysetpos,l=e.count;if(l===0||r===0)return Qs(n);var c=Db.fromDate(t),u=new Xb(e);u.rebuild(c.year,c.month);for(var d=tk(u,c,e);;){var f=u.getdayset(s)(c.year,c.month,c.day),g=f[0],y=f[1],_=f[2],m=ek(g,y,_,u,e);if(Ot(i))for(var p=Zb(i,d,y,_,u,g),k=0;k<p.length;k++){var S=p[k];if(a&&S>a)return Qs(n);if(S>=t){var D=xc(S,e);if(!n.accept(D)||l&&(--l,!l))return Qs(n)}}else for(var k=y;k<_;k++){var E=g[k];if(_t(E))for(var R=Td(u.yearordinal+E),P=0;P<d.length;P++){var L=d[P],S=xd(R,L);if(a&&S>a)return Qs(n);if(S>=t){var D=xc(S,e);if(!n.accept(D)||l&&(--l,!l))return Qs(n)}}}if(e.interval===0||(c.add(e,m),c.year>kd))return Qs(n);Jo(s)||(d=u.gettimeset(s)(c.hour,c.minute,c.second,0)),u.rebuild(c.year,c.month)}}function Jb(n,e,t){var s=t.bymonth,r=t.byweekno,a=t.byweekday,i=t.byeaster,l=t.bymonthday,c=t.bynmonthday,u=t.byyearday;return Ot(s)&&!tt(s,n.mmask[e])||Ot(r)&&!n.wnomask[e]||Ot(a)&&!tt(a,n.wdaymask[e])||Ot(n.nwdaymask)&&!n.nwdaymask[e]||i!==null&&!tt(n.eastermask,e)||(Ot(l)||Ot(c))&&!tt(l,n.mdaymask[e])&&!tt(c,n.nmdaymask[e])||Ot(u)&&(e<n.yearlen&&!tt(u,e+1)&&!tt(u,-n.yearlen+e)||e>=n.yearlen&&!tt(u,e+1-n.yearlen)&&!tt(u,-n.nextyearlen+e-n.yearlen))}function xc(n,e){return new Za(n,e.tzid).rezonedDate()}function Qs(n){return n.getValue()}function ek(n,e,t,s,r){for(var a=!1,i=e;i<t;i++){var l=n[i];a=Jb(s,l,r),a&&(n[l]=null)}return a}function tk(n,e,t){var s=t.freq,r=t.byhour,a=t.byminute,i=t.bysecond;return Jo(s)?Ab(t):s>=le.HOURLY&&Ot(r)&&!tt(r,e.hour)||s>=le.MINUTELY&&Ot(a)&&!tt(a,e.minute)||s>=le.SECONDLY&&Ot(i)&&!tt(i,e.second)?[]:n.gettimeset(s)(e.hour,e.minute,e.second,e.millisecond)}var Os={MO:new Zt(0),TU:new Zt(1),WE:new Zt(2),TH:new Zt(3),FR:new Zt(4),SA:new Zt(5),SU:new Zt(6)},el={freq:je.YEARLY,dtstart:null,interval:1,wkst:Os.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},sk=Object.keys(el),le=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new Nb,this.origOptions=Dd(e);var s=Eb(e).parsedOptions;this.options=s}return n.parseText=function(e,t){return Sd(e,t)},n.fromText=function(e,t){return Tb(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return Ed(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,s){if(this._cache)return this._cache._cacheAdd(e,t,s)},n.prototype.all=function(e){if(e)return this._iter(new bc("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new _r("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,s,r){if(s===void 0&&(s=!1),!Vr(e)||!Vr(t))throw new Error("Invalid date passed in to RRule.between");var a={before:t,after:e,inc:s};if(r)return this._iter(new bc("between",a,r));var i=this._cacheGet("between",a);return i===!1&&(i=this._iter(new _r("between",a)),this._cacheAdd("between",i,a)),i},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!Vr(e))throw new Error("Invalid date passed in to RRule.before");var s={dt:e,inc:t},r=this._cacheGet("before",s);return r===!1&&(r=this._iter(new _r("before",s)),this._cacheAdd("before",r,s)),r},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!Vr(e))throw new Error("Invalid date passed in to RRule.after");var s={dt:e,inc:t},r=this._cacheGet("after",s);return r===!1&&(r=this._iter(new _r("after",s)),this._cacheAdd("after",r,s)),r},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return vo(this.origOptions)},n.prototype.toText=function(e,t,s){return xb(this,e,t,s)},n.prototype.isFullyConvertibleToText=function(){return Sb(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=je.YEARLY,n.MONTHLY=je.MONTHLY,n.WEEKLY=je.WEEKLY,n.DAILY=je.DAILY,n.HOURLY=je.HOURLY,n.MINUTELY=je.MINUTELY,n.SECONDLY=je.SECONDLY,n.MO=Os.MO,n.TU=Os.TU,n.WE=Os.WE,n.TH=Os.TH,n.FR=Os.FR,n.SA=Os.SA,n.SU=Os.SU,n.parseString=fo,n.optionsToString=vo,n}();function nk(n,e,t,s,r,a){var i={},l=n.accept;function c(g,y){t.forEach(function(_){_.between(g,y,!0).forEach(function(m){i[Number(m)]=!0})})}r.forEach(function(g){var y=new Za(g,a).rezonedDate();i[Number(y)]=!0}),n.accept=function(g){var y=Number(g);return isNaN(y)?l.call(this,g):!i[y]&&(c(new Date(y-1),new Date(y+1)),!i[y])?(i[y]=!0,l.call(this,g)):!0},n.method==="between"&&(c(n.args.after,n.args.before),n.accept=function(g){var y=Number(g);return i[y]?!0:(i[y]=!0,l.call(this,g))});for(var u=0;u<s.length;u++){var d=new Za(s[u],a).rezonedDate();if(!n.accept(new Date(d.getTime())))break}e.forEach(function(g){Ed(n,g.options)});var f=n._result;switch(la(f),n.method){case"all":case"between":return f;case"before":return f.length&&f[f.length-1]||null;case"after":default:return f.length&&f[0]||null}}var Sc={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function rk(n,e){var t=[],s=[],r=[],a=[],i=Xa(n),l=i.dtstart,c=i.tzid,u=ck(n,e.unfold);return u.forEach(function(d){var f;if(d){var g=lk(d),y=g.name,_=g.parms,m=g.value;switch(y.toUpperCase()){case"RRULE":if(_.length)throw new Error("unsupported RRULE parm: ".concat(_.join(",")));t.push(fo(d));break;case"RDATE":var p=(f=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&f!==void 0?f:[],k=p[1];k&&!c&&(c=k),s=s.concat(Dc(m,_));break;case"EXRULE":if(_.length)throw new Error("unsupported EXRULE parm: ".concat(_.join(",")));r.push(fo(m));break;case"EXDATE":a=a.concat(Dc(m,_));break;case"DTSTART":break;default:throw new Error("unsupported property: "+y)}}}),{dtstart:l,tzid:c,rrulevals:t,rdatevals:s,exrulevals:r,exdatevals:a}}function ak(n,e){var t=rk(n,e),s=t.rrulevals,r=t.rdatevals,a=t.exrulevals,i=t.exdatevals,l=t.dtstart,c=t.tzid,u=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||s.length>1||r.length||a.length||i.length){var d=new dk(u);return d.dtstart(l),d.tzid(c||void 0),s.forEach(function(g){d.rrule(new le(Li(g,l,c),u))}),r.forEach(function(g){d.rdate(g)}),a.forEach(function(g){d.exrule(new le(Li(g,l,c),u))}),i.forEach(function(g){d.exdate(g)}),e.compatible&&e.dtstart&&d.rdate(l),d}var f=s[0]||{};return new le(Li(f,f.dtstart||e.dtstart||l,f.tzid||e.tzid||c),u)}function go(n,e){return e===void 0&&(e={}),ak(n,ik(e))}function Li(n,e,t){return ms(ms({},n),{dtstart:e,tzid:t})}function ik(n){var e=[],t=Object.keys(n),s=Object.keys(Sc);if(t.forEach(function(r){tt(s,r)||e.push(r)}),e.length)throw new Error("Invalid options: "+e.join(", "));return ms(ms({},Sc),n)}function ok(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=vb(n,":",1),t=e[0],s=e[1];return{name:t,value:s}}function lk(n){var e=ok(n),t=e.name,s=e.value,r=t.split(";");if(!r)throw new Error("empty property name");return{name:r[0].toUpperCase(),parms:r.slice(1),value:s}}function ck(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),s=0;s<t.length;){var r=t[s]=t[s].replace(/\s+$/g,"");r?s>0&&r[0]===" "?(t[s-1]+=r.slice(1),t.splice(s,1)):s+=1:t.splice(s,1)}return t}function uk(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function Dc(n,e){return uk(e),n.split(",").map(function(t){return Xo(t)})}function Ec(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var s=0;s<e._rrule.length;s++){var r=e._rrule[s].origOptions[n];if(r)return r}}}var dk=function(n){Zo(e,n);function e(t){t===void 0&&(t=!1);var s=n.call(this,{},t)||this;return s.dtstart=Ec.apply(s,["dtstart"]),s.tzid=Ec.apply(s,["tzid"]),s._rrule=[],s._rdate=[],s._exrule=[],s._exdate=[],s}return e.prototype._iter=function(t){return nk(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){Ac(t,this._rrule)},e.prototype.exrule=function(t){Ac(t,this._exrule)},e.prototype.rdate=function(t){Cc(t,this._rdate)},e.prototype.exdate=function(t){Cc(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return go(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return go(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(vo({dtstart:this._dtstart}))),this._rrule.forEach(function(s){t=t.concat(s.toString().split(`
`))}),this._exrule.forEach(function(s){t=t.concat(s.toString().split(`
`).map(function(r){return r.replace(/^RRULE:/,"EXRULE:")}).filter(function(r){return!/^DTSTART/.test(r)}))}),this._rdate.length&&t.push(Ic("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(Ic("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(s){return t.rrule(s.clone())}),this._exrule.forEach(function(s){return t.exrule(s.clone())}),this._rdate.forEach(function(s){return t.rdate(new Date(s.getTime()))}),this._exdate.forEach(function(s){return t.exdate(new Date(s.getTime()))}),t},e}(le);function Ac(n,e){if(!(n instanceof le))throw new TypeError(String(n)+" is not RRule instance");tt(e.map(String),String(n))||e.push(n)}function Cc(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");tt(e.map(Number),Number(n))||(e.push(n),la(e))}function Ic(n,e,t){var s=!t||t.toUpperCase()==="UTC",r=s?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),a=e.map(function(i){return Qo(i.valueOf(),s)}).join(",");return"".concat(r).concat(a)}class Ja{static parse(e){const t=e,s=e.trim().toLowerCase().replace(/\s+/g," ");if(!s)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence string cannot be empty"};const r=s.match(/^every\s+(.+)$/);if(!r)return{frequency:{type:"daily",interval:1},raw:t,isValid:!1,error:"Recurrence must start with 'every'"};let a=r[1],i;const l=a.match(/^(.+?)\s+when\s+done$/),c=a.match(/^(.+?)\s+when\s+due$/);if(l?(a=l[1],i=!0):c&&(a=c[1],i=!1),a==="weekday"||a==="weekdays"){const _=[0,1,2,3,4];return{frequency:{type:"weekly",interval:1,weekdays:_,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,_),naturalLanguage:t},raw:t,isValid:!0}}if(a==="weekend"||a==="weekends"){const _=[5,6];return{frequency:{type:"weekly",interval:1,weekdays:_,whenDone:i,rruleString:this.buildWeeklyRRuleString(1,_),naturalLanguage:t},raw:t,isValid:!0}}const u=this.parseOrdinalWeekdayPattern(a);if(u.matched)return u.error||u.ordinal===void 0||u.weekday===void 0?{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:u.error||"Invalid ordinal weekday pattern"}:{frequency:{type:"monthly",interval:1,dayOfMonth:1,whenDone:i,rruleString:this.buildOrdinalRRuleString(u.weekday,u.ordinal),naturalLanguage:t},raw:t,isValid:!0};const d=a.match(/^(\d+\s+)?days?$/);if(d){const _=d[1]?parseInt(d[1]):1;return{frequency:{type:"daily",interval:_,whenDone:i,rruleString:this.buildDailyRRuleString(_),naturalLanguage:t},raw:t,isValid:!0}}const f=a.match(/^(\d+\s+)?weeks?(?:\s+on\s+(.+))?$/);if(f){const _=f[1]?parseInt(f[1]):1,m=f[2];if(!m){const k=[1];return{frequency:{type:"weekly",interval:_,weekdays:k,whenDone:i,rruleString:this.buildWeeklyRRuleString(_,k),naturalLanguage:t},raw:t,isValid:!0}}const p=this.parseDayNames(m);return p.length===0?{frequency:{type:"weekly",interval:_,weekdays:[1],whenDone:i},raw:t,isValid:!1,error:"Invalid day names"}:{frequency:{type:"weekly",interval:_,weekdays:p,whenDone:i,rruleString:this.buildWeeklyRRuleString(_,p),naturalLanguage:t},raw:t,isValid:!0}}const g=a.match(/^(\d+\s+)?months?(?:\s+on\s+the\s+(\d+)(?:st|nd|rd|th)?)?$/);if(g){const _=g[1]?parseInt(g[1]):1,m=g[2]?parseInt(g[2]):1;return m<1||m>31?{frequency:{type:"monthly",interval:_,dayOfMonth:1,whenDone:i},raw:t,isValid:!1,error:"Day of month must be between 1 and 31"}:{frequency:{type:"monthly",interval:_,dayOfMonth:m,whenDone:i,rruleString:this.buildMonthlyRRuleString(_,m),naturalLanguage:t},raw:t,isValid:!0}}const y=a.match(/^(\d+\s+)?years?$/);if(y){const _=y[1]?parseInt(y[1]):1;return{frequency:{type:"yearly",interval:_,month:0,dayOfMonth:1,whenDone:i,rruleString:this.buildYearlyRRuleString(_),naturalLanguage:t},raw:t,isValid:!0}}return{frequency:{type:"daily",interval:1,whenDone:i},raw:t,isValid:!1,error:"Unrecognized recurrence pattern"}}static stringify(e){const t=this.stringifyOrdinalWeekday(e.rruleString);if(t)return e.whenDone?`${t} when done`:t;const s=e.interval;let r;switch(e.type){case"daily":r=s===1?"every day":`every ${s} days`;break;case"weekly":{const a=s===1?"week":`${s} weeks`;if(e.weekdays.length===0)r=`every ${a}`;else{const i=e.weekdays.map(l=>this.getDayName(l)).join(", ");r=`every ${a} on ${i}`}break}case"monthly":{const a=s===1?"month":`${s} months`,i=this.getDaySuffix(e.dayOfMonth);r=`every ${a} on the ${e.dayOfMonth}${i}`;break}case"yearly":{r=`every ${s===1?"year":`${s} years`}`;break}default:r="every day"}return e.whenDone?`${r} when done`:r}static parseDayNames(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6},s=e.split(",").map(a=>a.trim().toLowerCase()),r=[];for(const a of s)a in t&&r.push(t[a]);return r}static parseOrdinalWeekdayPattern(e){const t=e.split(" ");if(t.length<2)return{matched:!1};const s=this.parseOrdinalToken(t[0]);if(!s.matched)return{matched:!1};if(s.error)return{matched:!0,error:s.error};const r=this.parseSingleDay(t[1]);return r===null?{matched:!0,error:"Invalid weekday name"}:t.length===2?{matched:!0,ordinal:s.value,weekday:r}:t.length===5&&t[2]==="of"&&t[3]==="the"&&t[4]==="month"?{matched:!0,ordinal:s.value,weekday:r}:{matched:!0,error:"Ordinal weekday pattern must be 'every <ordinal> <weekday>' optionally followed by 'of the month'"}}static parseOrdinalToken(e){const t={first:1,second:2,third:3,fourth:4,last:-1};if(e in t)return{matched:!0,value:t[e]};const s=e.match(/^(\d+)(st|nd|rd|th)$/);if(!s)return{matched:!1};const r=parseInt(s[1],10);return r>=1&&r<=4?{matched:!0,value:r}:{matched:!0,error:"Ordinal weekday must be first, second, third, fourth, or last"}}static parseSingleDay(e){const t={monday:0,mon:0,tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6};return e in t?t[e]:null}static stringifyOrdinalWeekday(e){if(!e)return null;const t=this.parseRRuleString(e);if(!t||t.FREQ!=="MONTHLY"||!t.BYDAY||!t.BYSETPOS)return null;const s=this.fromRRuleWeekday(t.BYDAY);if(s===null)return null;const r=Number.parseInt(t.BYSETPOS,10);if(!Number.isFinite(r))return null;const a=this.ordinalWord(r);return a?`every ${a} ${this.getDayName(s)}`:null}static ordinalWord(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case-1:return"last";default:return null}}static buildOrdinalRRuleString(e,t){return`RRULE:FREQ=MONTHLY;BYDAY=${this.toRRuleWeekday(e)};BYSETPOS=${t}`}static toRRuleWeekday(e){return["MO","TU","WE","TH","FR","SA","SU"][e]||"MO"}static fromRRuleWeekday(e){const s=["MO","TU","WE","TH","FR","SA","SU"].indexOf(e);return s>=0?s:null}static parseRRuleString(e){const t=e.trim().toUpperCase(),s=t.startsWith("RRULE:")?t.slice(6):t;if(!s)return null;const r=s.split(";"),a={};for(const i of r){if(!i)continue;const[l,c]=i.split("=");if(!l||!c)return null;a[l]=c}return a}static getDayName(e){return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e]||"Monday"}static getDaySuffix(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}static buildDailyRRuleString(e){return`FREQ=DAILY;INTERVAL=${e}`}static buildWeeklyRRuleString(e,t){const s=t.map(r=>this.toRRuleWeekday(r)).join(",");return`FREQ=WEEKLY;INTERVAL=${e};BYDAY=${s}`}static buildMonthlyRRuleString(e,t){return`FREQ=MONTHLY;INTERVAL=${e};BYMONTHDAY=${t===31?-1:t}`}static buildYearlyRRuleString(e){return`FREQ=YEARLY;INTERVAL=${e}`}}var hk=C('<label><input type="radio" name="priority" class="svelte-1w15n9q"/> <span class="priority-selector__emoji svelte-1w15n9q"> </span> <span class="priority-selector__label svelte-1w15n9q"> </span></label>'),fk=C('<div class="priority-selector svelte-1w15n9q"></div>');function vk(n,e){ht(e,!0);let t=on(e,"value",15,"normal");const s=[{value:"highest",label:"Highest",emoji:"",color:"var(--b3-theme-error, #ef4444)"},{value:"high",label:"High",emoji:"",color:"#f97316"},{value:"medium",label:"Medium",emoji:"",color:"#f59e0b"},{value:"normal",label:"Normal",emoji:"",color:"#eab308"},{value:"low",label:"Low",emoji:"",color:"#22c55e"},{value:"lowest",label:"Lowest",emoji:"",color:"#64748b"}];function r(i){t(i),e.onchange(i)}var a=fk();He(a,21,()=>s,bt,(i,l)=>{var c=hk();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=v(d,2),g=h(f),y=v(f,2),_=h(y);$(()=>{u=et(c,1,"priority-selector__option svelte-1w15n9q",null,u,{active:t()===o(l).value}),Ns(c,`--priority-color: ${o(l).color??""}`),Bo(d,o(l).value),In(d,t()===o(l).value),N(g,o(l).emoji),N(_,o(l).label)}),x(i,c)}),x(n,a),ft()}xt(["change"]);var gk=C('<label><input type="radio" name="status" class="svelte-v9ezc0"/> <span class="status-selector__icon svelte-v9ezc0"> </span> <span class="status-selector__label svelte-v9ezc0"> </span></label>'),pk=C('<div class="status-selector svelte-v9ezc0"></div>');function mk(n,e){ht(e,!0);let t=on(e,"value",15,"todo");const s=[{value:"todo",label:"Todo",icon:"",color:"var(--b3-theme-on-surface)"},{value:"done",label:"Done",icon:"",color:"#44cc44"},{value:"cancelled",label:"Cancelled",icon:"",color:"#999"}];function r(i){t(i),e.onchange(i)}var a=pk();He(a,21,()=>s,bt,(i,l)=>{var c=gk();let u;var d=h(c);d.__change=()=>r(o(l).value);var f=v(d,2),g=h(f),y=v(f,2),_=h(y);$(()=>{u=et(c,1,"status-selector__option svelte-v9ezc0",null,u,{active:t()===o(l).value}),Ns(c,`--status-color: ${o(l).color??""}`),Bo(d,o(l).value),In(d,t()===o(l).value),N(g,o(l).icon),N(_,o(l).label)}),x(i,c)}),x(n,a),ft()}xt(["change"]);var yk=C('<div class="recurrence-input__valid svelte-787fjp"> Valid recurrence pattern</div>'),bk=C('<div class="recurrence-input__error svelte-787fjp"> </div>'),kk=C('<div class="recurrence-input__feedback svelte-787fjp"><!></div>'),_k=C('<li class="svelte-787fjp"> </li>'),wk=C('<div class="recurrence-input__preview svelte-787fjp"><div class="recurrence-input__preview-title svelte-787fjp">Next occurrences:</div> <ul class="recurrence-input__preview-list svelte-787fjp"></ul></div>'),Tk=C('<div class="recurrence-input svelte-787fjp"><input type="text" placeholder="e.g., every week on Monday"/> <!> <!></div>');function xk(n,e){ht(e,!0);let t=on(e,"value",15,""),s=on(e,"showPreview",3,!0);const r=J(()=>Ja.parse(t())),a=J(()=>o(r).isValid),i=J(()=>o(r).error);function l(k,S=3){const D=[],E=new Date;for(let R=0;R<S;R++){const P=new Date(E);switch(k.type){case"daily":P.setDate(E.getDate()+R*k.interval);break;case"weekly":P.setDate(E.getDate()+R*k.interval*7);break;case"monthly":P.setMonth(E.getMonth()+R*k.interval);break;case"yearly":P.setFullYear(E.getFullYear()+R*k.interval);break}D.push(P.toLocaleDateString())}return D}const c=J(()=>o(a)&&s()?l(o(r).frequency):[]);function u(k){const D=k.target.value;t(D);const E=Ja.parse(D);e.onchange(D,E.isValid?E.frequency:null,E.isValid)}var d=Tk(),f=h(d);let g;f.__input=u;var y=v(f,2);{var _=k=>{var S=kk(),D=h(S);{var E=P=>{var L=yk();x(P,L)},R=P=>{var L=bk(),H=h(L);$(()=>N(H,` ${(o(i)||"Invalid recurrence pattern")??""}`)),x(P,L)};W(D,P=>{o(a)?P(E):P(R,!1)})}x(k,S)};W(y,k=>{t().length>0&&k(_)})}var m=v(y,2);{var p=k=>{var S=wk(),D=v(h(S),2);He(D,21,()=>o(c),bt,(E,R)=>{var P=_k(),L=h(P);$(()=>N(L,o(R))),x(E,P)}),x(k,S)};W(m,k=>{o(a)&&s()&&o(c).length>0&&k(p)})}$(()=>{g=et(f,1,"recurrence-input__field svelte-787fjp",null,g,{valid:o(a),invalid:!o(a)&&t().length>0}),Le(f,"aria-invalid",!o(a)&&t().length>0)}),ut(f,t),x(n,d),ft()}xt(["input"]);var Sk=C('<div class="dependency-picker__chip svelte-10ls0lk"><span class="dependency-picker__chip-text svelte-10ls0lk"> </span> <button type="button" class="dependency-picker__chip-remove svelte-10ls0lk"></button></div>'),Dk=C('<div class="dependency-picker__chips svelte-10ls0lk"></div>'),Ek=C('<span class="dependency-picker__option-check svelte-10ls0lk"></span>'),Ak=C('<button type="button"><span class="dependency-picker__option-name svelte-10ls0lk"> </span> <!></button>'),Ck=C('<div class="dependency-picker__dropdown svelte-10ls0lk"></div>'),Ik=C('<div class="dependency-picker svelte-10ls0lk"><label class="dependency-picker__label svelte-10ls0lk"> </label> <!> <div class="dependency-picker__search-wrapper svelte-10ls0lk"><input type="text" class="dependency-picker__search svelte-10ls0lk" placeholder="Search tasks..."/> <!></div></div>');function Mc(n,e){ht(e,!0);let t=on(e,"selected",31,()=>De([])),s=on(e,"label",3,"Select tasks"),r=V(""),a=V(!1);const i=J(()=>e.repository.getAllTasks().filter(P=>P.id!==e.excludeId)),l=J(()=>o(r).trim()?o(i).filter(P=>P.name.toLowerCase().includes(o(r).toLowerCase())):o(i)),c=J(()=>o(i).filter(P=>t().includes(P.id)));function u(P){if(!t().includes(P)){const L=[...t(),P];t(L),e.onchange(L)}T(r,""),T(a,!1)}function d(P){const L=t().filter(H=>H!==P);t(L),e.onchange(L)}function f(){T(a,!0)}function g(){setTimeout(()=>{T(a,!1)},200)}var y=Ik(),_=h(y),m=h(_),p=v(_,2);{var k=P=>{var L=Dk();He(L,21,()=>o(c),H=>H.id,(H,Y)=>{var X=Sk(),oe=h(X),ae=h(oe),ve=v(oe,2);ve.__click=()=>d(o(Y).id),$(()=>{N(ae,o(Y).name),Le(ve,"aria-label",`Remove ${o(Y).name??""}`)}),x(H,X)}),x(P,L)};W(p,P=>{o(c).length>0&&P(k)})}var S=v(p,2),D=h(S),E=v(D,2);{var R=P=>{var L=Ck();He(L,21,()=>o(l).slice(0,10),H=>H.id,(H,Y)=>{var X=Ak();let oe;X.__click=()=>u(o(Y).id);var ae=h(X),ve=h(ae),Q=v(ae,2);{var Z=B=>{var M=Ek();x(B,M)};W(Q,B=>{t().includes(o(Y).id)&&B(Z)})}$((B,M)=>{oe=et(X,1,"dependency-picker__option svelte-10ls0lk",null,oe,B),X.disabled=M,N(ve,o(Y).name)},[()=>({selected:t().includes(o(Y).id)}),()=>t().includes(o(Y).id)]),x(H,X)}),x(P,L)};W(E,P=>{o(a)&&o(l).length>0&&P(R)})}$(()=>N(m,s())),Ut("focus",D,f),Ut("blur",D,g),ut(D,()=>o(r),P=>T(r,P)),x(n,y),ft()}xt(["click"]);var Mk=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),Ok=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),Rk=C('<div class="task-editor__error svelte-xc3qs9"> </div>'),Nk=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Completed:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),Pk=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Cancelled:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),Lk=C('<div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Linked block:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div>'),Fk=C('<div class="task-editor-overlay svelte-xc3qs9" role="dialog" aria-modal="true" aria-labelledby="task-editor-title" tabindex="-1"><div class="task-editor-modal svelte-xc3qs9" role="document"><div class="task-editor__header svelte-xc3qs9"><h2 id="task-editor-title" class="svelte-xc3qs9"> </h2> <button class="task-editor__close svelte-xc3qs9" type="button" aria-label="Close"></button></div> <div class="task-editor__body svelte-xc3qs9"><div class="task-editor__field svelte-xc3qs9"><label for="task-name" class="svelte-xc3qs9">Description *</label> <input id="task-name" type="text" placeholder="Task name" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-description" class="svelte-xc3qs9">Notes</label> <textarea id="task-description" placeholder="Additional details about this task..." rows="3" class="svelte-xc3qs9"></textarea></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Priority</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label class="svelte-xc3qs9">Status</label> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-due" class="svelte-xc3qs9">Due Date *</label> <input id="task-due" type="datetime-local" class="svelte-xc3qs9"/> <!></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-scheduled" class="svelte-xc3qs9">Scheduled Date</label> <input id="task-scheduled" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">When you plan to start working on this task</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-start" class="svelte-xc3qs9">Start Date</label> <input id="task-start" type="datetime-local" class="svelte-xc3qs9"/> <div class="task-editor__hint svelte-xc3qs9">Earliest date this task can begin</div></div> <div class="task-editor__field svelte-xc3qs9"><label for="task-recurrence" class="svelte-xc3qs9">Recurrence</label> <!> <!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__field svelte-xc3qs9"><!></div> <div class="task-editor__timestamps svelte-xc3qs9"><div class="task-editor__timestamp svelte-xc3qs9"><span class="task-editor__timestamp-label svelte-xc3qs9">Created:</span> <span class="task-editor__timestamp-value svelte-xc3qs9"> </span></div> <!> <!> <!></div></div> <div class="task-editor__footer svelte-xc3qs9"><button class="task-editor__cancel svelte-xc3qs9" type="button">Cancel</button> <button class="task-editor__save svelte-xc3qs9" type="button"> </button></div> <div class="task-editor__hint-footer svelte-xc3qs9"> Press <kbd class="svelte-xc3qs9">Esc</kbd> to close, <kbd class="svelte-xc3qs9">/Ctrl+Enter</kbd> to save</div></div></div>');function Ad(n,e){var Te,Re,pt,$t,St,Gt,Dt,Lt,Cs,Yt,ns,Kt;ht(e,!0);const t="every day",s="Blocked by (tasks that must complete first)",r="Blocks (tasks that depend on this)",a=!e.task;let i=V(De(((Te=e.task)==null?void 0:Te.name)||"")),l=V(De(((Re=e.task)==null?void 0:Re.description)||"")),c=V(De(((pt=e.task)==null?void 0:pt.priority)||"normal")),u=V(De((($t=e.task)==null?void 0:$t.status)||"todo")),d=V(De((St=e.task)!=null&&St.dueAt?new Date(e.task.dueAt).toISOString().slice(0,16):new Date().toISOString().slice(0,16))),f=V(De((Gt=e.task)!=null&&Gt.scheduledAt?new Date(e.task.scheduledAt).toISOString().slice(0,16):"")),g=V(De((Dt=e.task)!=null&&Dt.startAt?new Date(e.task.startAt).toISOString().slice(0,16):"")),y=V(De(((Lt=e.task)==null?void 0:Lt.recurrenceText)||((Cs=e.task)!=null&&Cs.frequency?Ja.stringify(e.task.frequency):t))),_=V(De(((Yt=e.task)==null?void 0:Yt.frequency)||null)),m=V(!0),p=V(De(((ns=e.task)==null?void 0:ns.blockedBy)||[])),k=V(De(((Kt=e.task)==null?void 0:Kt.dependsOn)||[])),S=V(De({name:!1,dueAt:!1,recurrence:!1})),D=V(!1),E=V(null);const R=J(()=>o(S).name&&!o(i).trim()?"Task name is required":""),P=J(()=>o(S).dueAt?o(d)?Number.isNaN(new Date(o(d)).getTime())?"Invalid due date":"":"Due date is required":""),L=J(()=>o(S).recurrence&&!o(m)?"Invalid recurrence pattern":""),H=J(()=>!!(o(R)||o(P)||o(L)));pa(()=>{requestAnimationFrame(()=>{var z;(z=o(E))==null||z.focus()})});function Y(z,be,nt){T(y,z,!0),T(_,be,!0),T(m,nt,!0),o(S).recurrence=!0}function X(z){T(c,z,!0)}function oe(z){T(u,z,!0)}function ae(z){T(p,z,!0)}function ve(z){T(k,z,!0)}async function Q(){if(T(S,{name:!0,dueAt:!0,recurrence:!0},!0),o(H)){j.warning("Please fix validation errors");return}if(!o(_)){j.error("Invalid recurrence pattern");return}T(D,!0);try{let z;a?z=ma(o(i).trim(),o(_),new Date(o(d))):(z={...e.task},z.name=o(i).trim(),z.frequency=o(_),z.dueAt=new Date(o(d)).toISOString()),z.description=o(l).trim()||void 0,z.priority=o(c),z.status=o(u),z.recurrenceText=o(y),z.scheduledAt=o(f)?new Date(o(f)).toISOString():void 0,z.startAt=o(g)?new Date(o(g)).toISOString():void 0,z.blockedBy=o(p).length>0?o(p):void 0,z.dependsOn=o(k).length>0?o(k):void 0,z.updatedAt=new Date().toISOString(),o(u)==="done"&&!z.lastCompletedAt&&(z.lastCompletedAt=new Date().toISOString()),o(u)==="cancelled"&&!z.cancelledAt&&(z.cancelledAt=new Date().toISOString()),await e.repository.saveTask(z),e.onSave&&e.onSave(z),j.success(`Task "${z.name}" ${a?"created":"updated"}`),We.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(z){j.error(`Failed to save task: ${z}`)}finally{T(D,!1)}}function Z(z){z.key==="Escape"&&e.onClose(),(z.metaKey||z.ctrlKey)&&z.key==="Enter"&&(z.preventDefault(),Q())}function B(z){return z?new Date(z).toLocaleString():""}var M=Fk();M.__keydown=Z;var I=h(M),G=h(I),se=h(G),ke=h(se),ge=v(se,2);ge.__click=function(...z){var be;(be=e.onClose)==null||be.apply(this,z)};var ce=v(G,2),Ie=h(ce),Me=v(h(Ie),2);Me.__input=()=>o(S).name=!0,Ps(Me,z=>T(E,z),()=>o(E));var Ue=v(Me,2);{var de=z=>{var be=Mk(),nt=h(be);$(()=>N(nt,o(R))),x(z,be)};W(Ue,z=>{o(R)&&z(de)})}var U=v(Ie,2),A=v(h(U),2),F=v(U,2),K=v(h(F),2);vk(K,{get value(){return o(c)},onchange:X});var ie=v(F,2),O=v(h(ie),2);mk(O,{get value(){return o(u)},onchange:oe});var q=v(ie,2),ee=v(h(q),2);ee.__input=()=>o(S).dueAt=!0;var me=v(ee,2);{var _e=z=>{var be=Ok(),nt=h(be);$(()=>N(nt,o(P))),x(z,be)};W(me,z=>{o(P)&&z(_e)})}var ue=v(q,2),Ee=v(h(ue),2),Ae=v(ue,2),$e=v(h(Ae),2),Je=v(Ae,2),Ge=v(h(Je),2);xk(Ge,{get value(){return o(y)},onchange:Y,showPreview:!0});var at=v(Ge,2);{var dt=z=>{var be=Rk(),nt=h(be);$(()=>N(nt,o(L))),x(z,be)};W(at,z=>{o(L)&&z(dt)})}var Ce=v(Je,2),Ne=h(Ce);{let z=J(()=>{var be;return(be=e.task)==null?void 0:be.id});Mc(Ne,{get repository(){return e.repository},get selected(){return o(p)},get excludeId(){return o(z)},onchange:ae,label:s})}var Se=v(Ce,2),Pe=h(Se);{let z=J(()=>{var be;return(be=e.task)==null?void 0:be.id});Mc(Pe,{get repository(){return e.repository},get selected(){return o(k)},get excludeId(){return o(z)},onchange:ve,label:r})}var Ke=v(Se,2),Be=h(Ke),st=v(h(Be),2),mt=h(st),gt=v(Be,2);{var It=z=>{var be=Nk(),nt=v(h(be),2),rs=h(nt);$(Vt=>N(rs,Vt),[()=>B(e.task.lastCompletedAt)]),x(z,be)};W(gt,z=>{var be;(be=e.task)!=null&&be.lastCompletedAt&&z(It)})}var yt=v(gt,2);{var Pt=z=>{var be=Pk(),nt=v(h(be),2),rs=h(nt);$(Vt=>N(rs,Vt),[()=>B(e.task.cancelledAt)]),x(z,be)};W(yt,z=>{var be;(be=e.task)!=null&&be.cancelledAt&&z(Pt)})}var ss=v(yt,2);{var re=z=>{var be=Lk(),nt=v(h(be),2),rs=h(nt);$(()=>N(rs,e.task.linkedBlockId)),x(z,be)};W(ss,z=>{var be;(be=e.task)!=null&&be.linkedBlockId&&z(re)})}var we=v(ce,2),pe=h(we);pe.__click=function(...z){var be;(be=e.onClose)==null||be.apply(this,z)};var Oe=v(pe,2);Oe.__click=Q;var he=h(Oe);$(z=>{N(ke,a?"Create Task":"Edit Task"),Le(Me,"aria-invalid",!!o(R)),Le(ee,"aria-invalid",!!o(P)),N(mt,z),Oe.disabled=o(D),N(he,o(D)?"Saving...":a?"Create Task":"Save Changes")},[()=>{var z;return B((z=e.task)==null?void 0:z.createdAt)}]),Ut("blur",Me,()=>o(S).name=!0),ut(Me,()=>o(i),z=>T(i,z)),ut(A,()=>o(l),z=>T(l,z)),Ut("blur",ee,()=>o(S).dueAt=!0),ut(ee,()=>o(d),z=>T(d,z)),ut(Ee,()=>o(f),z=>T(f,z)),ut($e,()=>o(g),z=>T(g,z)),x(n,M),ft()}xt(["keydown","click","input"]);var qk=C("<option> </option>"),Bk=C('<li class="svelte-b8rwae"> </li>'),Uk=C('<div class="validation-errors svelte-b8rwae"><h4 class="svelte-b8rwae"> Validation Errors:</h4> <ul class="svelte-b8rwae"></ul></div>'),zk=C('<div class="profile-editor svelte-b8rwae"><div class="profile-header svelte-b8rwae"><input type="text" placeholder="Profile name" class="profile-name-input svelte-b8rwae"/> <input type="text" placeholder="Description (optional)" class="profile-description-input svelte-b8rwae"/></div> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Path Scoping</h3> <p class="help-text svelte-b8rwae">Use glob patterns like <code class="svelte-b8rwae">daily/**</code>, <code class="svelte-b8rwae">projects/**</code> <br/> <strong>Tip:</strong> <code class="svelte-b8rwae">**</code> matches any depth, <code class="svelte-b8rwae">*</code> matches within a folder</p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Paths <span class="badge optional svelte-b8rwae">Optional</span></span> <textarea placeholder="daily/** projects/**  Leave empty to include all paths" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">If set, only tasks in these paths are included</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Paths <span class="badge wins svelte-b8rwae">Wins</span></span> <textarea placeholder="archive/** templates/** trash/**" rows="4" class="svelte-b8rwae"></textarea> <span class="hint svelte-b8rwae">Always excluded, even if in include list</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Tag Scoping</h3> <p class="help-text svelte-b8rwae">Tags are boundary-safe: <code class="svelte-b8rwae">#work</code>  <code class="svelte-b8rwae">#workshop</code> <br/> <strong>Case-insensitive:</strong> <code class="svelte-b8rwae">#Work</code> = <code class="svelte-b8rwae">#work</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Tags <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="#task, #work, #active" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must have at least one of these tags</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Tags <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="#archive, #template, #ignore" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks with these tags are always excluded</span></label></div></section> <section class="filter-section svelte-b8rwae"><h3 class="svelte-b8rwae"> Regex Scoping (Advanced)</h3> <p class="help-text svelte-b8rwae">Pattern matching for complex filtering. Invalid regex will be disabled automatically. <br/> <strong>Examples:</strong> <code class="svelte-b8rwae">TODO|FIXME</code>, <code class="svelte-b8rwae">wip|draft</code>, <code class="svelte-b8rwae">^\\[.*\\]</code></p> <div class="dual-input svelte-b8rwae"><label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Include Regex <span class="badge optional svelte-b8rwae">Optional</span></span> <input type="text" placeholder="TODO|FIXME|IMPORTANT" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Task must match this pattern</span></label> <label class="svelte-b8rwae"><span class="label-with-badge svelte-b8rwae">Exclude Regex <span class="badge wins svelte-b8rwae">Wins</span></span> <input type="text" placeholder="wip|draft|skip" class="svelte-b8rwae"/> <span class="hint svelte-b8rwae">Tasks matching this are excluded</span></label></div> <div class="regex-targets svelte-b8rwae"><span class="targets-label svelte-b8rwae">Match against:</span> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Task Text</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Path</span></label> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>File Name</span></label></div></section> <!> <div class="profile-save-actions svelte-b8rwae"><button type="button" class="primary svelte-b8rwae"> Save Profile</button> <button type="button" class="secondary svelte-b8rwae"> Reset All to Defaults</button></div></div>'),$k=C('<span class="task-path svelte-b8rwae"> </span>'),Yk=C('<span class="task-tags svelte-b8rwae"> </span>'),Wk=C('<span class="explanation svelte-b8rwae"> </span>'),jk=C('<li class="svelte-b8rwae"><div class="task-info svelte-b8rwae"><span class="task-name svelte-b8rwae"> </span> <!> <!></div> <!></li>'),Hk=C('<details open class="svelte-b8rwae"><summary class="svelte-b8rwae">Sample Excluded Tasks (first 20):</summary> <ul class="excluded-samples svelte-b8rwae"></ul></details>'),Gk=C('<div class="no-excluded svelte-b8rwae"> All tasks pass the current filter</div>'),Kk=C('<div class="profile-toolbar svelte-b8rwae"><div class="profile-selector svelte-b8rwae"><label for="profile-select" class="svelte-b8rwae">Active Profile:</label> <select id="profile-select" class="svelte-b8rwae"></select></div> <div class="profile-actions svelte-b8rwae"><button type="button" title="Create new profile" class="svelte-b8rwae">+ New</button> <button type="button" title="Duplicate current profile" class="svelte-b8rwae"> Duplicate</button> <button type="button" title="Delete current profile" class="svelte-b8rwae"> Delete</button> <button type="button" title="Export profile to JSON" class="svelte-b8rwae"> Export</button> <button type="button" title="Import profile from JSON" class="svelte-b8rwae"> Import</button></div></div> <!> <div class="preview svelte-b8rwae"><div class="preview-header svelte-b8rwae"><h3 class="svelte-b8rwae"> Live Preview</h3> <label class="checkbox-label svelte-b8rwae"><input type="checkbox" class="svelte-b8rwae"/> <span>Show Explain Mode</span></label></div> <div class="preview-stats svelte-b8rwae"><div class="stat stat-included svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Included</span></div></div> <div class="stat stat-excluded svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Excluded</span></div></div> <div class="stat stat-total svelte-b8rwae"><span class="stat-icon svelte-b8rwae"></span> <div class="stat-content svelte-b8rwae"><span class="stat-value svelte-b8rwae"> </span> <span class="stat-label svelte-b8rwae">Total</span></div></div></div> <!></div> <div class="quick-tips svelte-b8rwae"><h3 class="svelte-b8rwae"> Quick Tips</h3> <ul class="svelte-b8rwae"><li class="svelte-b8rwae"><strong>Precedence:</strong> Exclude always wins over include</li> <li class="svelte-b8rwae"><strong>Performance:</strong> Filters are compiled and optimized for 10k+ tasks</li> <li class="svelte-b8rwae"><strong>Profiles:</strong> Create multiple profiles for different contexts (Work, Personal, etc.)</li> <li class="svelte-b8rwae"><strong>Query Overrides:</strong> Use <code class="svelte-b8rwae">@ignoreGlobalFilter</code> or <code class="svelte-b8rwae">@profile Work</code> in queries</li> <li class="svelte-b8rwae"><strong>Debugging:</strong> Enable "Show Explain Mode" to see why tasks are excluded</li></ul></div>',1),Vk=C('<div class="disabled-state svelte-b8rwae"><p class="svelte-b8rwae">Global Filter is disabled. All tasks will be included.</p> <p class="hint svelte-b8rwae">Enable to start filtering tasks by path, tags, or regex patterns.</p></div>'),Qk=C(`<div class="global-filter-settings svelte-b8rwae"><div class="header svelte-b8rwae"><div class="header-content svelte-b8rwae"><h2 class="svelte-b8rwae">Global Filter Profiles</h2> <p class="subtitle svelte-b8rwae">Control which tasks are included in your plugin universe. 
        Tasks that fail the filter won't appear in queries, dashboards, or notifications.</p></div> <label class="enable-toggle svelte-b8rwae"><input type="checkbox"/> <span class="svelte-b8rwae">Enable Global Filter</span></label></div> <!></div>`);function Xk(n,e){ht(e,!0);const t=vs.getInstance();let s=V(De(e.settingsService.get().globalFilter??na)),r=J(()=>o(s).profiles.find(Q=>Q.id===o(s).activeProfileId)),a=V(De({included:0,excluded:0,samples:[]})),i=V(De([])),l=V(!1),c=V(""),u=V(""),d=V(""),f=V("");Tt(()=>{o(r)&&(T(c,o(r).includePaths.join(`
`),!0),T(u,o(r).excludePaths.join(`
`),!0),T(d,o(r).includeTags.join(", "),!0),T(f,o(r).excludeTags.join(", "),!0))});function g(Q){o(s).activeProfileId=Q,t.setActiveProfile(Q),k()}function y(){const Q={id:`profile_${Date.now()}`,name:"New Profile",description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]};o(s).profiles=[...o(s).profiles,Q],o(s).activeProfileId=Q.id,k(),j.success("Profile created")}function _(){if(!o(r))return;const Q={...o(r),id:`profile_${Date.now()}`,name:`${o(r).name} (Copy)`};o(s).profiles=[...o(s).profiles,Q],o(s).activeProfileId=Q.id,k(),j.success("Profile duplicated")}function m(Q){if(o(s).profiles.length<=1){j.error("Cannot delete the last profile");return}o(s).profiles=o(s).profiles.filter(Z=>Z.id!==Q),o(s).activeProfileId===Q&&(o(s).activeProfileId=o(s).profiles[0].id),k(),j.success("Profile deleted")}function p(){if(!o(r))return;o(r).includePaths=o(c).split(`
`).map(Z=>Z.trim()).filter(Boolean),o(r).excludePaths=o(u).split(`
`).map(Z=>Z.trim()).filter(Boolean),o(r).includeTags=o(d).split(",").map(Z=>Z.trim()).filter(Boolean),o(r).excludeTags=o(f).split(",").map(Z=>Z.trim()).filter(Boolean);const Q=Gh(o(r));T(i,Q.errors,!0),Q.valid?(k(),j.success("Profile saved")):j.error("Validation failed - check errors below")}async function k(){t.updateConfig(o(s)),await e.settingsService.update({globalFilter:o(s)}),We.emit("task: settings",{source:"global-filter"}),S()}function S(){if(!e.repository){T(a,{included:0,excluded:0,samples:[]},!0);return}const Q=e.repository.getAllTasks(),Z=vs.getInstance(),B=Q.filter(M=>!Z.shouldIncludeTask(M));T(a,{included:Q.length-B.length,excluded:B.length,samples:B.slice(0,20)},!0)}function D(Q){const Z=t.explainTask(Q);let B=Z.reason;return Z.matchedRule&&(B+=` (${Z.matchedRule.type}:  ${Z.matchedRule.pattern}`,Z.matchedRule.target&&(B+=` on ${Z.matchedRule.target}`),B+=")"),B}async function E(){confirm("Reset all profiles to defaults?  This cannot be undone.")&&(T(s,{...na},!0),await k(),j.success("Reset to defaults"))}function R(){if(!o(r))return;const Q=JSON.stringify(o(r),null,2),Z=new Blob([Q],{type:"application/json"}),B=URL.createObjectURL(Z),M=document.createElement("a");M.href=B,M.download=`${o(r).name.replace(/\s+/g,"-").toLowerCase()}-profile.json`,M.click(),URL.revokeObjectURL(B),j.success("Profile exported")}async function P(){const Q=document.createElement("input");Q.type="file",Q.accept=". json",Q.onchange=async Z=>{var M;const B=(M=Z.target.files)==null?void 0:M[0];if(B)try{const I=await B.text(),G=JSON.parse(I);if(!G.id||!G.name||!Array.isArray(G.includePaths))throw new Error("Invalid profile format");G.id=`profile_${Date.now()}`,o(s).profiles=[...o(s).profiles,G],o(s).activeProfileId=G.id,await k(),j.success(`Profile "${G.name}" imported`)}catch(I){j.error(`Import failed: ${I instanceof Error?I.message:"Unknown error"}`)}},Q.click()}Tt(()=>{S()});var L=Qk(),H=h(L),Y=v(h(H),2),X=h(Y);X.__change=()=>k();var oe=v(H,2);{var ae=Q=>{var Z=Kk(),B=Qe(Z),M=h(B),I=v(h(M),2);I.__change=()=>g(o(s).activeProfileId),He(I,21,()=>o(s).profiles,bt,(Ne,Se)=>{var Pe=qk(),Ke=h(Pe),Be={};$(()=>{N(Ke,o(Se).name),Be!==(Be=o(Se).id)&&(Pe.value=(Pe.__value=o(Se).id)??"")}),x(Ne,Pe)});var G=v(M,2),se=h(G);se.__click=y;var ke=v(se,2);ke.__click=_;var ge=v(ke,2);ge.__click=()=>m(o(s).activeProfileId);var ce=v(ge,2);ce.__click=R;var Ie=v(ce,2);Ie.__click=P;var Me=v(B,2);{var Ue=Ne=>{var Se=zk(),Pe=h(Se),Ke=h(Pe);Ke.__change=()=>p();var Be=v(Ke,2);Be.__change=()=>p();var st=v(Pe,2),mt=v(h(st),4),gt=h(mt),It=v(h(gt),2),yt=v(gt,2),Pt=v(h(yt),2),ss=v(st,2),re=v(h(ss),4),we=h(re),pe=v(h(we),2),Oe=v(we,2),he=v(h(Oe),2),Te=v(ss,2),Re=v(h(Te),4),pt=h(Re),$t=v(h(pt),2),St=v(pt,2),Gt=v(h(St),2),Dt=v(Re,2),Lt=v(h(Dt),2),Cs=h(Lt);Cs.__change=Ze=>{Ze.currentTarget.checked?o(r).regexTargets.includes("taskText")||(o(r).regexTargets=[...o(r).regexTargets,"taskText"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="taskText")};var Yt=v(Lt,2),ns=h(Yt);ns.__change=Ze=>{Ze.currentTarget.checked?o(r).regexTargets.includes("path")||(o(r).regexTargets=[...o(r).regexTargets,"path"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="path")};var Kt=v(Yt,2),z=h(Kt);z.__change=Ze=>{Ze.currentTarget.checked?o(r).regexTargets.includes("fileName")||(o(r).regexTargets=[...o(r).regexTargets,"fileName"]):o(r).regexTargets=o(r).regexTargets.filter(Ft=>Ft!=="fileName")};var be=v(Te,2);{var nt=Ze=>{var Ft=Uk(),vn=v(h(Ft),2);He(vn,21,()=>o(i),bt,(mi,yi)=>{var ka=Bk(),gn=h(ka);$(()=>N(gn,o(yi))),x(mi,ka)}),x(Ze,Ft)};W(be,Ze=>{o(i).length>0&&Ze(nt)})}var rs=v(be,2),Vt=h(rs);Vt.__click=p;var fn=v(Vt,2);fn.__click=E,$((Ze,Ft,vn)=>{In(Cs,Ze),In(ns,Ft),In(z,vn)},[()=>o(r).regexTargets.includes("taskText"),()=>o(r).regexTargets.includes("path"),()=>o(r).regexTargets.includes("fileName")]),ut(Ke,()=>o(r).name,Ze=>o(r).name=Ze),ut(Be,()=>o(r).description,Ze=>o(r).description=Ze),ut(It,()=>o(c),Ze=>T(c,Ze)),ut(Pt,()=>o(u),Ze=>T(u,Ze)),ut(pe,()=>o(d),Ze=>T(d,Ze)),ut(he,()=>o(f),Ze=>T(f,Ze)),ut($t,()=>o(r).includeRegex,Ze=>o(r).includeRegex=Ze),ut(Gt,()=>o(r).excludeRegex,Ze=>o(r).excludeRegex=Ze),x(Ne,Se)};W(Me,Ne=>{o(r)&&Ne(Ue)})}var de=v(Me,2),U=h(de),A=v(h(U),2),F=h(A),K=v(U,2),ie=h(K),O=v(h(ie),2),q=h(O),ee=h(q),me=v(ie,2),_e=v(h(me),2),ue=h(_e),Ee=h(ue),Ae=v(me,2),$e=v(h(Ae),2),Je=h($e),Ge=h(Je),at=v(K,2);{var dt=Ne=>{var Se=Hk(),Pe=v(h(Se),2);He(Pe,21,()=>o(a).samples,bt,(Ke,Be)=>{var st=jk(),mt=h(st),gt=h(mt),It=h(gt),yt=v(gt,2);{var Pt=Oe=>{var he=$k(),Te=h(he);$(()=>N(Te,o(Be).path)),x(Oe,he)};W(yt,Oe=>{o(Be).path&&Oe(Pt)})}var ss=v(yt,2);{var re=Oe=>{var he=Yk(),Te=h(he);$(Re=>N(Te,Re),[()=>o(Be).tags.join(" ")]),x(Oe,he)};W(ss,Oe=>{o(Be).tags&&o(Be).tags.length>0&&Oe(re)})}var we=v(mt,2);{var pe=Oe=>{var he=Wk(),Te=h(he);$(Re=>N(Te,Re),[()=>D(o(Be))]),x(Oe,he)};W(we,Oe=>{o(l)&&Oe(pe)})}$(()=>N(It,o(Be).name)),x(Ke,st)}),x(Ne,Se)},Ce=Ne=>{var Se=lt(),Pe=Qe(Se);{var Ke=Be=>{var st=Gk();x(Be,st)};W(Pe,Be=>{o(s).enabled&&Be(Ke)},!0)}x(Ne,Se)};W(at,Ne=>{o(a).samples.length>0?Ne(dt):Ne(Ce,!1)})}$(()=>{ge.disabled=o(s).profiles.length<=1,N(ee,o(a).included),N(Ee,o(a).excluded),N(Ge,o(a).included+o(a).excluded)}),Xu(I,()=>o(s).activeProfileId,Ne=>o(s).activeProfileId=Ne),Ls(F,()=>o(l),Ne=>T(l,Ne)),x(Q,Z)},ve=Q=>{var Z=Vk();x(Q,Z)};W(oe,Q=>{o(s).enabled?Q(ae):Q(ve,!1)})}Ls(X,()=>o(s).enabled,Q=>o(s).enabled=Q),x(n,L),ft()}xt(["change","click"]);var Zk=C('<button class="delete-btn svelte-1qw3eru">Delete</button>'),Jk=C('<span class="default-badge svelte-1qw3eru">Default</span>'),e_=C('<tr class="svelte-1qw3eru"><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"> </td><td class="svelte-1qw3eru"><span class="status-type svelte-1qw3eru"> </span></td><td class="svelte-1qw3eru"><code class="status-symbol svelte-1qw3eru"> </code></td><td class="example-col svelte-1qw3eru"><code class="example svelte-1qw3eru"> </code></td><td class="svelte-1qw3eru"><!></td></tr>'),t_=C('<div class="status-registry-editor svelte-1qw3eru"><h3 class="settings__section-title svelte-1qw3eru">Custom Task Statuses</h3> <p class="description svelte-1qw3eru">Define custom checkbox symbols for different task states</p> <div class="status-list svelte-1qw3eru"><div class="table-container svelte-1qw3eru"><table class="svelte-1qw3eru"><thead class="svelte-1qw3eru"><tr><th class="svelte-1qw3eru">Symbol</th><th class="svelte-1qw3eru">Name</th><th class="svelte-1qw3eru">Type</th><th class="svelte-1qw3eru">Next Symbol</th><th class="svelte-1qw3eru">Example</th><th class="svelte-1qw3eru">Actions</th></tr></thead><tbody class="svelte-1qw3eru"></tbody></table></div></div> <div class="add-status-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">Add Custom Status</h4> <div class="add-status-form"><div class="form-row svelte-1qw3eru"><div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Symbol (1 char)</label> <input type="text" placeholder="!" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Name</label> <input type="text" placeholder="Important" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Type</label> <select class="settings__input svelte-1qw3eru"><option>TODO</option><option>IN_PROGRESS</option><option>DONE</option><option>CANCELLED</option><option>NON_TASK</option></select></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">Next Symbol</label> <input type="text" placeholder="x" maxlength="1" class="settings__input svelte-1qw3eru"/></div> <div class="form-field svelte-1qw3eru"><label class="settings__label svelte-1qw3eru">&nbsp;</label> <button class="add-btn svelte-1qw3eru">Add Status</button></div></div></div></div> <div class="actions svelte-1qw3eru"><button class="reset-btn svelte-1qw3eru">Reset to Defaults</button></div> <div class="info-section svelte-1qw3eru"><h4 class="subsection-title svelte-1qw3eru">About Custom Statuses</h4> <ul class="svelte-1qw3eru"><li class="svelte-1qw3eru"><strong>Symbol:</strong> The character shown in the checkbox (e.g., <code class="svelte-1qw3eru">[!]</code>)</li> <li class="svelte-1qw3eru"><strong>Type:</strong> Determines how the task is treated (active, completed, etc.)</li> <li class="svelte-1qw3eru"><strong>Next Symbol:</strong> What symbol to use when toggling the task</li> <li class="svelte-1qw3eru"><strong>Examples:</strong> <code class="svelte-1qw3eru">[!]</code> for urgent, <code class="svelte-1qw3eru">[?]</code> for question, <code class="svelte-1qw3eru">[&gt;]</code> for forwarded</li></ul></div></div>');function s_(n,e){ht(e,!0);let t=Gs.getInstance(),s=V(De([])),r=V(""),a=V(""),i=V(De(wt.TODO)),l=V("x");function c(){T(s,t.getAll(),!0)}function u(){if(!o(r).trim()||!o(a).trim()){j.error("Symbol and name are required");return}if(o(r).length!==1){j.error("Symbol must be a single character");return}const de={symbol:o(r),name:o(a),type:o(i),nextStatusSymbol:o(l)},U=new Xs(de);t.register(U),c(),g(),j.success(`Status "${o(a)}" added`)}function d(de){if([" ","x","/","-"].includes(de)){j.error("Cannot delete default status");return}t.unregister(de),c(),j.success("Status deleted")}function f(){confirm("Reset all statuses to defaults? This will remove all custom statuses.")&&(t.reset(),c(),j.success("Statuses reset to defaults"))}function g(){T(r,""),T(a,""),T(i,wt.TODO,!0),T(l,"x")}Tt(()=>{c()});var y=t_(),_=v(h(y),4),m=h(_),p=h(m),k=v(h(p));He(k,21,()=>o(s),bt,(de,U)=>{var A=e_(),F=h(A),K=h(F),ie=h(K),O=v(F),q=h(O),ee=v(O),me=h(ee),_e=h(me),ue=v(ee),Ee=h(ue),Ae=h(Ee),$e=v(ue),Je=h($e),Ge=h(Je),at=v($e),dt=h(at);{var Ce=Se=>{var Pe=Zk();Pe.__click=()=>d(o(U).symbol),x(Se,Pe)},Ne=Se=>{var Pe=Jk();x(Se,Pe)};W(dt,Se=>{[" ","x","/","-"].includes(o(U).symbol)?Se(Ne,!1):Se(Ce)})}$(()=>{N(ie,`[${o(U).symbol??""}]`),N(q,o(U).name),N(_e,o(U).type),N(Ae,`[${o(U).nextStatusSymbol??""}]`),N(Ge,`- [${o(U).symbol??""}] Task example`)}),x(de,A)});var S=v(_,2),D=v(h(S),2),E=h(D),R=h(E),P=v(h(R),2),L=v(R,2),H=v(h(L),2),Y=v(L,2),X=v(h(Y),2),oe=h(X),ae={},ve=v(oe),Q={},Z=v(ve),B={},M=v(Z),I={},G=v(M),se={},ke=v(Y,2),ge=v(h(ke),2),ce=v(ke,2),Ie=v(h(ce),2);Ie.__click=u;var Me=v(S,2),Ue=h(Me);Ue.__click=f,$(()=>{ae!==(ae=wt.TODO)&&(oe.value=(oe.__value=wt.TODO)??""),Q!==(Q=wt.IN_PROGRESS)&&(ve.value=(ve.__value=wt.IN_PROGRESS)??""),B!==(B=wt.DONE)&&(Z.value=(Z.__value=wt.DONE)??""),I!==(I=wt.CANCELLED)&&(M.value=(M.__value=wt.CANCELLED)??""),se!==(se=wt.NON_TASK)&&(G.value=(G.__value=wt.NON_TASK)??"")}),ut(P,()=>o(r),de=>T(r,de)),ut(H,()=>o(a),de=>T(a,de)),Xu(X,()=>o(i),de=>T(i,de)),ut(ge,()=>o(l),de=>T(l,de)),x(n,y),ft()}xt(["click"]);var n_=C('<button class="settings__close-btn svelte-1ke3hir"></button>'),r_=C("<div> </div>"),a_=C('<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">n8n Webhook</h3> <label class="settings__toggle svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <span>Enabled</span></label></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-webhook">Webhook URL</label> <input id="n8n-webhook" class="settings__input svelte-1ke3hir" type="url" placeholder="https://your-n8n-instance.com/webhook/..."/></div> <div class="settings__field svelte-1ke3hir"><label class="settings__label svelte-1ke3hir" for="n8n-secret">Shared Secret</label> <input id="n8n-secret" class="settings__input svelte-1ke3hir" type="password" placeholder="Optional shared secret"/></div> <button class="settings__test-btn svelte-1ke3hir"> </button> <!></section>'),i_=C('<div class="settings__shortcut-context svelte-1ke3hir"> </div>'),o_=C('<div class="settings__shortcut svelte-1ke3hir"><div class="settings__shortcut-main svelte-1ke3hir"><div class="settings__shortcut-label svelte-1ke3hir"> </div> <div class="settings__shortcut-description svelte-1ke3hir"> </div> <!></div> <div class="settings__shortcut-keys svelte-1ke3hir"><input class="settings__shortcut-input svelte-1ke3hir" type="text" placeholder="Unassigned"/> <div class="settings__shortcut-actions svelte-1ke3hir"><button class="settings__shortcut-btn svelte-1ke3hir" type="button">Save</button> <button class="settings__shortcut-btn settings__shortcut-btn--ghost svelte-1ke3hir" type="button">Reset</button></div> <div class="settings__shortcut-default svelte-1ke3hir"> </div></div></div>'),l_=C(`<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">Keyboard Shortcuts</h3></div> <div class="settings__shortcuts svelte-1ke3hir"></div> <button class="settings__shortcut-reset-all svelte-1ke3hir" type="button">Reset all shortcuts</button> <p class="settings__shortcut-note svelte-1ke3hir">Tip: You can also customize these in SiYuan's native shortcut settings.</p></section>`),c_=C('<div class="settings__warning svelte-1ke3hir"> Strict mode enabled - tasks with any parsing errors will be rejected</div>'),u_=C('<section class="settings__section svelte-1ke3hir"><div class="settings__section-header svelte-1ke3hir"><h3 class="settings__section-title svelte-1ke3hir">Auto-Creation Settings</h3> <label class="settings__toggle svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <span>Enable Inline Creation</span></label></div> <p class="settings__description svelte-1ke3hir">Automatically create tasks from markdown checklists as you type.</p> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Auto-Creation Triggers</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Create on Enter</div> <div class="settings__checkbox-description svelte-1ke3hir">Automatically create task when you press Enter after typing a checklist</div></div></label> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Create on Blur</div> <div class="settings__checkbox-description svelte-1ke3hir">Automatically create task when you click away from a checklist (debounced)</div></div></label></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Normalization</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Normalize on Save</div> <div class="settings__checkbox-description svelte-1ke3hir">Reformat checklist text to standard format after task creation</div></div></label></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Parsing Mode</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Strict Parsing</div> <div class="settings__checkbox-description svelte-1ke3hir">Reject tasks with invalid syntax (warning: may be frustrating)</div></div></label> <!></div> <div class="settings__subsection svelte-1ke3hir"><h4 class="settings__subsection-title svelte-1ke3hir">Visual Indicators</h4> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Show Error Hints</div> <div class="settings__checkbox-description svelte-1ke3hir">Display inline error messages when task parsing fails</div></div></label> <label class="settings__checkbox svelte-1ke3hir"><input type="checkbox" class="svelte-1ke3hir"/> <div><div class="settings__checkbox-label svelte-1ke3hir">Highlight Managed Tasks</div> <div class="settings__checkbox-description svelte-1ke3hir">Add visual indicator to checklists that have linked tasks</div></div></label></div> <button class="settings__save-btn svelte-1ke3hir">Save Auto-Creation Settings</button></section>'),d_=C('<div class="settings__footer svelte-1ke3hir"><button class="settings__save-btn svelte-1ke3hir">Save Settings</button></div>'),h_=C('<div class="settings svelte-1ke3hir"><div class="settings__header svelte-1ke3hir"><h2 class="settings__title svelte-1ke3hir">Settings</h2> <!></div> <div class="settings__layout svelte-1ke3hir"><nav class="settings__nav svelte-1ke3hir"><button>General</button> <button>Global Filtering & Query</button> <button>Custom Statuses</button> <button>Shortcuts</button> <button>Auto-Creation</button></nav> <div class="settings__content svelte-1ke3hir"><!></div></div> <!></div>');function f_(n,e){ht(e,!0);let t=V(De(eo)),s=V(null),r=De({}),a=V("general"),i=V(De([])),l=V(De({})),c=V(De({enableInlineCreation:!0,autoCreateOnEnter:!1,autoCreateOnBlur:!1,normalizeOnSave:!0,strictParsing:!1,showInlineHints:!0,highlightManagedTasks:!0}));function u(){if(!e.shortcutManager){T(i,[],!0),T(l,{},!0);return}T(i,e.shortcutManager.getShortcutDisplay(),!0),T(l,o(i).reduce((I,G)=>(I[G.id]=G.currentHotkey||"",I),{}),!0)}function d(I,G){T(l,{...o(l),[I]:G},!0)}async function f(I){if(!e.shortcutManager)return;const G=await e.shortcutManager.updateShortcut(I,o(l)[I]??"");if(!G.success){j.error(G.message||"Failed to update shortcut.");return}j.success("Shortcut updated."),u()}async function g(I){e.shortcutManager&&(await e.shortcutManager.resetShortcut(I),j.success("Shortcut reset."),u())}async function y(){e.shortcutManager&&(await e.shortcutManager.resetAllShortcuts(),j.success("Shortcuts reset to defaults."),u())}Tt(()=>{T(t,e.eventService.getConfig(),!0)}),Tt(()=>{u()}),Tt(()=>{const I=e.settingsService.get();I.inlineTasks&&T(c,{...I.inlineTasks},!0)});async function _(){try{await e.eventService.saveConfig(o(t)),j.success("Settings saved successfully!"),e.onClose&&e.onClose()}catch(I){j.error("Failed to save settings: "+I)}}async function m(){try{await e.settingsService.update({inlineTasks:o(c)}),j.success("Auto-creation settings saved!")}catch(I){j.error("Failed to save settings: "+I)}}async function p(){T(s,"n8n"),r.n8n={success:!1,message:"Testing..."};try{const I=await e.eventService.testConnection();r.n8n={success:I.success,message:I.success?"Test successful!":I.message||"Test failed. Check configuration."}}catch(I){r.n8n={success:!1,message:"Error: "+(I instanceof Error?I.message:String(I))}}finally{T(s,null)}}var k=h_(),S=h(k),D=v(h(S),2);{var E=I=>{var G=n_();G.__click=function(...se){var ke;(ke=e.onClose)==null||ke.apply(this,se)},x(I,G)};W(D,I=>{e.onClose&&I(E)})}var R=v(S,2),P=h(R),L=h(P);L.__click=()=>T(a,"general");var H=v(L,2);H.__click=()=>T(a,"filter");var Y=v(H,2);Y.__click=()=>T(a,"statuses");var X=v(Y,2);X.__click=()=>T(a,"shortcuts");var oe=v(X,2);oe.__click=()=>T(a,"inlineTasks");var ae=v(P,2),ve=h(ae);{var Q=I=>{var G=a_(),se=h(G),ke=v(h(se),2),ge=h(ke),ce=v(se,2),Ie=v(h(ce),2),Me=v(ce,2),Ue=v(h(Me),2),de=v(Me,2);de.__click=p;var U=h(de),A=v(de,2);{var F=K=>{var ie=r_(),O=h(ie);$(()=>{et(ie,1,`settings__test-result ${r.n8n.success?"success":"error"}`,"svelte-1ke3hir"),N(O,r.n8n.message)}),x(K,ie)};W(A,K=>{r.n8n&&K(F)})}$(()=>{Ie.disabled=!o(t).n8n.enabled,Ue.disabled=!o(t).n8n.enabled,de.disabled=!o(t).n8n.enabled||o(s)==="n8n",N(U,o(s)==="n8n"?"Testing...":"Test Connection")}),Ls(ge,()=>o(t).n8n.enabled,K=>o(t).n8n.enabled=K),ut(Ie,()=>o(t).n8n.webhookUrl,K=>o(t).n8n.webhookUrl=K),ut(Ue,()=>o(t).n8n.sharedSecret,K=>o(t).n8n.sharedSecret=K),x(I,G)},Z=I=>{var G=lt(),se=Qe(G);{var ke=ce=>{Xk(ce,{get settingsService(){return e.settingsService},get repository(){return e.repository}})},ge=ce=>{var Ie=lt(),Me=Qe(Ie);{var Ue=U=>{s_(U,{})},de=U=>{var A=lt(),F=Qe(A);{var K=O=>{var q=l_(),ee=v(h(q),2);He(ee,21,()=>o(i),bt,(_e,ue)=>{var Ee=o_(),Ae=h(Ee),$e=h(Ae),Je=h($e),Ge=v($e,2),at=h(Ge),dt=v(Ge,2);{var Ce=gt=>{var It=i_(),yt=h(It);$(()=>N(yt,o(ue).context)),x(gt,It)};W(dt,gt=>{o(ue).context&&gt(Ce)})}var Ne=v(Ae,2),Se=h(Ne);Se.__input=gt=>d(o(ue).id,gt.currentTarget.value);var Pe=v(Se,2),Ke=h(Pe);Ke.__click=()=>f(o(ue).id);var Be=v(Ke,2);Be.__click=()=>g(o(ue).id);var st=v(Pe,2),mt=h(st);$(()=>{N(Je,o(ue).label),N(at,o(ue).description),Bo(Se,o(l)[o(ue).id]??""),N(mt,`Default: ${(o(ue).defaultHotkey||"Unassigned")??""}`)}),x(_e,Ee)});var me=v(ee,2);me.__click=y,x(O,q)},ie=O=>{var q=lt(),ee=Qe(q);{var me=_e=>{var ue=u_(),Ee=h(ue),Ae=v(h(Ee),2),$e=h(Ae),Je=v(Ee,4),Ge=v(h(Je),2),at=h(Ge),dt=v(Ge,2),Ce=h(dt),Ne=v(Je,2),Se=v(h(Ne),2),Pe=h(Se),Ke=v(Ne,2),Be=v(h(Ke),2),st=h(Be),mt=v(Be,2);{var gt=pe=>{var Oe=c_();x(pe,Oe)};W(mt,pe=>{o(c).strictParsing&&pe(gt)})}var It=v(Ke,2),yt=v(h(It),2),Pt=h(yt),ss=v(yt,2),re=h(ss),we=v(It,2);we.__click=m,$(()=>{at.disabled=!o(c).enableInlineCreation,Ce.disabled=!o(c).enableInlineCreation,Pe.disabled=!o(c).enableInlineCreation,st.disabled=!o(c).enableInlineCreation,Pt.disabled=!o(c).enableInlineCreation,re.disabled=!o(c).enableInlineCreation}),Ls($e,()=>o(c).enableInlineCreation,pe=>o(c).enableInlineCreation=pe),Ls(at,()=>o(c).autoCreateOnEnter,pe=>o(c).autoCreateOnEnter=pe),Ls(Ce,()=>o(c).autoCreateOnBlur,pe=>o(c).autoCreateOnBlur=pe),Ls(Pe,()=>o(c).normalizeOnSave,pe=>o(c).normalizeOnSave=pe),Ls(st,()=>o(c).strictParsing,pe=>o(c).strictParsing=pe),Ls(Pt,()=>o(c).showInlineHints,pe=>o(c).showInlineHints=pe),Ls(re,()=>o(c).highlightManagedTasks,pe=>o(c).highlightManagedTasks=pe),x(_e,ue)};W(ee,_e=>{o(a)==="inlineTasks"&&_e(me)},!0)}x(O,q)};W(F,O=>{o(a)==="shortcuts"?O(K):O(ie,!1)},!0)}x(U,A)};W(Me,U=>{o(a)==="statuses"?U(Ue):U(de,!1)},!0)}x(ce,Ie)};W(se,ce=>{o(a)==="filter"?ce(ke):ce(ge,!1)},!0)}x(I,G)};W(ve,I=>{o(a)==="general"?I(Q):I(Z,!1)})}var B=v(R,2);{var M=I=>{var G=d_(),se=h(G);se.__click=_,x(I,G)};W(B,I=>{o(a)==="general"&&I(M)})}$(()=>{et(L,1,`settings__nav-btn ${o(a)==="general"?"active":""}`,"svelte-1ke3hir"),et(H,1,`settings__nav-btn ${o(a)==="filter"?"active":""}`,"svelte-1ke3hir"),et(Y,1,`settings__nav-btn ${o(a)==="statuses"?"active":""}`,"svelte-1ke3hir"),et(X,1,`settings__nav-btn ${o(a)==="shortcuts"?"active":""}`,"svelte-1ke3hir"),et(oe,1,`settings__nav-btn ${o(a)==="inlineTasks"?"active":""}`,"svelte-1ke3hir")}),x(n,k),ft()}xt(["click","input"]);var v_=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),g_=C('<div class="dashboard__overlay svelte-1y1a8hs"><!></div>'),p_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),m_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),y_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),b_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),k_=C('<span class="dashboard__tab-badge svelte-1y1a8hs"> </span>'),__=C('<div class="dashboard__filters svelte-1y1a8hs"><span class="dashboard__filters-label svelte-1y1a8hs">Quick Filters:</span> <button>Not Done</button> <button>Due Today</button> <button>Overdue</button> <button>In Progress</button> <button>Blocked</button> <button>Blocking</button> <button>High Priority</button></div>'),w_=C('<div class="dashboard__tabs svelte-1y1a8hs" role="tablist" aria-label="Dashboard tabs"><button id="dashboard-tab-inbox" role="tab" aria-controls="dashboard-panel"> Inbox <!></button> <button id="dashboard-tab-today" role="tab" aria-controls="dashboard-panel"> Today <!></button> <button id="dashboard-tab-upcoming" role="tab" aria-controls="dashboard-panel"> Upcoming <!></button> <button id="dashboard-tab-done" role="tab" aria-controls="dashboard-panel"> Done <!></button> <button id="dashboard-tab-projects" role="tab" aria-controls="dashboard-panel"> Projects <!></button> <button id="dashboard-tab-search" role="tab" aria-controls="dashboard-panel"> Search</button> <button id="dashboard-tab-all" role="tab" aria-controls="dashboard-panel"> All <span class="dashboard__tab-badge svelte-1y1a8hs"> </span></button> <button id="dashboard-tab-insights" role="tab" aria-controls="dashboard-panel"> Insights</button></div> <!> <div id="dashboard-panel" class="dashboard__content svelte-1y1a8hs" role="tabpanel"><!></div>',1),T_=C('<div class="dashboard svelte-1y1a8hs"><div class="dashboard__header svelte-1y1a8hs"><h1 class="dashboard__title svelte-1y1a8hs">Recurring Tasks</h1> <div class="dashboard__header-actions svelte-1y1a8hs"><button class="dashboard__refresh-btn svelte-1y1a8hs" title="Refresh tasks"> </button> <button class="dashboard__settings-btn svelte-1y1a8hs"> Settings</button></div></div> <!></div>');function x_(n,e){ht(e,!0),Cf(jo,e.settingsService.get().urgency);const t=e.scheduler.getTimezoneHandler(),s=e.scheduler.getRecurrenceEngine();let r=V("today"),a=V(!1),i=V(!1),l=V(void 0),c=V(De(new Set)),u=V(De([])),d=J(()=>jv(o(u))),f=V(!1);const g=J(()=>["inbox","today","upcoming","done","projects","search","all","insights"].includes(o(r))?`dashboard-tab-${o(r)}`:void 0),y=J(()=>()=>{let A=o(u);if(o(c).has("notDone")&&(A=A.filter(F=>F.status!=="done"&&F.status!=="cancelled")),o(c).has("dueToday")){const F=new Date;F.setHours(0,0,0,0);const K=new Date(F);K.setDate(K.getDate()+1),A=A.filter(ie=>{if(!ie.dueAt)return!1;const O=new Date(ie.dueAt);return O>=F&&O<K})}if(o(c).has("overdue")){const F=new Date;F.setHours(0,0,0,0),A=A.filter(K=>!K.dueAt||K.status==="done"||K.status==="cancelled"?!1:new Date(K.dueAt)<F)}return o(c).has("inProgress")&&(A=A.filter(F=>F.status==="todo"&&F.statusSymbol&&F.statusSymbol!==" ")),o(c).has("blocked")&&(A=A.filter(F=>zv(F,o(u)))),o(c).has("blocking")&&(A=A.filter(F=>$v(F,o(u)))),o(c).has("highPriority")&&(A=A.filter(F=>{const K=Nr(F.priority)||"normal";return K==="high"||K==="highest"})),A}),_=J(()=>o(u).filter(A=>A.status!=="done"&&A.status!=="cancelled"&&!A.dueAt&&!A.scheduledAt&&!A.startAt).length),m=J(()=>()=>{const A=new Date;A.setHours(0,0,0,0);const F=new Date(A);return F.setDate(F.getDate()+7),o(u).filter(K=>{if(K.status==="done"||K.status==="cancelled"||!K.dueAt)return!1;const ie=new Date(K.dueAt);return ie.setHours(0,0,0,0),ie>A&&ie<=F}).length}),p=J(()=>()=>{const A=new Date;return A.setDate(A.getDate()-30),A.setHours(0,0,0,0),o(u).filter(F=>F.status!=="done"||!F.doneAt?!1:new Date(F.doneAt)>=A).length}),k=J(()=>o(u).filter(A=>A.status!=="done"&&A.status!=="cancelled").length);function S(A="initial"){T(f,!0),T(u,e.repository.getAllTasks().map(F=>({...F})),!0),T(f,!1),A!=="initial"&&j.info("Task list reloaded")}S();const D=()=>S("reload");pa(()=>{window.addEventListener("recurring-task-refresh",D)}),xv(()=>{window.removeEventListener("recurring-task-refresh",D)});async function E(A){We.emit("task: complete",{taskId:A.id})}async function R(A){const F=o(u),K=Ci(o(u),A.id,ie=>{const O={...ie},q=new Date(O.dueAt),ee=t.tomorrow();return ee.setHours(q.getHours(),q.getMinutes(),0,0),O.dueAt=ee.toISOString(),O.snoozeCount=(O.snoozeCount||0)+1,O.updatedAt=new Date().toISOString(),O});T(u,K,!0),j.info(`Task "${A.name}" delayed to tomorrow`);try{await e.eventService.emitTaskEvent("task. snoozed",A),await e.scheduler.delayToTomorrow(A.id)}catch(ie){T(u,F,!0),j.error("Failed to delay task:  "+ie),S("external")}}async function P(A){var K;if(!((K=A.name)!=null&&K.trim())){j.error("Task name is required");return}if(!Zu(A.frequency)){j.error("Invalid frequency configuration");return}const F={...A};T(u,Ia(o(u),F),!0),T(a,!1),T(l,void 0),j.success(`Task "${A.name}" saved successfully`),e.repository.saveTask(F).catch(ie=>{j.error("Failed to save task: "+ie),S("external")})}async function L(A){const F=o(u);T(u,Yl(o(u),A.id),!0);const K=window.setTimeout(async()=>{try{await e.repository.deleteTask(A.id)}catch(ie){T(u,F,!0),j.error("Failed to delete task: "+ie),S("external")}},5e3);Wn({message:`Task "${A.name}" deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(K),T(u,F,!0),j.info(`Restored "${A.name}"`)},showCountdown:!0})}async function H(A){const F=A.name.endsWith(" (copy)")?`${A.name} ${new Date().toLocaleDateString()}`:`${A.name} (copy)`,K=td(A,{name:F});T(u,Ia(o(u),K),!0),j.success(`Duplicated "${A.name}"`),e.repository.saveTask(K).catch(ie=>{T(u,Yl(o(u),K.id),!0),j.error("Failed to duplicate task: "+ie),S("external")})}async function Y(A){const F=!A.enabled,K={...A,enabled:F},ie=Ci(o(u),A.id,()=>K);T(u,ie,!0),j.info(`Task ${F?"enabled":"disabled"}`),e.repository.saveTask(K).catch(O=>{j.error("Failed to update task: "+O),S("external")})}async function X(A,F){if(A.length===0)return;const K=o(u),ie=new Set(A),O=o(u).map(q=>ie.has(q.id)?{...q,enabled:F}:q);T(u,O,!0),j.info(`${F?"Enabled":"Disabled"} ${A.length} task${A.length===1?"":"s"}`);try{const q=O.filter(ee=>ie.has(ee.id));await Promise.all(q.map(ee=>e.repository.saveTask(ee)))}catch(q){T(u,K,!0),j.error(`Failed to ${F?"enable":"disable"} tasks: ${q}`),S("external")}}async function oe(A){if(A.length===0)return;const F=o(u),K=new Set(A),ie=o(u).filter(q=>K.has(q.id));T(u,o(u).filter(q=>!K.has(q.id)),!0);const O=window.setTimeout(async()=>{try{await Promise.all(ie.map(q=>e.repository.deleteTask(q.id)))}catch(q){T(u,F,!0),j.error("Failed to delete tasks: "+q),S("external")}},5e3);Wn({message:`${ie.length} task${ie.length===1?"":"s"} deleted`,type:"success",duration:5e3,actionLabel:"Undo",onAction:()=>{window.clearTimeout(O),T(u,F,!0),j.info("Bulk delete undone")},showCountdown:!0})}function ae(A){T(l,A,!0),T(a,!0)}function ve(){T(l,void 0),T(a,!0)}function Q(){T(a,!1),T(l,void 0)}function Z(){T(i,!0)}function B(){T(i,!1)}async function M(A){const F=o(u),K=Ci(o(u),A.id,ie=>{const O={...ie};sd(O);const q=s.calculateNext(new Date(O.dueAt),O.frequency);return O.dueAt=q.toISOString(),O});T(u,K,!0),j.info(`Task "${A.name}" skipped to next occurrence`);try{await e.eventService.emitTaskEvent("task.skipped",A),await e.scheduler.skipTaskOccurrence(A.id)}catch(ie){T(u,F,!0),j.error("Failed to skip task: "+ie),S("external")}}function I(A){const F=new Set(o(c));F.has(A)?F.delete(A):F.add(A),T(c,F,!0)}async function G(A){const F={...A,status:"todo",doneAt:void 0};T(u,Ia(o(u),F),!0),j.success(`Task "${A.name}" marked as not done`),e.repository.saveTask(F).catch(K=>{j.error("Failed to update task: "+K),S("external")})}var se=T_(),ke=h(se),ge=v(h(ke),2),ce=h(ge);ce.__click=()=>S("reload");var Ie=h(ce),Me=v(ce,2);Me.__click=Z;var Ue=v(ke,2);{var de=A=>{var F=v_(),K=h(F);f_(K,{get eventService(){return e.eventService},get shortcutManager(){return e.shortcutManager},get settingsService(){return e.settingsService},get repository(){return e.repository},onClose:B}),x(A,F)},U=A=>{var F=lt(),K=Qe(F);{var ie=q=>{var ee=g_(),me=h(ee);Ad(me,{get task(){return o(l)},get repository(){return e.repository},onSave:P,onClose:Q}),x(q,ee)},O=q=>{var ee=w_(),me=Qe(ee),_e=h(me);_e.__click=()=>T(r,"inbox");var ue=v(h(_e));{var Ee=he=>{var Te=p_(),Re=h(Te);$(()=>N(Re,o(_))),x(he,Te)};W(ue,he=>{o(_)>0&&he(Ee)})}var Ae=v(_e,2);Ae.__click=()=>T(r,"today");var $e=v(h(Ae));{var Je=he=>{var Te=m_(),Re=h(Te);$(()=>N(Re,o(d).length)),x(he,Te)};W($e,he=>{o(d).length>0&&he(Je)})}var Ge=v(Ae,2);Ge.__click=()=>T(r,"upcoming");var at=v(h(Ge));{var dt=he=>{var Te=y_(),Re=h(Te);$(()=>N(Re,o(m))),x(he,Te)};W(at,he=>{o(m)>0&&he(dt)})}var Ce=v(Ge,2);Ce.__click=()=>T(r,"done");var Ne=v(h(Ce));{var Se=he=>{var Te=b_(),Re=h(Te);$(()=>N(Re,o(p))),x(he,Te)};W(Ne,he=>{o(p)>0&&he(Se)})}var Pe=v(Ce,2);Pe.__click=()=>T(r,"projects");var Ke=v(h(Pe));{var Be=he=>{var Te=k_(),Re=h(Te);$(()=>N(Re,o(k))),x(he,Te)};W(Ke,he=>{o(k)>0&&he(Be)})}var st=v(Pe,2);st.__click=()=>T(r,"search");var mt=v(st,2);mt.__click=()=>T(r,"all");var gt=v(h(mt)),It=h(gt),yt=v(mt,2);yt.__click=()=>T(r,"insights");var Pt=v(me,2);{var ss=he=>{var Te=__(),Re=v(h(Te),2);Re.__click=()=>I("notDone");var pt=v(Re,2);pt.__click=()=>I("dueToday");var $t=v(pt,2);$t.__click=()=>I("overdue");var St=v($t,2);St.__click=()=>I("inProgress");var Gt=v(St,2);Gt.__click=()=>I("blocked");var Dt=v(Gt,2);Dt.__click=()=>I("blocking");var Lt=v(Dt,2);Lt.__click=()=>I("highPriority"),$((Cs,Yt,ns,Kt,z,be,nt)=>{et(Re,1,`dashboard__filter-btn ${Cs??""}`,"svelte-1y1a8hs"),et(pt,1,`dashboard__filter-btn ${Yt??""}`,"svelte-1y1a8hs"),et($t,1,`dashboard__filter-btn ${ns??""}`,"svelte-1y1a8hs"),et(St,1,`dashboard__filter-btn ${Kt??""}`,"svelte-1y1a8hs"),et(Gt,1,`dashboard__filter-btn ${z??""}`,"svelte-1y1a8hs"),et(Dt,1,`dashboard__filter-btn ${be??""}`,"svelte-1y1a8hs"),et(Lt,1,`dashboard__filter-btn ${nt??""}`,"svelte-1y1a8hs")},[()=>o(c).has("notDone")?"active":"",()=>o(c).has("dueToday")?"active":"",()=>o(c).has("overdue")?"active":"",()=>o(c).has("inProgress")?"active":"",()=>o(c).has("blocked")?"active":"",()=>o(c).has("blocking")?"active":"",()=>o(c).has("highPriority")?"active":""]),x(he,Te)};W(Pt,he=>{o(r)!=="search"&&o(r)!=="timeline"&&o(r)!=="analytics"&&o(r)!=="insights"&&he(ss)})}var re=v(Pt,2),we=h(re);{var pe=he=>{{let Te=J(()=>o(c).size>0?o(y):o(u));Vg(he,{get tasks(){return o(Te)},onEdit:ae,onDone:E,onDelete:L})}},Oe=he=>{var Te=lt(),Re=Qe(Te);{var pt=St=>{{let Gt=J(()=>o(c).size>0?o(y).filter(Dt=>o(d).some(Lt=>Lt.id===Dt.id)):o(d));pg(St,{get tasks(){return o(Gt)},onDone:E,onDelay:R,onSkip:M,onEdit:ae,get timezoneHandler(){return t}})}},$t=St=>{var Gt=lt(),Dt=Qe(Gt);{var Lt=Yt=>{{let ns=J(()=>o(c).size>0?o(y):o(u));ep(Yt,{get tasks(){return o(ns)},onEdit:ae,onDone:E,onDelete:L})}},Cs=Yt=>{var ns=lt(),Kt=Qe(ns);{var z=nt=>{{let rs=J(()=>o(c).size>0?o(y):o(u));op(nt,{get tasks(){return o(rs)},onEdit:ae,onDelete:L,onUncomplete:G})}},be=nt=>{var rs=lt(),Vt=Qe(rs);{var fn=Ft=>{{let vn=J(()=>o(c).size>0?o(y):o(u));fp(Ft,{get tasks(){return o(vn)},onEdit:ae,onDone:E,onDelete:L})}},Ze=Ft=>{var vn=lt(),mi=Qe(vn);{var yi=gn=>{eb(gn,{get tasks(){return o(u)},onEdit:ae,onDone:E,onDelete:L})},ka=gn=>{var sl=lt(),Fd=Qe(sl);{var qd=ur=>{{let _a=J(()=>o(c).size>0?o(y):o(u));Sg(ur,{get tasks(){return o(_a)},onEdit:ae,onDelete:L,onDuplicate:H,onToggleEnabled:Y,onBulkEnable:Yr=>X(Yr,!0),onBulkDisable:Yr=>X(Yr,!1),onBulkDelete:oe,onCreate:ve})}},Bd=ur=>{var _a=lt(),Yr=Qe(_a);{var Ud=dr=>{Ng(dr,{get tasks(){return o(u)},get recurrenceEngine(){return s}})},zd=dr=>{var nl=lt(),$d=Qe(nl);{var Yd=hr=>{jg(hr,{get tasks(){return o(u)}})},Wd=hr=>{var rl=lt(),jd=Qe(rl);{var Hd=bi=>{hb(bi,{get tasks(){return o(u)},onApplySuggestion:async(wa,ki)=>{const al={...wa,frequency:ki.suggestedSchedule.frequency,dueAt:ki.suggestedSchedule.time?(()=>{const Ta=new Date(wa.dueAt),[Gd,Kd]=ki.suggestedSchedule.time.split(":").map(Number);return Ta.setHours(Gd,Kd||0,0,0),Ta.toISOString()})():wa.dueAt,updatedAt:new Date().toISOString()};T(u,Ia(o(u),al),!0),j.success(`Schedule updated for "${wa.name}"`);try{await e.repository.saveTask(al)}catch(Ta){j.error("Failed to save schedule update: "+Ta),S("external")}}})};W(jd,bi=>{o(r)==="insights"&&bi(Hd)},!0)}x(hr,rl)};W($d,hr=>{o(r)==="analytics"?hr(Yd):hr(Wd,!1)},!0)}x(dr,nl)};W(Yr,dr=>{o(r)==="timeline"?dr(Ud):dr(zd,!1)},!0)}x(ur,_a)};W(Fd,ur=>{o(r)==="all"?ur(qd):ur(Bd,!1)},!0)}x(gn,sl)};W(mi,gn=>{o(r)==="search"?gn(yi):gn(ka,!1)},!0)}x(Ft,vn)};W(Vt,Ft=>{o(r)==="projects"?Ft(fn):Ft(Ze,!1)},!0)}x(nt,rs)};W(Kt,nt=>{o(r)==="done"?nt(z):nt(be,!1)},!0)}x(Yt,ns)};W(Dt,Yt=>{o(r)==="upcoming"?Yt(Lt):Yt(Cs,!1)},!0)}x(St,Gt)};W(Re,St=>{o(r)==="today"?St(pt):St($t,!1)},!0)}x(he,Te)};W(we,he=>{o(r)==="inbox"?he(pe):he(Oe,!1)})}$(()=>{et(_e,1,`dashboard__tab ${o(r)==="inbox"?"active":""}`,"svelte-1y1a8hs"),Le(_e,"aria-selected",o(r)==="inbox"),et(Ae,1,`dashboard__tab ${o(r)==="today"?"active":""}`,"svelte-1y1a8hs"),Le(Ae,"aria-selected",o(r)==="today"),et(Ge,1,`dashboard__tab ${o(r)==="upcoming"?"active":""}`,"svelte-1y1a8hs"),Le(Ge,"aria-selected",o(r)==="upcoming"),et(Ce,1,`dashboard__tab ${o(r)==="done"?"active":""}`,"svelte-1y1a8hs"),Le(Ce,"aria-selected",o(r)==="done"),et(Pe,1,`dashboard__tab ${o(r)==="projects"?"active":""}`,"svelte-1y1a8hs"),Le(Pe,"aria-selected",o(r)==="projects"),et(st,1,`dashboard__tab ${o(r)==="search"?"active":""}`,"svelte-1y1a8hs"),Le(st,"aria-selected",o(r)==="search"),et(mt,1,`dashboard__tab ${o(r)==="all"?"active":""}`,"svelte-1y1a8hs"),Le(mt,"aria-selected",o(r)==="all"),N(It,o(u).length),et(yt,1,`dashboard__tab ${o(r)==="insights"?"active":""}`,"svelte-1y1a8hs"),Le(yt,"aria-selected",o(r)==="insights"),Le(re,"aria-labelledby",o(g))}),x(q,ee)};W(K,q=>{o(a)?q(ie):q(O,!1)},!0)}x(A,F)};W(Ue,A=>{o(i)?A(de):A(U,!1)})}$(()=>{ce.disabled=o(f),N(Ie,o(f)?"":"")}),x(n,se),ft()}xt(["click"]);var S_=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),D_=C('<div class="quick-add-card__error svelte-1q3w22"> </div>'),E_=C('<div class="quick-add-card__linked svelte-1q3w22">Linked block: <span class="svelte-1q3w22"> </span></div>'),A_=C('<button class="quick-add-card__advanced svelte-1q3w22" type="button">Advanced...</button>'),C_=C('<div class="quick-add-overlay svelte-1q3w22" role="dialog" aria-modal="true" aria-labelledby="quick-add-title"><div class="quick-add-card svelte-1q3w22" role="document"><div class="quick-add-card__header svelte-1q3w22"><h2 id="quick-add-title" class="svelte-1q3w22">Quick Add</h2> <button class="quick-add-card__close svelte-1q3w22" type="button" aria-label="Close"></button></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-name">Task Name *</label> <input id="quick-task-name" type="text" placeholder="e.g. Review daily notes" class="svelte-1q3w22"/> <!></div> <div class="quick-add-card__field svelte-1q3w22"><label for="quick-task-due">Due *</label> <input id="quick-task-due" type="datetime-local" class="svelte-1q3w22"/> <!></div> <!> <div class="quick-add-card__actions svelte-1q3w22"><button class="quick-add-card__cancel svelte-1q3w22" type="button">Cancel</button> <!> <button class="quick-add-card__save svelte-1q3w22" type="button"> </button></div> <p class="quick-add-card__hint svelte-1q3w22">Tip: Press /Ctrl + Enter to save.</p></div></div>');function I_(n,e){var B;ht(e,!0);let t=V(De(((B=e.prefill)==null?void 0:B.suggestedName)??"")),s=V(De(new Date().toISOString().slice(0,16))),r=V(De({name:!1,dueAt:!1})),a=V(!1),i=V(null);const l=J(()=>o(r).name&&!o(t).trim()?"Task name is required.":""),c=J(()=>o(r).dueAt?o(s)?Number.isNaN(new Date(o(s)).getTime())?"Enter a valid date and time.":"":"Due date and time are required.":""),u=J(()=>!!(o(l)||o(c)));pa(()=>{var M;if((M=e.prefill)!=null&&M.suggestedTime){const I=new Date,[G,se]=e.prefill.suggestedTime.split(":").map(Number);I.setHours(G,se,0,0),T(s,I.toISOString().slice(0,16),!0)}requestAnimationFrame(()=>{var I;(I=o(i))==null||I.focus()})});async function d(){var se,ke;if(T(r,{name:!0,dueAt:!0},!0),o(u)){j.warning("Please fill out the required fields.");return}const M=ci(),I=o(s).slice(11,16);if(M.time=I,!Zu(M)){j.error("Invalid frequency configuration.");return}const G=ma(o(t).trim(),M,new Date(o(s)));G.linkedBlockId=((se=e.prefill)==null?void 0:se.linkedBlockId)||void 0,G.linkedBlockContent=((ke=e.prefill)==null?void 0:ke.linkedBlockContent)||void 0,T(a,!0);try{await e.repository.saveTask(G),j.success(`Task "${G.name}" created`),We.emit("task:refresh",void 0),window.dispatchEvent(new CustomEvent("recurring-task-refresh")),e.onClose()}catch(ge){j.error("Failed to create task: "+ge)}finally{T(a,!1)}}function f(M){M.key==="Escape"&&e.onClose(),(M.metaKey||M.ctrlKey)&&M.key==="Enter"&&(M.preventDefault(),d())}var g=C_();g.__keydown=f;var y=h(g),_=h(y),m=v(h(_),2);m.__click=function(...M){var I;(I=e.onClose)==null||I.apply(this,M)};var p=v(_,2),k=v(h(p),2);k.__input=()=>o(r).name=!0,Ps(k,M=>T(i,M),()=>o(i));var S=v(k,2);{var D=M=>{var I=S_(),G=h(I);$(()=>N(G,o(l))),x(M,I)};W(S,M=>{o(l)&&M(D)})}var E=v(p,2),R=v(h(E),2);R.__input=()=>o(r).dueAt=!0;var P=v(R,2);{var L=M=>{var I=D_(),G=h(I);$(()=>N(G,o(c))),x(M,I)};W(P,M=>{o(c)&&M(L)})}var H=v(E,2);{var Y=M=>{var I=E_(),G=v(h(I)),se=h(G);$(()=>N(se,e.prefill.linkedBlockId)),x(M,I)};W(H,M=>{var I;(I=e.prefill)!=null&&I.linkedBlockId&&M(Y)})}var X=v(H,2),oe=h(X);oe.__click=function(...M){var I;(I=e.onClose)==null||I.apply(this,M)};var ae=v(oe,2);{var ve=M=>{var I=A_();I.__click=function(...G){var se;(se=e.onAdvanced)==null||se.apply(this,G)},x(M,I)};W(ae,M=>{e.onAdvanced&&M(ve)})}var Q=v(ae,2);Q.__click=d;var Z=h(Q);$(()=>{Le(k,"aria-invalid",!!o(l)),Le(R,"aria-invalid",!!o(c)),Q.disabled=o(a),N(Z,o(a)?"Saving":"Create Task")}),Ut("blur",k,()=>o(r).name=!0),ut(k,()=>o(t),M=>T(t,M)),Ut("blur",R,()=>o(r).dueAt=!0),ut(R,()=>o(s),M=>T(s,M)),x(n,g),ft()}xt(["keydown","click","input"]);var M_=C('<button class="postpone-card__option svelte-tkdeu6" type="button" role="listitem"> </button>'),O_=C('<div class="postpone-overlay svelte-tkdeu6" role="dialog" aria-modal="true" aria-labelledby="postpone-title"><div class="postpone-card svelte-tkdeu6" role="document"><div class="postpone-card__header svelte-tkdeu6"><h2 id="postpone-title" class="svelte-tkdeu6">Postpone task</h2> <button class="postpone-card__close svelte-tkdeu6" type="button" aria-label="Close"></button></div> <p class="postpone-card__summary svelte-tkdeu6">Choose a new due offset for <strong> </strong>.</p> <div class="postpone-card__options svelte-tkdeu6" role="list"></div> <div class="postpone-card__actions svelte-tkdeu6"><button class="postpone-card__cancel svelte-tkdeu6" type="button">Cancel</button></div></div></div>');function R_(n,e){ht(e,!0);let t=V(null);function s(m,p){p&&T(t,m,!0)}pa(()=>{requestAnimationFrame(()=>{var m;(m=o(t))==null||m.focus()})});function r(m){m.key==="Escape"&&e.onClose()}var a=O_();a.__keydown=r;var i=h(a),l=h(i),c=v(h(l),2);c.__click=function(...m){var p;(p=e.onClose)==null||p.apply(this,m)};var u=v(l,2),d=v(h(u)),f=h(d),g=v(u,2);He(g,21,()=>Mv,bt,(m,p,k)=>{var S=M_();S.__click=()=>e.onSelect(o(p).minutes);var D=h(S);vv(S,(E,R)=>s==null?void 0:s(E,R),()=>k===0),$(()=>N(D,o(p).label)),x(m,S)});var y=v(g,2),_=h(y);_.__click=function(...m){var p;(p=e.onClose)==null||p.apply(this,m)},$(()=>N(f,e.taskName)),x(n,a),ft()}xt(["keydown","click"]);function Cd(){return Intl.DateTimeFormat().resolvedOptions().timeZone}class N_{static migrateFrequency(e,t){if(e.rruleString)return e;const s=this.legacyToRRule(e),r=t?t.toISOString():new Date().toISOString();return{...e,rruleString:s.toString(),dtstart:r,naturalLanguage:s.toText(),timezone:e.timezone||Cd()}}static legacyToRRule(e){const t={freq:this.mapFreqType(e.type),interval:e.interval||1};return e.type==="weekly"&&e.weekdays&&e.weekdays.length>0&&(t.byweekday=e.weekdays.map(this.mapWeekday)),e.type==="monthly"&&e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth),e.type==="yearly"&&(e.month!==void 0&&(t.bymonth=e.month+1),e.dayOfMonth&&(e.dayOfMonth===31?t.bymonthday=-1:t.bymonthday=e.dayOfMonth)),new le(t)}static mapFreqType(e){switch(e){case"daily":return le.DAILY;case"weekly":return le.WEEKLY;case"monthly":return le.MONTHLY;case"yearly":return le.YEARLY;default:return le.DAILY}}static mapWeekday(e){return[le.MO,le.TU,le.WE,le.TH,le.FR,le.SA,le.SU][e]||le.MO}static migrateTask(e){var t;if((t=e.frequency)!=null&&t.rruleString||!e.frequency)return e;try{const s=new Date(e.dueAt),r=this.migrateFrequency(e.frequency,s),a={type:e.frequency.type,interval:e.frequency.interval,weekdays:"weekdays"in e.frequency?e.frequency.weekdays:void 0,dayOfMonth:"dayOfMonth"in e.frequency?e.frequency.dayOfMonth:void 0,month:"month"in e.frequency?e.frequency.month:void 0,migratedAt:new Date().toISOString()};return{...e,frequency:r,legacyRecurrenceSnapshot:a,updatedAt:new Date().toISOString()}}catch(s){throw ye(`Failed to migrate task ${e.id}:`,s),s}}}async function P_(n){let e=0,t=0,s=0;const r=[];for(const a of n)try{if(!a.frequency){t++,r.push(a);continue}if(a.frequency.rruleString){t++,r.push(a);continue}const i=N_.migrateTask(a);r.push(i),e++,ne(`Migrated task ${a.id} to RRULE format`)}catch(i){ye(`Failed to migrate task ${a.id}:`,i),s++,r.push(a)}return ne(`RRULE Migration complete: ${e} migrated, ${t} skipped, ${s} errors`),{migrated:e,skipped:t,errors:s,migratedTasks:r}}class L_{constructor(e){b(this,"plugin");this.plugin=e}getCurrentVersion(){return yn}async createBackup(e,t){try{const s=await this.plugin.loadData(e);if(s){const r=new Date().toISOString().replace(/[:.]/g,"-"),a=t!==void 0?`v${t}`:"unknown",i=`${e}-backup-${a}-${r}`;return await this.plugin.saveData(i,s),ne(`Created backup: ${i}`),i}throw new Error("No data to backup")}catch(s){throw ye("Failed to create backup",s),s}}async migrate(e){try{const t=await this.plugin.loadData(e);if(!t)return ne("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:yn};const s=Array.isArray(t)?t:Array.isArray(t.tasks)?t.tasks:[];if(s.length===0)return ne("No data to migrate"),{migrated:!1,tasksAffected:0,toVersion:yn};let r=!1,a,i,l=0;for(let u=0;u<s.length;u++){const d=s[u],f=d.version||0;f<yn&&(r||(i=f,a=await this.createBackup(e,f),r=!0),s[u]=this.migrateTask(d,f),l++,ne(`Migrated task ${d.id} from v${f} to v${yn}`))}const c=await P_(s);if(c.migrated>0){r||(i=4,a=await this.createBackup(e,i),r=!0),l+=c.migrated;for(let u=0;u<c.migratedTasks.length;u++)s[u]=c.migratedTasks[u]}if(r){const u=Array.isArray(t)?s:{...t,tasks:s};return await this.plugin.saveData(e,u),ne(`Migration complete: ${l} tasks migrated`),{migrated:!0,tasksAffected:l,fromVersion:i,toVersion:yn,backupKey:a}}else return ne("No migration needed - all tasks up to date"),{migrated:!1,tasksAffected:0,toVersion:yn}}catch(t){throw ye("Migration failed",t),t}}migrateTask(e,t){let s={...e};return t<1&&(s.version=1),t<2&&(s={...s,version:2,timezone:s.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,completionCount:s.completionCount||0,missCount:s.missCount||0,currentStreak:s.currentStreak||0,bestStreak:s.bestStreak||0,recentCompletions:s.recentCompletions||[],priority:s.priority||"normal",tags:s.tags||[],notificationChannels:s.notificationChannels||[],snoozeCount:s.snoozeCount||0,maxSnoozes:s.maxSnoozes||3}),t<3&&(s={...s,version:3,escalationPolicy:s.escalationPolicy||{enabled:!1,levels:[]},linkedBlockContent:s.linkedBlockContent||void 0,category:s.category||void 0,description:s.description||void 0}),t<4&&(s={...s,version:4,onCompletion:s.onCompletion||"keep",dependsOn:s.dependsOn||[],blockedBy:s.blockedBy||[]}),t<5&&(s={...s,version:5}),s}}class F_{constructor(e,t=50){b(this,"pendingState",null);b(this,"writeInProgress",!1);b(this,"scheduledTimer",null);b(this,"flushResolvers",[]);this.writer=e,this.debounceMs=t}requestSave(e){this.pendingState=e,!(this.writeInProgress||this.scheduledTimer)&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}async flush(){if(!(!this.pendingState&&!this.writeInProgress&&!this.scheduledTimer))return new Promise(e=>{this.flushResolvers.push(e),!this.writeInProgress&&!this.scheduledTimer&&this.pendingState&&this.drainQueue()})}async drainQueue(){if(!this.writeInProgress){this.writeInProgress=!0;try{for(;this.pendingState;){const e=this.pendingState;if(this.pendingState=null,!await this.writeWithRetry(e)){this.pendingState=e;break}}}finally{this.writeInProgress=!1,this.pendingState||this.resolveFlushes(),this.pendingState&&!this.scheduledTimer&&(this.scheduledTimer=setTimeout(()=>{this.scheduledTimer=null,this.drainQueue()},this.debounceMs))}}}async writeWithRetry(e){try{return await this.writer.write(e),!0}catch(t){ye("Task persistence write failed, retrying once",t)}try{return await this.writer.write(e),!0}catch(t){return ye("Task persistence write failed after retry",t),!1}}resolveFlushes(){if(this.flushResolvers.length===0)return;const e=[...this.flushResolvers];this.flushResolvers=[];for(const t of e)t()}}const po={},q_=Object.freeze(Object.defineProperty({__proto__:null,default:po},Symbol.toStringTag,{value:"Module"})),Oc=new Set;function Ua(n){const e=`${n.feature}:${n.capability}:${n.message}`;Oc.has(e)||(Oc.add(e),ze(n.message,{feature:n.feature,capability:n.capability,cause:n.cause}))}class Id extends Error{constructor(t,s,r){super(r);b(this,"capability");b(this,"feature");this.name="SiYuanCapabilityError",this.feature=t,this.capability=s}}class Md extends Error{constructor(t,s,r,a){super(r);b(this,"capability");b(this,"feature");b(this,"cause");this.name="SiYuanApiExecutionError",this.feature=t,this.capability=s,this.cause=a}}class Od{constructor(e=globalThis){b(this,"supportedCapabilities");b(this,"globalScope");this.globalScope=e,this.supportedCapabilities={setBlockAttrs:this.isSetBlockAttrsAvailable(),dataDir:this.isDataDirAvailable()}}isSetBlockAttrsAvailable(){var e;return typeof((e=this.globalScope)==null?void 0:e.setBlockAttrs)=="function"}isDataDirAvailable(){var e,t,s,r;return typeof((r=(s=(t=(e=this.globalScope)==null?void 0:e.siyuan)==null?void 0:t.config)==null?void 0:s.system)==null?void 0:r.dataDir)=="string"}getDataDir(){var e,t,s;return this.isDataDirAvailable()?((s=(t=(e=this.globalScope.siyuan)==null?void 0:e.config)==null?void 0:t.system)==null?void 0:s.dataDir)??null:null}async setBlockAttrs(e,t){const s=this.getSetBlockAttrs();try{await s(e,t)}catch(r){throw new Md("Block attribute sync","setBlockAttrs","Failed to sync block attributes via SiYuan API.",r)}}getSetBlockAttrs(){if(!this.isSetBlockAttrsAvailable())throw new Id("Block attribute sync","setBlockAttrs","Block attribute sync unavailable in this SiYuan version. Tasks will continue without block sync.");return this.globalScope.setBlockAttrs}}const B_=".tmp";class U_{constructor(e,t){b(this,"plugin");b(this,"apiAdapter");b(this,"fsPromises");this.plugin=e,this.apiAdapter=t}async loadActive(){try{const e=await this.plugin.loadData(Yn);if(e&&Array.isArray(e.tasks))return new Map(e.tasks.map(t=>[t.id,t]))}catch(e){ye("Failed to load active tasks",e)}return new Map}async saveActive(e){await this.write({tasks:Array.from(e.values())})}async write(e){try{await this.saveActiveAtomic(e),ne(`Saved ${e.tasks.length} active tasks`)}catch(t){throw ye("Failed to save active tasks",t),t}}async saveActiveAtomic(e){const t=await this.getFsPromises();if(!t){await this.plugin.saveData(Yn,e);return}const s=this.resolveStoragePath(Yn);if(!s){await this.plugin.saveData(Yn,e);return}const r=po.dirname(s);await t.mkdir(r,{recursive:!0});const a=`${s}${B_}`,i=JSON.stringify(e),l=await t.open(a,"w");try{await l.writeFile(i,"utf8"),await l.sync()}finally{await l.close()}try{await t.rename(a,s)}catch{await t.rm(s,{force:!0}),await t.rename(a,s)}}async getFsPromises(){if(this.fsPromises!==void 0)return this.fsPromises;try{const e=await Promise.resolve().then(()=>q_);return this.fsPromises=e.promises,this.fsPromises}catch(e){return ze("Node.js fs unavailable; falling back to plugin storage without atomic writes.",e),this.fsPromises=null,null}}resolveStoragePath(e){const t=this.apiAdapter.getDataDir(),s=this.plugin.name;return!t||!s?(t||Ua({feature:"Atomic task storage",capability:"dataDir",message:"SiYuan dataDir unavailable; falling back to plugin storage without atomic writes."}),null):po.join(t,"storage",`p${s}`,`${e}.json`)}}const Rc=1,Nc=1e3;class z_{constructor(e){b(this,"plugin");this.plugin=e}async archiveTask(e){await this.archiveTasks([e])}async archiveTasks(e){if(e.length===0)return;const t=await this.loadIndex(),s=this.groupByYear(e);for(const[r,a]of s.entries())await this.appendTasksToYear(t,r,a);await this.saveIndex(t)}async loadArchive(e){const t=await this.loadIndex();if(t.chunks.length===0)return[];const s=this.filterChunks(t.chunks,e),r=[];for(const l of s){const c=await this.loadChunk(l.key);if(c)for(const u of c.tasks)this.matchesQuery(u,e)&&r.push(u)}const a=(e==null?void 0:e.offset)??0,i=(e==null?void 0:e.limit)??r.length;return r.slice(a,a+i)}async loadIndex(){try{const e=await this.plugin.loadData(Fa);if(e&&typeof e=="object"&&Array.isArray(e.chunks))return{version:e.version??Rc,totalCount:e.totalCount??0,chunks:e.chunks}}catch(e){ye("Failed to load archive index",e)}return{version:Rc,totalCount:0,chunks:[]}}async saveIndex(e){try{await this.plugin.saveData(Fa,e)}catch(t){throw ye("Failed to save archive index",t),t}}buildChunkKey(e,t){return`${Fa}-${e}-${t}`}async loadChunk(e){try{const t=await this.plugin.loadData(e);if(t&&Array.isArray(t.tasks))return t}catch(t){ye("Failed to load archive chunk",{key:e,err:t})}return null}async saveChunk(e,t){try{await this.plugin.saveData(e,t)}catch(s){throw ye("Failed to save archive chunk",{key:e,err:s}),s}}groupByYear(e){const t=new Map;for(const s of e){const r=this.getCompletionTimestamp(s),a=new Date(r).getFullYear(),i=t.get(a);i?i.push(s):t.set(a,[s])}return t}async appendTasksToYear(e,t,s){let r=[...s];for(;r.length>0;){const a=this.findOrCreateChunk(e,t),i=await this.loadChunk(a.key)||{tasks:[]},l=Nc-i.tasks.length,c=r.slice(0,l);i.tasks.push(...c),r=r.slice(c.length);const u=this.updateChunkMeta(a,c);a.count=u.count,a.start=u.start,a.end=u.end,await this.saveChunk(a.key,i),e.totalCount+=c.length}}findOrCreateChunk(e,t){const r=e.chunks.filter(l=>l.year===t).sort((l,c)=>l.sequence-c.sequence).at(-1);if(r&&r.count<Nc)return r;const a=r?r.sequence+1:1,i={key:this.buildChunkKey(t,a),year:t,sequence:a,count:0};return e.chunks.push(i),i}updateChunkMeta(e,t){let s=e.start,r=e.end;for(const a of t){const i=this.getCompletionTimestamp(a);(!s||i<s)&&(s=i),(!r||i>r)&&(r=i)}return{...e,count:e.count+t.length,start:s,end:r}}filterChunks(e,t){if(!(t!=null&&t.from)&&!(t!=null&&t.to))return e;const s=t!=null&&t.from?new Date(t.from).getTime():null,r=t!=null&&t.to?new Date(t.to).getTime():null;return e.filter(a=>{const i=a.start?new Date(a.start).getTime():null,l=a.end?new Date(a.end).getTime():null;return!(s&&l&&l<s||r&&i&&i>r)})}matchesQuery(e,t){if(!t)return!0;if(t.taskId&&e.id!==t.taskId)return!1;const s=this.getCompletionTimestamp(e),r=new Date(s).getTime();return!(t.from&&r<new Date(t.from).getTime()||t.to&&r>new Date(t.to).getTime())}getCompletionTimestamp(e){return e.lastCompletedAt||e.updatedAt||e.dueAt}}class $_{constructor(e,t=new Od){b(this,"plugin");b(this,"activeTasks");b(this,"blockIndex",new Map);b(this,"taskBlockIndex",new Map);b(this,"dueIndex",new Map);b(this,"activeStore");b(this,"archiveStore");b(this,"persistence");b(this,"blockAttrSyncEnabled",!0);b(this,"blockApi");b(this,"apiAdapter");b(this,"syncRetryQueue",new Map);b(this,"retryProcessorInterval");this.plugin=e,this.activeTasks=new Map,this.apiAdapter=t,this.blockApi=t,this.activeStore=new U_(e,t),this.archiveStore=new z_(e),this.persistence=new F_(this.activeStore)}async init(){await this.migrateLegacyStorage();const e=await this.activeStore.loadActive(),t=vs.getInstance(),s=new Map;for(const[r,a]of e.entries())t.shouldIncludeTask(a)&&s.set(r,a);this.activeTasks=s,ne(`Loaded ${this.activeTasks.size} active tasks from storage (after global filter)`),this.rebuildBlockIndex(),this.rebuildDueIndex(),this.startSyncRetryProcessor()}async loadActiveTasks(e=1e3,t){const s=await this.activeStore.loadActive(),r=Array.from(s.values()),a=vs.getInstance(),i=r.filter(u=>a.shouldIncludeTask(u)),l=i.length;if(l===0)return[];const c=[];for(let u=0;u<l;u+=e){const d=i.slice(u,Math.min(u+e,l));c.push(...d),t&&t(c.length,l),await new Promise(f=>setTimeout(f,0))}return c}rebuildBlockIndex(){this.blockIndex.clear(),this.taskBlockIndex.clear();for(const e of this.activeTasks.values())e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId));ne(`Rebuilt block index with ${this.blockIndex.size} entries`)}rebuildDueIndex(){this.dueIndex.clear();for(const e of this.activeTasks.values())e.enabled&&this.addToDueIndex(e);ne(`Rebuilt due index with ${this.dueIndex.size} date entries`)}addToDueIndex(e){const t=e.dueAt.slice(0,10);this.dueIndex.has(t)||this.dueIndex.set(t,new Set),this.dueIndex.get(t).add(e.id)}removeFromDueIndex(e){const t=e.dueAt.slice(0,10),s=this.dueIndex.get(t);s&&(s.delete(e.id),s.size===0&&this.dueIndex.delete(t))}getTasksDueOn(e){const t=e.toISOString().slice(0,10);return this.getTasksForDueKey(t)}getTasksDueOnOrBefore(e){const t=e.toISOString().slice(0,10),s=[];for(const[r]of this.dueIndex)r<=t&&s.push(...this.getTasksForDueKey(r));return s}getTasksForDueKey(e){const t=this.dueIndex.get(e);if(!t)return[];const s=[];for(const r of t){const a=this.activeTasks.get(r);if(!a){this.removeStaleDueIndexEntry(e,r,"missing task");continue}if(!a.enabled){this.removeStaleDueIndexEntry(e,r,"task disabled");continue}if(a.dueAt.slice(0,10)!==e){this.removeStaleDueIndexEntry(e,r,"date mismatch");continue}s.push(a)}return s}removeStaleDueIndexEntry(e,t,s){const r=this.dueIndex.get(e);r&&(r.delete(t),r.size===0&&this.dueIndex.delete(e),ze("Removed stale due index entry",{taskId:t,dateKey:e,reason:s}))}async save(){this.persistence.requestSave({tasks:Array.from(this.activeTasks.values())})}async flush(){await this.persistence.flush()}getAllTasks(){return Array.from(this.activeTasks.values())}getTask(e){return this.activeTasks.get(e)}getTaskByBlockId(e){const t=this.blockIndex.get(e);return t?this.activeTasks.get(t):void 0}async saveTask(e){const t=this.activeTasks.get(e.id);if(t&&e.version!==void 0&&t.version!==void 0&&e.version<t.version)throw new Error(`Concurrent modification detected for task "${e.name}". Please refresh and try again.`);e.version=(e.version??0)+1;const s=this.activeTasks.get(e.id),r=this.taskBlockIndex.get(e.id);r&&r!==e.linkedBlockId&&(this.blockIndex.delete(r),this.taskBlockIndex.delete(e.id)),s&&s.enabled&&(s.dueAt!==e.dueAt||!e.enabled)&&this.removeFromDueIndex(s),e.linkedBlockId&&(this.blockIndex.set(e.linkedBlockId,e.id),this.taskBlockIndex.set(e.id,e.linkedBlockId)),e.enabled&&this.addToDueIndex(e),e.updatedAt=new Date().toISOString(),this.activeTasks.set(e.id,e),await this.save(),e.linkedBlockId&&await this.syncTaskToBlockAttrsWithRetry(e),r&&r!==e.linkedBlockId&&await this.clearBlockAttrs(r)}async syncTaskToBlockAttrs(e){e.linkedBlockId&&await this.updateBlockAttrs(e.linkedBlockId,{[ql]:e.id,[Bl]:e.dueAt,[Ul]:e.enabled?"true":"false"})}async clearBlockAttrs(e){await this.updateBlockAttrs(e,{[ql]:"",[Bl]:"",[Ul]:""})}async updateBlockAttrs(e,t){if(this.blockAttrSyncEnabled){if(!this.apiAdapter.supportedCapabilities.setBlockAttrs){Ua({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Block attribute sync unavailable in current SiYuan version. Tasks will continue to function without block sync."}),this.blockAttrSyncEnabled=!1;return}try{await this.blockApi.setBlockAttrs(e,t)}catch(s){s instanceof Id||s instanceof Md?Ua({feature:s.feature,capability:s.capability,message:s.message,cause:s.cause}):Ua({feature:"Block attribute sync",capability:"setBlockAttrs",message:"Unexpected error while syncing block attributes. Block sync disabled to keep tasks stable.",cause:s}),this.blockAttrSyncEnabled=!1}}}async deleteTask(e){const t=this.activeTasks.get(e);t!=null&&t.linkedBlockId&&(this.blockIndex.delete(t.linkedBlockId),await this.clearBlockAttrs(t.linkedBlockId)),this.taskBlockIndex.delete(e),t&&this.removeFromDueIndex(t),this.activeTasks.delete(e),await this.save()}getEnabledTasks(){return this.getAllTasks().filter(e=>e.enabled)}getTodayAndOverdueTasks(){const e=new Date,t=new Date(e);return t.setHours(23,59,59,999),this.getEnabledTasks().filter(s=>new Date(s.dueAt)<=t)}getTasksInRange(e,t){return this.getEnabledTasks().filter(s=>{const r=new Date(s.dueAt);return r>=e&&r<=t})}async clearAll(){this.activeTasks.clear(),await this.save()}async loadActive(){return this.activeStore.loadActive()}async saveActive(e){this.persistence.requestSave({tasks:Array.from(e.values())})}async archiveTask(e){await this.archiveStore.archiveTask(e)}async loadArchive(e){return this.archiveStore.loadArchive(e)}async migrateLegacyStorage(){const e=await this.plugin.loadData(Yn);if(e&&Array.isArray(e.tasks))return;const t=await this.plugin.loadData(Al);if(!t)return;const s=Array.isArray(t.tasks)?t.tasks:Array.isArray(t)?t:[];if(s.length===0)return;await this.plugin.saveData(Cl,t),ne(`Created legacy backup at ${Cl}`);const r=s.filter(l=>!l.enabled&&l.lastCompletedAt),a=s.filter(l=>!r.includes(l)),i=new Map(a.map(l=>[l.id,l]));this.persistence.requestSave({tasks:Array.from(i.values())}),await this.persistence.flush(),r.length>0&&await this.archiveStore.archiveTasks(r),ne("Legacy storage migration complete",{activeCount:a.length,archivedCount:r.length,legacyKey:Al,activeKey:Yn,archiveIndexKey:Fa})}async syncTaskToBlockAttrsWithRetry(e){try{await this.syncTaskToBlockAttrs(e),this.syncRetryQueue.delete(e.id)}catch(t){const s=this.syncRetryQueue.get(e.id)||{task:e,attempts:0,nextRetry:Date.now()};s.attempts<Ca?(s.attempts++,s.nextRetry=Date.now()+zl[s.attempts-1],s.task=e,this.syncRetryQueue.set(e.id,s),ze(`Block sync failed for task ${e.id}, added to retry queue`,{taskId:e.id,attempts:s.attempts,nextRetry:new Date(s.nextRetry).toISOString(),error:t instanceof Error?t.message:String(t)})):(ye(`Block sync failed for task ${e.id} after ${Ca} attempts`,{taskId:e.id,error:t instanceof Error?t.message:String(t)}),this.syncRetryQueue.delete(e.id))}}startSyncRetryProcessor(){this.retryProcessorInterval&&clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=setInterval(async()=>{const e=Date.now(),t=[];for(const[s,r]of this.syncRetryQueue.entries())r.nextRetry<=e&&t.push({id:s,entry:r});for(const{id:s,entry:r}of t)try{await this.syncTaskToBlockAttrs(r.task),this.syncRetryQueue.delete(s),ne(`Block sync retry succeeded for task ${s}`,{taskId:s,attempts:r.attempts})}catch(a){r.attempts<Ca?(r.attempts++,r.nextRetry=Date.now()+zl[r.attempts-1],this.syncRetryQueue.set(s,r),ze(`Block sync retry failed for task ${s}`,{taskId:s,attempts:r.attempts,nextRetry:new Date(r.nextRetry).toISOString(),error:a instanceof Error?a.message:String(a)})):(ye(`Block sync retry exhausted for task ${s} after ${Ca} attempts`,{taskId:s,error:a instanceof Error?a.message:String(a)}),this.syncRetryQueue.delete(s))}},Nv)}stopSyncRetryProcessor(){this.retryProcessorInterval&&(clearInterval(this.retryProcessorInterval),this.retryProcessorInterval=void 0)}}class Y_{constructor(e){this.storage=e}getAllTasks(){return this.storage.getAllTasks()}getTask(e){return this.storage.getTask(e)}getTaskByBlockId(e){return this.storage.getTaskByBlockId(e)}getEnabledTasks(){return this.storage.getEnabledTasks()}getTasksDueOnOrBefore(e){return this.storage.getTasksDueOnOrBefore(e)}getTodayAndOverdueTasks(){return this.storage.getTodayAndOverdueTasks()}getTasksInRange(e,t){return this.storage.getTasksInRange(e,t)}async saveTask(e){await this.storage.saveTask(e)}async deleteTask(e){await this.storage.deleteTask(e)}async archiveTask(e){await this.storage.archiveTask(e)}async loadArchive(e){return this.storage.loadArchive(e)}async flush(){await this.storage.flush()}}class W_{normalizeInterval(e){return!Number.isFinite(e)||e<1?1:Math.floor(e)}normalizeWeekdays(e){if(!Array.isArray(e))return[];const t=new Set;for(const s of e)Number.isFinite(s)&&s>=0&&s<=6&&t.add(Math.floor(s));return Array.from(t).sort((s,r)=>s-r)}normalizeDayOfMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,1),31)}normalizeMonth(e,t){const s=Number.isFinite(e)?Math.floor(e):t;return Math.min(Math.max(s,0),11)}calculateNext(e,t,s){if(s!=null&&s.timezone||Cd(),t.rruleString)return this.calculateNextWithRRule(e,t,s);const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,{type:i,time:l}=t,c=this.normalizeInterval(t.interval);let u;switch(i){case"daily":u=this.calculateNextDaily(a,c);break;case"weekly":u=this.calculateNextWeekly(a,c,this.normalizeWeekdays(t.weekdays));break;case"monthly":u=this.calculateNextMonthly(a,c,this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;case"yearly":u=this.calculateNextYearly(a,c,this.normalizeMonth(t.month,a.getMonth()),this.normalizeDayOfMonth(t.dayOfMonth,a.getDate()));break;default:throw new Error(`Unknown frequency type: ${i}`)}if(l){const{hours:d,minutes:f}=to(l);if(Number.isFinite(d)&&Number.isFinite(f)){const{date:g,shifted:y}=jl(u,d,f);y&&ze("DST shift detected while applying recurrence time",{requestedTime:l,original:u.toISOString(),adjusted:g.toISOString()}),u=g}}return u}calculateNextWithRRule(e,t,s){try{const a=((s==null?void 0:s.whenDone)??t.whenDone??!1)&&(s!=null&&s.completionDate)?s.completionDate:e,l=go(t.rruleString).after(a,!1);if(!l){ze("RRule returned no next occurrence, falling back to legacy logic",{rruleString:t.rruleString,baseDate:a.toISOString()});const{rruleString:u,naturalLanguage:d,...f}=t;return this.calculateNext(a,f,s)}let c=l;if(t.time){const{hours:u,minutes:d}=to(t.time);if(Number.isFinite(u)&&Number.isFinite(d)){const{date:f,shifted:g}=jl(c,u,d);g&&ze("DST shift detected while applying recurrence time",{requestedTime:t.time,original:c.toISOString(),adjusted:f.toISOString()}),c=f}}return c}catch(r){ye("Failed to parse rrule, falling back to legacy logic",{error:r instanceof Error?r.message:String(r),rruleString:t.rruleString});const{rruleString:a,naturalLanguage:i,...l}=t;return this.calculateNext(e,l,s)}}calculateNextDaily(e,t){return Mn(e,t)}calculateNextWeekly(e,t,s){if(!s||s.length===0)return Wl(e,t);const r=this.getMondayIndex(e),a=Math.min(Ei,t*14);for(let i=1;i<=a;i++){if(Math.floor((r+i)/7)%t!==0)continue;const c=Mn(e,i),u=this.getMondayIndex(c);if(s.includes(u))return c}return ze("Weekly recurrence guard hit, falling back to interval weeks.",{currentDue:e.toISOString(),interval:t,weekdays:s}),Wl(e,t)}getMondayIndex(e){return(e.getDay()+6)%7}calculateNextMonthly(e,t,s){const r=s??e.getDate(),a=e.getFullYear(),l=e.getMonth()+t,c=a+Math.floor(l/12),u=(l%12+12)%12,d=new Date(c,u+1,0).getDate(),f=Math.min(r,d),g=new Date(e);return g.setFullYear(c,u,f),g}calculateNextYearly(e,t,s,r){const a=r??e.getDate(),i=e.getFullYear()+t,l=new Date(i,s+1,0).getDate(),c=Math.min(a,l),u=new Date(e);return u.setFullYear(i,s,c),u}getOccurrencesInRange(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=t&&l<Ei;)i>=e&&a.push(new Date(i)),i=this.calculateNext(i,s),l++;return a}getMissedOccurrences(e,t,s,r){const a=[];let i=new Date(r),l=0;for(;i<=e&&l<Ei;)i=this.calculateNext(i,s),l++;let c=0;for(;i<t&&c<qa;)a.push(new Date(i)),i=this.calculateNext(i,s),c++;return c>=qa&&ze("Recovery iteration cap hit while computing missed occurrences",{lastCheckedAt:e.toISOString(),now:t.toISOString(),frequency:s,firstOccurrence:r.toISOString(),cap:qa}),a}}class j_{getTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}toLocal(e){return new Date(e)}createLocalDateTime(e,t){const{hours:s,minutes:r}=to(t);if(!Number.isFinite(s)||!Number.isFinite(r))return new Date(e);const a=new Date(e);return a.setHours(s,r,0,0),a}isSameLocalDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}startOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(0,0,0,0),t}endOfLocalDay(e){const t=e?new Date(e):new Date;return t.setHours(23,59,59,999),t}formatLocal(e){return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatLocalTime(e){return e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}formatLocalDate(e){return e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(e){const t=new Date,s=e.getTime()-t.getTime(),r=Math.trunc(s/(1e3*60)),a=Math.trunc(s/(1e3*60*60)),i=Math.trunc(s/(1e3*60*60*24));return Math.abs(s)<1e3*60?"now":Math.abs(r)<60?r>0?`in ${r}m`:`${-r}m ago`:Math.abs(a)<24?a>0?`in ${a}h`:`${-a}h ago`:i>0?`in ${i}d`:`${-i}d ago`}isToday(e){return this.isSameLocalDay(e,new Date)}isPast(e){return e<new Date}isOverdue(e){return this.isPast(e)&&!this.isToday(e)}addDays(e,t){const s=new Date(e);return s.setDate(s.getDate()+t),s}tomorrow(){return this.addDays(new Date,1)}nextWeek(){return this.addDays(new Date,7)}}class H_{constructor(e){b(this,"siyuanApi");this.siyuanApi=e}async execute(e,t){try{if(t==="keep")return ne(`Task "${e.name}" completed and kept`,{taskId:e.id}),{success:!0};if(t==="delete"){if(!e.linkedBlockId)return ze(`Task "${e.name}" has no linkedBlockId, cannot delete from document`,{taskId:e.id}),{success:!0,warnings:["Task has no linked block, removed from task list only"]};if(await this.hasNestedItems(e.linkedBlockId))return ze("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),{success:!1,error:"Cannot delete task with nested items",warnings:['Task has sub-items. Please remove them first or use "keep" mode.']};if(this.siyuanApi&&this.siyuanApi.deleteBlock)await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),ne(`Task "${e.name}" completed and deleted from document`,{taskId:e.id,blockId:e.linkedBlockId});else return ze("SiYuan API not available, cannot delete block from document"),{success:!0,warnings:["Block could not be deleted from document (API unavailable)"]};return{success:!0}}return{success:!1,error:`Unknown onCompletion action: ${t}`}}catch(s){return ye("Failed to execute onCompletion action",{taskId:e.id,action:t,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}async hasNestedItems(e){if(!this.siyuanApi||!this.siyuanApi.getChildBlocks)return ze("SiYuan API not available for nested item check"),!0;try{const t=await this.siyuanApi.getChildBlocks({id:e});return t&&t.length>0}catch(t){return ye("Failed to check for nested items",{blockId:e,error:t}),!0}}}class G_{constructor(e,t){b(this,"intervalMs");b(this,"timeoutId",null);b(this,"isRunning",!1);this.onTick=t,this.intervalMs=e}start(){this.isRunning||(this.isRunning=!0,this.scheduleNextTick())}stop(){this.timeoutId!==null&&(globalThis.clearTimeout(this.timeoutId),this.timeoutId=null),this.isRunning=!1}setInterval(e){this.intervalMs=e}isActive(){return this.isRunning}scheduleNextTick(){if(!this.isRunning)return;const e=Date.now(),t=this.intervalMs>0?this.intervalMs:zo,s=t-e%t;this.timeoutId=globalThis.setTimeout(()=>{this.onTick(),this.scheduleNextTick()},s)}}class K_{constructor(e,t=zo,s){b(this,"storage");b(this,"recurrenceEngine");b(this,"onCompletionHandler");b(this,"emittedDue",new Set);b(this,"emittedMissed",new Set);b(this,"timezoneHandler");b(this,"isChecking",!1);b(this,"lastCheckStartTime",0);b(this,"plugin",null);b(this,"listeners",{"task:due":new Set,"task:overdue":new Set});b(this,"MAX_EMITTED_ENTRIES",1e3);b(this,"EMITTED_RETENTION_DAYS",30);b(this,"EMITTED_SAVE_DEBOUNCE_MS",1500);b(this,"persistTimeoutId",null);b(this,"emittedStateReady",null);b(this,"timer");this.storage=e,this.recurrenceEngine=new W_,this.onCompletionHandler=new H_(s),this.timezoneHandler=new j_,this.plugin=s||null,this.timer=new G_(t,()=>{this.checkDueTasks()})}on(e,t){return this.listeners[e].add(t),()=>this.listeners[e].delete(t)}start(){this.ensureEmittedStateLoaded().finally(()=>{this.checkDueTasks(),this.timer.start(),ne("Scheduler started")})}stop(){this.timer.stop(),this.persistEmittedState(),ne("Scheduler stopped")}runOnce(){this.checkDueTasks()}isActive(e){return e.enabled===!0}checkDueTasks(){if(this.isChecking)if(Date.now()-(this.lastCheckStartTime||0)>3e4)ze("Scheduler check timeout detected, forcing reset"),this.isChecking=!1;else return;this.isChecking=!0,this.lastCheckStartTime=Date.now();const e=new Date,t=this.storage.getTasksDueOnOrBefore(e);try{for(const s of t){if(!this.isActive(s))continue;const r=new Date(s.dueAt),a=r<=e;if(a){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedDue.has(l)||(this.emitEvent("task:due",{taskId:s.id,dueAt:r,context:"today",task:s}),this.registerEmittedKey("due",l),ne(`Task due: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}const i=s.lastCompletedAt?new Date(s.lastCompletedAt):null;if(a&&e.getTime()-r.getTime()>=Cv&&(!i||i<r)){const l=this.buildOccurrenceKey(s.id,r,"hour");this.emittedMissed.has(l)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:r,context:"overdue",task:s}),this.registerEmittedKey("missed",l),ze(`Task missed: ${s.name}`,{taskId:s.id,dueAt:s.dueAt}))}}this.cleanupEmittedSets()}finally{this.isChecking=!1}}cleanupEmittedSets(){const e=new Date;e.setDate(e.getDate()-this.EMITTED_RETENTION_DAYS);const t=this.pruneEmittedSet("due",this.emittedDue,e),s=this.pruneEmittedSet("missed",this.emittedMissed,e);this.emittedDue=t.set,this.emittedMissed=s.set,(t.didTrim||s.didTrim)&&this.schedulePersistEmittedState()}pruneEmittedSet(e,t,s){const r=s.getTime(),a=Array.from(t).map(u=>({entry:u,time:this.parseOccurrenceKeyTimestamp(u)}));let i=a.filter(({time:u})=>u===null||u>=r),l=i.length!==a.length;i.length>this.MAX_EMITTED_ENTRIES&&(i=i.sort((u,d)=>(u.time??0)-(d.time??0)).slice(-this.MAX_EMITTED_ENTRIES),l=!0);const c=new Set(i.map(({entry:u})=>u));return l&&ne(`Cleaned up emitted${e==="due"?"Due":"Missed"} set: ${t.size} -> ${c.size}`),{set:c,didTrim:l}}parseOccurrenceKeyTimestamp(e){const t=e.indexOf(":");if(t===-1)return null;const s=e.slice(t+1);if(!s)return null;const r=s.length===13?`${s}:00:00.000Z`:s,a=new Date(r);return Number.isNaN(a.getTime())?null:a.getTime()}async markTaskDone(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);const s=new Date;t.doneAt=s.toISOString(),Uv(t);const r=JSON.parse(JSON.stringify(t));await this.storage.archiveTask(r);const a=t.onCompletion||"keep",i=await this.onCompletionHandler.execute(t,a);if(i.success||ye(`OnCompletion action failed for task "${t.name}"`,{taskId:t.id,action:a,error:i.error}),i.warnings)for(const u of i.warnings)ze(u,{taskId:t.id});const l=new Date(t.dueAt),c=this.recurrenceEngine.calculateNext(l,t.frequency,{completionDate:s,whenDone:t.whenDone});t.dueAt=c.toISOString(),t.doneAt=void 0,await this.storage.saveTask(t),ne(`Task "${t.name}" completed and rescheduled to ${c.toISOString()}`)}async delayTask(e,t){const s=this.storage.getTask(e);if(!s)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(s);const r=new Date(s.dueAt),a=new Date(r.getTime()+t*60*1e3);s.dueAt=a.toISOString(),s.snoozeCount=(s.snoozeCount||0)+1,await this.storage.saveTask(s),ne(`Task "${s.name}" delayed by ${t} minutes to ${a.toISOString()}`)}async delayToTomorrow(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);this.assertSnoozeAvailable(t);const s=new Date(t.dueAt),r=this.timezoneHandler.tomorrow();r.setHours(s.getHours(),s.getMinutes(),0,0),t.dueAt=r.toISOString(),t.snoozeCount=(t.snoozeCount||0)+1,await this.storage.saveTask(t),ne(`Task "${t.name}" delayed to tomorrow: ${r.toISOString()}`)}async skipOccurrence(e){const t=this.storage.getTask(e);if(!t)throw new Error(`Task not found: ${e}`);sd(t);const s=new Date(t.dueAt),r=this.recurrenceEngine.calculateNext(s,t.frequency);t.dueAt=r.toISOString(),await this.storage.saveTask(t),ne(`Task "${t.name}" skipped to ${r.toISOString()}`)}async delayTaskToTomorrow(e){return this.delayToTomorrow(e)}async skipTaskOccurrence(e){return this.skipOccurrence(e)}async recoverMissedTasks(){await this.ensureEmittedStateLoaded();const e=await this.loadLastRunTimestamp(),t=new Date;if(!e){await this.saveLastRunTimestamp(t),ne("First run detected, no recovery needed");return}ne(`Recovering missed tasks since ${e.toISOString()}`);for(const s of this.storage.getEnabledTasks())try{const r=this.recurrenceEngine.getMissedOccurrences(e,t,s.frequency,new Date(s.createdAt));for(const a of r){const i=this.buildOccurrenceKey(s.id,a,"exact");this.emittedMissed.has(i)||(this.emitEvent("task:overdue",{taskId:s.id,dueAt:a,context:"overdue",task:s}),this.registerEmittedKey("missed",i))}await this.advanceToNextFutureOccurrence(s,t)}catch(r){ye(`Failed to recover task ${s.id}:`,r)}await this.saveLastRunTimestamp(t),this.cleanupEmittedSets(),ne("Missed task recovery completed")}async advanceToNextFutureOccurrence(e,t){const s=new Date(e.dueAt);if(s>=t)return;let r=s,a=0;for(;r<t&&a<qa;)r=this.recurrenceEngine.calculateNext(r,e.frequency),a++;r>s&&(e.dueAt=r.toISOString(),await this.storage.saveTask(e),ne(`Advanced task "${e.name}" to ${r.toISOString()}`))}async loadLastRunTimestamp(){if(!this.plugin)return null;try{const e=await this.plugin.loadData(Fl);if(e&&e.timestamp)return new Date(e.timestamp)}catch(e){ye("Failed to load last run timestamp:",e)}return null}async saveLastRunTimestamp(e){if(this.plugin)try{await this.plugin.saveData(Fl,{timestamp:e.toISOString()})}catch(t){ye("Failed to save last run timestamp:",t)}}getRecurrenceEngine(){return this.recurrenceEngine}getTimezoneHandler(){return this.timezoneHandler}emitEvent(e,t){const s=this.listeners[e];for(const r of s)try{const a=r(t);a instanceof Promise&&a.catch(i=>{ye(`Scheduler listener error for ${e}:`,i)})}catch(a){ye(`Scheduler listener error for ${e}:`,a)}}assertSnoozeAvailable(e){const t=e.maxSnoozes??Iv,s=e.snoozeCount??0;if(t<=0)throw new Error("Snoozing is disabled for this task.");if(s>=t)throw new Error(`Snooze limit reached (${t}).`)}registerEmittedKey(e,t){e==="due"?this.emittedDue.add(t):this.emittedMissed.add(t),this.schedulePersistEmittedState()}ensureEmittedStateLoaded(){return this.emittedStateReady||(this.emittedStateReady=this.restoreEmittedState()),this.emittedStateReady}async restoreEmittedState(){if(this.plugin)try{const e=await this.plugin.loadData(Ol),t=Array.isArray(e==null?void 0:e.due)?e.due.filter(r=>typeof r=="string"):[],s=Array.isArray(e==null?void 0:e.missed)?e.missed.filter(r=>typeof r=="string"):[];this.emittedDue=new Set(t.slice(-this.MAX_EMITTED_ENTRIES)),this.emittedMissed=new Set(s.slice(-this.MAX_EMITTED_ENTRIES)),ne("Restored scheduler emitted state",{due:this.emittedDue.size,missed:this.emittedMissed.size})}catch(e){ye("Failed to restore scheduler emitted state:",e)}}schedulePersistEmittedState(){this.plugin&&this.persistTimeoutId===null&&(this.persistTimeoutId=globalThis.setTimeout(()=>{this.persistTimeoutId=null,this.persistEmittedState()},this.EMITTED_SAVE_DEBOUNCE_MS))}async persistEmittedState(){if(this.plugin)try{await this.plugin.saveData(Ol,{due:Array.from(this.emittedDue),missed:Array.from(this.emittedMissed)})}catch(e){ye("Failed to persist scheduler emitted state:",e)}}buildOccurrenceKey(e,t,s){return s==="exact"?`${e}:${t.toISOString()}`:`${e}:${t.toISOString().slice(0,13)}`}}const V_=7,Q_=2e3;class X_{constructor(e,t){b(this,"plugin");b(this,"storageKey");b(this,"notifications",new Map);b(this,"escalations",new Map);b(this,"lastCleanup",new Date);b(this,"isDirty",!1);this.plugin=e,this.storageKey=t}async load(){try{const e=await this.plugin.loadData(this.storageKey);if(e){const t=e;if(Array.isArray(t.notifications))for(const s of t.notifications)this.notifications.set(s.taskKey,s);if(Array.isArray(t.escalations))for(const s of t.escalations)this.escalations.set(s.taskId,s);t.lastCleanup&&(this.lastCleanup=new Date(t.lastCleanup)),ne(`Loaded notification state: ${this.notifications.size} notifications, ${this.escalations.size} escalations`),this.cleanupOldEntries()}}catch(e){ye("Failed to load notification state",e),this.notifications.clear(),this.escalations.clear()}}async save(){if(this.isDirty)try{const e={notifications:Array.from(this.notifications.values()),escalations:Array.from(this.escalations.values()),lastCleanup:this.lastCleanup.toISOString()};await this.plugin.saveData(this.storageKey,e),this.isDirty=!1,ea("Saved notification state")}catch(e){ye("Failed to save notification state",e)}}async forceSave(){this.isDirty=!0,await this.save()}hasNotified(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="due"}markNotified(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"due"}),this.isDirty=!0,this.notifications.size>Q_&&Array.from(this.notifications.keys()).slice(0,100).forEach(s=>this.notifications.delete(s))}hasMissed(e){const t=this.notifications.get(e);return t!==void 0&&t.type==="missed"}markMissed(e){this.notifications.set(e,{taskKey:e,notifiedAt:new Date().toISOString(),type:"missed"}),this.isDirty=!0}getEscalationLevel(e){const t=this.escalations.get(e);return(t==null?void 0:t.level)||0}incrementEscalation(e){const s=this.getEscalationLevel(e)+1;return this.escalations.set(e,{taskId:e,level:s,lastEscalatedAt:new Date().toISOString()}),this.isDirty=!0,s}resetEscalation(e){this.escalations.delete(e),this.isDirty=!0}generateTaskKey(e,t){const s=new Date(t);return`${e}:${s.toISOString().slice(0,13)}`}cleanupOldEntries(){const e=new Date;if((e.getTime()-this.lastCleanup.getTime())/(1e3*60*60*24)<1)return;const s=new Date(e.getTime()-V_*24*60*60*1e3);let r=0;for(const[a,i]of this.notifications.entries())new Date(i.notifiedAt)<s&&(this.notifications.delete(a),r++);r>0&&(ne(`Cleaned up ${r} old notification records`),this.isDirty=!0),this.lastCleanup=e}}function Z_(n){return{id:n.id,name:n.name,dueAt:n.dueAt,frequency:n.frequency,linkedBlockId:n.linkedBlockId,linkedBlockContent:n.linkedBlockContent,priority:n.priority,tags:n.tags,notificationChannels:n.notificationChannels,completionCount:n.completionCount,missCount:n.missCount,currentStreak:n.currentStreak,bestStreak:n.bestStreak}}const J_=30*1e3,ew=30*60*1e3,qn=500;class tw{constructor(e,t={}){b(this,"plugin");b(this,"config");b(this,"queue",[]);b(this,"dedupeKeys",new Set);b(this,"flushIntervalId",null);b(this,"fetcher");b(this,"notificationState");b(this,"schedulerUnsubscribe",[]);this.plugin=e,this.fetcher=t.fetcher??fetch,this.config={...eo},this.notificationState=t.notificationState??new X_(this.plugin,Dv)}async init(){await this.notificationState.load(),await this.loadConfig(),await this.loadQueue(),await this.flushQueueOnStartup(),this.startQueueWorker()}async flushQueueOnStartup(){this.queue.length>0&&(console.log(`Found ${this.queue.length} pending events from previous session`),await this.flushQueue())}async loadConfig(){try{const e=await this.plugin.loadData(Il);e&&(this.config={...eo,...e})}catch(e){console.error("Failed to load event config:",e)}}async saveConfig(e){this.config=e,await this.plugin.saveData(Il,e)}async loadQueue(){try{const e=await this.plugin.loadData(Ml);if(e){this.queue=Array.isArray(e.queue)?e.queue:[];const t=Array.isArray(e.dedupeKeys)?e.dedupeKeys:[];if(this.dedupeKeys=new Set(t),this.queue.length>qn){const s=this.queue.length-qn;this.queue=this.queue.slice(-qn),console.warn(`Event queue trimmed to ${qn} entries (dropped ${s}).`)}}}catch(e){console.error("Failed to load event queue:",e),this.queue=[],this.dedupeKeys=new Set}}async persistQueue(){const e=Array.from(this.dedupeKeys).slice(-Di);await this.plugin.saveData(Ml,{queue:this.queue,dedupeKeys:e})}startQueueWorker(){this.flushIntervalId===null&&(this.flushQueue(),this.flushIntervalId=globalThis.setInterval(()=>{this.flushQueue()},Av))}stopQueueWorker(){this.flushIntervalId!==null&&(globalThis.clearInterval(this.flushIntervalId),this.flushIntervalId=null)}async shutdown(){this.stopQueueWorker(),await this.notificationState.forceSave()}bindScheduler(e){this.unbindScheduler(),this.schedulerUnsubscribe=[e.on("task:due",t=>{this.handleTaskDue(t)}),e.on("task:overdue",t=>{this.handleTaskOverdue(t)})]}unbindScheduler(){this.schedulerUnsubscribe.forEach(e=>e()),this.schedulerUnsubscribe=[]}async handleTaskCompleted(e){await this.emitTaskEvent("task.completed",e,0),this.notificationState.resetEscalation(e.id),await this.notificationState.save()}async handleTaskSnoozed(e){await this.emitTaskEvent("task.snoozed",e,0)}async handleTaskDue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasNotified(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.due",e.task,s),this.notificationState.markNotified(t),this.notificationState.save()}async handleTaskOverdue(e){const t=this.notificationState.generateTaskKey(e.taskId,e.dueAt.toISOString());if(this.notificationState.hasMissed(t))return;const s=this.notificationState.getEscalationLevel(e.taskId);await this.emitTaskEvent("task.missed",e.task,s),this.notificationState.markMissed(t),this.notificationState.incrementEscalation(e.taskId),this.notificationState.save()}async emitTaskEvent(e,t,s=0){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const r=this.buildDedupeKey(e,t);if(this.isDuplicate(r))return;const a=this.buildPayload(e,t,r,1,s);await this.sendPayload(a)?(this.markDelivered(r),await this.persistQueue()):this.enqueue(a)}async testConnection(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return{success:!1,message:"n8n webhook not configured"};try{const e=`test.ping:${new Date().toISOString()}`,t={event:"test.ping",source:Rl,version:Nl,occurredAt:new Date().toISOString(),delivery:{dedupeKey:e,attempt:1}},s=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:await this.buildHeaders(t),body:JSON.stringify(t)});return s.ok?{success:!0,message:"Connection successful"}:{success:!1,message:`HTTP ${s.status}: ${s.statusText}`}}catch(e){return{success:!1,message:`Connection failed: ${e.message}`}}}async flushQueue(){if(!this.config.n8n.enabled||!this.config.n8n.webhookUrl)return;const e=Date.now();let t=!1;const s=[];for(const r of this.queue){if(new Date(r.nextAttemptAt).getTime()>e){s.push(r);continue}const a={...r.payload,delivery:{...r.payload.delivery,attempt:r.attempt}};if(await this.sendPayload(a))this.markDelivered(a.delivery.dedupeKey),t=!0;else{const l=r.attempt+1,c=this.getRetryDelay(l);s.push({...r,attempt:l,nextAttemptAt:new Date(e+c).toISOString()}),t=!0}}t&&(this.queue=s,await this.persistQueue())}getConfig(){return{...this.config}}buildPayload(e,t,s,r,a=0){const i=new Date,l=new Date(t.dueAt),c=i.getTime()-l.getTime();return{event:e,source:Rl,version:Nl,occurredAt:i.toISOString(),task:Z_(t),context:{timezone:t.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,delayMs:c>0?c:void 0,previousDueAt:t.lastCompletedAt,nextDueAt:void 0},routing:{escalationLevel:a,channels:t.notificationChannels||[]},delivery:{dedupeKey:s,attempt:r}}}buildDedupeKey(e,t){const s=new Date(t.dueAt).toISOString().slice(0,16);return`${e}:${t.id}:${s}`}isDuplicate(e){return this.dedupeKeys.has(e)?!0:this.queue.some(t=>t.payload.delivery.dedupeKey===e)}markDelivered(e){if(this.dedupeKeys.add(e),this.dedupeKeys.size>Di){const t=Array.from(this.dedupeKeys).slice(-Di);this.dedupeKeys=new Set(t)}}enqueue(e){const t=Date.now();if(this.queue.length>=qn){const s=this.queue.length-qn+1;this.queue.splice(0,s),console.warn(`Event queue capped at ${qn}. Dropped ${s} oldest entr${s===1?"y":"ies"}.`)}this.queue.push({id:`${e.delivery.dedupeKey}:${e.delivery.attempt}`,payload:e,attempt:e.delivery.attempt,nextAttemptAt:new Date(t+this.getRetryDelay(e.delivery.attempt)).toISOString()}),this.persistQueue()}getRetryDelay(e){const t=J_*Math.pow(2,e-1);return Math.min(t,ew)}async generateSignature(e,t){try{if(typeof crypto<"u"&&crypto.subtle){const s=new TextEncoder,r=s.encode(t),a=s.encode(e),i=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",i,a);return Array.from(new Uint8Array(l)).map(u=>u.toString(16).padStart(2,"0")).join("")}return console.warn("Web Crypto API not available - signature generation disabled"),""}catch(s){return console.error("Failed to generate signature:",s),""}}async buildHeaders(e){const t=JSON.stringify(e),s=new Date().toISOString();let r="";this.config.n8n.sharedSecret&&(r=await this.generateSignature(t+s,this.config.n8n.sharedSecret));const a={"Content-Type":"application/json","X-Shehab-Event":e.event,"X-Shehab-Timestamp":s};return r&&(a["X-Shehab-Signature"]=r),this.config.n8n.sharedSecret&&(a["X-Shehab-Note-Secret"]=this.config.n8n.sharedSecret),a}async sendPayload(e,t=!1){try{const s=JSON.stringify(e),r=await this.buildHeaders(e),a=await this.fetcher(this.config.n8n.webhookUrl,{method:"POST",headers:r,body:s});if(!a.ok)return console.error("n8n webhook failed:",a.statusText),!1;if(t){const i=await a.json().catch(()=>null);return!!(i&&i.ok)}return!0}catch(s){return console.error("Failed to send n8n event:",s),!1}}}const Et={dates:{autoAddCreated:!1,autoAddDone:!0,autoAddCancelled:!0},recurrence:{newTaskPosition:"below",removeScheduledOnRecurrence:!1,preserveOriginalTime:!0},dependencies:{warnOnCycles:!0,autoValidate:!0},filenameDate:{enabled:!1,patterns:["YYYY-MM-DD","YYYYMMDD"],folders:["daily/","journal/"],targetField:"scheduled"},globalFilter:na,globalQuery:yd,urgency:$o,smartRecurrence:{enabled:!0,autoAdjust:!1,minCompletionsForLearning:10,confidenceThreshold:.7},naturalLanguage:{enabled:!0,showConfidenceScore:!0,provideExamples:!0},crossNoteDependencies:{enabled:!0,checkInterval:5,notifyWhenMet:!0},smartSuggestions:{enabled:!0,minConfidence:.65,showDismissed:!1,autoApplyHighConfidence:!1},predictiveScheduling:{enabled:!0,showHeatmap:!0,minDataPoints:5,workingHours:{start:6,end:22},preferredDays:[1,2,3,4,5]},keyboardNavigation:{enabled:!1,useVimKeybindings:!0,customKeybindings:{},showModeIndicator:!0,showQuickHints:!0,enableCommandPalette:!0},inlineTasks:{enableInlineCreation:!0,autoCreateOnEnter:!1,autoCreateOnBlur:!1,normalizeOnSave:!0,strictParsing:!1,showInlineHints:!0,highlightManagedTasks:!0,enableInlineToggle:!0,updateBlockOnToggle:!0,showToggleNotifications:!1}};function Pc(n){var e,t,s,r;if(n.globalFilter&&!n.globalFilter.profiles){const a=n.globalFilter,i={id:"migrated-default",name:"Migrated Settings",description:"Automatically migrated from previous version",includePaths:[],excludePaths:[...a.excludeFolders||[],...a.excludeFilePatterns||[]],includeTags:[],excludeTags:a.excludeTags||[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:a.excludeStatusTypes||[]};n.globalFilter={enabled:a.enabled??!1,mode:a.mode??"all",activeProfileId:"migrated-default",profiles:[i]}}return{dates:{...Et.dates,...n.dates},recurrence:{...Et.recurrence,...n.recurrence},dependencies:{...Et.dependencies,...n.dependencies},filenameDate:{...Et.filenameDate,...n.filenameDate},globalFilter:{...Et.globalFilter,...n.globalFilter,profiles:((e=n.globalFilter)==null?void 0:e.profiles)??Et.globalFilter.profiles},globalQuery:{...Et.globalQuery,...n.globalQuery},urgency:{...Et.urgency,...n.urgency},smartRecurrence:{...Et.smartRecurrence,...n.smartRecurrence},naturalLanguage:{...Et.naturalLanguage,...n.naturalLanguage},crossNoteDependencies:{...Et.crossNoteDependencies,...n.crossNoteDependencies},smartSuggestions:{...Et.smartSuggestions,...n.smartSuggestions},predictiveScheduling:{...Et.predictiveScheduling,...n.predictiveScheduling,preferredDays:((t=n.predictiveScheduling)==null?void 0:t.preferredDays)??Et.predictiveScheduling.preferredDays,workingHours:((s=n.predictiveScheduling)==null?void 0:s.workingHours)??Et.predictiveScheduling.workingHours},keyboardNavigation:{...Et.keyboardNavigation,...n.keyboardNavigation,customKeybindings:((r=n.keyboardNavigation)==null?void 0:r.customKeybindings)??Et.keyboardNavigation.customKeybindings},inlineTasks:{...Et.inlineTasks,...n.inlineTasks}}}const Fi="plugin-settings";class sw{constructor(e){b(this,"plugin");b(this,"settings");this.plugin=e,this.settings=Et}async load(){try{const e=await this.plugin.loadData(Fi);e&&typeof e=="object"&&(this.settings=Pc(e))}catch(e){console.error("Failed to load plugin settings:",e)}}async save(e){this.settings=e,await this.plugin.saveData(Fi,e),We.emit("task:refresh",void 0)}get(){return this.settings}async update(e){this.settings=Pc(e),await this.plugin.saveData(Fi,this.settings),We.emit("task:refresh",void 0)}}const bn=class bn{constructor(e){b(this,"plugin");b(this,"isInitialized",!1);b(this,"storage");b(this,"repository");b(this,"scheduler");b(this,"eventService");b(this,"settingsService");this.plugin=e}static getInstance(e){if(!bn.instance){if(!e)return null;bn.instance=new bn(e)}return bn.instance}async initialize(){if(this.isInitialized){ze("TaskManager already initialized");return}ne("Initializing TaskManager"),this.settingsService=new sw(this.plugin),await this.settingsService.load();const e=this.settingsService.get();vs.getInstance().initialize(e.globalFilter),oa.getInstance().initialize(e.globalQuery),this.storage=new $_(this.plugin),await this.storage.init(),this.repository=new Y_(this.storage),this.eventService=new tw(this.plugin),await this.eventService.init(),this.scheduler=new K_(this.storage,zo,this.plugin),this.eventService.bindScheduler(this.scheduler),this.isInitialized=!0,ne("TaskManager initialized successfully")}async start(e,t){if(!this.isInitialized)throw new Error("TaskManager must be initialized before starting");e&&this.scheduler.on("task:due",({task:s})=>e(s)),t&&this.scheduler.on("task:overdue",({task:s})=>t(s)),this.scheduler.start(),await this.scheduler.recoverMissedTasks(),ne("TaskManager started")}async destroy(){ne("Destroying TaskManager"),this.scheduler&&this.scheduler.stop(),this.eventService&&await this.eventService.shutdown(),this.storage&&await this.storage.flush(),this.isInitialized=!1,bn.instance=null,ne("TaskManager destroyed")}getStorage(){return this.ensureInitialized(),this.storage}getRepository(){return this.ensureInitialized(),this.repository}getScheduler(){return this.ensureInitialized(),this.scheduler}getEventService(){return this.ensureInitialized(),this.eventService}getSettingsService(){return this.ensureInitialized(),this.settingsService}isReady(){return this.isInitialized}ensureInitialized(){if(!this.isInitialized)throw new Error("TaskManager is not initialized. Call initialize() first.")}};b(bn,"instance",null);let ei=bn;function nw(n){let t=`- [${n.status==="done"?"x":" "}] ${n.name}`;if(n.dueAt){const s=new Date(n.dueAt);t+=`  ${s.toISOString().split("T")[0]}`}return n.frequency&&(t+=`  every ${n.frequency.interval} ${n.frequency.type}${n.frequency.interval>1?"s":""}`),t}class rw{constructor(e,t,s,r){this.storage=e,this.recurrenceEngine=t,this.settings=s,this.siyuanApi=r}async onComplete(e,t){try{const s=[],r=this.addCompletionDate(e,t);let a;return e.frequency&&(a=await this.generateNextInstance(r,t),a&&(await this.placeNextInstance(r,a)||s.push("Could not place next instance in document (API unavailable)"),await this.storage.saveTask(a))),e.onCompletion==="delete"?await this.hasNestedItems(e.linkedBlockId)?(ze("Cannot delete task with nested items",{taskId:e.id,blockId:e.linkedBlockId}),await this.storage.saveTask(r),s.push("Task has nested items - kept instead of deleted")):await this.deleteTask(e):await this.storage.saveTask(r),{success:!0,nextTask:a,warnings:s.length>0?s:void 0}}catch(s){return ye("Failed to handle task completion",{taskId:e.id,error:s}),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}addCompletionDate(e,t){const s={...e},r=t.toISOString();return e.status==="done"&&this.settings.dates.autoAddDone?(s.doneAt=r,s.cancelledAt=void 0):e.status==="cancelled"&&this.settings.dates.autoAddCancelled&&(s.cancelledAt=r,s.doneAt=void 0),s}async generateNextInstance(e,t){if(e.frequency)try{const s=new Date(e.dueAt),r=this.recurrenceEngine.calculateNext(s,e.frequency,{completionDate:t,whenDone:e.frequency.whenDone||e.whenDone}),a=td(e,{dueAt:r.toISOString(),status:"todo",doneAt:void 0,cancelledAt:void 0,linkedBlockId:void 0,linkedBlockContent:void 0});return this.settings.recurrence.removeScheduledOnRecurrence&&(a.scheduledAt=void 0),a}catch(s){ye("Failed to generate next recurrence instance",{taskId:e.id,frequency:e.frequency,error:s});return}}async placeNextInstance(e,t){if(!e.linkedBlockId)return ze("Original task has no linkedBlockId, cannot place next instance"),!1;if(!this.siyuanApi)return ze("SiYuan API not available, cannot place next instance"),!1;const s=this.settings.recurrence.newTaskPosition,r=nw(t);try{let a;return s==="above"&&this.siyuanApi.insertBlockAbove?a=await this.siyuanApi.insertBlockAbove(e.linkedBlockId,r):s==="below"&&this.siyuanApi.insertBlockBelow&&(a=await this.siyuanApi.insertBlockBelow(e.linkedBlockId,r)),a!=null&&a.id?(t.linkedBlockId=a.id,t.linkedBlockContent=r,!0):!1}catch(a){return ye("Failed to place next instance in document",{taskId:e.id,placement:s,error:a}),!1}}async hasNestedItems(e){var t;if(!e||!((t=this.siyuanApi)!=null&&t.getChildBlocks))return!1;try{const s=await this.siyuanApi.getChildBlocks({id:e});return s&&s.length>0}catch(s){return ye("Failed to check for nested items",{blockId:e,error:s}),!1}}async deleteTask(e){var t;if(await this.storage.deleteTask(e.id),e.linkedBlockId&&((t=this.siyuanApi)!=null&&t.deleteBlock))try{await this.siyuanApi.deleteBlock({id:e.linkedBlockId}),ne("Task deleted from document and storage",{taskId:e.id,blockId:e.linkedBlockId})}catch(s){ye("Failed to delete task from document",{taskId:e.id,blockId:e.linkedBlockId,error:s})}else ne("Task deleted from storage only (no linked block)",{taskId:e.id})}}class Rd{constructor(e,t,s,r){b(this,"completionHandler");this.repository=e,this.recurrenceEngine=t,this.getSettings=s,this.siyuanApi=r,t&&s&&(this.completionHandler=new rw(e,t,s(),r))}get settings(){var e;return(e=this.getSettings)==null?void 0:e.call(this)}async toggleStatus(e){var t,s;try{const r=this.repository.getTask(e);if(!r){j.error("Task not found");return}const a=Gs.getInstance(),i=r.statusSymbol||" ",l=a.getNextSymbol(i),c={...r,statusSymbol:l},u=a.getStatus(l);if(u.type==="DONE"){if(c.status="done",r.frequency&&this.completionHandler){const d=await this.completionHandler.onComplete(c,new Date);d.success?(d.nextTask?(ne("Next recurrence created",{taskId:c.id,nextTaskId:d.nextTask.id,nextDue:d.nextTask.dueAt}),j.success("Task completed - next occurrence scheduled")):j.success(`Task status updated to ${u.name}`),d.warnings&&d.warnings.forEach(f=>j.warning(f))):j.error(`Failed to complete task: ${d.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!c.doneAt&&(c.doneAt=new Date().toISOString()),await this.repository.saveTask(c),j.success(`Task status updated to ${u.name}`);We.emit("task:updated",{taskId:e})}else u.type==="CANCELLED"?(c.status="cancelled",(s=this.settings)!=null&&s.dates.autoAddCancelled&&!c.cancelledAt&&(c.cancelledAt=new Date().toISOString()),await this.repository.saveTask(c),We.emit("task:updated",{taskId:e}),j.success(`Task status updated to ${u.name}`)):u.type==="TODO"&&(c.status="todo",await this.repository.saveTask(c),We.emit("task:updated",{taskId:e}),j.success(`Task status updated to ${u.name}`))}catch(r){ye("Failed to toggle task status",r),j.error("Failed to toggle status")}}async completeTask(e){var t;try{const s=this.repository.getTask(e);if(!s){j.error("Task not found");return}const r={...s,status:"done"};if(s.frequency&&this.completionHandler){const a=await this.completionHandler.onComplete(r,new Date);a.success?(a.nextTask?(ne("Next recurrence created",{taskId:r.id,nextTaskId:a.nextTask.id,nextDue:a.nextTask.dueAt}),j.success(`Task "${s.name}" completed - next occurrence scheduled`)):j.success(`Task "${s.name}" completed`),a.warnings&&a.warnings.forEach(i=>j.warning(i))):j.error(`Failed to complete task: ${a.error}`)}else(t=this.settings)!=null&&t.dates.autoAddDone&&!r.doneAt&&(r.doneAt=new Date().toISOString()),await this.repository.saveTask(r),j.success(`Task "${s.name}" completed`);We.emit("task:complete",{taskId:e})}catch(s){ye("Failed to complete task",s),j.error("Failed to complete task")}}async deleteTask(e){try{const t=this.repository.getTask(e);if(!t){j.error("Task not found");return}const r=this.repository.getAllTasks().filter(a=>{var i,l;return((i=a.blockedBy)==null?void 0:i.includes(e))||((l=a.dependsOn)==null?void 0:l.includes(e))});if(r.length>0&&!confirm(`This task is blocking ${r.length} other task(s). Are you sure you want to delete it?`))return;await this.repository.deleteTask(e),We.emit("task:deleted",{taskId:e}),j.success(`Task "${t.name}" deleted`)}catch(t){ye("Failed to delete task",t),j.error("Failed to delete task")}}async rescheduleToToday(e){try{const t=this.repository.getTask(e);if(!t){j.error("Task not found");return}const s=new Date;s.setHours(12,0,0,0);const r={...t,scheduledAt:s.toISOString(),updatedAt:new Date().toISOString()};await this.repository.saveTask(r),We.emit("task:updated",{taskId:e}),j.success("Task rescheduled to today")}catch(t){ye("Failed to reschedule task",t),j.error("Failed to reschedule task")}}async deferTask(e,t){try{const s=this.repository.getTask(e);if(!s){j.error("Task not found");return}const r={...s,updatedAt:new Date().toISOString()};if(s.dueAt){const a=new Date(s.dueAt);a.setDate(a.getDate()+t),r.dueAt=a.toISOString()}if(s.scheduledAt){const a=new Date(s.scheduledAt);a.setDate(a.getDate()+t),r.scheduledAt=a.toISOString()}await this.repository.saveTask(r),We.emit("task:updated",{taskId:e}),j.success(`Task deferred by ${t} day${t!==1?"s":""}`)}catch(s){ye("Failed to defer task",s),j.error("Failed to defer task")}}}class aw{constructor(e,t,s){b(this,"plugin");b(this,"storageKey");b(this,"settings");b(this,"defaults");this.plugin=e,this.storageKey=t,this.defaults={...s},this.settings={...s}}async load(){try{const e=await this.plugin.loadData(this.storageKey);e&&(this.settings={...this.defaults,...e})}catch(e){console.error(`Failed to load settings from ${this.storageKey}:`,e),this.settings={...this.defaults}}return this.settings}async save(e){e&&(this.settings=e);try{await this.plugin.saveData(this.storageKey,this.settings)}catch(t){throw console.error(`Failed to save settings to ${this.storageKey}:`,t),t}}get(){return{...this.settings}}async set(e,t){this.settings[e]=t,await this.save()}async reset(){this.settings={...this.defaults},await this.save()}has(e){return e in this.settings}getValue(e){return this.settings[e]}}const br=[{id:"quickAddTask",langKey:"quickAddTask",label:"Quick add recurring task",description:"Open the quick add dialog with focus on the task title.",defaultHotkey:"Ctrl+Shift+T",context:"Global / Editor"},{id:"markTaskDone",langKey:"markTaskDone",label:"Mark task as done",description:"Complete the focused task and trigger recurrence.",defaultHotkey:"Ctrl+Enter",context:"Task focus / Task block"},{id:"postponeTask",langKey:"postponeTask",label:"Postpone task",description:"Open the snooze selector for the focused task.",defaultHotkey:"Ctrl+Shift+P",context:"Task focus"},{id:"openRecurringTasksDock",langKey:"openRecurringTasksDock",label:"Open recurring tasks dock",description:"Focus the recurring tasks dashboard.",defaultHotkey:"Ctrl+Shift+O",context:"Global"},{id:"createRecurringTask",langKey:"createRecurringTask",label:"Create recurring task from selection",description:"Create a recurring task based on the current editor block.",defaultHotkey:"Ctrl+Shift+R",context:"Editor"},{id:"quickCompleteNextTask",langKey:"quickCompleteNextTask",label:"Quick complete next task",description:"Marks the most overdue task as complete.",defaultHotkey:"Ctrl+Shift+D",context:"Global"},{id:"toggleTaskStatus",langKey:"toggleTaskStatus",label:"Toggle task status",description:"Cycle the status of the focused task.",defaultHotkey:"Ctrl+Shift+X",context:"Task focus"},{id:"openTaskEditor",langKey:"openTaskEditor",label:"Open task editor",description:"Open the full task editor modal.",defaultHotkey:"Ctrl+Shift+E",context:"Global"},{id:"createTaskFromBlock",langKey:"createTaskFromBlock",label:"Create or Edit Task from Block",description:"Parse current block as inline task and open editor with pre-populated data.",defaultHotkey:"Ctrl+Shift+I",context:"Editor / Block"}],qi=br.reduce((n,e)=>(n[e.id]=e.defaultHotkey,n),{});function mo(n,e){We.emit("task:snooze",{taskId:n,minutes:e}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:e}})),ne(`Snoozing task ${n} for ${e} minutes`)}function iw(n){const e=new Date,t=new Date(e);t.setDate(t.getDate()+1);const s=no(t),r=Math.max(0,Math.floor((s.getTime()-e.getTime())/(60*1e3)));We.emit("task:snooze",{taskId:n,minutes:r}),window.dispatchEvent(new CustomEvent("task-snooze",{detail:{taskId:n,minutes:r}})),ne(`Snoozing task ${n} to tomorrow`)}function ow(n){n.eventBus.on("click-blockicon",({detail:e})=>{var i,l,c;const t=e.blockElements;if(!t||t.length===0)return;const s=t[0],r=s==null?void 0:s.getAttribute("data-node-id");if(!r)return;const a=(s==null?void 0:s.textContent)||"";e.menu.addItem({icon:"iconCalendar",label:((i=n.i18n)==null?void 0:i.createRecurringTask)||"Create Recurring Task",click:()=>{We.emit("task:create",{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:yo(a),suggestedTime:bo(a)}),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:{source:"block-menu",linkedBlockId:r,linkedBlockContent:a,suggestedName:yo(a),suggestedTime:bo(a)}}))}});try{const u=ei.getInstance();if(u&&u.isReady()){const f=u.getRepository().getTaskByBlockId(r);if(f){e.menu.addSeparator(),e.menu.addItem({icon:"iconCheck",label:((l=n.i18n)==null?void 0:l.completeTask)||"Complete Task",click:()=>{We.emit("task:complete",{taskId:f.id}),window.dispatchEvent(new CustomEvent("recurring-task-complete",{detail:{taskId:f.id}}))}});const g=[{label:"15 minutes",click:()=>mo(f.id,15)},{label:"1 hour",click:()=>mo(f.id,60)},{label:"Tomorrow",click:()=>iw(f.id)}];e.menu.addItem({icon:"iconClock",label:((c=n.i18n)==null?void 0:c.snoozeTask)||"Snooze Task",submenu:g})}}}catch{ea("TaskManager not available for quick actions")}}),ne("Registered block context menu")}function yo(n){const e=n.split(`
`)[0].trim();return e.length>50?e.substring(0,50)+"...":e}function bo(n){var s;const e=/\b(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?\b/,t=n.match(e);if(t){let r=parseInt(t[1],10);const a=t[2],i=(s=t[3])==null?void 0:s.toUpperCase();return i==="PM"&&r<12?r+=12:i==="AM"&&r===12&&(r=0),`${r.toString().padStart(2,"0")}:${a}`}return null}const lw="recurring-task-shortcuts",cw=350;class uw{constructor(e,t,s,r,a){b(this,"settingsStore");b(this,"settings",{...qi});b(this,"taskCommands");b(this,"cooldownTimers",new Map);this.plugin=e,this.repository=t,this.handlers=a,this.settingsStore=new aw(e,lw,qi),this.taskCommands=new Rd(t,s,r,void 0)}async initialize(){this.settings=await this.settingsStore.load()}registerShortcuts(){br.forEach(e=>{const t=this.settings[e.id]||e.defaultHotkey;this.plugin.addCommand({langKey:e.langKey,hotkey:t,callback:()=>{this.handleShortcut(e.id)}})}),ne("Registered shortcut commands",{shortcuts:br.map(e=>({id:e.id,hotkey:this.settings[e.id]}))})}getShortcutDisplay(){return br.map(e=>({id:e.id,label:e.label,description:e.description,context:e.context,currentHotkey:this.settings[e.id]||"",defaultHotkey:e.defaultHotkey}))}async updateShortcut(e,t){const s=t.trim(),r=this.findDuplicateHotkey(e,s);return r?{success:!1,message:`Hotkey already assigned to "${r.label}".`}:(this.settings={...this.settings,[e]:s},await this.settingsStore.save(this.settings),this.registerShortcuts(),{success:!0})}async resetShortcut(e){const t=this.getDefinition(e);t&&(this.settings={...this.settings,[e]:t.defaultHotkey},await this.settingsStore.save(this.settings),this.registerShortcuts())}async resetAllShortcuts(){this.settings={...qi},await this.settingsStore.save(this.settings),this.registerShortcuts()}destroy(){this.cooldownTimers.forEach(e=>globalThis.clearTimeout(e)),this.cooldownTimers.clear()}async handleShortcut(e){if(!this.shouldIgnoreShortcut(e))switch(e){case"quickAddTask":this.guardCooldown(e,cw,()=>{this.handlers.createTask(this.buildCreatePayload("shortcut"))});break;case"createRecurringTask":this.handlers.createTask(this.buildCreatePayload("shortcut"));break;case"openRecurringTasksDock":this.handlers.openDock();break;case"markTaskDone":{const t=this.resolveTaskId();if(!t)return;await this.handlers.completeTask(t);break}case"postponeTask":{const t=this.resolveTaskId();if(!t)return;this.handlers.postponeTask(t);break}case"quickCompleteNextTask":await this.quickCompleteNextTask();break;case"toggleTaskStatus":{const t=this.resolveTaskId();if(!t)return;await this.taskCommands.toggleStatus(t);break}case"openTaskEditor":this.handlers.openTaskEditor();break;case"createTaskFromBlock":await this.handlers.createTaskFromBlock();break}}guardCooldown(e,t,s){if(this.cooldownTimers.has(e))return;s();const r=globalThis.setTimeout(()=>{this.cooldownTimers.delete(e)},t);this.cooldownTimers.set(e,r)}shouldIgnoreShortcut(e){const t=document.activeElement;if(!t)return!1;const s=t.tagName.toLowerCase();return["input","textarea","select"].includes(s)?!0:t.isContentEditable?!this.isEditorAllowedShortcut(e):!1}isEditorAllowedShortcut(e){return e==="quickAddTask"||e==="createRecurringTask"}resolveTaskId(){const e=this.getFocusedTaskId();if(e)return e;const t=this.getSelectedBlockContext();if(!t)return null;const s=this.repository.getTaskByBlockId(t.blockId);return(s==null?void 0:s.id)??null}getFocusedTaskId(){const e=document.activeElement;if(!e)return null;const t=e.closest("[data-task-id]");return(t==null?void 0:t.dataset.taskId)??null}getSelectedBlockContext(){const e=window.getSelection(),t=e==null?void 0:e.anchorNode;if(!t)return null;const s=t instanceof HTMLElement?t:t.parentElement;if(!s)return null;const r=s.closest("[data-node-id]");if(!r)return null;const a=r.getAttribute("data-node-id");return a?{blockId:a,blockContent:r.textContent||""}:null}buildCreatePayload(e){const t=this.getSelectedBlockContext();return t?{source:e,linkedBlockId:t.blockId,linkedBlockContent:t.blockContent,suggestedName:yo(t.blockContent),suggestedTime:bo(t.blockContent)}:{source:e}}async quickCompleteNextTask(){try{const e=this.repository.getTodayAndOverdueTasks();if(e.length===0)return;const t=e[0];await this.taskCommands.completeTask(t.id)}catch(e){ye("Failed to quick complete task",e),j.error("Failed to complete task")}}getDefinition(e){return br.find(t=>t.id===e)}findDuplicateHotkey(e,t){if(!t)return null;const s=t.toLowerCase(),r=br.find(a=>a.id===e?!1:(this.settings[a.id]||"").toLowerCase()===s);return r?{id:r.id,label:r.label,description:r.description,context:r.context,currentHotkey:this.settings[r.id],defaultHotkey:r.defaultHotkey}:null}}async function dw(n,e,t,s,r){const a=new uw(n,e,s,r,t);return await a.initialize(),a.registerShortcuts(),a}class hw{constructor(e,t){b(this,"plugin");b(this,"repository");b(this,"topbarElement",null);b(this,"updateIntervalId",null);this.plugin=e,this.repository=t}init(){this.createTopbarButton(),this.startAutoUpdate(),ne("Topbar menu initialized")}destroy(){this.updateIntervalId!==null&&(window.clearInterval(this.updateIntervalId),this.updateIntervalId=null),this.topbarElement&&(this.topbarElement.remove(),this.topbarElement=null),ne("Topbar menu destroyed")}createTopbarButton(){const e=this.plugin.addTopBar({icon:"iconCalendar",title:"Recurring Tasks",position:"right",callback:()=>{this.toggleMenu()}});this.topbarElement=e,this.updateBadge()}updateBadge(){if(!this.topbarElement)return;const e=this.repository.getTodayAndOverdueTasks(),t=e.filter(s=>{const r=new Date(s.dueAt);return r<new Date&&!Ho(r)}).length;if(e.length>0){const s=this.topbarElement.querySelector(".b3-badge");if(s)s.textContent=e.length.toString(),s.style.display="block",t>0?s.style.backgroundColor="var(--b3-theme-error)":s.style.backgroundColor="var(--b3-theme-primary)";else{const r=document.createElement("span");r.className="b3-badge",r.textContent=e.length.toString(),r.style.display="block",r.style.backgroundColor=t>0?"var(--b3-theme-error)":"var(--b3-theme-primary)",this.topbarElement.appendChild(r)}}else{const s=this.topbarElement.querySelector(".b3-badge");s&&s.remove()}}toggleMenu(){We.emit("task:settings",{action:"toggle"});const e=new CustomEvent("recurring-task-settings",{detail:{action:"toggle"}});window.dispatchEvent(e)}startAutoUpdate(){this.updateIntervalId=window.setInterval(()=>{this.updateBadge()},60*1e3)}update(){this.updateBadge()}}class fw{constructor(e="tasks"){b(this,"codeLanguage");b(this,"cachedCodeBlocks",new WeakMap);b(this,"cachedAttributeBlocks",new WeakMap);this.codeLanguage=e.toLowerCase()}parse(e){const t=[];let s=this.cachedCodeBlocks.get(e);s||(s=e.querySelectorAll('[data-type="NodeCodeBlock"]'),this.cachedCodeBlocks.set(e,s)),s.forEach(a=>{var d;if((a.dataset.subtype||a.getAttribute("data-subtype")||"").toLowerCase()!==this.codeLanguage)return;const l=a.querySelector("code")||a.querySelector("textarea")||a.querySelector(".hljs")||a,c=((d=l==null?void 0:l.textContent)==null?void 0:d.trim())??"";if(!c)return;const u=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:u,query:c,element:a,source:"code"})});let r=this.cachedAttributeBlocks.get(e);return r||(r=e.querySelectorAll("[data-node-id]"),this.cachedAttributeBlocks.set(e,r)),r.forEach(a=>{if(a.classList.contains("rt-inline-query")||a.getAttribute("data-type")==="NodeCodeBlock")return;const i=this.parseAttributes(a);if(!i.query)return;const l=a.getAttribute("data-node-id")||`inline-query-${t.length}`;t.push({id:l,query:i.query,view:i.view,element:a,source:"attribute"})}),t}parseAttributes(e){var a;const t=e.getAttribute("custom-task-query")||e.getAttribute("data-attr-custom-task-query")||e.dataset.customTaskQuery||e.dataset.attrCustomTaskQuery,s=e.getAttribute("custom-task-view")||e.getAttribute("data-attr-custom-task-view")||e.dataset.customTaskView||e.dataset.attrCustomTaskView;if(t)return{query:t.trim(),view:s};const r=e.getAttribute("data-attrs");if(!r)return{};try{const i=JSON.parse(r),l=(a=i["custom-task-query"])==null?void 0:a.trim(),c=i["custom-task-view"];return{query:l,view:c}}catch{return{}}}}class vw{constructor(e=6e4,t=100){b(this,"cache",new Map);b(this,"metrics",{hits:0,misses:0,evictions:0});b(this,"maxSize");this.ttlMs=e,this.maxSize=t}buildKey(e,t){return`${e}::${t}`}get(e){const t=this.cache.get(e);return t?this.ttlMs>0&&Date.now()-t.updatedAt>this.ttlMs?(this.cache.delete(e),this.metrics.misses++,null):(t.lastAccessedAt=Date.now(),this.cache.delete(e),this.cache.set(e,t),this.metrics.hits++,t):(this.metrics.misses++,null)}set(e,t){this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU();const s=Date.now();this.cache.set(e,{result:t,updatedAt:s,lastAccessedAt:s})}clear(){this.cache.clear()}evictLRU(){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),this.metrics.evictions++)}getMetrics(){return{hits:this.metrics.hits,misses:this.metrics.misses,size:this.cache.size,evictions:this.metrics.evictions}}resetMetrics(){this.metrics.hits=0,this.metrics.misses=0,this.metrics.evictions=0}}class gw{render(e,t){if(e.innerHTML="",e.classList.add("rt-inline-query"),e.dataset.query=t.query,e.dataset.view=t.view,e.setAttribute("role","region"),e.setAttribute("aria-label","Task query results"),t.isIndexing){e.appendChild(this.renderLoadingState());return}if(t.error){e.appendChild(this.renderErrorState(t.error));return}if(!t.result){e.appendChild(this.renderState("No results yet."));return}const s=t.result.tasks,r=s.length;if(r===0||s.length===0){e.appendChild(this.renderEmptyState());return}const a=document.createElement("div");a.className="rt-inline-query__header",a.textContent=`Inline Tasks  ${r}`,e.appendChild(a);const i=t.view||"list",l=t.result.groups;if(l&&l.size>0?l.forEach((c,u)=>{const d=this.renderGroupSection(u,c,i,t);e.appendChild(d)}):e.appendChild(this.renderTaskCollection(s,i,t)),typeof t.maxItems=="number"&&typeof t.renderedCount=="number"&&t.renderedCount<r){const c=document.createElement("div");c.className="rt-inline-query__footer";const u=document.createElement("button");u.type="button",u.className="rt-inline-query__more",u.dataset.rtAction="more",u.textContent=`Show more (${t.renderedCount}/${r})`,c.appendChild(u),e.appendChild(c)}}renderGroupSection(e,t,s,r){const a=document.createElement("section");a.className="rt-inline-query__group";const i=document.createElement("div");return i.className="rt-inline-query__group-title",i.textContent=e||"Untitled",a.appendChild(i),a.appendChild(this.renderTaskCollection(t,s,r)),a}renderTaskCollection(e,t,s){return t==="table"?this.renderTable(e,s):this.renderList(e,s)}renderList(e,t){const s=document.createElement("ul");s.className="rt-inline-query__list",s.setAttribute("role","list"),s.setAttribute("aria-label","Tasks");const r=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(i=>{const l=document.createElement("li");l.className="rt-inline-query__item",l.dataset.taskId=i.id;const c=document.createElement("button");c.type="button",c.className="rt-inline-query__checkbox",c.dataset.rtAction="toggle",c.setAttribute("aria-pressed",String(i.status==="done"));const u=i.status==="done"?`Mark incomplete: ${i.name.replace(/"/g,"'")}`:`Mark complete: ${i.name.replace(/"/g,"'")}`;c.setAttribute("aria-label",u),c.textContent=i.status==="done"?"":"";const d=document.createElement("span");d.className="rt-inline-query__title",d.textContent=i.name,i.status==="done"&&d.classList.add("rt-inline-query__title--done");const f=document.createElement("span");f.className="rt-inline-query__meta",f.textContent=this.formatTaskMeta(i);const g=this.renderSource(i),y=document.createElement("button");y.type="button",y.className="rt-inline-query__edit",y.dataset.rtAction="edit",y.setAttribute("aria-label",`Edit task: ${i.name.replace(/"/g,"'")}`),y.textContent="Edit",l.appendChild(c),l.appendChild(d),l.appendChild(f),g&&l.appendChild(g),l.appendChild(y),r.appendChild(l)}),s.appendChild(r),s}renderTable(e,t){const s=document.createElement("table");s.className="rt-inline-query__table",s.setAttribute("role","table"),s.setAttribute("aria-label","Tasks table");const r=document.createElement("thead"),a=document.createElement("tr");["Status","Task","Dates","Priority","Source",""].forEach(u=>{const d=document.createElement("th");d.textContent=u,a.appendChild(d)}),r.appendChild(a),s.appendChild(r);const i=document.createElement("tbody"),l=document.createDocumentFragment();return this.getRenderedTasks(e,t).forEach(u=>{const d=document.createElement("tr");d.dataset.taskId=u.id;const f=document.createElement("td"),g=document.createElement("button");g.type="button",g.className="rt-inline-query__checkbox",g.dataset.rtAction="toggle",g.setAttribute("aria-pressed",String(u.status==="done"));const y=u.status==="done"?`Mark incomplete: ${u.name.replace(/"/g,"'")}`:`Mark complete: ${u.name.replace(/"/g,"'")}`;g.setAttribute("aria-label",y),g.textContent=u.status==="done"?"":"",f.appendChild(g);const _=document.createElement("td");_.textContent=u.name,u.status==="done"&&_.classList.add("rt-inline-query__title--done");const m=document.createElement("td");m.textContent=this.formatTaskDates(u);const p=document.createElement("td");p.textContent=u.priority??"";const k=document.createElement("td"),S=this.renderSource(u);S?k.appendChild(S):k.textContent="";const D=document.createElement("td"),E=document.createElement("button");E.type="button",E.className="rt-inline-query__edit",E.dataset.rtAction="edit",E.setAttribute("aria-label",`Edit task: ${u.name.replace(/"/g,"'")}`),E.textContent="Edit",D.appendChild(E),d.appendChild(f),d.appendChild(_),d.appendChild(m),d.appendChild(p),d.appendChild(k),d.appendChild(D),l.appendChild(d)}),i.appendChild(l),s.appendChild(i),s}getRenderedTasks(e,t){return t.maxItems?e.slice(0,t.maxItems):e}formatTaskDates(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),t.length>0?t.join("  "):""}formatTaskMeta(e){const t=[];return e.dueAt&&t.push(`Due ${this.formatDate(e.dueAt)}`),e.scheduledAt&&t.push(`Scheduled ${this.formatDate(e.scheduledAt)}`),e.startAt&&t.push(`Start ${this.formatDate(e.startAt)}`),e.priority&&t.push(`Priority ${e.priority}`),t.length>0?t.join("  "):"No dates"}formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString()}catch{return e}}renderSource(e){if(!e.linkedBlockId&&!e.path)return null;const t=document.createElement("a");return t.className="rt-inline-query__source",t.dataset.rtAction="jump",t.dataset.blockId=e.linkedBlockId??"",e.linkedBlockId&&(t.href=`siyuan://blocks/${e.linkedBlockId}`),t.textContent=this.formatSourceLabel(e),t.title=e.path??e.linkedBlockId??"",t}formatSourceLabel(e){if(e.path){const t=e.path.split("/");return t[t.length-1]||e.path}return e.linkedBlockId?"Block":"Source"}renderState(e,t="info"){const s=document.createElement("div");return s.className=`rt-inline-query__state rt-inline-query__state--${t}`,s.textContent=e,s}renderLoadingState(){const e=document.createElement("div");e.className="rt-inline-query__loading",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-label","Loading tasks");const t=document.createElement("div");t.className="rt-inline-query__spinner";const s=document.createElement("div");return s.className="rt-inline-query__loading-text",s.textContent="Building index",e.appendChild(t),e.appendChild(s),e}renderErrorState(e){const t=document.createElement("div");t.className="rt-inline-query__state rt-inline-query__state--error",t.setAttribute("role","alert");const s=document.createElement("div");s.className="rt-inline-query__error-icon",s.textContent="";const r=document.createElement("div");r.className="rt-inline-query__error-message",r.textContent=e;const a=document.createElement("div");return a.className="rt-inline-query__error-hint",a.textContent="Check your query syntax and try again.",t.appendChild(s),t.appendChild(r),t.appendChild(a),t}renderEmptyState(){const e=document.createElement("div");e.className="rt-inline-query__state rt-inline-query__state--empty";const t=document.createElement("div");t.className="rt-inline-query__empty-icon",t.textContent="";const s=document.createElement("div");s.className="rt-inline-query__empty-message",s.textContent="No tasks match this query";const r=document.createElement("div");return r.className="rt-inline-query__empty-hint",r.textContent="Try adjusting your filters or create a new task.",e.appendChild(t),e.appendChild(s),e.appendChild(r),e}}class pw{constructor(e){b(this,"parser",new fw);b(this,"renderer",new gw);b(this,"cache",new vw);b(this,"queryComposer",new md(new nr));b(this,"blocks",new Map);b(this,"refreshTimer");b(this,"indexReady",!1);b(this,"unsubs",[]);b(this,"debounceMs");b(this,"pageSize");this.options=e,this.debounceMs=e.debounceMs??300,this.pageSize=e.pageSize??50}mount(){var r,a,i,l;this.refreshAll();const{plugin:e}=this.options,t=()=>this.scheduleRefresh(),s=()=>this.scheduleRefresh();try{const c=(a=(r=e.eventBus).on)==null?void 0:a.call(r,"loaded-protyle",t),u=(l=(i=e.eventBus).on)==null?void 0:l.call(i,"switch-protyle",s);typeof c=="function"&&this.unsubs.push(c),typeof u=="function"&&this.unsubs.push(u)}catch(c){ze("Inline query controller failed to bind protyle events",c)}this.unsubs.push(We.on("task:refresh",()=>{this.cache.clear(),this.scheduleRefresh()})),this.unsubs.push(We.on("task:settings",()=>{this.cache.clear(),this.scheduleRefresh()}))}destroy(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.blocks.forEach(({container:e})=>e.remove()),this.blocks.clear(),this.unsubs.forEach(e=>e()),this.unsubs=[]}scheduleRefresh(){this.refreshTimer&&globalThis.clearTimeout(this.refreshTimer),this.refreshTimer=globalThis.setTimeout(()=>{this.refreshAll()},this.debounceMs)}refreshAll(){const e=this.getProtyleRoots();if(e.length===0)return;const t=new Set;e.forEach(s=>{this.parser.parse(s).forEach(a=>{t.add(a.id);const i=this.getOrCreateBlockState(a);this.renderBlock(i)})}),Array.from(this.blocks.keys()).forEach(s=>{if(!t.has(s)){const r=this.blocks.get(s);r==null||r.container.remove(),this.blocks.delete(s)}}),this.indexReady=!0}renderBlock(e){const{block:t}=e,s=t.view??"list";if(!this.indexReady){this.renderer.render(e.container,{query:t.query,view:s,isIndexing:!0});return}let r,a;try{a=this.executeQuery(t.query)}catch(l){r=l instanceof Error?l.message:String(l)}const i=a?Math.min(e.renderLimit,a.tasks.length):0;this.renderer.render(e.container,{query:t.query,view:s,result:a,error:r,maxItems:e.renderLimit,renderedCount:i})}executeQuery(e){const t=this.options.settingsService.get(),s=this.buildSettingsHash(t),r=this.cache.buildKey(e,s),a=this.cache.get(r);if(a)return a.result;const i={getAllTasks:()=>this.options.repository.getAllTasks()},l=new pd(i,{urgencySettings:t.urgency}),c=oa.getInstance();if(c.isEnabled()&&c.getError())throw new Error(`Global query error: ${c.getError()}`);const u=this.queryComposer.compose(e,c.getAST()).ast,d=l.execute(u);return this.cache.set(r,d),d}buildSettingsHash(e){try{return JSON.stringify(e)}catch{return String(Date.now())}}getOrCreateBlockState(e){const t=this.blocks.get(e.id);if(t)return t.block=e,t;const s=document.createElement("div");s.dataset.rtInlineQuery=e.id,s.className="rt-inline-query",e.element.insertAdjacentElement("afterend",s),s.addEventListener("click",a=>this.handleContainerClick(a));const r={block:e,container:s,renderLimit:this.pageSize};return this.blocks.set(e.id,r),r}handleContainerClick(e){const t=e.target;if(!t)return;const s=t.closest("[data-rt-action]");if(!s)return;const r=s.dataset.rtAction,a=t.closest(".rt-inline-query");if(!a)return;const i=a.dataset.rtInlineQuery;if(!i)return;const l=this.blocks.get(i);if(!l)return;if(r==="more"){l.renderLimit+=this.pageSize,this.renderBlock(l);return}const c=t.closest("[data-task-id]"),u=c==null?void 0:c.dataset.taskId;if(u){if(r==="toggle"){this.options.onToggleTask(u);return}if(r==="edit"){const d=this.options.repository.getTask(u);d&&this.options.onEditTask(d)}}}getProtyleRoots(){return Array.from(document.querySelectorAll(".protyle-wysiwyg"))}}function Bi(n,e=new Date){if(!n||typeof n!="string")return{error:!0,message:"Empty or invalid date input"};const t=n.trim();if(!t)return{error:!0,message:"Empty date string"};const s=ls.parse(t,e);return s.isValid&&s.date?{date:ls.toISODateString(s.date)}:{error:!0,message:s.error||`Could not parse date: ${n}`}}function mw(n){if(!n||typeof n!="string")return{error:!0,message:"Empty or invalid recurrence text"};const e=n.trim();if(!e)return{error:!0,message:"Empty recurrence string"};let t="scheduled",s=e.toLowerCase();s.includes("when done")?(t="done",s=s.replace(/\s*when\s+done\s*$/i,"").trim()):s.includes("when scheduled")&&(t="scheduled",s=s.replace(/\s*when\s+scheduled\s*$/i,"").trim());const r=Ja.parse(s);if(!r.isValid)return{error:!0,message:r.error||`Could not parse recurrence: ${n}`};if(!r.frequency.rruleString)return{error:!0,message:"Failed to generate RRULE string"};let a=r.frequency.rruleString;return a.startsWith("RRULE:")&&(a=a.substring(6)),{rule:a,mode:t}}function yw(n){try{const e=n.startsWith("RRULE:")?n:`RRULE:${n}`;return le.fromString(e).toText()}catch{return n}}const bw=/^-\s*\[\s*([ x\-])\s*\]/i,kw=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,_w=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,ww=/\s+([^#]+?)(?=\s*(?:||||||||#|$))/,Tw=/\s+(.+?)(?=\s*(?:|||||#|$))/,Lc=//,Fc=//,qc=//,xw=/\s+([a-zA-Z0-9\-_]+)/,Sw=/\s+([a-zA-Z0-9\-_,\s]+)/,Bc=/#([a-zA-Z0-9\-_]+)/g;function tl(n){if(!n||typeof n!="string")return{error:!0,message:"Invalid input: text must be a non-empty string"};const e=n.trim(),t=e.match(bw);if(!t)return{error:!0,message:'Not a checklist item: must start with "- [ ]", "- [x]", or "- [-]"',position:0};const s=t[1].toLowerCase(),r=s==="x"?"done":s==="-"?"cancelled":"todo";let a=e.substring(t[0].length).trim();const i={description:"",status:r},l=a.match(kw);if(l){const m=l[1].trim(),p=Bi(m);if(p.error)return{error:!0,message:`Invalid due date: ${p.message}`,token:m};i.dueDate=p.date,a=a.replace(l[0],"")}const c=a.match(_w);if(c){const m=c[1].trim(),p=Bi(m);if(p.error)return{error:!0,message:`Invalid scheduled date: ${p.message}`,token:m};i.scheduledDate=p.date,a=a.replace(c[0],"")}const u=a.match(ww);if(u){const m=u[1].trim(),p=Bi(m);if(p.error)return{error:!0,message:`Invalid start date: ${p.message}`,token:m};i.startDate=p.date,a=a.replace(u[0],"")}const d=a.match(Tw);if(d){const m=d[1].trim(),p=mw(m);if(p.error)return{error:!0,message:`Invalid recurrence: ${p.message}`,token:m};i.recurrence={rule:p.rule,mode:p.mode},a=a.replace(d[0],"")}Lc.test(a)&&(i.priority="high",a=a.replace(Lc,"")),Fc.test(a)&&(i.priority="medium",a=a.replace(Fc,"")),qc.test(a)&&(i.priority="low",a=a.replace(qc,""));const f=a.match(xw);f&&(i.id=f[1],a=a.replace(f[0],""));const g=a.match(Sw);if(g){const m=g[1].split(",").map(p=>p.trim()).filter(p=>p.length>0);m.length>0&&(i.dependsOn=m),a=a.replace(g[0],"")}const y=[],_=a.matchAll(Bc);for(const m of _)y.push(m[1]);return y.length>0&&(i.tags=y,a=a.replace(Bc,"")),i.description=a.trim(),i}function Nd(n){const e=[],t=n.status==="done"?"x":n.status==="cancelled"?"-":" ";if(e.push(`- [${t}]`),e.push(n.description),n.dueDate&&e.push(` ${n.dueDate}`),n.scheduledDate&&e.push(` ${n.scheduledDate}`),n.startDate&&e.push(` ${n.startDate}`),n.recurrence){const s=yw(n.recurrence.rule),r=n.recurrence.mode==="done"?" when done":"";e.push(` ${s}${r}`)}return n.priority==="high"?e.push(""):n.priority==="medium"?e.push(""):n.priority==="low"&&e.push(""),n.id&&e.push(` ${n.id}`),n.dependsOn&&n.dependsOn.length>0&&e.push(` ${n.dependsOn.join(",")}`),n.tags&&n.tags.length>0&&e.push(...n.tags.map(s=>`#${s}`)),e.join(" ")}function Dw(){const n=window.getSelection(),e=n==null?void 0:n.anchorNode;if(!e)return null;const t=e instanceof HTMLElement?e:e.parentElement;if(!t)return null;const s=t.closest("[data-node-id]");if(!s)return null;const r=s.getAttribute("data-node-id");if(!r)return null;const a=s.textContent||"",i=/^-\s*\[\s*[x\s\-]\s*\]/i.test(a.trim());return{blockId:r,content:a.trim(),isChecklist:i}}const Ui=new Map;function Pd(n,e){ze("Task parse error",{error:n,blockId:e});const t=`Invalid task syntax: ${n.message}`;j.warning(t,5e3),Ew(e),n.token&&ne("Problematic token",{token:n.token}),n.position!==void 0&&ne("Error position",{position:n.position})}function Ew(n){try{const e=document.querySelector(`[data-node-id="${n}"]`);if(e){e.classList.add("task-parse-error");const t=Ui.get(n);t!==void 0&&clearTimeout(t);const s=setTimeout(()=>{const r=document.querySelector(`[data-node-id="${n}"]`);r&&r.classList.remove("task-parse-error"),Ui.delete(n)},5e3);Ui.set(n,s)}}catch(e){ze("Failed to add error class to block",{error:e,blockId:n})}}async function Aw(n){ne("Create task from block command triggered");const e=Dw();if(!e){j.error("No block selected or cursor not in editor"),ze("No block context available");return}ne("Block data extracted",{blockId:e.blockId,isChecklist:e.isChecklist,contentLength:e.content.length});let t=e.content;e.isChecklist||(t=`- [ ] ${t}`,ne("Auto-promoted plain text to checklist"));const s=tl(t);if("error"in s){ne("Parse error occurred, opening editor with raw content",{error:s}),Pd(s,e.blockId);const i=ma(e.content,ci(),new Date);i.linkedBlockId=e.blockId,i.linkedBlockContent=e.content,n.openTaskEditor(i,{name:e.content,status:"todo"});return}ne("Task parsed successfully",{parsed:s});const r=n.repository.getTaskByBlockId(e.blockId);let a;r?(ne("Editing existing task",{taskId:r.id}),a={...r},Ld(a,s)):(ne("Creating new task from block"),a=Cw(s,e.blockId,e.content)),n.openTaskEditor(a)}function Cw(n,e,t){const s=n.dueDate?new Date(n.dueDate):new Date,r=ci(),a=ma(n.description,r,s);return a.linkedBlockId=e,a.linkedBlockContent=t,Ld(a,n),a}function Ld(n,e){n.name=e.description,n.status=e.status,e.dueDate&&(n.dueAt=new Date(e.dueDate).toISOString()),e.scheduledDate&&(n.scheduledAt=new Date(e.scheduledDate).toISOString()),e.startDate&&(n.startAt=new Date(e.startDate).toISOString()),e.priority&&(n.priority=e.priority==="high"?"high":e.priority==="low"?"low":"normal"),e.tags&&(n.tags=e.tags),e.dependsOn&&(n.dependsOn=e.dependsOn),e.recurrence&&(n.recurrenceText=e.recurrence.rule)}class Iw{constructor(e){b(this,"deps");b(this,"debouncedCreateTimeout");b(this,"debouncedCreateInternal",async(e,t)=>{await this.tryAutoCreate(e,t)});b(this,"debouncedCreate",(e,t)=>{this.debouncedCreateTimeout!==void 0&&clearTimeout(this.debouncedCreateTimeout),this.debouncedCreateTimeout=setTimeout(()=>{this.debouncedCreateInternal(e,t),this.debouncedCreateTimeout=void 0},500)});this.deps=e}async handleEnter(e,t){const s=this.deps.settings();if(!s.enableInlineCreation||!s.autoCreateOnEnter){ne("Auto-create on Enter disabled");return}await this.tryAutoCreate(e,t)}async handleBlur(e,t){const s=this.deps.settings();if(!s.enableInlineCreation||!s.autoCreateOnBlur){ne("Auto-create on Blur disabled");return}this.debouncedCreate(e,t)}async tryAutoCreate(e,t){try{const s=this.deps.settings();if(!t.trim().match(/^-\s*\[\s*[x\s\-]\s*\]/i)){ne("Not a checklist, skipping auto-create",{blockId:e});return}const r=this.deps.repository.getTaskByBlockId(e);if(r){ne("Task already exists for block, skipping",{blockId:e,taskId:r.id});return}const a=tl(t);if("error"in a){s.showInlineHints&&Pd(a,e),ze("Parse error during auto-create",{error:a,blockId:e});return}ne("Auto-creating task from block",{blockId:e,parsed:a});const i=this.createTaskFromParsed(a,e,t);if(await this.deps.saveTask(i),ne("Task auto-created successfully",{taskId:i.id,blockId:e}),s.normalizeOnSave&&this.deps.updateBlockContent){const l=Nd(a);l!==t&&(await this.deps.updateBlockContent(e,l),ne("Block content normalized",{blockId:e}))}}catch(s){ye("Auto-create failed",{error:s,blockId:e})}}createTaskFromParsed(e,t,s){const r=ma(e.description||"Untitled Task",ci(),new Date);return r.linkedBlockId=t,r.linkedBlockContent=s,e.dueDate&&(r.due=new Date(e.dueDate)),e.scheduledDate&&(r.scheduled=new Date(e.scheduledDate)),e.startDate&&(r.start=new Date(e.startDate)),e.priority&&(r.priority=e.priority==="high"?1:e.priority==="medium"?2:3),e.tags&&(r.tags=e.tags),e.recurrence&&(r.frequency.recurrenceRule=e.recurrence.rule),r.status=e.status==="done"?"done":e.status==="cancelled"?"cancelled":"todo",r}cleanup(){this.debouncedCreateTimeout!==void 0&&(clearTimeout(this.debouncedCreateTimeout),this.debouncedCreateTimeout=void 0)}}class Mw{constructor(e){b(this,"taskIndex");b(this,"taskCommands");b(this,"parseInlineTask");b(this,"normalizeTask");b(this,"pendingToggles",new Map);b(this,"debounceMs",100);var t,s;this.taskIndex=e.taskIndex,this.taskCommands=e.taskCommands,this.parseInlineTask=((t=e.parser)==null?void 0:t.parseInlineTask)||tl,this.normalizeTask=((s=e.parser)==null?void 0:s.normalizeTask)||Nd}async handleToggle(e,t){const s=this.pendingToggles.get(e);s&&clearTimeout(s);const r=setTimeout(async()=>{await this.processToggle(e,t),this.pendingToggles.delete(e)},this.debounceMs);this.pendingToggles.set(e,r)}async processToggle(e,t){try{const s=this.taskIndex.getByBlockId(e);if(!s){ea("Checkbox toggle on non-managed task",{blockId:e});return}const r=this.getBlockContentFromDOM(e);if(!r){ze("Could not get block content for toggle",{blockId:e});return}const a=this.parseInlineTask(r);if("error"in a){ye("Failed to parse inline task during toggle",{blockId:e,error:a.message});return}const i=this.calculateNewStatus(t,a.status);if(i===s.status){ea("Status unchanged, ignoring toggle",{blockId:e,status:i});return}ne("Processing inline task toggle",{blockId:e,taskId:s.id,oldStatus:s.status,newStatus:i,newChecked:t}),i==="done"?await this.taskCommands.completeTask(s.id):await this.ensureTaskStatus(s.id,i),await this.updateBlockAfterToggle(e,s.id,i)}catch(s){ye("Failed to handle inline toggle",{blockId:e,newChecked:t,error:s}),j.error("Failed to update task")}}calculateNewStatus(e,t){return e?t==="done"?t:"done":t==="todo"?t:"todo"}async ensureTaskStatus(e,t){const s=this.taskIndex.getById(e);if(!s){ze("Task not found when ensuring status",{taskId:e});return}s.status!==t&&await this.taskCommands.toggleStatus(e)}async isManagedTask(e){return this.taskIndex.getByBlockId(e)!==void 0}async updateBlockAfterToggle(e,t,s){try{const r=this.taskIndex.getById(t);if(!r){ze("Task not found after toggle",{taskId:t,blockId:e});return}const a=this.getBlockContentFromDOM(e);if(!a){ze("Block not found after toggle",{blockId:e});return}const i=this.parseInlineTask(a);if("error"in i){ye("Failed to parse block after toggle",{blockId:e,error:i.message});return}const l={...i,status:s,dueDate:r.dueAt?r.dueAt.split("T")[0]:void 0,scheduledDate:r.scheduledAt?r.scheduledAt.split("T")[0]:void 0,startDate:r.startAt?r.startAt.split("T")[0]:void 0},c=this.normalizeTask(l);this.updateBlockContentInDOM(e,c),ea("Block content updated after toggle",{blockId:e,taskId:t,status:s})}catch(r){ye("Failed to update block after toggle",{blockId:e,taskId:t,error:r})}}getBlockContentFromDOM(e){var s;const t=document.querySelector(`[data-node-id="${e}"]`);return t&&((s=t.textContent)==null?void 0:s.trim())||null}updateBlockContentInDOM(e,t){const s=document.querySelector(`[data-node-id="${e}"]`);if(!s){ze("Block element not found for update",{blockId:e});return}const r=s.firstChild;r&&r.nodeType===Node.TEXT_NODE?r.textContent=t:s.textContent=t}destroy(){for(const e of this.pendingToggles.values())clearTimeout(e);this.pendingToggles.clear()}}const sa=class sa extends wo.Plugin{constructor(){super(...arguments);b(this,"taskManager");b(this,"repository");b(this,"scheduler");b(this,"eventService");b(this,"migrationManager");b(this,"topbarMenu");b(this,"settingsService");b(this,"dashboardComponent",null);b(this,"dockEl");b(this,"quickAddComponent",null);b(this,"quickAddContainer",null);b(this,"taskEditorComponent",null);b(this,"taskEditorContainer",null);b(this,"postponeComponent",null);b(this,"postponeContainer",null);b(this,"pendingCompletionTimeouts",new Map);b(this,"shortcutManager",null);b(this,"inlineQueryController",null);b(this,"autoTaskCreator",null);b(this,"inlineToggleHandler",null);b(this,"checkboxClickListener",null);b(this,"autoCreationKeydownHandler",null);b(this,"autoCreationBlurHandler",null);b(this,"handleCreateTaskEvent",t=>{try{const s=t;ne("Create task event received",s.detail),this.openQuickAdd(s.detail)}catch(s){ye("Failed to handle create task event",s),j.error("Failed to open task creator.")}});b(this,"handleSettingsEvent",t=>{try{ne("Settings event received",t.detail),this.openDock()}catch(s){ye("Failed to handle settings event",s),j.error("Failed to open settings.")}});b(this,"handleCompleteTaskEvent",async t=>{try{const s=t,{taskId:r}=s.detail??{};if(!r)throw new Error("Missing taskId for completion event.");await this.handleCompleteTask(r)}catch(s){ye("Failed to complete task",s),j.error("Failed to complete task.")}});b(this,"handleSnoozeTaskEvent",async t=>{try{const s=t,{taskId:r,minutes:a}=s.detail??{};if(!r||typeof a!="number")throw new Error("Missing task snooze details.");await this.handleSnoozeTask(r,a)}catch(s){ye("Failed to snooze task",s),j.error("Failed to snooze task.")}})}async onload(){ne("Loading Recurring Tasks Plugin"),this.migrationManager=new L_(this);try{await this.migrationManager.migrate(Yn)}catch(r){ye("Migration failed, continuing with existing data",r)}const t=ei.getInstance(this);if(!t)throw new Error("TaskManager failed to initialize");this.taskManager=t,await this.taskManager.initialize(),this.repository=this.taskManager.getRepository(),this.scheduler=this.taskManager.getScheduler(),this.eventService=this.taskManager.getEventService();const s=this.taskManager.getSettingsService();this.settingsService=s;try{await this.taskManager.start()}catch(r){ye("Failed to start TaskManager",r)}this.shortcutManager=await dw(this,this.repository,{createTask:r=>this.dispatchCreateTask(r),completeTask:r=>We.emit("task:complete",{taskId:r}),postponeTask:r=>this.openPostponePicker(r),openDock:()=>this.openDock(),openTaskEditor:()=>this.openTaskEditor(),createTaskFromBlock:()=>this.handleCreateTaskFromBlock()},this.scheduler.getRecurrenceEngine(),()=>s.get()),this.addCommand({langString:"switchGlobalFilterProfile",hotkey:"F",callback:async()=>{var d;const a=vs.getInstance().getConfig();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled. Enable it in settings first.",3e3,"info");return}if(a.profiles.length===0){showMessage(this.i18n.noProfiles||"No profiles found. Create one in settings.",3e3,"info");return}const i=new Menu;a.profiles.forEach(f=>{i.addItem({label:f.name,icon:f.id===a.activeProfileId?"iconCheck":"",click:async()=>{await this.switchToProfile(f.id)}})}),i.addSeparator(),i.addItem({label:this.i18n.manageProfiles||"Manage Profiles...",icon:"iconSettings",click:()=>{this.openSettings("global-filter")}});const l=(d=document.activeElement)==null?void 0:d.getBoundingClientRect(),c=l?l.left:window.innerWidth/2,u=l?l.bottom+5:100;i.showAtPosition({x:c,y:u})}}),this.addCommand({langString:"toggleGlobalFilter",hotkey:"",callback:async()=>{const r=vs.getInstance(),a=r.getConfig(),i=!a.enabled;await this.settingsService.update({globalFilter:{...a,enabled:i}}),r.updateConfig({...a,enabled:i}),showMessage(i?this.i18n.globalFilterEnabled||"Global Filter enabled":this.i18n.globalFilterDisabled||"Global Filter disabled",2e3,"info"),We.emit("task:refresh",void 0)}}),this.addCommand({langString:"showGlobalFilterStatus",hotkey:"",callback:async()=>{const r=vs.getInstance(),a=r.getConfig(),i=r.getActiveProfile();if(!a.enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter: Disabled",3e3,"info");return}if(!i){showMessage(this.i18n.noActiveProfile||"No active profile",3e3,"error");return}const l=await this.repository.getAllTasks(),c=l.filter(g=>r.shouldIncludeTask(g)).length,u=l.length-c,d=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Global Filter Status</h3>
            <p><strong>Active Profile:</strong> ${i.name}</p>
            ${i.description?`<p style="color: var(--text-muted); font-size: 0.9em;">${i.description}</p>`:""}
            <p><strong>Included Tasks:</strong> ${c}</p>
            <p><strong>Excluded Tasks:</strong> ${u}</p>
            <p><strong>Total Tasks:</strong> ${l.length}</p>
          </div>
        `;new Dialog({title:"Global Filter Status",content:d,width:"400px"}).open()}}),this.addCommand({langString:"createGlobalFilterProfile",hotkey:"",callback:async()=>{const r=await this.promptForInput(this.i18n.enterProfileName||"Enter profile name:","");if(!r||r.trim()==="")return;const a=vs.getInstance(),i=a.getConfig(),l={id:`profile_${Date.now()}`,name:r.trim(),description:"",includePaths:[],excludePaths:[],includeTags:[],excludeTags:[],includeRegex:void 0,excludeRegex:void 0,regexTargets:["taskText"],excludeStatusTypes:[]},c={...i,profiles:[...i.profiles,l],activeProfileId:l.id};a.updateConfig(c),await this.settingsService.update({globalFilter:c}),showMessage(`Profile "${r}" created and activated`,2e3,"info"),await this.confirmDialog(this.i18n.configureNewProfile||"Configure new profile now?")&&this.openSettings("global-filter")}}),this.addCommand({langString:"explainTaskExclusion",hotkey:"",callback:async()=>{const r=vs.getInstance();if(!r.getConfig().enabled){showMessage(this.i18n.globalFilterDisabled||"Global Filter is disabled",2e3,"info");return}const i=await this.getFocusedTask();if(!i){showMessage(this.i18n.noTaskSelected||"No task selected. Click on a task first.",3e3,"info");return}const l=r.explainTask(i);let c=`
          <div style="padding: 10px;">
            <h3 style="margin: 0 0 10px 0;">Filter Explanation</h3>
            <p><strong>Task:</strong> ${i.name}</p>
        `;l.included?c+=`
            <p style="color: var(--text-success); font-weight: 600;"> Task is INCLUDED</p>
            <p>${l.reason}</p>
          `:(c+=`
            <p style="color: var(--text-error); font-weight: 600;"> Task is EXCLUDED</p>
            <p><strong>Reason:</strong> ${l.reason}</p>
          `,l.matchedRule&&(c+=`
              <p><strong>Matched Rule:</strong></p>
              <ul style="margin-left: 20px;">
                <li><strong>Type:</strong> ${l.matchedRule.type}</li>
                <li><strong>Pattern:</strong> <code>${l.matchedRule.pattern}</code></li>
                ${l.matchedRule.target?`<li><strong>Target:</strong> ${l.matchedRule.target}</li>`:""}
              </ul>
            `)),c+="</div>",new Dialog({title:"Task Filter Explanation",content:c,width:"500px"}).open()}}),ow(this),this.topbarMenu=new hw(this,this.repository),this.topbarMenu.init(),this.addDock({config:{position:"RightBottom",size:{width:400,height:600},icon:"iconCalendar",title:"Recurring Tasks"},data:null,type:Ev,init:r=>{this.dockEl=r.element,this.renderDashboard()},destroy:()=>{this.destroyDashboard()}}),this.addEventListeners(),this.inlineQueryController=new pw({plugin:this,repository:this.repository,settingsService:this.settingsService,onEditTask:r=>this.openTaskEditor(r),onToggleTask:r=>We.emit("task:complete",{taskId:r})}),this.inlineQueryController.mount(),this.autoTaskCreator=new Iw({repository:this.repository,settings:()=>this.settingsService.get().inlineTasks,saveTask:async r=>{await this.repository.createTask(r)}}),this.setupAutoCreationEventHandlers(),this.setupInlineToggleHandler(),ne("Recurring Tasks Plugin loaded successfully")}async onunload(){ne("Unloading Recurring Tasks Plugin"),this.pendingCompletionTimeouts.forEach(t=>{globalThis.clearTimeout(t)}),this.pendingCompletionTimeouts.clear(),this.taskManager&&await this.taskManager.destroy(),this.topbarMenu&&this.topbarMenu.destroy(),this.autoTaskCreator&&this.autoTaskCreator.cleanup(),this.inlineToggleHandler&&this.inlineToggleHandler.destroy(),this.checkboxClickListener&&(document.removeEventListener("click",this.checkboxClickListener,!0),this.checkboxClickListener=null),this.destroyDashboard(),this.closeQuickAdd(),this.closeTaskEditor(),this.closePostponePicker(),this.removeEventListeners(),this.shortcutManager&&(this.shortcutManager.destroy(),this.shortcutManager=null),this.inlineQueryController&&(this.inlineQueryController.destroy(),this.inlineQueryController=null)}renderDashboard(){this.dockEl&&!this.dashboardComponent&&(this.dashboardComponent=Da(x_,{target:this.dockEl,props:{repository:this.repository,scheduler:this.scheduler,eventService:this.eventService,shortcutManager:this.shortcutManager,settingsService:this.settingsService}}))}destroyDashboard(){this.dashboardComponent&&(Ea(this.dashboardComponent),this.dashboardComponent=null)}addEventListeners(){try{We.on("task:create",t=>{ne("Create task event received",t),this.openQuickAdd(t)}),We.on("task:complete",async t=>{await this.handleCompleteTask(t.taskId)}),We.on("task:snooze",async t=>{await this.handleSnoozeTask(t.taskId,t.minutes)}),We.on("task:settings",()=>{this.openDock()}),We.on("task:refresh",()=>{}),window.addEventListener("recurring-task-create",this.handleCreateTaskEvent),window.addEventListener("recurring-task-settings",this.handleSettingsEvent),window.addEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.addEventListener("task-snooze",this.handleSnoozeTaskEvent)}catch(t){ye("Failed to add event listeners",t),this.removeEventListeners()}}removeEventListeners(){We.clear(),window.removeEventListener("recurring-task-create",this.handleCreateTaskEvent),window.removeEventListener("recurring-task-settings",this.handleSettingsEvent),window.removeEventListener("recurring-task-complete",this.handleCompleteTaskEvent),window.removeEventListener("task-snooze",this.handleSnoozeTaskEvent),this.autoCreationKeydownHandler&&document.removeEventListener("keydown",this.autoCreationKeydownHandler),this.autoCreationBlurHandler&&document.removeEventListener("focusout",this.autoCreationBlurHandler,!0)}setupAutoCreationEventHandlers(){this.autoTaskCreator&&(this.autoCreationKeydownHandler=t=>{if(t.key!=="Enter")return;const r=t.target.closest("[data-node-id]");if(!r)return;const a=r.getAttribute("data-node-id"),i=r.textContent||"";!a||!sa.CHECKLIST_PATTERN.test(i.trim())||this.autoTaskCreator.handleEnter(a,i.trim())},this.autoCreationBlurHandler=t=>{const r=t.target.closest("[data-node-id]");if(!r)return;const a=r.getAttribute("data-node-id"),i=r.textContent||"";!a||!sa.CHECKLIST_PATTERN.test(i.trim())||this.autoTaskCreator.handleBlur(a,i.trim())},document.addEventListener("keydown",this.autoCreationKeydownHandler),document.addEventListener("focusout",this.autoCreationBlurHandler,!0),ne("Auto-creation event handlers registered"))}setupInlineToggleHandler(){const t=this.settingsService.get();if(!t.inlineTasks.enableInlineToggle){ne("Inline toggle handler disabled in settings");return}const s=new Rd(this.repository,this.scheduler.getRecurrenceEngine(),()=>this.settingsService.get(),void 0);this.inlineToggleHandler=new Mw({taskIndex:this.taskManager.getTaskIndex(),taskCommands:s}),this.checkboxClickListener=async r=>{const a=r.target;if(a.tagName==="INPUT"&&a.type==="checkbox"){const i=a.closest("[data-node-id]");if(!i)return;const l=i.getAttribute("data-node-id");if(!l)return;const c=a.checked;this.inlineToggleHandler.handleToggle(l,c).catch(u=>{ye("Failed to handle inline toggle",u),t.inlineTasks.showToggleNotifications&&j.error("Failed to update task")})}},document.addEventListener("click",this.checkboxClickListener,!0),ne("Inline toggle handler setup complete")}async handleCompleteTask(t){const s=this.repository.getTask(t);if(s){if(this.pendingCompletionTimeouts.has(t)){j.info(`Completion already pending for "${s.name}".`);return}const r=globalThis.setTimeout(async()=>{this.pendingCompletionTimeouts.delete(t);try{await this.eventService.handleTaskCompleted(s),await this.scheduler.markTaskDone(t),this.topbarMenu&&this.topbarMenu.update(),We.emit("task:refresh",void 0),ne(`Task completed: ${s.name}`)}catch(i){ye("Failed to finalize task completion",i),j.error("Failed to complete task.")}},5e3);this.pendingCompletionTimeouts.set(t,r);const a=()=>{const i=this.pendingCompletionTimeouts.get(t);i&&(globalThis.clearTimeout(i),this.pendingCompletionTimeouts.delete(t),j.info(`Undo: "${s.name}" restored`))};Wn({message:`Task "${s.name}" completed.`,type:"success",duration:5e3,actionLabel:"Undo",onAction:a,showCountdown:!0})}}async handleSnoozeTask(t,s){const r=this.repository.getTask(t);r&&(await this.eventService.handleTaskSnoozed(r),await this.scheduler.delayTask(t,s),this.topbarMenu&&this.topbarMenu.update(),ne(`Task snoozed: ${r.name} for ${s} minutes`))}openQuickAdd(t){this.quickAddComponent&&this.closeQuickAdd(),this.quickAddContainer=document.createElement("div"),document.body.appendChild(this.quickAddContainer),this.quickAddComponent=Da(I_,{target:this.quickAddContainer,props:{repository:this.repository,prefill:t,onClose:()=>this.closeQuickAdd(),onAdvanced:()=>{this.closeQuickAdd(),this.openTaskEditor()}}})}openPostponePicker(t){const s=this.repository.getTask(t);if(!s){j.error("Task not found");return}this.postponeComponent&&this.closePostponePicker(),this.postponeContainer=document.createElement("div"),document.body.appendChild(this.postponeContainer),this.postponeComponent=Da(R_,{target:this.postponeContainer,props:{taskName:s.name,onClose:()=>this.closePostponePicker(),onSelect:r=>{mo(t,r),this.closePostponePicker()}}})}closePostponePicker(){this.postponeComponent&&(Ea(this.postponeComponent),this.postponeComponent=null),this.postponeContainer&&(this.postponeContainer.remove(),this.postponeContainer=null)}dispatchCreateTask(t){We.emit("task:create",t),window.dispatchEvent(new CustomEvent("recurring-task-create",{detail:t}))}closeQuickAdd(){this.quickAddComponent&&(Ea(this.quickAddComponent),this.quickAddComponent=null),this.quickAddContainer&&(this.quickAddContainer.remove(),this.quickAddContainer=null)}openTaskEditor(t){this.taskEditorComponent&&this.closeTaskEditor(),this.taskEditorContainer=document.createElement("div"),document.body.appendChild(this.taskEditorContainer),this.taskEditorComponent=Da(Ad,{target:this.taskEditorContainer,props:{repository:this.repository,task:t,onClose:()=>this.closeTaskEditor(),onSave:()=>{window.dispatchEvent(new CustomEvent("recurring-task-refresh"))}}})}closeTaskEditor(){this.taskEditorComponent&&(Ea(this.taskEditorComponent),this.taskEditorComponent=null),this.taskEditorContainer&&(this.taskEditorContainer.remove(),this.taskEditorContainer=null)}async handleCreateTaskFromBlock(){const t=new Od;await Aw({repository:this.repository,blockApi:t,openTaskEditor:(s,r)=>{this.openTaskEditor(s)}})}async switchToProfile(t){const s=vs.getInstance(),r=s.getConfig(),a=r.profiles.find(i=>i.id===t);if(!a){showMessage(this.i18n.profileNotFound||"Profile not found",2e3,"error");return}s.setActiveProfile(t),await this.settingsService.update({globalFilter:{...r,activeProfileId:t}}),showMessage(`Switched to profile: ${a.name}`,2e3,"info"),We.emit("task:refresh",void 0)}openSettings(t){const s=new SettingsDialog(this,this.settingsService);t&&s.openToSection(t),s.open()}async promptForInput(t,s){return new Promise(r=>{var l;const a=new Dialog({title:t,content:`
          <div style="padding: 10px;">
            <input 
              type="text" 
              id="input-value" 
              value="${s}" 
              style="width: 100%; padding: 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px;"
            />
          </div>
        `,width:"400px"});(l=a.element.querySelector("#input-value"))==null||l.addEventListener("keypress",c=>{var u;if(c.key==="Enter"){const d=(u=a.element.querySelector("#input-value"))==null?void 0:u.value;a.destroy(),r(d||null)}});const i=a.element.querySelector(".b3-dialog__footer");if(i){const c=document.createElement("button");c.textContent="OK",c.className="b3-button b3-button--primary",c.onclick=()=>{var f;const d=(f=a.element.querySelector("#input-value"))==null?void 0:f.value;a.destroy(),r(d||null)};const u=document.createElement("button");u.textContent="Cancel",u.className="b3-button",u.onclick=()=>{a.destroy(),r(null)},i.appendChild(u),i.appendChild(c)}a.open()})}async confirmDialog(t){return new Promise(s=>{const r=new Dialog({title:"Confirm",content:`<div style="padding: 10px;">${t}</div>`,width:"350px"}),a=r.element.querySelector(".b3-dialog__footer");if(a){const i=document.createElement("button");i.textContent="Yes",i.className="b3-button b3-button--primary",i.onclick=()=>{r.destroy(),s(!0)};const l=document.createElement("button");l.textContent="No",l.className="b3-button",l.onclick=()=>{r.destroy(),s(!1)},a.appendChild(l),a.appendChild(i)}r.open()})}async getFocusedTask(){const t=document.activeElement,s=t==null?void 0:t.getAttribute("data-task-id");return s?this.repository.getTask(s)||null:(this.taskEditorComponent,null)}};b(sa,"CHECKLIST_PATTERN",/^-\s*\[\s*[x\s\-]\s*\]/i);let ko=sa;module.exports=ko;
